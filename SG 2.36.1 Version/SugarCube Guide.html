<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>SugarCube Guide</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.36.1): A free (gratis and libre) story format.

Copyright © 2013–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/1.2.20171210/classList.js */
"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",i=t.Element[n],s=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},a=function(t,e){if(""===e)throw new c("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(e))throw new c("INVALID_CHARACTER_ERR","The token must not contain space characters.");return o.call(t,e)},l=function(t){for(var e=r.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],i=0,s=n.length;s>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},u=l[n]=[],h=function(){return new l(this)};if(c[n]=Error[n],u.item=function(t){return this[t]||null},u.contains=function(t){return~a(this,t+"")},u.add=function(){var t,e=arguments,n=0,i=e.length,s=!1;do t=e[n]+"",~a(this,t)||(this.push(t),s=!0);while(++n<i);s&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,i=0,s=n.length,r=!1;do for(t=n[i]+"",e=a(this,t);~e;)this.splice(e,1),r=!0,e=a(this,t);while(++i<s);r&&this._updateClassName()},u.toggle=function(t,e){var n=this.contains(t),i=n?e!==!0&&"remove":e!==!1&&"add";return i&&this[i](t),e===!0||e===!1?e:!n},u.replace=function(t,e){var n=a(t+"");~n&&(this.splice(n,1,e),this._updateClassName())},u.toString=function(){return this.join(" ")},s.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(i,e,f)}catch(p){void 0!==p.number&&-2146823252!==p.number||(f.enumerable=!1,s.defineProperty(i,e,f))}}else s[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self),function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,i=arguments.length;for(n=0;i>n;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(t,e){var n=this.toString().split(" "),i=n.indexOf(t+"");~i&&(n=n.slice(i),this.remove.apply(this,n),this.add(e),this.add.apply(this,n.slice(1)))}),t=null}());
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2020 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.14/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},j="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,$=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},F="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?$(t):T.call(t)===F};var N;var C=String.prototype.valueOf,k=function tryStringObject(t){try{C.call(t);return true}catch(r){return false}},A="[object String]";N=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?k(t):T.call(t)===A};var R=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var P=function(t){var r;if(R){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var Z=function Empty(){};P(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){Z.prototype=r.prototype;a.prototype=new Z;Z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var H=d.bind(n.toString);var W=d.bind(s);var B=g.bind(s);if(typeof document==="object"&&document&&document.documentElement){try{W(document.documentElement.childNodes)}catch(X){var L=W;var q=B;W=function arraySliceIE(t){var r=[];var e=t.length;while(e-- >0){r[e]=t[e]}return q(r,L(arguments,1))};B=function arraySliceApplyIE(t,r){return q(W(t),r)}}}var K=d.bind(f.slice);var Q=d.bind(f.split);var V=d.bind(f.indexOf);var _=d.bind(v);var tt=d.bind(n.propertyIsEnumerable);var rt=d.bind(r.sort);var et=t.isArray||function isArray(t){return H(t)==="[object Array]"};var nt=[].unshift(0)!==1;P(r,{unshift:function(){h.apply(this,arguments);return this.length}},nt);P(t,{isArray:et});var it=e("a");var at=it[0]!=="a"||!(0 in it);var ot=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};P(r,{forEach:function forEach(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=-1;var i=z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!ot(r.forEach));P(r,{map:function map(r){var e=z.ToObject(this);var n=at&&N(this)?Q(this,""):e;var i=z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!ot(r.map));P(r,{filter:function filter(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){_(i,a)}}}return i}},!ot(r.filter));P(r,{every:function every(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!ot(r.every));P(r,{some:function some(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!ot(r.some));var ft=false;if(r.reduce){ft=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduce:function reduce(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!ft);var ut=false;if(r.reduceRight){ut=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduceRight:function reduceRight(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!ut);var lt=r.indexOf&&[0,1].indexOf(1,2)!==-1;P(r,{indexOf:function indexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},lt);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;P(r,{lastIndexOf:function lastIndexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},st);var ct=function(){var t=[1,2];var r=t.splice();return t.length===2&&et(r)&&r.length===0}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ct);var vt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=W(arguments);if(e.length<2){_(e,this.length-t)}else{e[1]=z.ToInteger(r)}}return c.apply(this,e)}},!vt);var ht=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var pt=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();P(r,{splice:function splice(t,r){var e=z.ToObject(this);var n=[];var i=z.ToUint32(e.length);var a=z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=arguments.length===0?0:arguments.length===1?i-f:b(w(z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=W(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!ht||!pt);var yt=r.join;var dt;try{dt=Array.prototype.join.call("123",",")!=="1,2,3"}catch(X){dt=true}if(dt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(N(this)?Q(this,""):this,r)}},dt)}var gt=[1,2].join(undefined)!=="1,2";if(gt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(this,r)}},gt)}var wt=function push(t){var r=z.ToObject(this);var e=z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var bt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:function push(t){if(et(this)){return v.apply(this,arguments)}return wt.apply(this,arguments)}},bt);var Tt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:wt},Tt);P(r,{slice:function(t,r){var e=N(this)?Q(this,""):this;return B(e,arguments)}},at);var mt=function(){try{[1,2].sort(null)}catch(t){try{[1,2].sort({})}catch(r){return false}}return true}();var Dt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var St=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();P(r,{sort:function sort(t){if(typeof t==="undefined"){return rt(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return rt(this,t)}},mt||!St||!Dt);var xt=!tt({toString:null},"toString");var Ot=tt(function(){},"prototype");var Et=!G("x","0");var jt=function(t){var r=t.constructor;return r&&r.prototype===t};var It={$applicationCache:true,$console:true,$external:true,$frame:true,$frameElement:true,$frames:true,$innerHeight:true,$innerWidth:true,$onmozfullscreenchange:true,$onmozfullscreenerror:true,$outerHeight:true,$outerWidth:true,$pageXOffset:true,$pageYOffset:true,$parent:true,$scrollLeft:true,$scrollTop:true,$scrollX:true,$scrollY:true,$self:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$window:true,$width:true,$height:true,$top:true,$localStorage:true};var Mt=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!It["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){jt(window[t])}}catch(r){return true}}return false}();var Ut=function(t){if(typeof window==="undefined"||!Mt){return jt(t)}try{return jt(t)}catch(r){return false}};var $t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ft=$t.length;var Nt=function isArguments(t){return H(t)==="[object Arguments]"};var Ct=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!et(t)&&D(t.callee)};var kt=Nt(arguments)?Nt:Ct;P(e,{keys:function keys(t){var r=D(t);var e=kt(t);var n=t!==null&&typeof t==="object";var i=n&&N(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=Ot&&r;if(i&&Et||e){for(var u=0;u<t.length;++u){_(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){_(a,o(l))}}}if(xt){var s=Ut(t);for(var c=0;c<Ft;c++){var v=$t[c];if(!(s&&v==="constructor")&&G(t,v)){_(a,v)}}}return a}});var At=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Pt=e.keys;P(e,{keys:function keys(t){if(kt(t)){return Pt(W(t))}else{return Pt(t)}}},!At||Rt);var Jt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var Yt=new Date(-0x55d318d56a724);var zt=new Date(14496624e5);var Zt=Yt.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Gt;var Ht;var Wt=Yt.getTimezoneOffset();if(Wt<-720){Gt=Yt.toDateString()!=="Tue Jan 02 -45875";Ht=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}else{Gt=Yt.toDateString()!=="Mon Jan 01 -45875";Ht=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}var Bt=d.bind(Date.prototype.getFullYear);var Xt=d.bind(Date.prototype.getMonth);var Lt=d.bind(Date.prototype.getDate);var qt=d.bind(Date.prototype.getUTCFullYear);var Kt=d.bind(Date.prototype.getUTCMonth);var Qt=d.bind(Date.prototype.getUTCDate);var Vt=d.bind(Date.prototype.getUTCDay);var _t=d.bind(Date.prototype.getUTCHours);var tr=d.bind(Date.prototype.getUTCMinutes);var rr=d.bind(Date.prototype.getUTCSeconds);var er=d.bind(Date.prototype.getUTCMilliseconds);var nr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var ir=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ar=function daysInMonth(t,r){return Lt(new Date(r,t,0))};P(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Xt(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);var e=Lt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);if(t<0&&Kt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);var e=Qt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e}},Jt);P(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Vt(this);var r=Qt(this);var e=Kt(this);var n=qt(this);var i=_t(this);var a=tr(this);var o=rr(this);return nr[t]+", "+(r<10?"0"+r:r)+" "+ir[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Jt||Zt);P(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n}},Jt||Gt);if(Jt||Ht){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(R){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var or=-621987552e5;var fr="-000001";var ur=Date.prototype.toISOString&&new Date(or).toISOString().indexOf(fr)===-1;var lr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var sr=d.bind(Date.prototype.getTime);P(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(sr(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=qt(this);var r=Kt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,Qt(this),_t(this),tr(this),rr(this)];t=(t<0?"-":t>9999?"+":"")+K("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=K("00"+e[n],-2)}return t+"-"+W(e,0,2).join("-")+"T"+W(e,2).join(":")+"."+K("000"+er(this),-3)+"Z"}},ur||lr);var cr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(or).toJSON().indexOf(fr)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!cr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var vr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var hr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var pr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pr||hr||!vr){var yr=Math.pow(2,31)-1;var dr=Y(new Date(1970,0,1,0,0,0,yr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(dr&&s>=7&&l>yr){var p=Math.floor(l/yr)*yr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){P(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(dr&&n>yr){var i=Math.floor(n/yr)*yr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}P(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;P(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};P(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var gr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(1000000000000000128).toFixed(0)!=="1000000000000000128");var wr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<wr.size){n+=t*wr.data[e];wr.data[e]=n%wr.base;n=Math.floor(n/wr.base)}},divide:function divide(t){var r=wr.size;var e=0;while(--r>=0){e+=wr.data[r];wr.data[r]=Math.floor(e/t);e=e%t*wr.base}},numToString:function numToString(){var t=wr.size;var r="";while(--t>=0){if(r!==""||t===0||wr.data[t]!==0){var e=o(wr.data[t]);if(r===""){r=e}else{r+=K("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var br=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=wr.log(e*wr.pow(2,69,1))-69;f=a<0?e*wr.pow(2,-a,1):e/wr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){wr.multiply(0,f);l=r;while(l>=7){wr.multiply(1e7,0);l-=7}wr.multiply(wr.pow(10,l,1),0);l=a-1;while(l>=23){wr.divide(1<<23);l-=23}wr.divide(1<<l);wr.multiply(1,1);wr.divide(2);i=wr.numToString()}else{wr.multiply(0,f);wr.multiply(1<<-a,0);i=wr.numToString()+K("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+K("0.0000000000000000000",0,r-s+2)+i}else{i=n+K(i,0,s-r)+"."+K(i,s-r)}}else{i=n+i}return i};P(l,{toFixed:br},gr);var Tr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var mr=l.toPrecision;P(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?mr.call(this):mr.call(this,t)}},Tr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return Q(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){_(a,K(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,W(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){_(a,"")}}else{_(a,K(i,f))}return a.length>p?W(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return Q(this,t,r)}}var Dr=f.replace;var Sr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){_(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!Sr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Dr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;_(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Dr.call(this,t,i)}}}var xr=f.substr;var Or="".substr&&"0b".substr(-1)!=="b";P(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return xr.call(this,e,r)}},Or);var Er="\t\n\x0B\f\r \xa0\u1680\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var jr="\u200b";var Ir="["+Er+"]";var Mr=new RegExp("^"+Ir+Ir+"*");var Ur=new RegExp(Ir+Ir+"*$");var $r=f.trim&&(Er.trim()||!jr.trim());P(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Mr,"").replace(Ur,"")}},$r);var Fr=d.bind(String.prototype.trim);var Nr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;P(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=V(K(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Nr);var Cr=f.lastIndexOf;P(f,{lastIndexOf:function lastIndexOf(t){return Cr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Er+"08")!==8||parseInt(Er+"0x16")!==22){parseInt=function(t){var r=/^[-+]?0[xX]/;return function parseInt(e,n){if(typeof e==="symbol"){""+e}var i=Fr(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Fr(String(r));var n=t(e);return n===0&&K(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var kr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=kr}if(R){var Ar=function(t,r){if(tt(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};Ar(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}Ar(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Rr=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Rr}});
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.4/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var L=Math.exp;var F=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(F(1+t)/(1+t-1))};var Q=function isArguments(e){return g(e)==="[object Arguments]"};var ee=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var te=Q(arguments)?Q:ee;var re={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var ne=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var oe=typeof $==="function"&&typeof $["for"]==="function"&&re.symbol($());var ie=re.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ie="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ae=S.Reflect;var ue=String;var fe=typeof document==="undefined"||!document?null:document.all;var se=fe==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==fe};var ce={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!ce.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===fe},ToObject:function(e,t){return Object(ce.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return ce.IsCallable(e)},ToInt32:function(e){return ce.ToNumber(e)>>0},ToUint32:function(e){return ce.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=ce.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=ce.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return ce.TypeIsObject(e)&&(typeof e[ie]!=="undefined"||te(e))},GetIterator:function(e){if(te(e)){return new q(e,"value")}var t=ce.GetMethod(e,ie);if(!ce.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=ce.Call(t,e);if(!ce.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=ce.ToObject(e)[t];if(se(r)){return void 0}if(!ce.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ce.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=ce.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!ce.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ce.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=ce.IteratorNext(e);var r=ce.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ae.construct){return ae.construct(e,t,o)}var i=o.prototype;if(!ce.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=ce.Call(e,a,t);return ce.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!ce.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(se(n)){return t}if(!ce.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=ce.ToString(e);var i="<"+t;if(r!==""){var a=ce.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!ce.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return re.regex(e)},ToString:function ToString(e){return ue(e)}};if(s&&oe){var le=function defineWellKnownSymbol(e){if(re.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!re.symbol($.search)){var pe=le("search");var ve=String.prototype.search;h(RegExp.prototype,pe,function search(e){return ce.Call(ve,e,[this])});var ye=function search(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,pe);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(ve,t,[ce.ToString(e)])};ne(String.prototype,"search",ye)}if(!re.symbol($.replace)){var he=le("replace");var be=String.prototype.replace;h(RegExp.prototype,he,function replace(e,t){return ce.Call(be,e,[this,t])});var ge=function replace(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,he);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(be,r,[ce.ToString(e),t])};ne(String.prototype,"replace",ge)}if(!re.symbol($.split)){var de=le("split");var me=String.prototype.split;h(RegExp.prototype,de,function split(e,t){return ce.Call(me,e,[this,t])});var Oe=function split(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,de);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(me,r,[ce.ToString(e),t])};ne(String.prototype,"split",Oe)}var we=re.symbol($.match);var je=we&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!we||je){var Se=le("match");var Te=String.prototype.match;h(RegExp.prototype,Se,function match(e){return ce.Call(Te,e,[this])});var Ie=function match(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,Se);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(Te,t,[ce.ToString(e)])};ne(String.prototype,"match",Ie)}}var Ee=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Pe=function(){return this};var Ce=function(e){if(s&&!z(e,J)){m.getter(e,J,Pe)}};var Me=function(e,t){var r=t||function iterator(){return this};h(e,ie,r);if(!e[ie]&&re.symbol(ie)){e[ie]=r}};var xe=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ne=function createDataPropertyOrThrow(e,t,r){xe(e,t,r);if(!ce.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ae=function(e,t,r,n){if(!ce.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!ce.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;ne(String,"fromCodePoint",function fromCodePoint(e){return ce.Call(Re,this,arguments)})}var _e={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ce.SameValue(r,ce.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=ce.ToObject(e,"bad callSite");var r=ce.ToObject(t.raw,"bad raw value");var n=r.length;var o=ce.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=ce.ToString(a);s=ce.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=ce.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){ne(String,"raw",_e.raw)}b(String,_e);var ke=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Le=Infinity;var Fe={repeat:function repeat(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);if(r<0||r>=Le){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return ke(t,r)},startsWith:function startsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=ce.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(ce.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=ce.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:ce.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(ce.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=ce.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){ne(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var De=i(function(){return"/a/".startsWith(/a/)});var ze=a(function(){return"abc".startsWith("a",Infinity)===false});if(!De||!ze){ne(String.prototype,"startsWith",Fe.startsWith);ne(String.prototype,"endsWith",Fe.endsWith)}}if(oe){var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!qe){ne(String.prototype,"startsWith",Fe.startsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!We){ne(String.prototype,"endsWith",Fe.endsWith)}var Ge=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!Ge){ne(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var He=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Ve=new RegExp("(^["+He+"]+)|(["+He+"]+$)","g");var Be=function trim(){return ce.ToString(ce.RequireObjectCoercible(this)).replace(Ve,"")};var Ue=["\x85","\u200b","\ufffe"].join("");var $e=new RegExp("["+Ue+"]","g");var Je=/^[-+]0x[0-9a-f]+$/i;var Xe=Ue.trim().length!==Ue.length;h(String.prototype,"trim",Be,Xe);var Ke=function(e){return{value:e,done:arguments.length===0}};var Ze=function(e){ce.RequireObjectCoercible(e);this._s=ce.ToString(e);this._i=0};Ze.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ke()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ke(e.substr(t,o))};Me(Ze.prototype);Me(String.prototype,function(){return new Ze(this)});var Ye={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!ce.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(te(e)||ce.GetMethod(e,ie))!=="undefined";var u,f,s;if(a){f=ce.IsConstructor(r)?Object(new r):[];var c=ce.GetIterator(e);var l,p;s=0;while(true){l=ce.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){ce.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=ce.ToObject(e);u=ce.ToLength(y.length);f=ce.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ne(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!ce.IsCallable(t)?new Array(e):ce.Construct(t,[e]);for(var o=0;o<e;++o){Ne(n,o,arguments[o])}n.length=e;return n}};b(Array,Ye);Ce(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=ce.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ke(o)}}this.array=void 0;return Ke()}});Me(q.prototype);var Qe=Array.of===Ye.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Qe){ne(Array,"of",Ye.of)}var et={copyWithin:function copyWithin(e,t){var r=ce.ToObject(this);var n=ce.ToLength(r.length);var o=ce.ToInteger(e);var i=ce.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:ce.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ce.ToObject(this);var o=ce.ToLength(n.length);t=ce.ToInteger(typeof t==="undefined"?0:t);r=ce.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!ce.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ce.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]){b(Array.prototype,{values:Array.prototype[ie]});if(re.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var tt=Array.prototype.values;ne(Array.prototype,"values",function values(){return ce.Call(tt,this,arguments)});h(Array.prototype,ie,Array.prototype.values,true)}b(Array.prototype,et);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Me(Object.getPrototypeOf([].values()))}var rt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var nt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!rt||!nt){ne(Array,"from",Ye.from)}var ot=function(){return a(function(){return Array.from([0],void 0)})}();if(!ot){var it=Array.from;ne(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return ce.Call(it,this,arguments)}else{return t(it,this,e)}})}var at=-(Math.pow(2,32)-1);var ut=function(e,r){var n={length:at};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!ut(Array.prototype.forEach)){var ft=Array.prototype.forEach;ne(Array.prototype,"forEach",function forEach(e){return ce.Call(ft,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.map)){var st=Array.prototype.map;ne(Array.prototype,"map",function map(e){return ce.Call(st,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.filter)){var ct=Array.prototype.filter;ne(Array.prototype,"filter",function filter(e){return ce.Call(ct,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.some)){var lt=Array.prototype.some;ne(Array.prototype,"some",function some(e){return ce.Call(lt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.every)){var pt=Array.prototype.every;ne(Array.prototype,"every",function every(e){return ce.Call(pt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduce)){var vt=Array.prototype.reduce;ne(Array.prototype,"reduce",function reduce(e){return ce.Call(vt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduceRight,true)){var yt=Array.prototype.reduceRight;ne(Array.prototype,"reduceRight",function reduceRight(e){return ce.Call(yt,this.length>=0?this:[],arguments)},true)}var ht=Number("0o10")!==8;var bt=Number("0b10")!==2;var gt=y(Ue,function(e){return Number(e+0+e)===0});if(ht||bt||gt){var dt=Number;var mt=/^0b[01]+$/i;var Ot=/^0o[0-7]+$/i;var wt=mt.test.bind(mt);var jt=Ot.test.bind(Ot);var St=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(re.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(re.primitive(t)){return t}}throw new TypeError("No default value")};var Tt=$e.test.bind($e);var It=Je.test.bind(Je);var Et=function(){var e=function Number(t){var r;if(arguments.length>0){r=re.primitive(t)?t:St(t,"number")}else{r=0}if(typeof r==="string"){r=ce.Call(Be,r);if(wt(r)){r=parseInt(C(r,2),2)}else if(jt(r)){r=parseInt(C(r,2),8)}else if(Tt(r)||It(r)){r=NaN}}var n=this;var o=a(function(){dt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new dt(r)}return dt(r)};return e}();Ee(dt,Et,{});b(Et,{NaN:dt.NaN,MAX_VALUE:dt.MAX_VALUE,MIN_VALUE:dt.MIN_VALUE,NEGATIVE_INFINITY:dt.NEGATIVE_INFINITY,POSITIVE_INFINITY:dt.POSITIVE_INFINITY});Number=Et;m.redefine(S,"Number",Et)}var Pt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Pt,MIN_SAFE_INTEGER:-Pt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&ce.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){ne(Array.prototype,"find",et.find)}if([,1].findIndex(function(){return true})!==0){ne(Array.prototype,"findIndex",et.findIndex)}var Ct=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Mt=function ensureEnumerable(e,t){if(s&&Ct(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var xt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Nt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var At=function(e,t){var r=n(Object(t));var o;if(ce.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Ct(t))}return p(P(r,o||[]),Nt(t),e)};var Rt={assign:function(e,t){var r=ce.ToObject(e,"Cannot convert undefined or null to object");return p(ce.Call(xt,1,arguments),At,r)},is:function is(e,t){return ce.SameValue(e,t)}};var _t=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(_t){ne(Object,"assign",Rt.assign)}b(Object,Rt);if(s){var kt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!ce.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||ce.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,kt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Lt=!i(function(){return Object.keys("foo")});if(!Lt){var Ft=Object.keys;ne(Object,"keys",function keys(e){return Ft(ce.ToObject(e))});n=Object.keys}var Dt=i(function(){return Object.keys(/a/g)});if(Dt){var zt=Object.keys;ne(Object,"keys",function keys(e){if(re.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return zt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var qt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!qt){var Wt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Gt=Object.getOwnPropertyNames;ne(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=ce.ToObject(e);if(g(t)==="[object Window]"){try{return Gt(t)}catch(r){return P([],Wt)}}return Gt(t)})}}if(Object.getOwnPropertyDescriptor){var Ht=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Ht){var Vt=Object.getOwnPropertyDescriptor;ne(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Vt(ce.ToObject(e),t)})}}if(Object.seal){var Bt=!i(function(){return Object.seal("foo")});if(!Bt){var Ut=Object.seal;ne(Object,"seal",function seal(e){if(!ce.TypeIsObject(e)){return e}return Ut(e)})}}if(Object.isSealed){var $t=!i(function(){return Object.isSealed("foo")});if(!$t){var Jt=Object.isSealed;ne(Object,"isSealed",function isSealed(e){if(!ce.TypeIsObject(e)){return true}return Jt(e)})}}if(Object.freeze){var Xt=!i(function(){return Object.freeze("foo")});if(!Xt){var Kt=Object.freeze;ne(Object,"freeze",function freeze(e){if(!ce.TypeIsObject(e)){return e}return Kt(e)})}}if(Object.isFrozen){var Zt=!i(function(){return Object.isFrozen("foo")});if(!Zt){var Yt=Object.isFrozen;ne(Object,"isFrozen",function isFrozen(e){if(!ce.TypeIsObject(e)){return true}return Yt(e)})}}if(Object.preventExtensions){var Qt=!i(function(){return Object.preventExtensions("foo")});if(!Qt){var er=Object.preventExtensions;ne(Object,"preventExtensions",function preventExtensions(e){if(!ce.TypeIsObject(e)){return e}return er(e)})}}if(Object.isExtensible){var tr=!i(function(){return Object.isExtensible("foo")});if(!tr){var rr=Object.isExtensible;ne(Object,"isExtensible",function isExtensible(e){if(!ce.TypeIsObject(e)){return false}return rr(e)})}}if(Object.getPrototypeOf){var nr=!i(function(){return Object.getPrototypeOf("foo")});if(!nr){var or=Object.getPrototypeOf;ne(Object,"getPrototypeOf",function getPrototypeOf(e){return or(ce.ToObject(e))})}}var ir=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ce.IsCallable(e.get)}();if(s&&!ir){var ar=function flags(){if(!ce.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ar)}var ur=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var fr=oe&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var sr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var cr=sr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!sr||!cr){var lr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=ce.RequireObjectCoercible(this);if(re.regex(e)){return t(lr,e)}var r=ue(e.source);var n=ue(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,lr)}if(s&&(!ur||fr)){var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var yr=function(){return this.source};var hr=ce.IsCallable(vr.get)?vr.get:yr;var br=RegExp;var gr=function(){return function RegExp(e,t){var r=ce.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(re.regex(e)){o=ce.Call(hr,e);i=typeof t==="undefined"?ce.Call(pr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new br(e,t)}}();Ee(br,gr,{$input:true});RegExp=gr;m.redefine(S,"RegExp",gr)}if(s){var dr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(dr),function(e){if(e in RegExp&&!(dr[e]in RegExp)){m.getter(RegExp,dr[e],function get(){return RegExp[e]})}})}Ce(RegExp);var mr=1/Number.EPSILON;var Or=function roundTiesToEven(e){return e+mr-mr};var wr=Math.pow(2,-23);var jr=Math.pow(2,127)*(2-wr);var Sr=Math.pow(2,-126);var Tr=Math.E;var Ir=Math.LOG2E;var Er=Math.LOG10E;var Pr=Number.prototype.clz;delete Number.prototype.clz;var Cr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Y(t-1+D(1-r)*t)}var n=t/2;return Y(n+D(1-r)*n-1)+1/Ir},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=k(t);var n=r*r;var o=Z(t);if(r<1){return o*Y(r+n/(D(n+1)+1))}return o*(Y(r/2+D(1+1/n)*r/2-1)+1/Ir)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(X(t)||t<-1||t>1){return NaN}var r=k(t);return Z(t)*Y(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=L(F(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=ce.ToUint32(t);if(r===0){return 32}return Pr?ce.Call(Pr,r):31-_(F(r+.5)*Ir)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}var r=L(k(t)-1);return(r+1/(r*Tr*Tr))*(Tr/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return L(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return F(e)*Ir},log10:function log10(e){return F(e)*Er},log1p:Y,sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=k(t);if(r<1){var n=Math.expm1(r);return Z(t)*n*(1+1/(n+1))/2}var o=L(r-1);return Z(t)*(o-1/(o*Tr*Tr))*(Tr/2)},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=ce.ToUint32(e);var n=ce.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<Sr){return r*Or(n/Sr/wr)*Sr*wr}var o=(1+wr/Number.EPSILON)*n;var i=o-(o-n);if(i>jr||X(i)){return r*Infinity}return r*i}};var Mr=function withinULPDistance(e,t,r){return k(1-e/t)/Number.EPSILON<(r||8)};b(Math,Cr);h(Math,"sinh",Cr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",Cr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",Cr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Cr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"asinh",Cr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",Cr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",Cr.tanh,Math.tanh(-2e-17)!==-2e-17);
h(Math,"acosh",Cr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",Cr.acosh,!Mr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",Cr.cbrt,!Mr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",Cr.sinh,Math.sinh(-2e-17)!==-2e-17);var xr=Math.expm1(10);h(Math,"expm1",Cr.expm1,xr>22025.465794806718||xr<22025.465794806718);var Nr=Math.round;var Ar=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Rr=mr+1;var _r=2*mr-1;var kr=[Rr,_r].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Ar||!kr);m.preserveToString(Math.round,Nr);var Lr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Cr.imul;m.preserveToString(Math.imul,Lr)}if(Math.imul.length!==2){ne(Math,"imul",function imul(e,t){return ce.Call(Lr,Math,arguments)})}var Fr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}ce.IsPromise=function(e){if(!ce.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!ce.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(ce.IsCallable(t.resolve)&&ce.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&ce.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=ce.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(ce.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!ce.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!ce.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!ce.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ae(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=ce.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=ce.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(ce.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!ce.IsPromise(n)){throw new TypeError("not a promise")}var o=ce.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=ce.IsCallable(e)?e:a;var d=ce.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Fr==="function"){b(S,{Promise:Fr});var Dr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var zr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,W)});var qr=i(function(){return S.Promise.call(3,W)});var Wr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(n){return true}return t===r}(S.Promise);var Gr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Hr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Hr.prototype=Promise.prototype;Hr.all=Promise.all;var Vr=a(function(){return!!Hr.all([1,2])});if(!Dr||!zr||!qr||Wr||!Gr||Vr){Promise=Fr;ne(S,"Promise",Fr)}if(Promise.all.length!==1){var Br=Promise.all;ne(Promise,"all",function all(e){return ce.Call(Br,this,arguments)})}if(Promise.race.length!==1){var Ur=Promise.race;ne(Promise,"race",function race(e){return ce.Call(Ur,this,arguments)})}if(Promise.resolve.length!==1){var $r=Promise.resolve;ne(Promise,"resolve",function resolve(e){return ce.Call($r,this,arguments)})}if(Promise.reject.length!==1){var Jr=Promise.reject;ne(Promise,"reject",function reject(e){return ce.Call(Jr,this,arguments)})}Mt(Promise,"all");Mt(Promise,"race");Mt(Promise,"resolve");Mt(Promise,"reject");Ce(Promise)}var Xr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Kr=Xr(["z","a","bb"]);var Zr=Xr(["z",1,"a","3",2]);if(s){var Yr=function fastkey(e,t){if(!t&&!Kr){return null}if(se(e)){return"^"+ce.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Zr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Qr=function emptyObject(){return Object.create?Object.create(null):{}};var en=function addIterableToMap(e,n,o){if(r(o)||re.string(o)){l(o,function(e){if(!ce.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!se(o)){a=n.set;if(!ce.IsCallable(a)){throw new TypeError("bad map")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!ce.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){ce.IteratorClose(i,true);throw s}}}}};var tn=function addIterableToSet(e,n,o){if(r(o)||re.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!se(o)){a=n.add;if(!ce.IsCallable(a)){throw new TypeError("bad set")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){ce.IteratorClose(i,true);throw s}}}}};var rn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!ce.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ce.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ke()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ke(n)}}this.i=void 0;return Ke()}};Me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ae(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Qr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){en(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Yr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Yr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(ce.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Yr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(ce.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=Yr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(ce.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Qr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!ce.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+ce.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ae(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Qr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){tn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new rn.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Yr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Yr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=Yr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Qr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Me(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};Me(f.prototype);return i}()};var nn=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(nn){S.Set=rn.Set}if(S.Map||S.Set){var on=a(function(){return new Map([[1,2]]).get(1)===2});if(!on){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var an=new Map;var un=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var fn=an.set(1,2)===an;if(!un||!fn){ne(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!un){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var sn=new Set;var cn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(sn);var ln=sn.add(1)===sn;if(!cn||!ln){var pn=Set.prototype.add;Set.prototype.add=function add(e){t(pn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,pn)}if(!cn){var vn=Set.prototype.has;Set.prototype.has=function has(e){return t(vn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,vn);var yn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],yn)}var hn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||bn||!gn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var dn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var mn=Object.setPrototypeOf&&!dn;var On=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||mn||!On){var wn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new wn;if(arguments.length>0){tn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=wn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,wn)}var jn=new S.Map;var Sn=!a(function(){return jn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||jn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof jn.keys().next!=="function"||Sn||!hn){b(S,{Map:rn.Map,Set:rn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Me(Object.getPrototypeOf((new S.Map).keys()));Me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var Tn=S.Set.prototype.has;ne(S.Set.prototype,"has",function has(e){return t(Tn,this,e)})}}b(S,rn);Ce(S.Map);Ce(S.Set)}var In=function throwUnlessTargetIsObject(e){if(!ce.TypeIsObject(e)){throw new TypeError("target must be an object")}};var En={apply:function apply(){return ce.Call(ce.Call,null,arguments)},construct:function construct(e,t){if(!ce.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!ce.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return ce.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){In(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){In(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(En,{ownKeys:function ownKeys(e){In(e);var t=Object.getOwnPropertyNames(e);if(ce.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Pn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(En,{isExtensible:function isExtensible(e){In(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){In(e);return Pn(function(){return Object.preventExtensions(e)})}})}if(s){var Cn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Cn(o,t,r)}if("value"in n){return n.value}if(n.get){return ce.Call(n.get,r)}return void 0};var Mn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Mn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!ce.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ae.defineProperty(o,r,{value:n})}else{return ae.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(En,{defineProperty:function defineProperty(e,t,r){In(e);return Pn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){In(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){In(e);var r=arguments.length>2?arguments[2]:e;return Cn(e,t,r)},set:function set(e,t,r){In(e);var n=arguments.length>3?arguments[3]:e;return Mn(e,t,r,n)}})}if(Object.getPrototypeOf){var xn=Object.getPrototypeOf;En.getPrototypeOf=function getPrototypeOf(e){In(e);return xn(e)}}if(Object.setPrototypeOf&&En.getPrototypeOf){var Nn=function(e,t){var r=t;while(r){if(e===r){return true}r=En.getPrototypeOf(r)}return false};Object.assign(En,{setPrototypeOf:function setPrototypeOf(e,t){In(e);if(t!==null&&!ce.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ae.getPrototypeOf(e)){return true}if(ae.isExtensible&&!ae.isExtensible(e)){return false}if(Nn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var An=function(e,t){if(!ce.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){ne(S.Reflect,e,t)}}};Object.keys(En).forEach(function(e){An(e,En[e])});var Rn=S.Reflect.getPrototypeOf;if(c&&Rn&&Rn.name!=="getPrototypeOf"){ne(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(Rn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){ne(S.Reflect,"setPrototypeOf",En.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){ne(S.Reflect,"defineProperty",En.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){ne(S.Reflect,"construct",En.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var _n=Date.prototype.toString;var kn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return ce.Call(_n,this)};ne(Date.prototype,"toString",kn)}var Ln={anchor:function anchor(e){return ce.CreateHTML(this,"a","name",e)},big:function big(){return ce.CreateHTML(this,"big","","")},blink:function blink(){return ce.CreateHTML(this,"blink","","")},bold:function bold(){return ce.CreateHTML(this,"b","","")},fixed:function fixed(){return ce.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return ce.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return ce.CreateHTML(this,"font","size",e)},italics:function italics(){return ce.CreateHTML(this,"i","","")},link:function link(e){return ce.CreateHTML(this,"a","href",e)},small:function small(){return ce.CreateHTML(this,"small","","")},strike:function strike(){return ce.CreateHTML(this,"strike","","")},sub:function sub(){return ce.CreateHTML(this,"sub","","")},sup:function sub(){return ce.CreateHTML(this,"sup","","")}};l(Object.keys(Ln),function(e){var r=String.prototype[e];var n=false;if(ce.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){ne(String.prototype,e,Ln[e])}});var Fn=function(){if(!oe){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var Dn=a(function(){if(!oe){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(Fn||!Dn){var zn=JSON.stringify;ne(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=ce.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(re.symbol(n)){return Nt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return zn.apply(this,o)})}return S});
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}("undefined"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t="object"==typeof e&&"number"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return"string"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),"function"==typeof t?r=t:i(this.options,t),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/dist/FileSaver.js */
(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:500000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url('data:application/octet-stream;base64,d09GRgABAAAAADLAAA8AAAAAWHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY+IEkIY21hcAAAAdgAAAG8AAAF3rob9jFjdnQgAAADlAAAABMAAAAgBtX/BGZwZ20AAAOoAAAFkAAAC3CKkZBZZ2FzcAAACTgAAAAIAAAACAAAABBnbHlmAAAJQAAAI6gAADv+gJOpzGhlYWQAACzoAAAAMwAAADYY1IZaaGhlYQAALRwAAAAgAAAAJAfCBClobXR4AAAtPAAAAJEAAAFMBfb/0WxvY2EAAC3QAAAAqAAAAKhjiHI5bWF4cAAALngAAAAgAAAAIAFjDA9uYW1lAAAumAAAAY0AAAL94+zEpHBvc3QAADAoAAACHAAAA11cG/YjcHJlcAAAMkQAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZNZgnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4vGF4EMgf9z2KIYg5imAYUZgTJAQDSIQumAHic7dTVbltRAETR7dpNCikzQ8rMzMxt/M39mHnsU1/TfZz5jFpaV7pXJunMDLAZmOqaZjD5y4Tx+uPTyeL5lG2L5zN+L94zG8+ztr7ulXH1fra4bvK9M79xiWW2sNXPbWeFHexkF7vZw172sZ8DHOQQhznCUY5xnBOc5BSnOcNZVjnHeS5wkUtc5gpX/f3r3OAmt7jNHe5yj/s84CGPeMwTnvKM57zgJa94zRve8o73fOAjn/jMF77yje/84Ce/WGPun1zi/2tlXKbp3Xyc44bFyZanSWokJDXOOjXSk/LUSXn+pEwCKTNBaqQqZU5IjX+XMjukTBEp80TKZJEyY6RMGylzR8oEkjKLpEwlKfNJyqSSMrOkTC8pc0zKRJMy26RMOSnzTsrkk7IDpGwDKXtByoaQsiukbA0p+0PKJpGyU6RsFyl7RmosQcrukbKFpOwjKZtJyo6Ssq2k7C0pG0zKLpOy1aTsNymbTsrOk7L9pNwBUi4CKbeBlCtByr0g5XKQckNIuSak3BVSLgwpt4aUq0PK/SHlEpFyk0i5TqTcKVIuFim3i5QrRso9I+WykXLjXOYNzP8BuAPUwHicY2BAAxIQyBz0PwuEARJsA90AeJytVml300YUHXlJnIQsJQstamHExGmwRiZswYAJQbJjIF2crZWgixQ76b7xid/gX/Nk2nPoN35a7xsvJJC053Cak6N3583VzNtlElqS2AvrkZSbL8XU1iaN7DwJ6YZNy1F8KDt7IWWKyd8FURCtltq3HYdERCJQta6wRBD7HlmaZHzoUUbLtqRXTcotPekuW+NBvVXffho6yrE7oaRmM3RoPbIlVRhVokimPVLSpmWo+itJK7y/wsxXzVDCiE4iabwZxtBI3htntMpoNbbjKIpsstwoUiSa4UEUeZTVEufkigkMygfNkPLKpxHlw/yIrNijnFawS7bT/L4vead3OT+xX29RtuRAH8iO7ODsdCVfhFtbYdy0k+0oVBF213dCbNnsVP9mj/KaRgO3KzK90IxgqXyFECs/ocz+IVktnE/5kkejWrKRE0HrZU7sSz6B1uOIKXHNGFnQ3dEJEdT9kjMM9pg+Hvzx3imWCxMCeBzLekclnAgTKWFzNEnaMHJgJWWLKqn1rpg45XVaxFvCfu3a0ZfOaONQd2I8Ww8dWzlRyfFoUqeZTJ3aSc2jKQ2ilHQmeMyvAyg/oklebWM1iZVH0zhmxoREIgIt3EtTQSw7saQpBM2jGb25G6a5di1apMkD9dyj9/TmVri501PaDvSzRn9Wp2I62AvT6WnkL/Fp2uUiRen66Rl+TOJB1gIykS02w5SDB2/9DtLL15YchdcG2O7t8yuofdZE8KQB+xvQHk/VKQlMhZhViFZAYq1rWZbJ1awWqcjUd0OaVr6s0wSKchwXx76Mcf1fMzOWmBK+34nTsyMuPXPtSwjTHHybdT2a16nFcgFxZnlOp1mW7+s0x/IDneZZntfpCEtbp6MsP9RpgeVHOh1jeUELmnTfwZCLMOQCDpAwhKUDQ1hegiEsFQxhuQhDWBZhCMslGMLyYxjCchmGsLysZdXUU0nj2plYBmxCYGKOHrnMReVqKrlUQrtoVGpDnhJulVQUz6p/ZaBePPKGObAWSJfIml8xzpWPRuX41hUtbxo7V8Cx6m8fjvY58VLWi4U/Bf/V1lQlvWLNw5Or8BuGnmwnqjapeHRNl89VPbr+X1RUWAv0G0iFWCjKsmxwZyKEjzqdhmqglUPMbMw8tOt1y5qfw/03MUIWUP34NxQaC9yDTllJWe3grNXX27LcO4NyOBMsSTE38/pW+CIjs9J+kVnKno98HnAFjEpl2GoDrRW82ScxD5neJM8EcVtRNkja2M4EiQ0c84B5850EJmHqqg3kTuGGDfgFYW7BeSdconqjLIfuRezzKKT8W6fiRPaoaIzAs9kbYa/vQspvcQwkNPmlfgxUFaGpGDUV0DRSbqgGX8bZum1Cxg70Iyp2w7Ks4sPHFveVkm0ZhHykiNWjo5/WXqJOqtx+ZhSX752+BcEgNTF/e990cZDKu1rJMkdtA1O3GpVT15pD41WH6uZR9b3j7BM5a5puuiceel/TqtvBxVwssPZtDtJSJhfU9WGFDaLLxaVQ6mU0Se+4BxgWGNDvUIqN/6v62HyeK1WF0XEk307Ut9HnYAz8D9h/R/UD0Pdj6HINLs/3mhOfbvThbJmuohfrp+g3MGutuVm6BtzQdAPiIUetjrjKDXynBnF6pLkc6SHgY90V4gHAJoDF4BPdtYzmUwCj+Yw5PsDnzGHQZA6DLeYw2GbOGsAOcxjsMofBHnMYfMGcdYAvmcMgZA6DiDkMnjAnAHjKHAZfMYfB18xh8A1z7gN8yxwGMXMYJMxhsK/p1jDMLV7QXaC2QVWgA1NPWNzD4lBTZcj+jheG/b1BzP7BIKb+qOn2kPoTLwz1Z4OY+otBTP1V050h9TdeGOrvBjH1D4OY+ky/GMtlBr+MfJcKB5RdbD7n74n3D9vFQLkAAQAB//8AD3icrXsLcFzlleZ//v+++nb37dfte/VotVrdrW5JltuKpO6WJVluPyXbsmOEbGRjO4KVjWPZlsM4QIU4IYGlgCE2yxqKIQkJg2GreKQCTCZb1CZkiswjzOwOmSTATNVWTZLdDUwSMrVDsomD23vOf69assFAqgbk+773P4//nPOdc/5mwNjFl8WjosbaWblmxiOmIlTGYXzb11M7Z2ohAMbZCcZ5iG9prZl4whfwGju05xtttitUdwXYEUgkbQtWga5lC+XBaqJI285qpb8dVEc8Gnm5L5QM/f58yAlB399a7dD0mWAmdAqaMvBmKPKX9TdDwSjod9yhx03FAPcvI6Gk2lV33XoXUtKgL8C6Wa0WSzXbVjhg6JoqIPShCK0FOvOuE48K1V4B1VUQAVevugmP7Fz2CmTzW5/8+ZGP/+Kp7h/8oI4MuOZ7M5B9IvujH2Wf+PnCAjzn8ZK6AieMKRcvXnxWWSWCzGARlPcqtqs21WZzEBFgYIVDAYWzVJIrXBlH+hXGlWNM00GAJmYZ8sKBzTJFVZVppijqDFMVdTIWLa0o5JrdaHusPZGIG1IjFhQGK2mAZEe56kJnR1bTY7ZT7eivFGODBTdma3pHtlCNDVbwmgMHx/aO4R8ffeet5/ZCG6TfuV03IaSJU3oIzKsGO9+5PV+BwU5xqnOQx1aO8fW71yvD9fPn55/fA22PmsaFvfSgwZ8wzPiFvZ2DUMnzJ2hHVDMmHucPsSRrq7UQo4DMAV/AW7CANw/Zru3NIx20bBEpXwukArlxxOPReibaG63/SyQyiftzcBy3k1HuOHgjEgFHnkYfh4VodDJC4138Ff8hv5PlWbrWmm2O6grNEgGNCWGnbFtRm1Z04gzQPPWvkqMWF4eWU8DB267Df+gNe84bBvfRpfNI5Ny5yAmHDh5/PPLuByMlekDS9DsRR73nWHetwBShSO5PqCBQONO4E2wGlSvYZG6gMzeQ09SWFZC0tWION3oOVVXGTbGM+hrAzQj0O25yoN8R8YzzRsaZdzLwhpsGPEm783hAJ9+kq286eDX5pn/VydDjvk7i8EuchU21JJ3DNOqFzeABmywPcNXxhu/wB+3whrqwVw7Cn1j8vPfdDH6O7PR3fDV/Cb85wua/waSit309grZJHHOhHEQ9CA7zTGVCUb0ZvXzc1lrRe5Af+4An0aSL9op0IU9y6vRFtAYGKy7KJGFbQrdg2dXqGAwWilld0zUy9xLqd6A/zeFuy7gzYFmBOwOhZ6NNhZakm8YTI7S1pyM1mM032V26qevXGlzZ8+TKvROlB/BBkO9ACDalB7OZuBnuC5tRcAItpalENNOfhajVH1A2a1HjbHZ4N4r54oWLz4qPoe4jrMo2sonapm5QRQBQ3XycKVxwRRxjQuVCnWc6mrzOZ5FvBiraOmia5FubYRpok8n0ioRTKOQMNbWiszxYWAFZrQ1sB+dDJTFYghzyiBN3oB857ndIAha4Se/+YGUtjAkXXUO2xPE2eoe3TWPeMOXmzNi+j9w1HghvVbSAmu4c6nFac6MgbzXFU2baDr1241+98TfHtU/9t7df+MzU4msmfPYj06Wbw8Gqohda0/FkSyiyvtPGG/FsMKq1pLqmPvndkye/+y+08eYIHEJZpFmJra2Nop/VWuKcCwPvgRhnGlOFps6iIdAEmFVAKh53jblZyBU6nAFdbfX03tGwioZ9oGnEyDSWTQCyFzhoR+s/jdjgWLmc3L2K21zEmXCsM5aDm4g9Ny5v0PZVb+dY9Rcd/sl5eTiPj0nTaeiU+BhhW2qbuzJcUy2Nc2gCrjBkxWCqZiArGgOuwSzjAlDb5L91XfpvfYbpij6ZRIUWYoVcLqC2+UqNLddsMrekY3GZztVl2uQjpl4xjedIM+Uybc/r5viShuHgcgXuwQtpuoMHz8utCe/s8S+Y/7xMaYu2DX1yDrez3lp3cyyKdop+HLcLi878Uh9SKOSlj73cOIUFRVKVKHhaSS9JP452RCcYoJ3w85bz8Ckp9VN4xeZj9atpH4FnPCV4OtiDNIVYCrWwsbauK81VxUlaQnA+riFBisoUsiU0LbQpASCmmRAwg1MNJoH19uQ6WpriUV1jIQjphA5QjosiTfiy1tF+kPJKMTFYpAu6lkx40odnTv7VjYtC/QtTJyGH9HmMnKamGrcaqmaagRsMUwR9WeLmwsQREvIRevSvYa8uVFXo9Sc0w5A8/Rp5+jcxhXLuYAOIx/pbY+ggFp0FV8lNoLNAEQvyDkwBZR9T1ZC6xR0qFgsybix3DJcR7iIGwCsCHHQM0nYKVSBXQZPnqG7KDZiqrn8K524gpN9ghAx42k4GsvF3nohnA0kbnglkC9mrl7h4Db2TommKcVE1QOPRd97K5WJxsKO5nIjHbHtx/og3kK8iWys1he/EkKlqCbFOB6iKQp5Q5Yp6DB0AsjmPvHEFSGsoFraPaVpI2zLc2lmudErjJ/eeQwbKPoRBZulcwhwXYc6i1SdiEpiCF+KrFOIrAzKaHdhQ79tw4MAGuJv4rt8sQQu80jloGnnDfNVJBa+vn1WjSg1d8NHrg44FbTgdJ5+T77yy/gDI5wY7633yTbI7+CdyMDyEL2paDd0BvZjyfIYXH2/H+aqjDfXUisgnk3rFYMePoyZBegWanQpM5hKdlUSU1JnoQH2iG1d90IYADi0JPV2/oxMEeB7apm+aBngFw/ObMjzHzv7dgzyOh48fHZnmO9c8Wv+2RAGwHiP20UNnzx46mvYxyaMixDpZX22lQqQgRDqG4kYcMo92cpypAOo0Ti+iSYXJRGc5l8wvQhPfqpE0SYa7nDwkeQyh26OOlbecqVumoCwJ8+mDm+9/5T4eOyOt+4wk8WjavYTIG+7nD5Li2cWv8zGkMYoz51q2u3Y1JQSwfcumSn9JUxW0CZIWQ5isqKCo8zoGFPybx/lyHD2w4AaCBw7Ap1HIxAaHyZlr1tXG1owMt7h5Ox5QmxF4Iv6vDhaQoTFAYADuYIlnLa7b7RwtiOBDtVK1dbyCMXXxn5azOIIKfLFKaQP9K3HKIMYEQosvhkIWH23TQ9wIpCq9M4WxycnJsQIUYrEJ/bPGuOZohfHVzdmMaAmHm418c7DU3xdoyYPebFktPJtpHu7fefjw4R0VHiNTa06ZUTPe09a1sdTUVNrYtbo3nth11VW7tBa1d/U1a1t71rdG2u1IJNkWDYdbUs0pnnFT+OloWzISsdsjqVpvy9prqrNjed41POfPx2+J7TIXaWP5Wgf5bvToBEvpppQYOXPOJoda4gTQE6TsNK8sAvUSSHBFygfnfM9wL+8aK/Bddv0tZ8SufyKZ7ml7s20iCWdsPpPu4YVaXuur/2M6WX8riReTE21vtPUAnn4iyTxdf0vJ+/QM0pwsUL4D5BmUBQEeXpaU4W6RtExzN1In7eT9qHPpIoUdqAzSrdyHIPo1JNRps1uioCWJyIm2U/JG8oO4aZMXozF8b4RupRd5JJv7Nn8ZeUyxjlrakhJHcwO2gHMUDgGLR0MmS0GrIoMRWos0K81LUnPZYgmkw6sM8HtCoQTaT9y0Wu3f/MZuCYfijhMPhUVQNdL2hY8kMroS/8UvEqqeSfC/xzPV07k3vsqyrL+2ykYnhJjEz45OLIdbu4ncrbrWhImzltU7oqqaXAEdMWiHxPsSdvuF70K6/xf6FejjL13YBvFVP+UXrkwnyelZjBcltoLypQIoEmsoiDUw4C2QFS/I/J6yx5ybWOOqaMad0kJlKo+ElAdLqvRTMqOsgucuM64j3hgHU1H1mIkQ084Oje3eXT1lZwL1nwaD0BZMNfFTcHpv+sf7v6LEo4oZMlRbFNqH9tb60nEN0UkQ0mYawZNpR878eFuD1lWsl/Jb9J5iMbPlDKnkh3raBmS66U1M9Jm5rKUmMel1dKLOcxrVSgf5dJqU4o0g0pJyTlV37x4bytpCATOG8VUT4+m9cPoURiakE34ZMes/wbB0Roun+2p7h9oLSlwzQqZq2eIr+xe2/Rhp5QF8hHn5Hh/FfM9ibs32UrNG+l22ZbrnJ8N+fERAcD6YCp6nuPc2Aq/vWXiMfzKaye/BDfzTLPwe33MT8ns4P/y0uiLBdyZw3qRvNvGZegjF6H+escXvreOnkD7zm7IkADTbJEkU4sdw1jmwzpTj42smHLB82ijenjfx9YsXkccR+B5+I1azGtQk+4maTpnLlsBL75E7O1IPea+mzfPmUwQt00FJoG+nPxN/zruZzZprTljyx2GpXiHdYWBZtcINeB+2xVP16/GT9euDwf00TbqgK5gK7QvCmfp/wPn15WDa3BcM1l/Hy8F9wZQ31nf4Q2IjjrXyG+BnzXnMmqXiTuB5CLa01gINjvb8mesSTwHuSAEtzm8anp+uvwbdprkfhUs0wCNIxH6TP1l/vf6aPDThK0TXI5I+tjj+SX/8wIcaPxWX4y+CqsCiEIiAIzhsKrgfh+6qv+4L4RETPl6/zqMKukki9AA96OseZb3Zk7UKVKxZKt65tpR1J9p1sTGgP5Z4ah+KEzl73R/xEfr+I8H5fchlN/Jr0n0c3fSGkrz+vbhd5m2ZWltThDeKUaKh3WTZXWauS+WomBdMkjGvOCRuT9YfcIZxk0x24/5cT3q8redxe8TpTsLn03b9LIaFo/I0eQ7uxtjQm6rffI4elnTcJfbwX/qRFyG+Vw+SaJdyFIpugk0WXCcnaZFo1323viNAWHZPvk1+ugfjTf2sbcPR5LDT442bhwPj6Z5z9qi9wr8B85Ji51yXb3tISxlpSUtaZEYnFX8ZbHI6C8vk4ll2h5/YdRQbM0CUbSmXHsd5rH5zWz7fBnc/5iA1NLANwyQZ2+5JjiYfQ4mle+BxJA1prT9g+770dv4zTz9RnTPp+JlY4DJKoroOucmyT4fnsGIeFC3H9EtmB+qnGyP6413tPvs4BhIwipskDKakeIg+KKTgbl92JBkkHn1J3c8t+9ia2vBKhMFkGBJtEjrGDIzKE1SeAgTJiDAVRYpKmSGwMlksJor5gUWgjKlXYS0gurS4neaYflXJnaWBUjDKNAVhkWoF1WhHz7uJ2PapE8NHJkulySPD62/qVmLapMq10a997JqvnphQarc8dO3UQ2smYr38pfOWszK6fTs+eBKfHy4j8t2uWNrWnbDx5CNfe+TkxrHVE/EEW4ynxM9H2FhtpAeE2tnGFUH1J4xXChxD5hACLNXbLgOA3WU353rI37Y44SipbwdxwED/mEC0rOmuIzmlGkw7SBzNxZ6NN3519+zXRhV1Uosp3TdtGD68s4eXJo8uzHVtjyXc85gC9MYmRh+euuaRk+vhAG43Tm3RLGW7Clp52Oesq3N7dKVjnW9KxCdWjyFvi/nUs+Ja5CnPxtn+2t4NnVwLrELw76JqDMz1MacMGJoR0I5RVsA1lR/DLEdonLJLQWnOMcSamKlrszLnWWZ3mzcVOjsrnYWynTfVNmQ6aQFxrWtL9SQtgjqsojbxf5lp+qquSF1rVGyk02qZZEEKRkPdlv9ff3LVQ6MTFMas8xSft3fNVbd+vqg1KaF5w7RwBsirUye24UVXDS3oIcj/nz+56mF6qQlUAQ++gGoNytcxFG7P98DWMXMoHIL/6l/Z7p1riv8ko2oiyiru129WsSrmUjO1XdtWc0Pr7miOoWOV9YUQ07WQPmsCisWYDge5puAUAI3NIk6EQACmaQ+BGRaAwOSemV1TH90+vnlDrZBNFOi/nEUlLL96lYx5VZLqB5zDQLFQzGm6KuUX89L6YqxRuaPsCwXYTlJE1EVJt9ycWTo8bereoW7Wv38ewfOzmgI/N42Kn53LatjTxUCv85zbEyg+Y5hTcDddq99M2ysc8/51lABfjZ++8KvSxvUlnpCj7U+mIG3vR8yhXSbXEbaB3cDmatdds4lrhi9Z8hskNo2hkI+RQHWN6fMIUwKGFZiNhDmCNq6BoR1gejCoTzNdD86woB6cPDh33YFr91w99dHJLePr1tp525NylKZkzJtthLplN+ADzhOxjpiN1trRPwb/vhKfqIcMg8Mr3DDqd38o4cM36y9KWa+Tsn7v4/ocj134Vcg2TZsf/ABFKH4tYwrtObZYYxoF3QiQC+PjATwUho5+W8MkQlOOqUDxnlMNjZpsfB8zjJCxZe2afKeTjXeuboqT2XcOlsACB6XROFhWch7AeNy/VsZfx4fO5Aj8EjTVRPjLdtrmTS1NX7Azce6kmjZnnHf+1iuBiG0duzsmQTiZPzfjEoTGAqZ7xqt/nmmai8gXOWb0/sG9z8vyyPNOZjKDf9DlRgmQR93keVlHOU/9RTkfH8W8ieTQzWpsc21DGRM0Xw4soAUWDEDPtMB0oS9I5qeXC0PhMySPyTWjuYFctn9JEgWLp6FSXdz71TeSgzuQBmnXVHPXGqWhIhXkF+H2lQXxVqiSO5OthN9CQQSazmBOhdycwSgoZRJvQ28Yz8SVltDiwd3PUxMLN9De1dWehinH5783RvA9xhpyoHgnWAfGvE3sqtqOFT25rGIoMB4GBa0NAaepg2KYyiwVijQqFKGtopEeUFFYgQCboj0jZ8cCk7U1Q2W3MBBLjMRi0SCKxO0od6gD6Muon6Q35JGLDZS9DEpfLNZTA4aqrmrD0rwHCAO8Cs/Ur4a3J0Lql9WU4RfBJiYySfg+cviqaczLvipt59LuhbjXflPdSuRLUUd/9VV422jRv6SF/NbehYrcQ1p2AZ6jd80L5+kSRwE3WV+OVGTs9GvnU6yLDbJsrZ2aE+iijskqPtuHgTAktgz0r+xtaUaslZRRH6FKlRJrBwO9bK+lef8YXipg7j8GSJjM+GRPmSApRv6n//T4VrH3qqbRaNxoqoxSNMfwD6MV18yPulftrX+xZ7gXeka7vMCPgf2aQ8+N4bPuaKz7lg2LIGjjTT3x4T4jvubPYKL+cFtPTxscwm0DA+yVNaMjbFNt/cE9k+sUpoxgas8Gu1qjhG7GqUu+oAFel8B2gTDcgt+54If2XXv1VVsmVvRkM4m4TnnrYCGLtt5foc4F2rWO/NrIbxENvBHUy0WJBYqEg8hbyklAxoATvupfHMCZ3wAHaASEAFz/Y7pUPh+ZumWK7z65G1KGftgMJro0NbIzrOvbm1sCuhL9tBGKtrof1aLaZkdRjS4zYhzSDTDVw4bldnrPGtubWgKGiH0adR1JuR9VI/qErSgB72HMk0emp2+anr6F7kfTydZ+zdKSO0EdDRuTqaip3xAIjapaLa1aWqg/kmqNQEiXzza3ZFbqId3euezR4Iiqbkj5j7ZEIeTX7X4n9vLvLmKL2mAXILVUp0WPoyLCVJVGQ+/yNlGhjP8PNLq4y9vNy9rPrn+eW36OaPmdX0nTF7EIpu9XPlvW1XMgOiHbSHIL1ji1nsbpBdbAyXtlTRwjSHuCqyJvkjfAVEiMe317oeLEURlNKa/CI7tfVLxLp5qb4tFwUFVYJ3R6/STHqy1Xi1R9RLvvd6lSPIba14rZoo6zwa3w/7L18OGzRwC+N7B52+HD2zYPfA8OP3iIH9kyjkd4Fdwj9x85skUPzfXhQd9cSN96mB+97yjgoYUXvZ7kxYu/UW7mL7Eo+rwKK9byTKWsSWWz6N8VBaZxB5ShgDJZHerscm0J6L1at2fNGPH4CqQNZ+gAGTeaPZVNBB52IJ7nt/uI3N/B0707Do+8vmEH37rpdTLX8eEDd47Xr564Y3aIj+67azM8Q4dwYHjpHbJoOu1/8OkH++lk4s59Y2Lo+tsevG1ukA/N3uHb9f9TbkFebNRET61I/GEuOEtdCkxKcdfISpPptmSn01kdVNF4Y4NjHF1rWnh0cxWZKImsJdKcKPPIkZR5RIoYkcJ7dh665dDOHqV/4jgc2ILXkYz77zgwypGsH1zKst/L+ir6nJVsPdtR2zaC4aQTZC9CR4p0jigDQ6gmexJcUeeXdbS0xY7WslzDdpPF8uryAPX0L+tqoVNFD5QrFi7rbKGXwYnkJGCpwra4XMZe1th6JZcOCL0VgV445HepqL+l5jVdKMHP1VeH89a/WtYaK2/9Z/g4noyFYduzjf6WpSS0FIKDRovrC4aaQ9ZArQ9b1r/K58P0Yhi/4Msl4WPhFbUuzCTBb1OitsjmCVsAn+Qs3eokTJ1FeEQlI1nGXNlfnbS8tcc/sYz4wU8vsbd+lr/UII5u7mncOYBJ+WKc+5jsETe/L03AXCfmN4IlTVnCOYiVSxyWr5h45up7d/Lpu568c7ey4zRcu6yjzk9P3Xvu3im5qb9yaf98ab2AwZIsy0Zrq6nXxkG22zi121ScGiC71IoiZwcZqlAmzUCmvaU5GgkkzaQfoNCjlKimWnxvGhtR5b4r0roYFX59BZLFsvVB5NMRIVAGQ65bJoBsRuaFbLJM/0n3nZCLlZaWYKj+efWy88WezKv+yiG5dKnN23mX2uUJbi5bY+Rc4XgxBrHXGnlYb637gwLPEuXVBmD1ViiIyzgRfl5f9NddvfoB9NDxw0clWD9KV0FbdhMMjzfc+H7uJXEG8fo6Ns4O1q5fU+KCCq16PhXG3JuJcczFw6GwEaLSBXkQwNwF4DgLs1AgHDqA2FToAXEgCDpj+jTudDaDgUmnGsaG9bWx1UOVctJGzBlDf2HJWgZyh1HHkeV53RK5WC6Gc8fr45AzKSByxwlWHShTsxydSgfVLhALUZsXOiS8w0TlVOdJ006bC4ZayA43j7cN9WCqeCgYDTvGJzKnKG0Jn7ou6KSC18Frs8FUk2Jch1frv65/kWLdMMbf2fWfDKac4HFdaYpb8HY9ZDXZhnEylEgHP7t2L6YMcO46M22b111HA113zoFBDJQUpy/WLx6B36K+MxQdmlHBKerm0BIJKqUu68GgoLY0VSpexdChJiDC1WpC9qwK1cQYpS7U0BW0JAzeMrX6P+hRI2Dy4z/hqqmb4gS3jG8GLT77P1Ue5E4wfOFTFoioAS8NYVYZhv9umJapaPV6hct6wHdkHiowcqVYnvUivt5Qa+3vK/X2dBXy2Uy6pclBE4pR4XkwxWHTtq93vH+tv0l2U6pFvbNRePWrv51uBFbBWmgHbw/upXv+0LnRc1AxL/RjLrVgmvx/yP0Fq1KJxarV2A+PHct2HDvWwbvxJIYX60/THfzHrcdGH7shQm/iC2l6E/fXRumtaPU/ybeyx+p34UkVL0LJv9PAUHOomzL1w8q9uZaYoV3SIOoujHBKKii60eKMxhJHXUMgTQW0InVqqErq22AbYN6BHOMkFCMtlpWLDDc/0NM23tYLZ1uGMX5ZrWfPtkQj+chQ61lZiH+gZSiai0Sbz4JhDbeswXd2PSVr8E/twqtr8KXdu690Q2KpI6jHMMuhBjdRdbG9iQslEae6YVhDV7gBdOiHgK4iKtSERkv4yOpAP8ZMpimmNqtSRuUFG50FDD2AeaYRNrasGS0P2LTwuGDncpRJNtZ5Fpev85SVhMY6T3ewBJrtjAFIs8XZi95eSXOXLJkW75wKaXmE7afkst1TsjBDJxP3v3I//kG6Z9R+ce7WnfcfrvHRo6fPnT46CpteTMJZ7yXKMb2XTlHieMpspgUYLz+k3UsJV/LFTWNH7vvT08eHlfWHHtx+69yLSbZMRhHWhDn2SG0oYCC3qE/B0qAKuZqPg+b5XkErlwWmYkKlMkNY2eLmUAqF3OJinmKjrPIhuK1/W/IJ6z8kh5K1D2aK+/UTWqOzkz1fC4xVOgKKKqgjZqKV9nhTGGOgUGnZjiK4Mq8jJFKOMwJ0UxSLdlO/Ymvrtq8H3/UG+nBNcG0e7Vh79xt/yOf37KklDMPYaeyc3LZ1y8hwT671KoP8BApooL9agOqYUm2FATeRptTcdeQGxexmC3pWyw2u5ZSr4l9xsLCKW+DaaeqxVskXZql+XdTggY9NDrcHk331MoTzqZSj3fGlCe3GxJQT6IsGjeBkQOGQO53v+VKSb9E1EVMQ5vKs2/R7axiimWAmiVCh4/MZ1eYrecvvMWx9oa71KppmNkVhBs6G6m+veHkw8amOFi0QFY4pTI7RrikRxSd1jgBaCeytDEHmYSsUN/HTEEyqQVQ6ppY4937ER/nPmMXaWK6W8TvQy1cj+s28wcIlS70LHqQsSoS5rB18abP70ubwv0VMqrRhJALnb2SJXZ76vg7pAPc9++oF2+s8XzLyZUMt/3ajhy35encPGy4n+lIy4Xvvou1JERMJFmTa8zqHldSwlaBa9k6VC63heDzM/3cYttfndDMiKlbIwCN7eV2F8FS61toUNZhCzHltUoKChwg/yah6WVnr8jIXJer+ultoizj14CWn/GfvvEU5uIjTdtnx8nw86K1TlzWF5QsXBhYXGlw+3rLk/5IB/G8+gzZuYUagPa8ByoUaWfiRIuA35I4CrJOMVariLtOCaKD+Ryq3gvWTwSDci1AAfVtQi7zzsmWE4F5Vq/+RPKDe8714vX5SVSVGuXjxa2K/iCyN42qyOkbLkXwt6FIjmt5sRsHC11VB2yANZQl1HL+GWjFC9Em4Vx7Q2oKTeB2+oKkeL3xEkBU015zWlri4VEBrpICIlwZ7Eso2mgSVKs8GLeJN5YsLnmn7Lh7/45KS6ncSg5I/Por8NcaWi7UW27Te2JeyTGPqPg3VS9j2CzJyeznjn1qaGXCrpsq8ro655n7+1zi3WwkBRkGuRl5e3eMyi6L0TvDJcnYwTnM14fWG5Xyh5nXVLya56BmNJRUi25oYoiGRJBGXdaO+Rb1Y9R861mlZYzodsf21K8/wZ1mC8I75Hr9viTsF+fsW5BzxTSO1IFQNz6DJvnC/lPv9L6Ab4KcvfJU6gC94y9NfMP31s7i5XY5RIn6LJqKRxjAKDuOVppiQA65ycUhaEvVeQya8dVuF6uCYKClVFADVGd5FyGt9RTWAAgg50ahiNFm2YkcCarHv3QTW/6Jna0TY0VA0FEpnMkbciKJ0RGSrrMN/XzzKfy7p3saOsq21cUl7FVQ2Dboqxg8D38S4hnxooL2bGRU1qurqAtP1Q1M7xzd3Sd4MKlx9aN7cxtWq/1OQAi25ohrK0s0ilVHwbgmKVNGWD1T/IMmcmd2u68h5MhPsLpW6Mf7ZEUPfceC+0zfhdXy9uTm5cQffujnZrMQFzmZdv+n0HyDOnl33Z4RjOcFoIL338N50IIpBxBEd9+2+7fV+vGGHQ5Y18NCTDw1EwkITYRu/JwZe9fPMI+IfxFUsyjbSqvKhAcwt168pdedsTBbTzZxTnRzRxQyV/if8uggP8y2VcpqWw7iyTmgJOy3GuEu5oK35P5xC0L6GZFag308hopD9/6r3KyoE7rKG5Tqi3D9z8s6TM/3+7mEeeCxiPDanxdWDjxmRxwKIeebmVFVePajGtTl5VaWLcGDdLdMVpbTvxD0n9pWUyvQtew1RfioQFOU/1vU/Lotg4KmyMEz9nnuM2OINTVu8ETPuuUeXPuNZUcFYEmd9rFRbYSxfVUjLiN9dFerqyvd2yKWFBEEB548Fup3m1PWnBQHUERnjyKYur0O1v1pBfvl30u2Hnj4EwydOw/CBOyd23vd4+YefpuUbvHb84elmO9HXD1P3Tq1f48YM5VZ17msH5/d1fPtmWQndeOwTd1EnZNeXbtwsoBRbcbJ29T3T0GbGDO+3J95aen6KxViWDVCHL8i5wsPAxPLfE1FDb55RmQnmCYgrEoijOyX+6KeDoE66Tt5ONjkSgheKBA9LqL6qpqchU0E7QaSYtJ3+irSVimrrmpLJU3ej0gsK6vTRXbdlEXtnb9u17Z9B+Un9m9Hg5rmoE93YF4zCPwZ31H9b/6f6b3cEgzvAgAIYO4IwfMe64Q03nOX3fXzD8Lo7brzrLtiCz85tCkajwb6N0b9LJD738MOfSxTs2x7mj3yGsEgjzzBYB9Xw2hGCYAZOzYWG2uR6nFlvxlJeEZfO732ziNsX84be4ffMGz7/gRmQb1dyTX8Q/dtArU8Hb8Wybmgod53NBlQOilxbg9mPCIstK3sTAzE7O5BMJuTKkvJgwfulBskXM0CBMymXLQrpkSoDMVmJ6aA2QjGG4SJkRk38g5sd61dtYGoQ4St+jHY+U23r4aVWOEjtseoMnDgvfwCEm2+hp6r/X91AK4zYkU3HMVEaxnR3qBfqPzn+/wHPnsOreJxjYGRgYABi1vIsoXh+m68M3MwvgCIMt5YoxkDp2P9f/2exVDAHAbkcDEwgUQAz1Qu/AHicY2BkYGAO+p/FwMBS9v/r/68sFQxAERQQDACh8QbyeJxdT0sVwzAMy49AkAxAkbT3UQiAITGAISmAYQiA9th4ttUs7Q568UeSlVidiwSkB3PUPg+ESd6ZD/+8v7HyrtzwghY89ZB6BcyrYqc6RZhw48YhaA1Wc/v1PQtdeXJ/HppUmFM597nvBVK7D+Z+E8/uQZLBgDyaz3Llvxx02S3c/Hv813JrznryZP4F+6lSfQAAAAAAAAAAUAC2ATABaAGyAfoCJAKwAzYDmgQSBFwExgUyBbQF/AZOBvwHRAe2B/YISgigCPIJGglCCWQJignACgAKQAp2CroLAAtGC4oL8gxcDPINng5iDuYPag/6EF4RIBGGEeQSShKYEyQTbhOyFAoUYhS+FVoVphYoFooXHBeGGFoYnhjGGOwZChlOGXgZrBneGhwaWhqgGtIbLhvyHHQc2B1QHZ4d/wABAAAAUwBtAAYAAAAAAAIAIAAwAHMAAAB2C3AAAAAAeJx1kN9q2zAUh39q0441YxcbjN3tXJWWEcc1lEGvWkLbXZeSu8JUV/6T2VKQlY48w95ifYa9zt6jd/vFESUUYiP5O5/O8ZEE4AP+QWH9nHKsWeEdozXv4A0uIu/Sf488IN9G3sMQPyLv0/+MfICv+BV5iI/4wz+owVtGM/yNrPBZfYm8g/fqW+Rd+svIA/Jd5D18UovI+/S/Ix9gqp4iD3GoniduvvR1WQU5mhxLlmap3C/FUdVWN6IXoXK+k3MpnA2maVySuza0ZlToUZ07292YctFov6k2eWp8VzsrJ0m6qa+NNV4H87Dq1j2WWQiFFN61chX7yNy7mclDUoUwPxuPN/tjAoc5lvCoUaJCgOCI9pjfDGk/BPfMEGaus2pYaDQ0GgtWVP1Kx/ico2BkaQ0zGnKCnHNL09KNuK451721rLqhLfmfht5vzdrmp7Sr3nUfC07YL92afU1r+wrd7/Dh5WwdHrmLjDawanUK3+9acPXqPML7Wq3NaHL6pL+1QHuGMd8t5/8PvPGO3QAAAHicbZLnlpswEIV9DRiwvZtseu89Ib333vvmBWRZYMVC0pHEEufpg8BO/kTncOfTaLgMOtPr97o17P1/baKPACEiDBAjQYohRhhjDevYhu3YwA7sxC7sxh7sxT7sxwEcxCEcxhEcxTEcxwmcxCmcxhmcxTmcxwVcxCVkuIwruIpruI4buIlbuI07uIt7uI8HeIhHeIwneIpneI4XeIlXeI03eIt3eI8P+IhP+Iwv+Ipv+I5N/OiF1hEz9JKxUrtFrDl1lWF9NR9QIikToRaVjUouKxvOmNBjLxnlhgo2DbnM1djLKrNGnGPScSUzItzGv93yPP2bSQSX84z9cqFQdJ56yZRmMhW8mLlJJSaBI0XYPDaZKDUviZmvr6DrNjJMi0WcK1MTM02mqpbZlJtEsNx5SI238jSodJtoS7qv+BpPw67IY9xU+dg5TXjROTWwdGrIOzWhT+uA0jolxqjaZrSOnCF2Nmq16651EYpMm1fakAul9SJQeR5QVYQlk1VkZ8SwoVNFIVjWnKQrlBGdMToftdoZjrs77DajqXKrS02YEFxbbtdWkG0x44JJVUS5aBqKSlJwmhDrmOF2Hv9Wqsy4TNqoKhfmSrrQKuNSL5nvPG6p0s0AkEWkSWVZMy1Kx3ljk03qLuZ14lTmB8gNGmByGrGfjLrhlhJV2f7SaIneNF1ypQNbybBUSgZswQaWEUNngeay1/sD4l/60HicY/DewXAiKGIjI2Nf5AbGnRwMHAzJBRsZWJ02MTAyaIEYm7mYGDkgLD4GMIvNaRfTAaA0J5DN7rSLwQHCZmZw2ajC2BEYscGhI2Ijc4rLRjUQbxdHAwMji0NHckgESEkkEGzmYWLk0drB+L91A0vvRiYGFwAMdiP0AAA=') format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-webkit-transition:none!important;-o-transition:none!important;transition:none!important}:-webkit-full-screen{height:100%;width:100%}:-ms-fullscreen{height:100%;width:100%}:fullscreen{height:100%;width:100%}body::-ms-backdrop{background:0 0}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111;overflow:auto}a{cursor:pointer;color:#68d;text-decoration:none;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}a[disabled],span.link-disabled{color:#aaa;cursor:not-allowed!important;text-decoration:none}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em;resize:vertical}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input[type=range]{-webkit-appearance:none;min-height:1.2em}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;margin-top:-5px;width:33px}input[type=range]:focus::-webkit-slider-runnable-track{background:#222}input[type=range]::-moz-range-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-moz-range-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;width:33px}input[type=range]::-ms-track{background:0 0;border-color:transparent;color:transparent;cursor:pointer;height:10px;width:calc(100% - 1px)}input[type=range]::-ms-fill-lower{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-fill-upper{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:16px;width:33px}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;max-width:100%;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.75em}.error-view>.error{display:inline-block;margin-left:.25em}.error-view>.error-toggle+.error{margin-left:1.5em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){background-color:rgba(0,0,0,.2);display:block;margin:0 0 .25em;overflow-x:auto;padding:.25em}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0\00a0"}[data-icon-after]:after{content:"\00a0\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}@media (prefers-reduced-motion:reduce){.passage{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}</style>
<style id="style-core-macro" type="text/css">@-webkit-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@-o-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.macro-append-insert,.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-prepend-insert,.macro-repeat-insert,.macro-replace-insert,.macro-timed-insert{-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-append-in,.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-prepend-in,.macro-repeat-in,.macro-replace-in,.macro-timed-in{opacity:0}.macro-type-cursor:after{-webkit-animation:cursor-blink 1s infinite;-o-animation:cursor-blink 1s infinite;animation:cursor-blink 1s infinite;content:"\2590";opacity:1}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-webkit-transition:visibility .2s step-end,opacity .2s ease-in;-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:-50%;left:-50%;height:200%;width:200%}#ui-dialog.open{display:block;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog>*{-webkit-box-sizing:border-box;box-sizing:border-box}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:92%;height:calc(100% - 2.1em)}@media (prefers-reduced-motion:reduce){#ui-overlay.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-overlay:not(.open){-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-dialog.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]>div:first-child{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999;speak:none;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves .datestamp{font-size:75%;margin-left:1em}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-desc],#ui-dialog-body.settings p[id|=setting-desc]{font-size:87.5%;margin:0 0 0 .5em}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:1em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.settings input[type=range][id|=setting-control]{max-width:35vw}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em;-webkit-transition:margin-left .2s ease-in;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-webkit-transition:left .2s ease-in;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-webkit-transition:visibility .2s step-end;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}@media (prefers-reduced-motion:reduce){#story{-webkit-transition:margin-left 0s;-o-transition:margin-left 0s;transition:margin-left 0s}#ui-bar{-webkit-transition:left 0s;-o-transition:left 0s;transition:left 0s}}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-toggle{color:#eee;background-color:#222;border:1px solid #444;height:101%;height:calc(100% + 1px);left:-2em;left:calc(-2em - 1px);position:absolute;top:-1px;width:2em}#debug-bar-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-hint{bottom:.175em;font-size:4.5em;opacity:.33;pointer-events:none;position:fixed;right:.6em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:650%;max-height:65vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none;color:#c00}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-hint:after,#debug-bar-toggle:before,#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#debug-bar-toggle:before{content:"\e838"}#debug-bar-hint:after{content:"\e838\202f\e822"}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript must be enabled to play.</noscript></div>
		<div id="init-lacking"><p>Browser lacks capabilities required to play.</p><p>Upgrade or switch to another browser.</p></div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<!-- UUID://C15CE33F-61F6-4909-BB59-73EE7A3D57B1// --><tw-storydata name="SugarCube Guide" startnode="18" creator="Tweego" creator-version="2.1.1+81d1d71" ifid="C15CE33F-61F6-4909-BB59-73EE7A3D57B1" zoom="0.3" format="SugarCube" format-version="2.36.1" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">html.serif {
    font-family: serif;
}
html.mono {
    font-family: monospace;
}
html.cursive {
    font-family: cursive;
}
.sc-docu body {
    background-color:#fff;
    color:#111;
}

.sc-docu #ui-dialog-body {
    background-color:#fff;
}


.sc-docu a {
    color: #4722cc;
}
.sc-docu a:hover {
    color: #8822cc;
}

.sc-docu #menu li a:hover {
    color: #eee;
    background: #88f;
}
.sc-docu button {
    background: purple;
    border-color: #b70bb7;
}
.sc-docu button:not([disabled]):hover {
    background: #b70bb7;
    border-color: purple;
}
.sc-docu button:disabled {
    background-color: #444;
    border: 1px solid #666;
}

label {
    font-weight: bold;
}
  
.sc-docu input, .sc-docu select, .sc-docu textarea {
    color: #111;
}
.sc-docu input:not(:disabled):focus, 
.sc-docu input:not(:disabled):hover, 
.sc-docu select:not(:disabled):focus, 
.sc-docu select:not(:disabled):hover, 
.sc-docu textarea:not(:disabled):focus, 
.sc-docu textarea:not(:disabled):hover {
    color: #eee;
    background-color: #88f;
}
  
.sc-docu #ui-dialog-titlebar {
    background: #ccc;
}
#ui-dialog-title {
    padding: 0.2em;
}
#ui-dialog-close {
    height: 100%;
} 
.sc-docu #ui-dialog-close {
    color: #4722cc;
}
#ui-dialog-body.settings div[id|="header-body"] {
    margin: 1em 0 0 0;
    text-align: center;
}
  
.sc-docu #ui-bar {
    background: #f5f5f5;
    border-right-color: purple;
}

.sc-docu #ui-bar-history [id|="history"], .sc-docu #ui-bar-toggle {
    color: #1d005e;
}

.sc-docu #ui-bar-history [id|="history"]:disabled {
    color: #80008036;
}

.sc-docu #ui-bar-history [id|="history"], .sc-docu #ui-bar-toggle {
    border-color: purple;
}

.sc-docu #menu li a {
    color: #111;
}
.sc-docu #menu li a:hover {
    color: #eee;
    background: #88f;
}
.sc-docu #menu ul {
    border-color: purple;
}

.sc-docu #menu li:not(:first-child) {
    border-color: purple;
}

.sc-docu #menu-core li[id|="menu-item"] a::before, .sc-docu #ui-bar-history [id|="history"], .sc-docu #ui-bar-toggle::before {
    color: #1d005e;
}


/* Headers */
#passages h1 {
    background: #0b1f0b;
    border-radius: 5px;
    padding: 0.5em;
}
.sc-docu #passages h1 {
    background-color: #ccc;
}
h1 {
    text-align: center;
}
h3 {
    margin-top: 2em;
}
h4 {
    margin-left: 3em;
    font-size: 115%;
}
h5 {
    margin-left: 3em;
    text-decoration: underline dotted;
}
/* Blockcode */
blockquote {
    border-left: 4px #0b1f0b solid;
    padding: 5px;
}
.sc-docu blockquote {
    border-left-color: #88f;
}
/* Code */
code, pre {
    font-family:monospace,monospace;
    font-size:1em;
    background: #03350369;
    border-radius: 1em;
    padding: 0.2em 0.5em;
}
.sc-docu code, .sc-docu pre {
    background: #8888ff69;
}
pre {
    overflow:auto;
    white-space: pre-wrap;
}
pre code {
    background: transparent !important;
    border-radius: 0;
    padding: 0;
}
code {
    display: inline-block;
}
h4 code, h3 code {
    background-color: #013c01;
}
.sc-docu h4 code, .sc-docu h3 code {
    background: #89a6ff;
}

/* Tables */
.passage th {
    text-align: center;
    font-size: 110%;
}
.passage td {
    padding-top: 6px;
    padding-bottom: 6px;
}
#audio tr th:nth-child(3), #audio tr td:nth-child(3) {
    width: 35%;
}

/* Other Stuff */

.simon {
    width: 134px;
    margin: auto;
}
hr.before-simon {
    border-color: darkgreen;
}
.sc-docu hr.before-simon {
    border-color: purple;
}  
.simon-does {
    text-transform: capitalize;
}

.colour {
    color: green;
}
.sc-docu .colour {
    color: pink;
}

#link-menu {
    text-align: center;
}
.flickering {
    animation: flicker 1s infinite;
}
@keyframes flicker {
    0% { opacity:1; }
    50% { opacity:0; } 
    100% { opacity:1; }
}

[data-tags~="BasicUI"] body {
    color: #eee;
    background: #111;
}
[data-tags~="BasicUI"] #story {background: #012f01;} 
[data-tags~="BasicUI"] #ui-bar {background-color: #330404;}
[data-tags~="BasicUI"].sc-docu #passages h1 {background: transparent;}
[data-tags~="BasicUI"] .passage a {color: #dd6d66;}
/* max width on popup */

#test-bar {
    background: #0b1f0b;
    width: 100%;
    height: 2em;
    border-radius: 20px;
    border: 2px solid #013c01;
}
#test-bar::-moz-progress-bar {
    background: linear-gradient(-90deg, #00800078, #6ecfff, #00800078);
    border-radius: 20px;
}
#test-bar::-webkit-progress-bar {
    background: #0b1f0b;
    border-radius: 20px;
}
#test-bar::-webkit-progress-value {
    background: linear-gradient(-90deg, #00800078, #6ecfff, #00800078);
    border-radius: 20px;
}

#test-metbar {
    background: #1d0b1f;
    width: 100%;
    height: 2em;
    border-radius: 20px;
    border: 2px solid #3a013c;
}
#test-metbar::-moz-meter-bar {
    background: linear-gradient(-90deg, #76008078, #ffe26e, #76008078);
    border-radius: 20px;
}

#test-metbar::-webkit-meter-bar {
	background: #1d0b1f;
    border-radius: 20px;
    height: 2em;
    border: 2px solid #3a013c;
}
#test-metbar::-webkit-meter-optimum-value {
    background: linear-gradient(-90deg, #76008078, #ffe26e, #76008078);
    border-radius: 20px;
}

.statBarContainer {
    background: #660303;
    width: 100%;
    height: 2em;
    border-radius: 20px;
    border: 2px solid #a40606;
}
.statBar {
    background: linear-gradient(-90deg, #ff489e78, #6effc2, #ff489e78);
    border-radius: 20px;
    height: inherit;
}

#bad-idea {
    color: #444;
}
</style><script role="script" id="twine-user-script" type="text/twine-javascript">//----UI BASE----
    //--Scrollback to top
$(document).on(":passagedisplay", function() {
    $("#passages").scrollTop(0);
});
//----SETTINGS----

Setting.addHeader("Visual Setting");

var settingThemeNames = ["Base SC", "SC Docu"];
var settingThemeHandler = function () {
    var $html = $("html");
        $html.removeClass("sc-docu");
        switch (settings.theme) {
            case "SC Docu":
                $html.addClass("sc-docu");
                break;
}};
Setting.addList("theme", {
    label    : "Change Theme",
    desc     : "Choose between the Base StyleSheet<br>or the SugarCube Documentation",
    list     : settingThemeNames,
    default  : "Base SC",
    onInit   : settingThemeHandler,
    onChange : settingThemeHandler
});

Setting.addHeader("Font Settings");

var settingFontFam = ["Sans-Serif", "Serif", "Monospace", "Cursive"];
var settingFontFamHandler = function () {
    var $html = $("html");
        $html.removeClass("cursive serif mono");
        switch (settings.fontFam) {
            case "Serif":
                $html.addClass("serif");
                break;
            case "Monospace":
                $html.addClass("mono");
                break;
            case "Cursive":
                $html.addClass("cursive");
                break;
}};
Setting.addList("fontFam", {
    label    : "Change Font",
    desc     : "This will use the default fonts of your device.",
    list     : settingFontFam,
    default  : "Sans-Serif",
    onInit   : settingFontFamHandler,
    onChange : settingFontFamHandler
});

    //--FONT SIZE--
var settingFontSize = ["100%", "130%", "150%"];
var resizeFont = function() {
    var size = document.getElementById("passages");
    switch (settings.fontSize) {
        case "100%":
            size.style.fontSize = "100%";
            break;
        case "130%":
            size.style.fontSize = "130%";
            break;
        case "150%":
            size.style.fontSize = "150%";
            break;
    }
};
Setting.addList("fontSize", {
    label		: "Change Font Size",
    list		: settingFontSize,
    default     : "100%",
    onInit		: resizeFont,
    onChange	: resizeFont
});

// dialog API macro set (minified), by chapel; for SugarCube 2
;Macro.add("dialog",{tags:["onopen","onclose"],handler:function(){var t="",s=null,n=null,o=this.args.length>0?this.args[0]:"",e=this.args.length>1?this.args.slice(1).flatten():[];this.payload.forEach((function(o,e){0===e?t=o.contents:"onopen"===o.name?s=s?s+o.contents:o.contents:n=n?n+o.contents:o.contents})),e.push("macro-"+this.name),Dialog.setup(o,e.join(" ")),Dialog.wiki(t),s&&"string"==typeof s&&s.trim()&&$(document).one(":dialogopened",(function(){$.wiki(s)})),n&&"string"==typeof n&&n.trim()&&$(document).one(":dialogclosed",(function(){$.wiki(n)})),Dialog.open()}}),Macro.add("popup",{handler:function(){if(this.args.length<1)return this.error("need at least one argument; the passage to display");if(!Story.has(this.args[0]))return this.error("the passage "+this.args[0]+"does not exist");var t=this.args[0],s=this.args.length>1?this.args[1]:"",n=this.args.length>2?this.args.slice(2).flatten():[];n.push("macro-"+this.name),Dialog.setup(s,n.join(" ")),Dialog.wiki(Story.get(t).processText()),Dialog.open()}}),Macro.add("dialogclose",{skipArgs:!0,handler:function(){Dialog.close()}});

// message-macro.min.js, for SugarCube 2, by Chapel
// v1.0.1, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;setup.messageMacro={},setup.messageMacro.default="Help",Macro.add("message",{tags:null,handler:function(){var e=this.payload[0].contents,a=$(document.createElement("span")),s=$(document.createElement(this.args.includes("btn")?"button":"a")),t=$(document.createElement("span"));s.wiki(this.args.length>0&&"btn"!==this.args[0]?this.args[0]:setup.messageMacro.default).ariaClick(this.createShadowWrapper((function(){a.hasClass("open")?t.css("display","none").empty():t.css("display","block").wiki(e),a.toggleClass("open")}))),a.attr("id","macro-"+this.name+"-"+this.args.join("").replace(/[^A-Za-z0-9]/g,"")).addClass("message-text").append(s).append(t).appendTo(this.output)}});
// end message-macro.min.js
</script><tw-tag name="menu" color="blue"></tw-tag><tw-tag name="chapter" color="purple"></tw-tag><tw-tag name="page" color="yellow"></tw-tag><tw-passagedata pid="1" name="Index" tags="" position="1200,200" size="200,100">&lt;h1&gt;Index&lt;/h1&gt;\
&lt;h3&gt;The Basics&lt;/h3&gt;\
* &#39;&#39;[[About Twine and SugarCube|About]]&#39;&#39;
* &#39;&#39;[[Starting with SugarCube|Basics]]&#39;&#39;
** [[The Elements on the Page|Basics-UI]]
** [[Linking Passages|Macro-Link-Basic]]
** [[Tracking Information|Macro-Set-Basic]]
** [[Display Variation|Macro-If-Basic]]
** [[The Basics of Variables|Variables-Base]]
** [[Basic Demo|Demo-Basic]]
\
&lt;h3&gt; The Basics+&lt;/h3&gt;\
* &#39;&#39;[[SugarCube Markup and Basic Styling|Markup]]&#39;&#39;
** [[Showing the Value of a Variable|Markup-Variable]]
** [[Using a Variable inside a Link|Markup-Link]]
** [[Display an Image, and turn an Image into a Link|Markup-Image]]
** [[Removing a Line-break|Markup-Nobr]]
** [[Basic Text Styling|Markup-Styling]] (long)
* &#39;&#39;[[Going Further with the Basics|Macro-Basic]]&#39;&#39;
** [[Displaying more than text in Links|Macro-Link]]
** [[Setting and Changing Variables|Macro-Set]]
** [[Unsetting Variables|Macro-Unset]]
** [[More Conditional Statements|Macro-If]]
** [[Display Variables, the Print Macro and Variants|Macro-Print]]
* &#39;&#39;[[Adding some Interactivity|Macro-Interact]]&#39;&#39;
** [[Multi or Single Option Choices|Macro-CheckRadio]]
** [[Cycles and Conditional Options|Macro-Cycle]]
*** [[Make the Cycle Macro Accessible|Accessibility-Cycle]]
** [[Revealing Extra Text and Disappearing Links|Macro-Link-AppPreRep]]
** [[Listboxes and Conditional Options|Macro-Listbox]]
** [[Player Input in three macros|Macro-Input]]
* &#39;&#39;[[Basic Special Passages|Special-Passage]]&#39;&#39;
** [[Headers and Footers|SP-HeaderFooter]]
** [[Special Passages for the UI Bar|SP-UIBar]]
** [[Setting Important Variables before Start|SP-Init]]
** [[Special Passage Demo|SP-Demo]]
* &#39;&#39;[[About JavaScript and the StyleSheet|Base-JS-CSS]]&#39;&#39;
* &#39;&#39;[[ULRs for Assets and Testing|URL-Types]]&#39;&#39;
\
&lt;h3&gt;Intermediate Use&lt;/h3&gt;\
* &#39;&#39;[[More SugarCube Markup|Markup-Int]]&#39;&#39;
** [[Special Attributes and Directives|Markup-Attribute]]
** [[Displaying Code and Verbatim Text|Markup-Code-Verbatim]]
** [[Display Small Variation with Templates|Markup-Template]]
* &#39;&#39;[[Going Further with Basic APIs and More|API-Adv]]&#39;&#39;
** [[More Popups APIs|API-Dialog]]
** [[More UIBar APIs|API-UIBar]]
** [[The Template APIs|TemplateAPI]]
** [[(Un)Locking the Loading Screen|API-Lock]]
* &#39;&#39;[[More Interactivity Macros|Macro-Interact-Adv]]&#39;&#39;
** [[DOM Macros and Revealing Text in Targeted Spots|Macro-ApPreRepCopy]]
** [[Single-Use Choice Lists|Macro-Action-Choice]]
** [[Delaying Displaying Text or Running Code|Macro-Timed]]
** [[Displaying Text Letter by Letter|Macro-Type]]
** [[Using Custom Macro|Custom-Macro]]
* &#39;&#39;[[Macros of Convenience|Macro-Conv]]&#39;&#39;
** [[An Alternative to Conditional Statements|Macro-Switch]]
** [[Removing Blank Space and Hiding Code|Macro-Nobr-Silent]]
** [[Including a Passage inside another|Macro-Include]]
** [[Creating and Using a Widget|Macro-Widget]]
** [[Going Back or Returning to a Passage with a Special Link|Macro-Back-Return]]
*** [[Arbitrarily Long Returns|Long-Return-JS]]
** [[Sending the Player to a Passage|Macro-Goto]]
** [[Using JavaScript in the Passage|Macro-Script-Run]]
* &#39;&#39;[[More Special Passages and Tags|Special-Tags]]&#39;&#39;
** [[Special Tags creating Special Passages and Functionalities|Tags-Built]]
** [[Process Code Before and After Rendering a Passage|SP-PassageReady-Done]]
** [[Changing the UI of the Project|SP-StoryInterface]]
** [[Customising Passages with Tags|Tags-CSS]]
** [[Including Assets with Tags|Tags-Asset]]
** [[The Special Variables|SP-Variables]]
* &#39;&#39;[[Harness the Power of Functions|Functions]]&#39;&#39;
** [[Cloning Variables, and Random Values Functions|Function-Clone-Random]]
** [[Using Play, Passage, and Tags information|Function-Pass-Tag]]
** [[Memorizing Information and Metadata|Function-Metadata]]
** [[JavaScript-only Functions|Function-JS]]
* &#39;&#39;[[Using Methods to change Variables|Methods]] &#39;&#39;
** [[Methods and String Variables|Method-String]]
** [[Methods and Numbers|Method-Number]]
** [[Methods and Arrays|Method-Array]]
* &#39;&#39;[[Adding Sound with the Audio Macros|Macro-Audio]]&#39;&#39;
** [[Setting up the Audio Tracks|CacheAudio]]
** [[Create Track Groups and Playlists|Macro-Group-Playlist]]
** [[Playing Tracks in a Passage|Audio-Macro]]
** [[Other Audio Macros|Audio-Other]]
* &#39;&#39;[[Going further in Styling with CSS and JavaScript|Int-JS-CSS]]&#39;&#39;
** [[The Different Targetable Elements|Int-JS-CSS-Elements]]
*** [[The Full List of Targetable Elements|HTML-Full-List]]
** [[Ensuring that Elements Start at the Top when Opened|Int-JS-CSS-Events]]
** [[Import and Change the Font|Int-JS-CSS-Font]]
** [[Using the Root and CSS var|Int-JS-CSS-Root]]
** [[Formating for Different Screen Size|Int-JS-CSS-Media]]
** [[Intro to Animation|Int-JS-CSS-Animation]]
** [[Creating Stats, Meter, and Progress Bars|Int-JS-CSS-Stat]] (long)
** [[Editing the Loading Screen|Int-JS-CSS-LoadingScreen]]
** [[A Note on Interface Accessibility|Accessibility]]
* &#39;&#39;[[Some Useful Basic APIs|Basic-API]]&#39;&#39;
** [[Moving back and forth in the History|Basic-API-Engine]]
** [[Create a PopUp|Basic-API-Dialog]]
** [[Handle the SideBar|Basic-API-UIBar]]
** [[Open the JumpTo, Restart, Saves, and Settings PopUp|Basic-API-UI]]
** [[Overriding the Navigation to a Passage|Basic-Config-Navig]]
** [[Some Useful Configuration API for your Project|Basic-API-Config]]
* &#39;&#39;[[Edit the Built-In Text or Change the Game&#39;s Language|Localization]]&#39;&#39;
** [[l10nStrings, and How to Edit Them|Local-L10n]]
** [[Localization, and Pre-Translated Templates|Local-Trans]]
** [[Providing Multiple Languages In-Game|Local-Setting]]
\
&lt;h3&gt;&#39;&#39;Advanced Mode&#39;&#39;&lt;/h3&gt;\
&gt; &#39;&#39;Note:&#39;&#39; Many of the elements included in the following chapters will require knowledge of JavaScript, jQuery, and understanding of the core processed of SugarCube.
* &#39;&#39;[[Advanced Macros|Macro-Adv]]&#39;&#39;
** [[DOM Macros and Changing Class of an Element|Macro-DOM-Adv]] 
** [[Loops and Repeats - Two Ways|Macro-For-Repeat]]
** [[Capturing the Value of a Variable|Macro-Capture]]
** [[Emulating PassageDone for one Passage|Macro-Done]]
* &#39;&#39;[[More Variable and Interaction Methods|Methods-Adv]]&#39;&#39;
** [[More Methods to change Variables|Method-Variables]]
** [[jQuery Methods and Interactivity|Method-jQuery]]
* &#39;&#39;[[The Settings API|Settings]]&#39;&#39;
** [[Adding Headers|SettingsHeader]]
** [[Creating a Toggle Setting|SettingsToggle]]
** [[Creating a List Setting|SettingsList]]
** [[Creating a Slider|SettingsRange]]
** [[Going Further with Settings|Settings-More]]
* &#39;&#39;[[Going further with the Engine API|Engine-API]]&#39;&#39;
** [[Checking the State of the Game|Engine-State]]
** [[Move through the Player&#39;s History|Engine-Go]]
** [[(Re-)Play a Passage|Engine-Play]]
** [[Restarting without the Built-In PopUp|Engine-Restart]]
* &#39;&#39;[[The Save APIs and Further Saving Configurations|SaveAPI]]&#39;&#39;
** [[Save Objects and Their Contents|SaveAPI-Objects]]
** [[The Basic APIs of the Save Elements|SaveAPI-General]]
** [[Managing the Save Slots|SaveAPI-Slots]]
** [[Managing the Autosave Slot|SaveAPI-Autosave]]
** [[Using Save-related Events|SaveAPI-Events]]
* &#39;&#39;[[More Configuration APIs to Customise Interaction|Config-API]]&#39;&#39;
** [[Macro-relevant Configurations|Confic-Macro]]
** [[Editing the Behaviour and Display of Passage Elements|Config-Passage]]
** [[Save Configurations|Config-Saves]]
** [[Other Config APIs|Config-Misc]]
* &#39;&#39;[[Getting the FullScreen Experience|FullScreen]]&#39;&#39;
* &#39;&#39;[[Trigger Code with Special Events|Events]]&#39;&#39;
** [[Dialog Events|Events-Dialog]]
** [[Passage and Navigation Events|Events-Passage]]
** [[System Events|Events-System]]
** [[Type Macro Events|Events-Type]]
* &#39;&#39;[[Creating your Own Macro|Macro]]&#39;&#39;
** [[The Base APIs for Macros|Macro-API]]
** [[Using Macro Context Objects in the handler|Macro-Context]]
* &#39;&#39;[[Managing Story Elements with APIs|StoryAPI]]&#39;&#39;
* &#39;&#39;[[Managing Passage Properties with APIs|PassageAPI]]&#39;&#39;
* &#39;&#39;[[Dealing with the State of Play|StateAPI]]&#39;&#39; 
** [[Managing the State of Variables|StateAPI-Variable]]
** [[Exploring the Different Moments inside the State|StateAPI-State]]
** [[Using the Story Metadata|StateAPI-Metadata]]
** [[Initialising a Seedable PRNG|StateAPI-PRNG]]

&lt;div id=&quot;link-menu&quot;&gt;&lt;&lt;back &quot;Return to Previous Page&quot;&gt;&gt; - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="2" name="Function/Method List" tags="" position="1200,400" size="200,100">&lt;h1&gt;Functions and Methods List&lt;/h1&gt;
Below, you will find the list of Functions and Methods included in SugarCube, and where they are discussed in this guide.
&gt; &#39;&#39;Note:&#39;&#39; As SugarCube is built on JavaScript, you can use any JavaScript and jQuery functions and methods, even ones you create and define yourself.

&lt;h3&gt;Functions&lt;/h3&gt;
* {{{clone()}}} : [[Cloning Variables, and Random Values Functions|Function-Clone-Random]]
* {{{either()}}} : [[Cloning Variables, and Random Values Functions|Function-Clone-Random]]
* {{{forget()}}} : [[Memorizing Information and Metadata|Function-Metadata]]
* {{{hasVisited()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{lastVisited()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{importScripts()}}} : [[JavaScript-only Functions|Function-JS]]
* {{{importStyles()}}} : [[JavaScript-only Functions|Function-JS]]
* {{{memorize()}}} : [[Memorizing Information and Metadata|Function-Metadata]]
* {{{passage()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{previous()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{random()}}} : [[Cloning Variables, and Random Values Functions|Function-Clone-Random]]
* {{{randomFloat()}}} : [[Cloning Variables, and Random Values Functions|Function-Clone-Random]]
* {{{recall()}}} : [[Memorizing Information and Metadata|Function-Metadata]]
* {{{tags()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{temporary()}}} : [[JavaScript-only Functions|Function-JS]]
* {{{time()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{turns()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{variables()}}} : [[JavaScript-only Functions|Function-JS]]
* {{{visited()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* {{{visitedTags()}}} : [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  

&lt;h3&gt;Methods&lt;/h3&gt;
* {{{&lt;Array&gt;.concat()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.concatUnique()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.count()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.delete()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.deleteAt()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.first()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.flat()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.includes()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.includesAll()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.includesAny()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.last()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.pluck()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.pluckMany()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.pop()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.push()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.pushUnique()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.random()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.randomMany()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.shift()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.shuffle()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.unshift()}}} : [[Methods and Arrays|Method-Array]]
* {{{&lt;Array&gt;.unshiftUnique()}}} : [[Methods and Arrays|Method-Array]]
* {{{Math.clamp()}}} : [[Methods and Numbers|Method-Number]]
* {{{Math.round()}}} : [[Methods and Numbers|Method-Number]]
* {{{Math.trunc()}}} : [[Methods and Numbers|Method-Number]]
* {{{&lt;Number&gt;.clamp()}}} : [[Methods and Numbers|Method-Number]]
* {{{&lt;String&gt;.count()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.first()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.includes()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.last()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.toLocaleLowerCase()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.toLowerCase()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.toLocaleUpperCase()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.toUpperCase()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.toLocaleUpperFirst()}}} : [[Methods and String Variables|Method-String]]
* {{{&lt;String&gt;.toUpperFirst()}}} : [[Methods and String Variables|Method-String]]

&lt;div id=&quot;link-menu&quot;&gt;&lt;&lt;back &quot;Return to Previous Page&quot;&gt;&gt; - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="3" name="API List" tags="" position="1200,500" size="200,100">&lt;h1&gt;APIs List&lt;/h1&gt;
Below, you will find the list of SugarCube APIs, and where they are discussed in this guide.
&gt; &#39;&#39;Note:&#39;&#39; Most of the elements below are meant for Advanced users.

&lt;h3&gt;Config API&lt;/h3&gt;
&lt;h4&gt;Audio Settings&lt;/h4&gt;\
* {{{Config.audio.pauseOnFadeToZero}}} : [[Macro-relevant Configurations|Confic-Macro]] 
* {{{Config.audio.preloadMetadata}}} : [[Macro-relevant Configurations|Confic-Macro]] 
&lt;h4&gt;History Settings&lt;/h4&gt;\
* {{{Config.history.controls}}} : [[Some Useful Configuration API for your Project|Basic-API-Config]]
* {{{Config.history.maxStates}}} : [[Some Useful Configuration API for your Project|Basic-API-Config]]
&lt;h4&gt;Macros Settings&lt;/h4&gt;\
* {{{Config.macros.maxLoopIterations}}} : [[Macro-relevant Configurations|Confic-Macro]] 
* {{{Config.macros.typeSkipKey}}} : [[Macro-relevant Configurations|Confic-Macro]] 
* {{{Config.macros.typeVisitedPassages}}} : [[Macro-relevant Configurations|Confic-Macro]] 
&lt;h4&gt;Navigation Settings&lt;/h4&gt;\
* {{{Config.navigation.override}}} : [[Overriding the Navigation to a Passage|Basic-Config-Navig]]
&lt;h4&gt;Passages Settings &lt;/h4&gt;\
* {{{Config.passages.descriptions}}} : [[Editing the Behaviour and Display of Passage Elements|Config-Passage]]
* {{{Config.passages.displayTitles}}} : [[Editing the Behaviour and Display of Passage Elements|Config-Passage]]
* {{{Config.passages.nobr}}} : [[Some Useful Configuration API for your Project|Basic-API-Config]]
* {{{Config.passages.onProcess}}} : [[Editing the Behaviour and Display of Passage Elements|Config-Passage]]
* {{{Config.passages.start}}} : [[Editing the Behaviour and Display of Passage Elements|Config-Passage]]
* {{{Config.passages.transitionOut}}} : [[Editing the Behaviour and Display of Passage Elements|Config-Passage]]
&lt;h4&gt;Saves Settings  &lt;/h4&gt;\
* {{{Config.saves.autoload}}} : [[Save Configurations|Config-Saves]]
* {{{Config.saves.autosave}}} : [[Save Configurations|Config-Saves]]
* {{{Config.saves.id}}} : [[Save Configurations|Config-Saves]]
* {{{Config.saves.isAllowed}}} : [[Save Configurations|Config-Saves]]
* {{{Config.saves.slots}}} : [[Some Useful Configuration API for your Project|Basic-API-Config]]
* {{{Config.saves.tryDiskOnMobile}}} : [[Save Configurations|Config-Saves]]
* {{{Config.saves.version}}} : [[Save Configurations|Config-Saves]]
&lt;h4&gt;UI Settings&lt;/h4&gt;\
* {{{Config.ui.stowBarInitially}}} : [[Other Config APIs|Config-Misc]]
* {{{Config.ui.updateStoryElements}}} : [[Other Config APIs|Config-Misc]]
&lt;h4&gt;Miscellaneous Settings &lt;/h4&gt;\
* {{{Config.addVisitedLinkClass}}} : [[Other Config APIs|Config-Misc]]
* {{{Config.cleanupWikifierOutput}}} : [[Some Useful Configuration API for your Project|Basic-API-Config]]
* {{{Config.debug}}} : [[Other Config APIs|Config-Misc]]
* {{{Config.loadDelay}}} :[[(Un)Locking the Loading Screen|API-Lock]] 

&lt;h3&gt;Dialog API&lt;/h3&gt;
* {{{Dialog.append()}}} : [[More Popups APIs|API-Dialog]] 
* {{{Dialog.body()}}} : [[More Popups APIs|API-Dialog]] 
* {{{Dialog.close()}}} : [[Create a PopUp|Basic-API-Dialog]] 
* {{{Dialog.isOpen()}}} : [[More Popups APIs|API-Dialog]] 
* {{{Dialog.open()}}} : [[Create a PopUp|Basic-API-Dialog]]
* {{{Dialog.setup()}}} : [[Create a PopUp|Basic-API-Dialog]]
* {{{Dialog.wiki()}}} : [[Create a PopUp|Basic-API-Dialog]]

&lt;h3&gt;Engine API&lt;/h3&gt;
* {{{Engine.lastPlay}}} : [[(Re-)Play a Passage|Engine-Play]]
* {{{Engine.state }}} : [[Checking the State of the Game|Engine-State]]
* {{{Engine.backward()}}} : [[Moving back and forth in the History|Basic-API-Engine]]
* {{{Engine.forward()}}} : [[Moving back and forth in the History|Basic-API-Engine]]
* {{{Engine.go()}}} : [[Move through the Player&#39;s History|Engine-Go]]
* {{{Engine.goTo()}}} : [[Move through the Player&#39;s History|Engine-Go]]
* {{{Engine.isIdle()}}} : [[Checking the State of the Game|Engine-State]]
* {{{Engine.isPlaying()}}} : [[Checking the State of the Game|Engine-State]]
* {{{Engine.isRendering()}}} : [[Checking the State of the Game|Engine-State]]
* {{{Engine.play()}}} : [[(Re-)Play a Passage|Engine-Play]]
* {{{Engine.restart()}}} : [[Restarting without the Built-In PopUp|Engine-Restart]]
* {{{Engine.show()}}} : [[(Re-)Play a Passage|Engine-Play]]

&lt;h3&gt;Fullscreen API&lt;/h3&gt;
* {{{Fullscreen.element }}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.isEnabled()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.isFullscreen()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.request()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.exit()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.toggle()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.onChange()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.offChange()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.onError()}}} : [[Getting the FullScreen Experience|FullScreen]]
* {{{Fullscreen.offError()}}} : [[Getting the FullScreen Experience|FullScreen]]

&lt;h3&gt;LoadScreen API&lt;/h3&gt;
* {{{LoadScreen.lock()}}} :[[(Un)Locking the Loading Screen|API-Lock]] 
* {{{LoadScreen.unlock()}}} :[[(Un)Locking the Loading Screen|API-Lock]] 

&lt;h3&gt;Macro API&lt;/h3&gt;
* {{{Macro.add()}}} : [[The Base APIs for Macros|Macro-API]] 
* {{{Macro.delete()}}} : [[The Base APIs for Macros|Macro-API]]
* {{{Macro.get()}}} : [[The Base APIs for Macros|Macro-API]]
* {{{Macro.has()}}} : [[The Base APIs for Macros|Macro-API]]
* {{{Macro.tags.get()}}} : [[The Base APIs for Macros|Macro-API]]
* {{{Macro.tags.has()}}} : [[The Base APIs for Macros|Macro-API]]

&lt;h3&gt;MacroContext API&lt;/h3&gt;
* {{{&lt;MacroContext&gt;.args}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.args.full}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.args.raw}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.name}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.output}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.parent}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.parser}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.payload}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.self}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.contextHas()}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.contextSelect()}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.contextSelectAll()}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.createShadowWrapper()}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 
* {{{&lt;MacroContext&gt;.error()}}} : [[Using Macro Context Objects in the handler|Macro-Context]] 

&lt;h3&gt;Passage API&lt;/h3&gt;
* {{{&lt;Passage&gt;.domId}}} : [[Managing Passage Properties with APIs|PassageAPI]]
* {{{&lt;Passage&gt;.tags}}} : [[Managing Passage Properties with APIs|PassageAPI]]
* {{{&lt;Passage&gt;.text}}} : [[Managing Passage Properties with APIs|PassageAPI]]
* {{{&lt;Passage&gt;.title}}} : [[Managing Passage Properties with APIs|PassageAPI]]
* {{{&lt;Passage&gt;.description()}}} : [[Managing Passage Properties with APIs|PassageAPI]]
* {{{&lt;Passage&gt;.processText()}}} : [[Managing Passage Properties with APIs|PassageAPI]]

&lt;h3&gt;Save API&lt;/h3&gt;
* {{{Save Objects}}} : [[Save Objects and Their Contents|SaveAPI-Objects]] 
* {{{Save.clear()}}} : [[The Basic APIs of the Save Elements|SaveAPI-General]]
* {{{Save.get()}}} : [[The Basic APIs of the Save Elements|SaveAPI-General]]
* {{{Save.ok()}}} : [[The Basic APIs of the Save Elements|SaveAPI-General]]
&lt;h4&gt;Slots &lt;/h4&gt;\
* {{{Save.slots.length}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.count()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.delete()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.get()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.has()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.isEmpty()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.load()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.ok()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
* {{{Save.slots.save()}}} : [[Managing the Save Slots|SaveAPI-Slots]]
&lt;h4&gt;Autosave &lt;/h4&gt;\
* {{{Save.autosave.delete()}}} : [[Managing the Autosave Slot|SaveAPI-Autosave]] 
* {{{Save.autosave.get()}}} : [[Managing the Autosave Slot|SaveAPI-Autosave]] 
* {{{Save.autosave.has()}}} : [[Managing the Autosave Slot|SaveAPI-Autosave]] 
* {{{Save.autosave.load()}}} : [[Managing the Autosave Slot|SaveAPI-Autosave]] 
* {{{Save.autosave.ok()}}} : [[Managing the Autosave Slot|SaveAPI-Autosave]] 
* {{{Save.autosave.save()}}} : [[Managing the Autosave Slot|SaveAPI-Autosave]] 
&lt;h4&gt;Disk&lt;/h4&gt;\
* {{{Save.export()}}} : [[The Basic APIs of the Save Elements|SaveAPI-General]]
* {{{Save.import()}}} : [[The Basic APIs of the Save Elements|SaveAPI-General]]
&lt;h4&gt;Serialization&lt;/h4&gt;\
* {{{Save.serialize()}}} : [[The Basic APIs of the Save Elements|SaveAPI-General]]
* {{{Save.deserialize()}}} : [[The Basic APIs of the Save Elements|SaveAPI-General]]
&lt;h4&gt;Events &lt;/h4&gt;\
* {{{Save.onLoad.add()}}} : [[Using Save-related Events|SaveAPI-Events]] 
* {{{Save.onLoad.clear()}}} : [[Using Save-related Events|SaveAPI-Events]] 
* {{{Save.onLoad.delete()}}} : [[Using Save-related Events|SaveAPI-Events]] 
* {{{Save.onLoad.size}}} : [[Using Save-related Events|SaveAPI-Events]] 
* {{{Save.onSave.add()}}} : [[Using Save-related Events|SaveAPI-Events]] 
* {{{Save.onSave.clear()}}} : [[Using Save-related Events|SaveAPI-Events]] 
* {{{Save.onSave.delete()}}} : [[Using Save-related Events|SaveAPI-Events]] 
* {{{Save.onSave.size}}} : [[Using Save-related Events|SaveAPI-Events]] 

&lt;h3&gt;Setting API&lt;/h3&gt;
* {{{Setting.addHeader()}}} : [[Adding Headers|SettingsHeader]]
* {{{Setting.addToggle()}}} : [[Creating a Toggle Setting|SettingsToggle]]
* {{{Setting.addList()}}} : [[Creating a List Setting|SettingsList]]
* {{{Setting.addRange()}}} : [[Creating a Slider|SettingsRange]]
* {{{Setting.load()}}} : [[Going Further with Settings|Settings-More]]
* {{{Setting.reset()}}} : [[Going Further with Settings|Settings-More]]
* {{{Setting.save()}}} : [[Going Further with Settings|Settings-More]]
* {{{settings}}} : [[Going Further with Settings|Settings-More]]

&lt;h3&gt;State API&lt;/h3&gt;
* {{{State.active}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.bottom}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.current}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.length}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.passage}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.size}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.temporary}}} : [[Managing the State of Variables|StateAPI-Variable]]
* {{{State.top}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.turns}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.variables}}} : [[Managing the State of Variables|StateAPI-Variable]]
* {{{State.getVar()}}} : [[Managing the State of Variables|StateAPI-Variable]]
* {{{State.has()}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.hasPlayed()}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.index()}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.isEmpty()}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.peek()}}} : [[Exploring the Different Moments inside the State|StateAPI-State]] 
* {{{State.metadata.size}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.metadata.clear()}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.metadata.delete()}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.metadata.entries()}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.metadata.get()}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.metadata.has()}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.metadata.keys()}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.metadata.set()}}} : [[Using the Story Metadata|StateAPI-Metadata]] 
* {{{State.prng.init()}}} : [[Initialising a Seedable PRNG|StateAPI-PRNG]] 
* {{{State.prng.isEnabled()}}} : [[Initialising a Seedable PRNG|StateAPI-PRNG]] 
* {{{State.prng.pull}}} : [[Initialising a Seedable PRNG|StateAPI-PRNG]] 
* {{{State.prng.seed}}} : [[Initialising a Seedable PRNG|StateAPI-PRNG]] 
* {{{State.random()}}} : [[Initialising a Seedable PRNG|StateAPI-PRNG]] 
* {{{State.setVar()}}} : [[Managing the State of Variables|StateAPI-Variable]]

&lt;h3&gt;Story API&lt;/h3&gt;
* {{{Story.domId}}} : [[Managing Story Elements with APIs|StoryAPI]]
* {{{Story.ifId}}} : [[Managing Story Elements with APIs|StoryAPI]]
* {{{Story.title}}} : [[Managing Story Elements with APIs|StoryAPI]]
* {{{Story.get()}}} : [[Managing Story Elements with APIs|StoryAPI]]
* {{{Story.has()}}} : [[Managing Story Elements with APIs|StoryAPI]]
* {{{Story.lookup()}}} : [[Managing Story Elements with APIs|StoryAPI]]
* {{{Story.lookupWith()}}} : [[Managing Story Elements with APIs|StoryAPI]]

&lt;h3&gt;Template API&lt;/h3&gt;
* {{{Template.size}}}: [[The Template APIs|TemplateAPI]] 
* {{{Template.add()}}}: [[The Template APIs|TemplateAPI]] 
* {{{Template.delete()}}}: [[The Template APIs|TemplateAPI]] 
* {{{Template.get()}}}: [[The Template APIs|TemplateAPI]] 
* {{{Template.has()}}}: [[The Template APIs|TemplateAPI]] 

&lt;h3&gt;UI API&lt;/h3&gt;
* {{{UI.alert()}}} : [[More Popups APIs|API-Dialog]] 
* {{{UI.jumpto()}}} : [[Open the JumpTo, Restart, Saves, and Settings PopUp|Basic-API-UI]] 
* {{{UI.restart()}}} : [[Open the JumpTo, Restart, Saves, and Settings PopUp|Basic-API-UI]] 
* {{{UI.saves()}}} : [[Open the JumpTo, Restart, Saves, and Settings PopUp|Basic-API-UI]] 
* {{{UI.settings()}}} : [[Open the JumpTo, Restart, Saves, and Settings PopUp|Basic-API-UI]] 
* {{{UI.share()}}} : [[Open the JumpTo, Restart, Saves, and Settings PopUp|Basic-API-UI]] 

&lt;h3&gt;UIBar API&lt;/h3&gt;
* {{{UIBar.destroy()}}} : [[Handle the SideBar|Basic-API-UIBar]]
* {{{UIBar.hide()}}} : [[Handle the SideBar|Basic-API-UIBar]]
* {{{UIBar.isHidden()}}} : [[More UIBar APIs|API-UIBar]] 
* {{{UIBar.isStowed()}}} : [[More UIBar APIs|API-UIBar]] 
* {{{UIBar.show()}}} : [[Handle the SideBar|Basic-API-UIBar]]
* {{{UIBar.stow()}}} : [[Handle the SideBar|Basic-API-UIBar]]
* {{{.unstow()}}} : [[Handle the SideBar|Basic-API-UIBar]]
* {{{UIBar.update()}}} : [[More UIBar APIs|API-UIBar]] 

&lt;div id=&quot;link-menu&quot;&gt;&lt;&lt;back &quot;Return to Previous Page&quot;&gt;&gt; - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="4" name="Macros List" tags="" position="1200,300" size="200,100">&lt;h1&gt;Macro List&lt;/h1&gt;
Below, you will find the alphabetical list of SugarCube macro, and where they are discussed in this guide.

* {{{&lt;&lt;actions&gt;&gt;}}}: [[Single-Use Choice Lists|Macro-Action-Choice]]
* {{{&lt;&lt;addclass&gt;&gt;}}}: [[DOM Macros and Changing Class of an Element|Macro-DOM-Adv]]
* {{{&lt;&lt;append&gt;&gt;}}}: [[DOM Macros and Revealing Text in Targeted Spots|Macro-ApPreRepCopy]]
* {{{&lt;&lt;audio&gt;&gt;}}}: [[Playing Tracks in a Passage|Audio-Macro]]
* {{{&lt;&lt;back&gt;&gt;}}}: [[Going Back or Returning to a Passage with a Special Link|Macro-Back-Return]]
* {{{&lt;&lt;break&gt;&gt;}}}: [[Loops and Repeats - Two Ways|Macro-For-Repeat]]
* {{{&lt;&lt;button&gt;&gt;}}}: See {{{&lt;&lt;link&gt;&gt;}}}
* {{{&lt;&lt;cacheaudio&gt;&gt;}}}: [[Setting up the Audio Tracks|CacheAudio]]
* {{{&lt;&lt;capture&gt;&gt;}}}: [[Capturing the Value of a Variable|Macro-Capture]]
* {{{&lt;&lt;checkbox&gt;&gt;}}}: [[Multi or Single Option Choices|Macro-CheckRadio]]
* {{{&lt;&lt;choice&gt;&gt;}}}: [[Single-Use Choice Lists|Macro-Action-Choice]]
* {{{&lt;&lt;continue&gt;&gt;}}}: [[Loops and Repeats - Two Ways|Macro-For-Repeat]]
* {{{&lt;&lt;copy&gt;&gt;}}}: [[DOM Macros and Revealing Text in Targeted Spots|Macro-ApPreRepCopy]]
* {{{&lt;&lt;createaudiogroup&gt;&gt;}}}: [[Create Track Groups and Playlists|Macro-Group-Playlist]]
* {{{&lt;&lt;createplaylist&gt;&gt;}}}: [[Create Track Groups and Playlists|Macro-Group-Playlist]]
* {{{&lt;&lt;cycle&gt;&gt;}}}: [[Cycles and Conditional Options|Macro-Cycle]]
* {{{&lt;&lt;done&gt;&gt;}}}: [[Emulating PassageDone for one Passage|Macro-Done]]
* {{{&lt;&lt;for&gt;&gt;}}}: [[Loops and Repeats - Two Ways|Macro-For-Repeat]]
* {{{&lt;&lt;if&gt;&gt;}}}: [[Display Variation|Macro-If-Basic]], [[More Conditional Statements|Macro-If]]
* {{{&lt;&lt;include&gt;&gt;}}}: [[Including a Passage inside another|Macro-Include]]
* {{{&lt;&lt;goto&gt;&gt;}}}: [[Sending the Player to a Passage|Macro-Goto]], [[Overriding the Navigation to a Passage|Basic-Config-Navig]]
* {{{&lt;&lt;link&gt;&gt;}}}: [[Linking Passages|Macro-Link-Basic]], [[Displaying more than text in Links|Macro-Link]]
* {{{&lt;&lt;linkappend&gt;&gt;}}}: [[Revealing Extra Text and Disappearing Links|Macro-Link-AppPreRep]]
* {{{&lt;&lt;linkprepend&gt;&gt;}}}: [[Revealing Extra Text and Disappearing Links|Macro-Link-AppPreRep]]
* {{{&lt;&lt;linkreplace&gt;&gt;}}}: [[Revealing Extra Text and Disappearing Links|Macro-Link-AppPreRep]]
* {{{&lt;&lt;listbox&gt;&gt;}}}: [[Listboxes and Conditional Options|Macro-Listbox]]
* {{{&lt;&lt;masteraudio&gt;&gt;}}}: [[Other Audio Macros|Audio-Other]]
* {{{&lt;&lt;nobr&gt;&gt;}}}: [[Removing Blank Space and Hiding Code|Macro-Nobr-Silent]]
* {{{&lt;&lt;numberbox&gt;&gt;}}}: [[Player Input in three macros|Macro-Input]]
* {{{&lt;&lt;playlist&gt;&gt;}}}: [[Playing Tracks in a Passage|Audio-Macro]]
* {{{&lt;&lt;prepend&gt;&gt;}}}: [[DOM Macros and Revealing Text in Targeted Spots|Macro-ApPreRepCopy]]
* {{{&lt;&lt;print&gt;&gt;}}} / {{{&lt;&lt;=&gt;&gt;}}} / {{{&lt;&lt;-&gt;&gt;}}}: [[Display Variables, the Print Macro and Variants|Macro-Print]]
* {{{&lt;&lt;radiobutton&gt;&gt;}}}: [[Multi or Single Option Choices|Macro-CheckRadio]]
* {{{&lt;&lt;remove&gt;&gt;}}}: [[DOM Macros and Revealing Text in Targeted Spots|Macro-ApPreRepCopy]]
* {{{&lt;&lt;removeaudiogroup&gt;&gt;}}}: [[Other Audio Macros|Audio-Other]]
* {{{&lt;&lt;removeclass&gt;&gt;}}}: [[DOM Macros and Changing Class of an Element|Macro-DOM-Adv]]
* {{{&lt;&lt;removeplaylist&gt;&gt;}}}: [[Other Audio Macros|Audio-Other]]
* {{{&lt;&lt;repeat&gt;&gt;}}}: [[Loops and Repeats - Two Ways|Macro-For-Repeat]]
* {{{&lt;&lt;replace&gt;&gt;}}}: [[DOM Macros and Revealing Text in Targeted Spots|Macro-ApPreRepCopy]]
* {{{&lt;&lt;return&gt;&gt;}}}: [[Going Back or Returning to a Passage with a Special Link|Macro-Back-Return]]
* {{{&lt;&lt;run&gt;&gt;}}}: [[Unsetting Variables|Macro-Unset]], [[Using JavaScript in the Passage|Macro-Script-Run]]
* {{{&lt;&lt;script&gt;&gt;}}}: [[Using JavaScript in the Passage|Macro-Script-Run]]
* {{{&lt;&lt;set&gt;&gt;}}}: [[Tracking Information|Macro-Set-Basic]], [[Setting and Changing Variables|Macro-Set]]
* {{{&lt;&lt;silently&gt;&gt;}}}: [[Removing Blank Space and Hiding Code|Macro-Nobr-Silent]]
* {{{&lt;&lt;stop&gt;&gt;}}}: [[Loops and Repeats - Two Ways|Macro-For-Repeat]]
* {{{&lt;&lt;switch&gt;&gt;}}}: [[An Alternative to Conditional Statements|Macro-Switch]]
* {{{&lt;&lt;textarea&gt;&gt;}}}: [[Player Input in three macros|Macro-Input]]
* {{{&lt;&lt;textbox&gt;&gt;}}}: [[Player Input in three macros|Macro-Input]]
* {{{&lt;&lt;timed&gt;&gt;}}}: [[Delaying Displaying Text or Running Code|Macro-Timed]]
* {{{&lt;&lt;toggleclass&gt;&gt;}}}: [[DOM Macros and Changing Class of an Element|Macro-DOM-Adv]]
* {{{&lt;&lt;type&gt;&gt;}}}: [[Displaying Text Letter by Letter|Macro-Type]]
* {{{&lt;&lt;unset&gt;&gt;}}}: [[Unsetting Variables|Macro-Unset]]
* {{{&lt;&lt;waitforaudio&gt;&gt;}}}: [[Setting up the Audio Tracks|CacheAudio]]
* {{{&lt;&lt;widget&gt;&gt;}}}: [[Creating and Using a Widget|Macro-Widget]]

&lt;div id=&quot;link-menu&quot;&gt;&lt;&lt;back &quot;Return to Previous Page&quot;&gt;&gt; - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="5" name="Widget" tags="widget nobr" position="1900,100" size="100,100">&lt;&lt;widget &quot;SomeWidget&quot;&gt;&gt;
    Wow Some Text
&lt;&lt;/widget&gt;&gt;
&lt;&lt;widget &quot;SimonSays&quot;&gt;&gt;
    &lt;&lt;set _array to [&quot;Raise your hands!&quot;, &quot;Jump!&quot;, &quot;Dance!&quot;]&gt;&gt;
    &lt;&lt;print _array.random()&gt;&gt;
&lt;&lt;/widget&gt;&gt;
&lt;&lt;widget &quot;SimonSpecialSay&quot;&gt;&gt;
    &lt;&lt;if _args[0]&gt;&gt;
        &lt;&lt;print _args[0]&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;SimonSays&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/widget&gt;&gt;
&lt;&lt;widget &quot;SimonDoes&quot; container&gt;&gt;
    &lt;div class=&quot;simon&quot;&gt;
        &lt;hr class=&quot;before-simon&quot;&gt;
        &lt;p class=&quot;simon-does&quot;&gt;_contents&lt;/p&gt;
    &lt;/div&gt;
&lt;&lt;/widget&gt;&gt;</tw-passagedata><tw-passagedata pid="6" name="TheCube" tags="Twine.image" position="2100,400" size="100,100">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABLCAYAAAA4TnrqAAAAB3RJTUUH5AMQDQ4vazJd/wAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAzdJREFUeNrt3M1rGkEUAHDb/jO9tce20B5bUKOiLpqIH/9Gbh4CvQQCnsV6r7d4rh9gY8EYjYk5qQcPBmM8iB6E7E7nyS5Yu36s7uzne/BYFnZ25v2cdZaFXYfDgHF0dPTWgbE5XC7XN6/XW6VYxOPxXNHtV1SRQfL5fH8A6fj4WEilUiQcDguwL+LZHu0VnT0cxbgHlFgsxufzeTKbzch8Pl9sYT8ajfIi2j0cD+0QSURaTQkNjrMT2gKJXm7tXZBsiZZMJl+73e7Yvkjb0OC8pkdTG2kXNOgP+kUkK6FpjWRKNI7j3iwjxeNxTZFMgSYh0VXpwQhI69BgXMtoMG7dkBKJhKGQtqHBuJmjycwkwchI69Dgx2WGZnakDTNNUA3NakjM0GjDTzTrcJJIJCLkcjkymUwsgbSaUBfUd3JyIqHVoX4lD9++Q8N0Ov1oVSQ5tGw2+wh1Q/2KsarVKmk0GrdPT091K0PRS7L+/Px8OxgMyEFYtVptkVZEk5BGoxGBVA1rBe3GSkjMsMyMRpFu5JCYY5kJbRuSZlhGRtsVSXMsI6EpRdINaxltOBw2zICkO5aUzWbzmhZwxxJpOp02DkEyDBZLNDqT7sbj8fWhSIbDUhNNbSTDYh2CxgrJ8FhK0FgjmQZrE5pWSKbDEpNvtVq/KVCVwl3RAnitoMyItch2u13UEgmxEAuxEAuxEAuxEAuxEAuxEAuxEAuxEAuxEAuxEAuxEAuxEMsaWOVy2VZYvV5POZbH4zmFRhzHvVxcXJBKpWJprH6/TzKZDAmFQi/iZxJOFb044Ha7P9KGl9DY7/fzZ2dnpFQqWQqr2+0S+CxCIBDgxRl1CXXv/VqKHmissVRH0hONFRZzJD3Q1MbSHElLNLWwOp3Of0g0P+j2+i90TleP/DJasVjUFWsVSRyffkgs0fbFMjwSCzSlWCtIguGRNqAJStF2xTI9khpo27AkpGAwKCH9dDqd7y3zAR8oBoraBW0dlhwSXZXfOawaUNw2tFUs2yEpQZOwbI8k84TjC4UowOoJf9Tn5+ekUChU0+k0PPWQbgF+wXEOjH/QiuKdNpGQXC7XZ9TZjPYDkTDsE38BhSF0jgiMpUIAAAAASUVORK5CYII=</tw-passagedata><tw-passagedata pid="7" name="Credits" tags="side popup" position="1900,400" size="100,100">This guide was constructed by &#39;&#39;manonamora&#39;&#39;.
It is based on the SugarCube official documentation, created by Thomas M. Edwards, the developer of the SugarCube format.

&lt;h3&gt;manonamora&lt;/h3&gt;\
You can find:
* my other templates on [[Itch|https://manonamora.itch.io/]], as well as my guides:
** [[Ready-to-Use Tweego and Guide|https://manonamora.itch.io/ready-to-use-tweego-folder]]
** [[ChoiceScript to SugarCube Guide|https://manonamora.itch.io/choicescript-sugarcube-tweego-folder]]
* my games and IF experiments on [[Itch|https://manonamora.itch.io/]]
* me, and ask me questions, over on [[Tumblr|https://manonamora-if.tumblr.com]] or [[my website|https://manonamora.neocities.org/]]
* my Twine Resource Masterlist [[on Tumbr|https://manonamora-if.tumblr.com/post/700577877042888704/]] or the [[IntFiction Forum|https://intfiction.org/t/twine-resource-masterlist-wiki/65903]] (more up to date).

&lt;h3&gt;Twine and SugarCube&lt;/h3&gt;\
[[About Twine and SugarCube|About]]
You can download Twine over on the [[Twinery.org|https://twinery.org/]] website, which includes the SugarCube format.
Thomas M. Edwards hosts the Documentation for the SugarCube format over on [[his website|https://www.motoslave.net/sugarcube/2/docs/]].

You can also find resources and help with Twine and SugarCube:
* on the [[IntFiction Forum|https://intfiction.org/c/authoring/twine/46]]
* on the [[Twine Subreddit|https://www.reddit.com/r/twinegames/]]
* in the [[Twine Discord|https://discord.gg/n5dJvPp]]
* and more listed in this [[Masterlist|https://manonamora-if.tumblr.com/post/700577877042888704/]] ([[IntFiction Forum copy|https://intfiction.org/t/twine-resource-masterlist-wiki/65903]])

&lt;h3&gt;HTML, CSS, JavaScript&lt;/h3&gt;\
There are many online courses to learn the basics (or further) of the Twine-adjacent languages: HTML, CSS, JavaScript/jQuery.
* the [[W3 School|https://www.w3schools.com/]] has the most beginner explanations, and lets you test and edit their examples.
* [[MDN Web Docs|https://developer.mozilla.org/en-US/]] is more technical but provides a more extensive documentation.
* [[jQuery|https://jquery.com/]] has also a special documentation website.

&lt;h3&gt;This Guide also uses...&lt;/h3&gt;\
The {{{&lt;&lt;message&gt;&gt;}}} and {{{Dialog API}}} macros from [[Chapel|https://github.com/ChapelR/custom-macros-for-sugarcube-2/]].
The Accessibility Fix for the {{{&lt;&lt;cycle&gt;&gt;}}} macro by [[HiEv|https://www.patreon.com/HiEv]].

&lt;h3&gt;A Special Thanks to...&lt;/h3&gt;\
* Chris Klimas for creating Twine, and TME for making the SugarCube format and the Tweego compiler.
* Cycy for making the Twee 3 Language Tool extension for VScode.
* The Twine Discord, especially Crepes, TRBRY, Gwen, Cyrus, Sjoerd, SleepyFool, TME, for their help and sharing examples when I forgot what certain macros were supposed to do!</tw-passagedata><tw-passagedata pid="8" name="Organise" tags="" position="2475,100" size="100,100">&lt;h1&gt;Some Random Stuff That will be Organised Later&lt;/h1&gt;
Here are some SugarCube relevant bits, which I haven&#39;t found a good place to put right now.
The links below won&#39;t change but may be located in a different Sub Menu at a later date. See [[Update Log]] for more information.

Welp there is nothing there:P
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="9" name="Passage" tags="" position="2475,225" size="100,100">This is an empty passage for an interactive example.

&lt;&lt;back &quot;Go back to the previous passage!&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="10" name="StoryAuthor" tags="" position="2300,400" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;This is made by me! Manon :D&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="11" name="StoryBanner" tags="" position="2300,100" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;&lt;img data-passage=&quot;TheCube&quot;&gt;&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="12" name="StoryCaption" tags="" position="2300,500" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;I can&#39;t think of a good caption... so here&#39;s some text&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="13" name="StoryDisplayTitle" tags="" position="2300,200" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;SG SUPER GUIDE YO@!&lt;&lt;else&gt;&gt;100% Good Twine SugarCube Guide&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="14" name="StoryMenu" tags="" position="2300,600" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;[[This will only accept links, and this one is broken]]
	[[But this one will send you back to the main menu!|Start]]
	And this won&#39;t appeat, because it&#39;s not a link.
	&lt;&lt;button [[And neither will this, because a button is not a link]]&gt;&gt;&lt;&lt;/button&gt;&gt;
	&lt;&lt;else&gt;&gt;[[Index]]
	&lt;&lt;link &quot;Credits&quot;&gt;&gt;&lt;&lt;popup &quot;Credits&quot; &quot;Credits&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
	[[Update Log]]&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="15" name="StorySubtitle" tags="" position="2300,300" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;The bestest of guides!&lt;&lt;else&gt;&gt;Version 1.2.1&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="16" name="PassageFooter" tags="" position="2000,200" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;&lt;hr&gt;The Footer in action! included in a horizontal bar&lt;&lt;else&gt;&gt;&lt;hr&gt;
	&lt;center&gt;&lt;&lt;link &quot;Lexicon&quot;&gt;&gt;&lt;&lt;popup &#39;Lexicon&#39; &quot;Lexicon&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; - [[Pages Index|Index]]
  [[Macros List]] - [[Function/Method List]] - [[API List]]
  &lt;&lt;link &quot;Credits&quot;&gt;&gt;&lt;&lt;popup &quot;Credits&quot; &quot;Credits&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; - [[Need More Help?|https://manonamora-if.tumblr.com/ask]]&lt;/center&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="17" name="PassageHeader" tags="" position="1900,200" size="100,100">&lt;&lt;if tags().includes(&quot;sp-demo&quot;)&gt;&gt;The Header in action! included in a horizontal bar&lt;hr&gt;&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="18" name="Start" tags="noreturn menu" position="1500,100" size="200,200">&lt;div style=&quot;text-align:right;font-size:85%;&quot;&gt;Last Updated: 24 Jan &#39;24&lt;/div&gt;
&lt;h1&gt;100% Good Twine SugarCube Guide&lt;/h1&gt;\
This guide was created as an &#39;&#39;alternative&#39;&#39; to the SugarCube documentation, including simpler explanations to the macros and with clearer examples when possible. It is meant to make the SugarCube format more accessible to new and learning users.

The guide covers the different aspects of the SugarCube format, from its particular markup, to its macros, functions, and APIs. It also touches upon possible customisation of SugarCube projects, with editing the StyleSheet with CSS or the JavaScript passage. And, it brushes upon aspects of accessibility in terms of code, design, and formatting.
&gt; This guide is based on the [[official SugarCube documentation|https://www.motoslave.net/sugarcube/2/docs/]], and is up to date as of the &#39;&#39;version 2.36.1&#39;&#39;. For later version, please refer to the official documentation. /* Though, I will update this guide when SG updates, as soon as I am able */
\
The guide is separated in different categories: &#39;&#39;The Basics(+)&#39;&#39;, &#39;&#39;Intermediate Use&#39;&#39;, and &#39;&#39;Advanced Mode&#39;&#39;. 
Only the Basics are necessary to be able to create a game with SugarCube. 
Knowledge of CSS, JavaScript/jQuery may be required for more complex elements.
&gt; &#39;&#39;Note:&#39;&#39; any coding done in SugarCube is case and character sensitive, meaning that 
&gt; {{{name ≠ Name}}} or {{{&quot; &quot; ≠ “ ”}}}.

&gt; &#39;&#39;The Basics&#39;&#39;
* [[About Twine and SugarCube|About]]
* [[Starting with SugarCube|Basics]] 
\
&gt; &#39;&#39;The Basics+&#39;&#39;
* [[SugarCube Markup and Basic Styling|Markup]] 
* [[Going Further with the Basics|Macro-Basic]] 
* [[Adding some Interactivity|Macro-Interact]] 
* [[Basic Special Passages|Special-Passage]] 
* [[About JavaScript and the StyleSheet|Base-JS-CSS]] 
* [[ULRs for Assets and Testing|URL-Types]] 
\
&gt; &#39;&#39;Intermediate Use&#39;&#39;
* [[More SugarCube Markup|Markup-Int]] 
* [[More Interactivity Macros|Macro-Interact-Adv]] 
* [[Macros of Convenience|Macro-Conv]] 
* [[More Special Passages and Tags|Special-Tags]] 
* [[Harness the Power of Functions|Functions]] 
* [[Using Methods to change Variables|Methods]] 
* [[Adding Sound with the Audio Macros|Macro-Audio]]
* [[Going further in Styling with CSS and JavaScript|Int-JS-CSS]] 
* [[Some Useful Basic APIs|Basic-API]] 
* [[Edit the Built-In Text or Change the Game&#39;s Language|Localization]]
\
&gt; &#39;&#39;Advanced Mode&#39;&#39;
&gt; &#39;&#39;Note:&#39;&#39; Many of the elements included in the following chapters will require knowledge of JavaScript, jQuery, and understanding of the core processed of SugarCube.
* [[Advanced Macros|Macro-Adv]]
* [[More Variable and Interaction Methods|Methods-Adv]] 
* [[Going Further with Basic APIs and More|API-Adv]] 
* [[The Settings APIs|Settings]] 
* [[The Save APIs and Further Saving Configurations|SaveAPI]] 
* [[Going Further with the Engine API|Engine-API]]
* [[More Configuration APIs to Customise Interaction|Config-API]] 
* [[Getting the FullScreen Experience|FullScreen]] 
* [[Trigger Code with Special Events|Events]] 
* [[Creating your Own Macro|Macro]] 
* [[Managing Story Elements with APIs|StoryAPI]] 
* [[Managing Passage Properties with APIs|PassageAPI]] 
* [[Dealing with the State of Play|StateAPI]] 
/*
[ ★ UPDATE ★ ] - [ ★ NEW ★ ]
* Key Binding - An Alternative|KeyBinding HIEV SETTING TO FIX
*/

If something is unclear, if you find an error in this guide, if you think I missing an important element, or if I did not provide enough examples, please [[let me know|https://manonamora-if.tumblr.com/ask]]!</tw-passagedata><tw-passagedata pid="19" name="Lexicon" tags="side popup" position="1500,400" size="100,100">__Types of Values__
//String//	: type of value, word, wrapped in {&quot; &quot;}
//Boolean// : type of value, true/false 
//Integer// : type of value, number
//Object//  : type of variable, can have multiple variables nested inside
	//Property//  : a sub element of an object
//Array//   : type of variable, can have multiple values inside

__Types of Variables__
//Temporary variable// ({{{_temp}}}) : an editable variable that disappears when moving to a new passage.
//Permanent variable// ({{{$var}}})  : an editable variable that tracks a value until changed or unset. 
//Setup variable// ({{{setup.var}}}) : a variable set at the start of the game, and cannot be edited.
//Settings variable// ({{{settings.var}}}) : a variable set with a Setting in the JavaScript passage.

__Other Concepts__
//UI//		 : User Interface, the page shown to the player
//API//      : Application Programming Interface, code that will trigger hidden built-in fuctions
//Macro//    : a block of code designed to do a specific task
	//Container// : (ref to macro) a block a code wrapped between an opening and closing tag 
	//Argument//  : (ref to macro) items set in the macro to process code.
//Function// : JavaScript blocks of code designed to do a specific task
//Method//   : JavaScript blocks of code designed to do a specific task, linked to a reciever

&gt; If something is missing here, let me know!!!!</tw-passagedata><tw-passagedata pid="20" name="Macro-Interact" tags="chapter menu" position="1400,600" size="200,100">&lt;h1&gt;Adding some Interactivity&lt;/h1&gt;
Aside from links, there are other macros to make your project a bit more interactive. SugarCube is built with multiple that can help add different kinds of gameplay elements. The macros mentioned in the pages listed below are quite useful for character creation, including puzzles, or even a combat system!
\
* [[Multi or Single Option Choices|Macro-CheckRadio]]
* [[Cycles and Conditional Options|Macro-Cycle]] 
** [[Make the Cycle Macro Accessible|Accessibility-Cycle]]
* [[Revealing Extra Text and Disappearing Links|Macro-Link-AppPreRep]]
* [[Listboxes and Conditional Options|Macro-Listbox]] 
* [[Player Input in three macros|Macro-Input]]
\
&gt; &#39;&#39;Note:&#39;&#39; For a concrete example of interactive character creator, see the [[Character Creator Template|https://manonamora.itch.io/twine-sugarcube-templates]].
\
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="21" name="Macro-CheckRadio" tags="page" position="1500,800" size="100,100">&lt;h1&gt;Multi or Single Option Choices&lt;/h1&gt;
Anoter way to display choice options aside from link can be found with the {{{&lt;&lt;checkbox&gt;&gt;}}} and {{{&lt;&lt;radiobutton&gt;&gt;}}} macros. The first allows the player to choose multiple options from a list, while the second only give the player one option to select. Both let player make choices without moving to a new passage.
These macros are great for customising characters!
\
&lt;h3&gt;{{{&lt;&lt;checkbox&gt;&gt;}}}&lt;/h3&gt;\
The {{{&lt;&lt;checkbox&gt;&gt;}}} creates a visual checkbox, which will modify the value of a variable, depending on whether the box is checked or not.

&lt;&lt;checkbox &quot;_warning&quot; false true&gt;&gt; I&#39;ve read the warnings...

This macro has 5 arguments:
* the variable saving the player&#39;s choice
* the value to give the variable when the checkbox is //unchecked//
* the value to give the variable when the checkbox is //checked//
* {{{autocheck}}} (optional): whether the checkbox should match the state of the named variable 
** this will check the box if the variable has the same current value as when the checkbox is checked
* {{{checked}}} (optional): whether the checkbox should be checked when the passage loads
{{{
    &lt;&lt;checkbox &quot;_example&quot; false true autocheck&gt;&gt; Displayed Text
    &lt;&lt;checkbox &quot;_object.property&quot; 1 0 autocheck&gt;&gt; Displayed Text
    &lt;&lt;checkbox &quot;_array[0]&quot; &quot;Tim&quot; &quot;Tom&quot; autocheck checked&gt;&gt; Displayed Text
}}}
&gt; &#39;&#39;Note:&#39;&#39; unlike {{{&lt;&lt;radiobutton&gt;&gt;}}}, you cannot use the same variable (or array position or object property) for more than one {{{&lt;&lt;checkbox&gt;&gt;}}}. Otherwsie, the last iteration with that re-used variable will override any previous choice.
\
&lt;h3&gt;{{{&lt;&lt;radiobutton&gt;&gt;}}}&lt;/h3&gt;\
The {{{&lt;&lt;radiobutton&gt;&gt;}}} creates a visual radio button, which will modify the value of a variable. You can use multiple of these linked to one variable to create a group of options.

&lt;&lt;radiobutton &quot;_pieBlueberry&quot; false&gt;&gt; I&#39;ve read the warnings...

This macro has 4 arguments:
* the variable saving the player&#39;s choice
* the value to give the variable when the option is //checked//
* {{{autocheck}}} (optional): whether the radiobutton should match the state of the named variable 
** this will check the option with the same current value of the variable 
* {{{checked}}} (optional): whether the option should be checked from the start (only for one per group)
{{{
    &lt;&lt;radiobutton &quot;_exmaple&quot; false&gt;&gt; Displayed Text
    &lt;&lt;radiobutton &quot;_object.property&quot; 1&gt;&gt; Displayed Text
    &lt;&lt;radiobutton &quot;_array[0]&quot; &quot;Tim&quot; checked&gt;&gt; Displayed Text

A radiobutton group:
    &lt;&lt;radiobutton &quot;$pie&quot; &quot;blueberry&quot; checked&gt;&gt; Blueberry?
    &lt;&lt;radiobutton &quot;$pie&quot; &quot;cherry&quot;&gt;&gt; Cherry?
    &lt;&lt;radiobutton &quot;$pie&quot; &quot;coconut cream&quot;&gt;&gt; Coconut cream?
}}}
\
&lt;h3&gt;Using a {{{&lt;label&gt;}}}&lt;/h3&gt;\
For accessiblity reasons, it is recommended to wrap each option of the macros above with the HTML markup {{{&lt;label&gt;}}}. Rather than forcing the player to click on a small checkbox or radiobutton, they will be able to click on the displayed text to trigger the macro.
{{{
    &lt;label&gt;&lt;&lt;checkbox &quot;_example&quot; false true autocheck&gt;&gt; Displayed Text&lt;/label&gt;
    &lt;label&gt;&lt;&lt;radiobutton &quot;_exmaple&quot; false&gt;&gt; Displayed Text&lt;/label&gt;
}}}
&lt;label&gt;&lt;&lt;checkbox &quot;_example&quot; false true autocheck&gt;&gt; Displayed Text&lt;/label&gt;
&lt;label&gt;&lt;&lt;radiobutton &quot;_exmaple&quot; false&gt;&gt; Displayed Text&lt;/label&gt;

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Interactive Macro Menu|Macro-Interact]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="22" name="Macro-Cycle" tags="page" position="1400,700" size="100,100">&lt;h1&gt;Cycles and Conditional Options&lt;/h1&gt;
Cycles can be a fun way to have the player interact with the story, and give a different way to format choices or display different variations. The {{{&lt;&lt;cycle&gt;&gt;}}} macro can be useful to lists MC characteristics options, or environmental observations.

I looked at her and she &lt;&lt;cycle &quot;_example&quot;&gt;&gt;
	&lt;&lt;option &quot;seemed fine&quot;&gt;&gt;
	&lt;&lt;option &quot;was distraught&quot;&gt;&gt;
	&lt;&lt;option &quot;was in tears&quot;&gt;&gt;
	&lt;&lt;option &quot;smiled&quot;&gt;&gt;
&lt;&lt;/cycle&gt;&gt;.

The macro has two sets of arguments: one for the container {{{&lt;&lt;cycle&gt;&gt;}}} and one set for the {{{&lt;&lt;option&gt;&gt;}}}/{{{&lt;&lt;optionfrom&gt;&gt;}}}.
* {{{&lt;&lt;cycle&gt;&gt;}}}:
** the variable to save the player&#39;s choice
** {{{once}}} (optional): whether the cycle stops at the last option
** {{{autoselect}}} (optional): will autoselect the option from the list, if the value of the variable is included in the list of options
* {{{&lt;&lt;option&gt;&gt;}}}
** the name of the option.
** (optional) the value of the option (if different from the name).
* {{{&lt;&lt;optionfrom&gt;&gt;}}}:
** the variable containing the list of options (array or object).

Assuming that the array {{{_pieOptions = [&quot;blueberry&quot;, &quot;cherry&quot;, &quot;coconut cream&quot;]}}}:
{{{
    &lt;&lt;cycle &quot;_example&quot; autoselect&gt;&gt;
        &lt;&lt;option &quot;seemed fine&quot; false&gt;&gt;
        &lt;&lt;option &quot;was distraught&quot;&gt;&gt;
        &lt;&lt;option &quot;was in tears&quot; 0&gt;&gt;
        &lt;&lt;option &quot;smiled&quot; &quot;bad&quot;&gt;&gt;
    &lt;&lt;/cycle&gt;&gt;
→ this cycle is the same as shown above, aside from most options having different values from their labels.

    &lt;&lt;cycle &quot;$pie&quot; once autoselect&gt;&gt;
        &lt;&lt;optionsfrom _pieOptions&gt;&gt;
    &lt;&lt;/cycle&gt;&gt;
→ this cycle will display the options from the array _pieOptions, and will stop when reaching the end.
}}}
\
&lt;h3&gt;Why {{{&lt;&lt;optionfrom&gt;&gt;}}} instead of {{{&lt;&lt;option&gt;&gt;}}}?&lt;/h3&gt;\
The reason for choosing one rather than the other will depend on preferences and situations. 

{{{&lt;&lt;optionfrom&gt;&gt;}}} allows for cleaner/less code on the page, as well as giving the option to provide different options to players depending on how the list variable is set before use. While the {{{&lt;&lt;cycle&gt;&gt;}}} macro is a container, it will not accept any other macros inside, except the option ones. This means you cannot add or remove options within the cycle code (i.e. you cannot do {{{&lt;&lt;if $var&gt;&gt;&lt;&lt;option &quot;value&quot;&gt;&gt;&lt;&lt;/if&gt;&gt;}}}).
&gt; &#39;&#39;Note:&#39;&#39; you can also hide all your cycles inside [[widgets|Macro-Widget]].
\
If the list of options is set ahead of the passage, and unchanging, {{{&lt;&lt;option&gt;&gt;}}} might be the easiest way to go. If the list&#39;s content is conditional on specific paths, then {{{&lt;&lt;optionfrom&gt;&gt;}}} might be more fitting.
&gt; &#39;&#39;Note:&#39;&#39; You can also have different {{{&lt;&lt;cycle&gt;&gt;}}}/{{{&lt;&lt;option&gt;&gt;}}} combo for each situation...
\
With {{{&lt;&lt;optionfrom&gt;&gt;}}}, you also have two options to set the cycle: using an array or an object. The first is the simplest, as you set a list of options inside an array, but it will mean the displayed text will also be the value of the cycled variable. On the other hand, objects seem a bit more complex to set up, but will allow you to display a different text than the value. 
For example, assuming that:
{{{
    _pieOptionsArray = [&quot;blueberry&quot;, &quot;cherry&quot;, &quot;coconut cream&quot;]

    _pieOptionsObject = { &quot;Blueberry&quot; : &quot;1&quot;, &quot;Cherry&quot; : &quot;2&quot;, &quot;Coconut cream&quot; : &quot;3&quot; }
}}}
&lt;&lt;set _pieOptions = [&quot;blueberry&quot;, &quot;cherry&quot;, &quot;coconut cream&quot;], _pieOptions2 = { &quot;Blueberry&quot; : &quot;1&quot;, &quot;Cherry&quot; : &quot;2&quot;, &quot;Coconut cream&quot; : &quot;3&quot; }&gt;&gt;\
The array will show : &lt;&lt;cycle &quot;_pie&quot; autoselect&gt;&gt;
	&lt;&lt;optionsfrom _pieOptions&gt;&gt;
&lt;&lt;/cycle&gt;&gt; (value of the first option: _pie)
While the object will show: &lt;&lt;cycle &quot;_pie2&quot; autoselect&gt;&gt;
	&lt;&lt;optionsfrom _pieOptions2&gt;&gt;
&lt;&lt;/cycle&gt;&gt; (value of the first option: _pie2)

&gt; &#39;&#39;Note on the cycle macro:&#39;&#39; this macro has some issues with accessiblity (screen readers). While this can be remedied with some [[extra code|Accessibility-Cycle]], this should be taken into account when creating a project.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Interactive Macro Menu|Macro-Interact]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="23" name="Accessibility-Cycle" tags="page" position="1500,700" size="100,100">&lt;h1&gt;Make the Cycle Macro Accessible&lt;/h1&gt;
While it can be a fun way to have Interactivity in your project, the {{{&lt;&lt;cycle&gt;&gt;}}} [[macro|Macro-Cycle]] has some issues with accessiblity (especially screen readers). This can be remedied with the code below, created by [[HiEv|https://www.reddit.com/r/twinegames/comments/qo1p1j/cycling_links_and_accessibility/]], which you must include in your JavaScript.
{{{
    $(document).on(&quot;:passagerender&quot;, function (event) {
        var clinks = $(event.content).find(&quot;.macro-cycle&quot;);
        if (clinks.length) {
            clinks.attr(&quot;aria-label&quot;, function (event) {
                return &quot;(click to change) &quot; + $(this).text();
            });
            clinks.on(&quot;click&quot;, function (evnt) {
                //Fix SugarCube bug with &lt;&lt;cycle&gt;&gt;+Config.cleanupWikifierOutput
                    $(this).find(&quot;p&quot;).contents().unwrap();  
                //End Fix bug 
                $(this).attr(&quot;aria-label&quot;, &quot;(click to change) &quot; + $(this).text());
            });
        }
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you are not using the {{{Config.cleanupWikifierOutput}}} [[API|Basic-API-Config]] in your project, the Fix Bug code line can be removed.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Interactive Macro Menu|Macro-Interact]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="24" name="Macro-Link-AppPreRep" tags="page" position="1500,900" size="100,100">&lt;h1&gt;Revealing Extra Text and Disappearing Links&lt;/h1&gt;
Instead of forcing the player to another passage to continue the story, or if you want to add extra flavour text, SugarCube includes three link macros with a twist: {{{&lt;&lt;linkappend&gt;&gt;}}}, {{{&lt;&lt;linkprepend&gt;&gt;}}} and {{{&lt;&lt;linkreplace&gt;&gt;}}}. Like their name suggests, when the link is clicked, the macro will add text after the link ({{{&lt;&lt;linkappend&gt;&gt;}}}), add text before the link ({{{&lt;&lt;linkprepend&gt;&gt;}}}), or replace the link with a new text ({{{&lt;&lt;linkreplace&gt;&gt;}}}).

The three container macros have each 2 arguments:
* the text to display in the link
* (optional) whether to show the new text with a transition : {{{t8n}}} or {{{transition}}}
\
&lt;h3&gt;{{{&lt;&lt;linkappend&gt;&gt;}}}&lt;/h3&gt;\
This macro is essentially a combination of the {{{&lt;&lt;link&gt;&gt;}}} and {{{&lt;&lt;append&gt;&gt;}}} macros, by creating a one-time use link that deactivates itself when clicked and prints the content coded inside the container &#39;&#39;after&#39;&#39; that link.
{{{
    &lt;&lt;linkappend &quot;text in link&quot; t8n&gt;&gt;text to appear after the link&lt;&lt;/linkappend&gt;&gt;
    &lt;&lt;linkappend &quot;text in link&quot; t8n&gt;&gt;/* Code */&lt;&lt;/linkappend&gt;&gt;
}}}
Ex: I ate a &lt;&lt;linkappend &quot;cookie&quot; t8n&gt;&gt;, which was filled with chocolate&lt;&lt;/linkappend&gt;&gt;.
\
&lt;h3&gt;{{{&lt;&lt;linkprepend&gt;&gt;}}}&lt;/h3&gt;\
This macro is essentially a combination of the {{{&lt;&lt;link&gt;&gt;}}} and {{{&lt;&lt;prepend&gt;&gt;}}} macros, by creating a one-time use link that deactivates itself when clicked and displays the content coded inside the container &#39;&#39;before&#39;&#39; that link.
{{{
    &lt;&lt;linkprepend &quot;text in link&quot; t8n&gt;&gt;text to appear before the link&lt;&lt;/linkprepend&gt;&gt;
    &lt;&lt;linkprepend &quot;text in link&quot; t8n&gt;&gt;/* Code */&lt;&lt;/linkprepend&gt;&gt;
}}}
Ex: I ate a &lt;&lt;linkprepend &quot;cookie&quot; t8n&gt;&gt;delicious &lt;&lt;/linkprepend&gt;&gt;.
\
&lt;h3&gt;{{{&lt;&lt;linkreplace&gt;&gt;}}}&lt;/h3&gt;\
This macro is essentially a combination of the {{{&lt;&lt;link&gt;&gt;}}} and {{{&lt;&lt;replace&gt;&gt;}}} macros, by creating a one-time use link that replaces itself with the content coded inside the container when clicked.
{{{
    &lt;&lt;linkreplace &quot;text in link&quot; t8n&gt;&gt;text to appear before the link&lt;&lt;/linkreplace&gt;&gt;
    &lt;&lt;linkreplace &quot;text in link&quot; t8n&gt;&gt;/* Code */&lt;&lt;/linkreplace&gt;&gt;
}}}
Ex: I ate a &lt;&lt;linkreplace &quot;cookie&quot; t8n&gt;&gt;slice of pie&lt;&lt;/linkreplace&gt;&gt;.

&gt; &#39;&#39;Note:&#39;&#39; if you are looking for more flexibility in the placement of the link and/or the display of the added text, you may want to use their respective [[DOM macros|Macro-ApPreRepCopy]] nested inside a {{{&lt;&lt;link&gt;&gt;}}} instead.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Interactive Macro Menu|Macro-Interact]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="25" name="Macro-Listbox" tags="page" position="1400,800" size="100,100">&lt;h1&gt;Listboxes and Conditional Options&lt;/h1&gt;
Listboxes are an easy way to have the player interact with the story, and give a different way to format choices. The {{{&lt;&lt;listbox&gt;&gt;}}} can be useful to lists options for a character&#39;s characteristics, or choosing a location to travel to.

Where to go next? &lt;&lt;listbox &quot;_example&quot;&gt;&gt;
	&lt;&lt;option &quot;Home&quot;&gt;&gt;
	&lt;&lt;option &quot;Garden&quot;&gt;&gt;
	&lt;&lt;option &quot;Cinema&quot;&gt;&gt;
	&lt;&lt;option &quot;School&quot;&gt;&gt;
&lt;&lt;/listbox&gt;&gt;

The macro has two sets of arguments: one for the container {{{&lt;&lt;listbox&gt;&gt;}}} and one set for the {{{&lt;&lt;option&gt;&gt;}}}/{{{&lt;&lt;optionfrom&gt;&gt;}}}.
* {{{&lt;&lt;listbox&gt;&gt;}}}:
** the variable to save the player&#39;s choice.
** {{{autoselect}}} (optional): will autoselect the option from the list, if the current value of the variable is included in the list of options
* {{{&lt;&lt;option&gt;&gt;}}}
** the name of the option.
** (optional) the value of the option (if different from the name).
* {{{&lt;&lt;optionfrom&gt;&gt;}}}:
** the variable containing the list of options (array or object).

Assuming that the array {{{_pieOptions = [&quot;blueberry&quot;, &quot;cherry&quot;, &quot;coconut cream&quot;]}}}:
{{{
    &lt;&lt;listbox &quot;_example&quot; autoselect&gt;&gt;
        &lt;&lt;option &quot;Home&quot; false&gt;&gt;
        &lt;&lt;option &quot;Garden&quot;&gt;&gt;
        &lt;&lt;option &quot;Cinema&quot; 0&gt;&gt;
        &lt;&lt;option &quot;School&quot; &quot;bad&quot;&gt;&gt;
    &lt;&lt;/listbox&gt;&gt;
→ this list is the same as shown above, aside from most options having different values from their labels.

    &lt;&lt;listbox &quot;$pie&quot; autoselect&gt;&gt;
        &lt;&lt;optionsfrom _pieOptions&gt;&gt;
    &lt;&lt;/listbox&gt;&gt;
→ this list will display the options from the array _pieOptions.
}}}
\
&lt;h3&gt;Why {{{&lt;&lt;optionfrom&gt;&gt;}}} instead of {{{&lt;&lt;option&gt;&gt;}}}?&lt;/h3&gt;\
The reason for choosing one rather than the other will depend on preferences and situations. 

{{{&lt;&lt;optionfrom&gt;&gt;}}} allows for cleaner/less code on the page, as well as giving the option to provide different options to players depending on how the list variable is set before use. While the {{{&lt;&lt;listbox&gt;&gt;}}} macro is a container, it will not accept any other macros inside, except the option ones. This means you cannot add or remove options within the listbox code (i.e. you cannot do {{{&lt;&lt;if $var&gt;&gt;&lt;&lt;option &quot;value&quot;&gt;&gt;&lt;&lt;/if&gt;&gt;}}}).
&gt; &#39;&#39;Note:&#39;&#39; you can also hide all your cycles inside [[widgets|Macro-Widget]].
\
If the list of options is set ahead of the passage, and unchanging, {{{&lt;&lt;option&gt;&gt;}}} might be the easiest way to go. If the list&#39;s content is conditional on specific paths, then {{{&lt;&lt;optionfrom&gt;&gt;}}} might be more fitting.
&gt; &#39;&#39;Note:&#39;&#39; You can also have different {{{&lt;&lt;listbox&gt;&gt;}}}/{{{&lt;&lt;option&gt;&gt;}}} combo for each situation...
\
With {{{&lt;&lt;optionfrom&gt;&gt;}}}, you also have two options to set the cycle: using an array or an object. The first is the simplest, as you set a list of options inside an array, but it will mean the displayed text will also be the value of the cycled variable. On the other hand, objects seem a bit more complex to set up, but will allow you to display a different text than the value. 
For example, assuming that:
{{{
    _pieOptionsArray = [&quot;blueberry&quot;, &quot;cherry&quot;, &quot;coconut cream&quot;]

    _pieOptionsObject = { &quot;Blueberry&quot; : &quot;1&quot;, &quot;Cherry&quot; : &quot;2&quot;, &quot;Coconut cream&quot; : &quot;3&quot; }
}}}
&lt;&lt;set _pieOptions = [&quot;blueberry&quot;, &quot;cherry&quot;, &quot;coconut cream&quot;], _pieOptions2 = { &quot;Blueberry&quot; : &quot;1&quot;, &quot;Cherry&quot; : &quot;2&quot;, &quot;Coconut cream&quot; : &quot;3&quot; }&gt;&gt;\
The array will show : &lt;&lt;listbox &quot;_pie&quot; autoselect&gt;&gt;
	&lt;&lt;optionsfrom _pieOptions&gt;&gt;
&lt;&lt;/listbox&gt;&gt; (value of the first option: _pie)
While the object will show: &lt;&lt;listbox &quot;_pie2&quot; autoselect&gt;&gt;
	&lt;&lt;optionsfrom _pieOptions2&gt;&gt;
&lt;&lt;/listbox&gt;&gt; (value of the first option: _pie2)

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Interactive Macro Menu|Macro-Interact]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="26" name="Macro-Input" tags="page" position="1400,900" size="100,100">&lt;h1&gt;Player Input in three macros&lt;/h1&gt;
SugarCube offers three variations of input boxes: the {{{&lt;&lt;textbox&gt;&gt;}}}, the {{{&lt;&lt;textarea&gt;&gt;}}}, and the {{{&lt;&lt;numberbox&gt;&gt;}}}. The latter deals with integer (numbers), while the other two save inputs into strings (words).
\
&lt;h3&gt;The {{{&lt;&lt;textbox&gt;&gt;}}} macro&lt;/h3&gt;\
The textbox allows the player to indicate a string of word(s). This can be useful for short and simple inputs, like a name.

&lt;&lt;textbox &quot;_wager&quot; &quot;Jane&quot;&gt;&gt;

The macro has four arguments:
* the variable to save the player input (must be wrapped inside quotes/apostrophes)
* the default text visible to the player
* {{{&quot;PassageName&quot;}}} (optional) whether the player will be sent to another passage when pressing //Enter//
* {{{autofocus}}} (optional) whether the area is automatically in focus when the passage loads
{{{
    &lt;&lt;textbox &quot;$variable&quot; &quot;Default Text&quot; &quot;NextPassage&quot; autofocus&gt;&gt;
→ this will be in focus, showing &quot;Default Text&quot;, with the final value saved in $variable, and the player sent to &quot;NextPassage&quot; when pressing Enter.

    &lt;&lt;textbox &quot;$variable&quot; &quot;&quot;&gt;&gt;
→ this will not be in focus, showing 0 as the default value, and saving the input in $variable.
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you need to check the value of the {{{&lt;&lt;textbox&gt;&gt;}}} before the player moves to another passage, I would not recommend indicating a passage name in the macro, but use a separate button/link.
\
&lt;h3&gt;The {{{&lt;&lt;numberbox&gt;&gt;}}} macro&lt;/h3&gt;\
The macro works similarly to the {{{&lt;&lt;textbox&gt;&gt;}}}, aside from saving the input as an integer instead of a string.

&lt;&lt;numberbox &quot;_wager&quot; 100&gt;&gt;

The macro has four arguments:
* the variable to save the player input (must be wrapped in quotes/apostrophes)
* the default number visible to the player
* {{{PassageName}}} (optional) whether the player will be sent to another passage when presseing //Enter//
* {{{autofocus}}} (optional) whether the area is automatically in focus 
{{{
    &lt;&lt;numberbox &quot;$variable&quot; 10 &quot;NextPassage&quot; autofocus&gt;&gt;
→ this will be in focus, showing the number 10, with the final value saved in $variable, and the player sent to &quot;NextPassage&quot; when pressing Enter.

    &lt;&lt;numberbox &quot;$variable&quot; &quot;&quot;&gt;&gt;
→ this will not be in focus, showing 0 as the default value, and saving the input in $variable.
}}}
&gt; &#39;&#39;Notes:&#39;&#39; while the macro does not have min or max value, [[the Numberpool custom macro|http://www.motoslave.net/sugarcube/2/#downloads]] does.
&gt; If you need to check the value of the {{{&lt;&lt;numberbox&gt;&gt;}}} before the player moves to another passage, I would not recommend indicating a passage name in the macro, but use a separate button/link.
\
&lt;h3&gt;The {{{&lt;&lt;textarea&gt;&gt;}}} macro&lt;/h3&gt;\
This macro creates a multi-line area for the player to input text, and saves this input inside a variable. This is a good interactive macro to save longer bits of text, like journal entries.
Unlike the two previous macros, the {{{&lt;&lt;textarea&gt;&gt;}}} allows the player to resize the input box (unless disabled with some CSS).

&lt;&lt;textarea &quot;_example&quot; &quot;This is an example of a text area.&quot;&gt;&gt;

The macro has three arguments:
* the variable to save the player input (must be wrapped in quotes/apostrophes)
* the default text visible to the player
* {{{autofocus}}} (optional) whether the area is automatically in focus 
{{{
    &lt;&lt;textarea &quot;$variable&quot; &quot;Visible Text&quot; autofocus&gt;&gt; 
→ this will be in focus and the player will see &quot;Visible Text&quot; in the box, and the player input will be saved in $variable

    &lt;&lt;textarea &quot;$variable&quot; &quot;&quot;&gt;&gt; 
→ this will not be in focus, and will not show any text, but the final input will be saved in $variable
}}}

&gt; &#39;&#39;Note on autofocus:&#39;&#39; As of SugarCube 2.36.1, the autofocus function has some issues when: it is located outside of a passage, the passage with those macros is the first one loaded (also during page refresh), more than one macros on the page has autofocus on.
&gt; This can be fixed(-ish) with some [[jQuery]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Interactive Macro Menu|Macro-Interact]] - [[Back to the Start Menu|Start]]&lt;/div&gt;
/* TODO!! TODO WAHT? of the jQuery....*/</tw-passagedata><tw-passagedata pid="27" name="Macro-Basic" tags="chapter menu" position="1100,600" size="200,100">&lt;h1&gt;Going Further with the Basics&lt;/h1&gt;
After [[linking passages|Macro-Link-Basic]], [[setting variables|Macro-Set-Basic]], and creating some simple [[conditional statements|Macro-If-Basic]], you would have the basis required to make a textual game. You can add onto this base, with more complex use of those macros, as well as including a few more related ones. This chapter is meant to expand the use of the basic macros.

* [[Displaying more than text in Links|Macro-Link]]  
* [[Setting and Changing Variables|Macro-Set]]
* [[Unsetting Variables|Macro-Unset]]  
* [[More Conditional Statements|Macro-If]]   
* [[Display Variables, the Print Macro and Variants|Macro-Print]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="28" name="Macro-Link" tags="page" position="1100,700" size="100,100">&lt;h1&gt;Displaying more than text in Links&lt;/h1&gt;
Like the [[Link Markup|Markup-Link]], you can display more than just plain text as links. This includes the content of variables, widgets, or even images (similar to the [[Image Markup|Markup-Image]]). 

You can use variables to display the text of the link, or send the player to a certain passage.
Assuming that {{{$passage = &quot;Garden&quot;}}} and {{{$text = &quot;Go take a walk&quot;}}}:
{{{
    &lt;&lt;link $text $passage&gt;&gt;&lt;&lt;/link&gt;&gt;

→ will work the same way as
    &lt;&lt;link [[Go take a walk|Garden]]&gt;&gt;&lt;&lt;/link&gt;&gt; 
→ or 
    &lt;&lt;link &quot;Go take a walk&quot; &quot;Garden&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}

Displaying &#39;&#39;the value of a variable&#39;&#39; is a bit more straightforward than with the [[Link Markup|Markup-Link]]. 
Assuming that {{{$name = &quot;Jane&quot;}}} and {{{$location = &quot;Garden&quot;}}}:&lt;&lt;set $name to &quot;Jane&quot;&gt;&gt;
{{{&lt;&lt;link &quot;I am $name&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;}}} → &lt;&lt;link &quot;I am $name&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;

You can even use &#39;&#39;conditional statements&#39;&#39; to display variation inside a link. In the example below, depending on the value of {{{$location}}}, the text will show a different text.
{{{
&lt;&lt;link &#39;&lt;&lt;if $location is &quot;Garden&quot;&gt;&gt;Go back to the house&lt;&lt;else&gt;&gt;Go to the house&lt;&lt;/if&gt;&gt;&#39; &quot;House&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;

&lt;&lt;link `($location === &quot;Garden&quot;) ? &quot;Go back to the house&quot; : &quot;Go to the house&quot;` &quot;House&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; the second example is called a //ternary conditional operator//, used in JavaScript as a one-line if-else statement. You will require a backtick {{{`}}} instead of a quote or apostrophe, as it is technically JavaScript code.
\
Similarly, for &#39;&#39;widgets&#39;&#39;, assuming that {{{&lt;&lt;widget &quot;SomeWidget&quot;&gt;&gt;Wow Some Text&lt;&lt;/widget&gt;&gt;}}}:
{{{&lt;&lt;link &quot;&lt;&lt;SomeWidget&gt;&gt;&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;}}} → &lt;&lt;link &quot;&lt;&lt;SomeWidget&gt;&gt;&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
&gt; &#39;&#39;Note:&#39;&#39; you need to wrap the widget with quotes/apostrophe inside the link! Otherwise, you will get an error.
\
As for &#39;&#39;images&#39;&#39;, you can use the [[Image markup|Markup-Image]] inside the {{{&lt;&lt;link&gt;&gt;}}} macro, or the HTML markup ({{{&lt;img&gt;}}}). You will also need to know the [[URL|URL-Types]] of the relevant image.
{{{
    &lt;&lt;link [img[URL][Passage]]&gt;&gt;&lt;&lt;/link&gt;&gt;

    &lt;&lt;link &quot;[img[URL]]&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;

    &lt;&lt;link &#39;&lt;img src=&quot;URL&quot;&gt;&#39; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
\
&lt;h3&gt;Quotes or Apostrophes... or both?&lt;/h3&gt;\
To use the {{{&lt;&lt;link&gt;&gt;}}} macro, you need to either include the [[Link Markup|Markup-Link]] or wrap the wanted text (and potentially the passage) with either Apostrophes {{{&#39; &#39;}}} or Quotes {{{&quot; &quot;}}}, which are essentially interchangeable (see examples). 

However, this can become an issue if the wrapped text/element contains apostrophes or quotes to function (like the image or the conditional statement examples above), or to format the text (like with [[bolding|Markup-Styling]]). In this case, you have multiple solutions:
&gt; //Nest one inside the other// {{{&#39; &quot; &quot; &#39;}}} or {{{&quot; &#39; &#39; &quot;}}}: 
{{{
    &lt;&lt;link &#39;&quot;I am speaking!&quot;&#39; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;link &quot;I don&#39;t think this is a good idea...&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;link &#39;&lt;img src=&quot;URL&quot;&gt;&#39; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;link &quot;//&#39;&#39;HEY!&#39;&#39;//&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
&gt; //Use the backslash before the nested character// {{{\}}}:
{{{
    &lt;&lt;link &quot;\&quot;I am speaking!\&quot;&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;link &#39;I don\&#39;t think this is a good idea...&#39; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;link &quot;&lt;img src=\&quot;URL\&quot;&gt;&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;link &quot;//\&#39;\&#39;HEY!\&#39;\&#39;//&quot; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; For story text requiring an apostrophe or quotes, I would recommend the use of the curly type ({{{“ ”}}} and {{{‘ ’}}}) rather than straight ones. This way, you would not run into the nesting issue mentioned above.
&gt; {{{&lt;&lt;link &#39;“I am speaking!”&#39; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;}}} → &lt;&lt;link &#39;“I am speaking!”&#39; &quot;Passage&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Base Macro Menu|Macro-Basic]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="29" name="Macro-Set" tags="page" position="1100,800" size="100,100">&lt;h1&gt;Setting and Changing Variables&lt;/h1&gt;
To first [[set a variable|Macro-Set-Basic]], you would most commonly use the {{{to}}} operator, as the example below:
{{{&lt;&lt;set $var to &quot;a value&quot;&gt;&gt;}}}

But, to change the value of a variable, especially if that value is numerical, the {{{&lt;&lt;set&gt;&gt;}}} macro will accept other JavaScript (mathematical) operators: 
&lt;&lt;nobr&gt;&gt;
&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;Operator&lt;/th&gt;&lt;th&gt;Explanation&lt;/th&gt;&lt;th&gt;Example&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{ = }}}&lt;/td&gt;&lt;td&gt;Works like {{{to}}}.&lt;br&gt; Assign the value to the variable.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples = 6&gt;&gt;}}}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{+=}}}&lt;/td&gt;&lt;td&gt;Adds to the current value.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples += 6&gt;&gt;}}} or {{{&lt;&lt;set $apples to $apples + 6&gt;&gt;}}} &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{-=}}}&lt;/td&gt;&lt;td&gt;Substract to the current value.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples -= 6&gt;&gt;}}} or {{{&lt;&lt;set $apples to $apples - 6&gt;&gt;}}} &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{*=}}}&lt;/td&gt;&lt;td&gt;Multiplies the current value.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples *= 6&gt;&gt;}}} or {{{&lt;&lt;set $apples to $apples * 6&gt;&gt;}}} &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{/=}}}&lt;/td&gt;&lt;td&gt;Divides the current value.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples /= 6&gt;&gt;}}} or {{{&lt;&lt;set $apples to $apples / 6&gt;&gt;}}} &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{%=}}}&lt;/td&gt;&lt;td&gt;Removes a percentage of the current value.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples %= 6&gt;&gt;}}}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{++}}}&lt;/td&gt;&lt;td&gt;Adds 1 to the current value.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples ++&gt;&gt;}}}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{--}}}&lt;/td&gt;&lt;td&gt;Removes 1 to the current value.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;set $apples --&gt;&gt;}}}&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;style&gt;td:first-of-type {width: 15%;text-align: center;}&lt;/style&gt;
&lt;&lt;/nobr&gt;&gt;
\
Aside from setting a variable with a value, you can also set it with the value of another variable, or a combination of values from multiple variables.
Assuming that {{{$test = 6}}} and {{{$apple = 4}}}:
{{{
    &lt;&lt;set $test to $apple&gt;&gt;
→ $test will have the value of $apple (= 4)

    &lt;&lt;set $test += $apple&gt;&gt;
→ $test will have the value of ($test + $apple) (= 10)

    &lt;&lt;set $test to (($apple * 4)/($test - 2))&gt;&gt;
→ $test will have the value of ($apple multiplied by 4) divided by ($test minus 2) (= 4)
}}}
&gt; &#39;&#39;Note:&#39;&#39; when handling complex calculations of variable, using parentheses {{{( )}}} will help order the code.
\
It is also possible to use some of these operators with string values and variables.
Assuming that {{{$name = &quot;Jane&quot;}}} and {{{$surname = &quot;Doe&quot;}}}, and the widget {{{&lt;&lt;widget &quot;SomeWidget&quot;&gt;&gt;Wow Some Text&lt;&lt;/widget&gt;&gt;}}}:
{{{
    &lt;&lt;set $wholename to $name + $surname&gt;&gt;
→ $wholename will have the value &quot;JaneDoe&quot;
    &lt;&lt;set $wholename to $name + &quot; &quot; + $surname&gt;&gt;
→ $wholename will have the value &quot;Jane Doe&quot;

    &lt;&lt;set $address to &quot;Hello, $name&quot;&gt;&gt;
→ $address will print &quot;Hello, Jane&quot; on the page.
}}}
&gt; &#39;&#39;Note:&#39;&#39; if the value {{{$name}}} changes or if {{{$name}}} is unset during the story, this will affect how {{{$address}}} is displayed, but not {{{$wholename}}}. 
&gt; {{{$address}}} will not show &quot;Hello, Jane&quot; if {{{$name}}} changes, but will show the current value of {{{$name}}} (or the name of the variable, if unset). 
{{{
    &lt;&lt;set $text to &quot;&lt;&lt;SomeWidget&gt;&gt;&quot;&gt;&gt;
→ $text will print the content of the widget, here &quot;Wow Some Text&quot;.
}}}

You can also mix the types of values when combining them, similarly to the examples above. Mixing anything with a string value will result in a string value. Mixing integer with a boolean will result in a integer.
Assuming that {{{$name = &quot;Jane&quot;}}} and {{{$apple = 4}}}
{{{
    &lt;&lt;set $test to $name + $apple&gt;&gt;
→ $test will have the value &quot;Jane4&quot; (string)
}}}
&gt; &#39;&#39;Note:&#39;&#39; using some mathematical operators on a string-based variable will give an error: {{{&lt;&lt;set $name /= 2&gt;&gt;}}}.
\
&lt;h3&gt;Setting up Arrays and Objects&lt;/h3&gt;\
To use an array or object variable, you need to define it as an array or object ahead of time. This can be done at the earliest inside [[StoryInit|SP-Init]], and, at the lastest, just before you use them. Defined arrays and objects can be empty before use.
Arrays need to be defined with square brackets {{{[ ]}}}, while objects need curly brackets {{{ {} }}}
{{{
→ Array:
    &lt;&lt;set $array to []&gt;&gt; → defined but empty
    &lt;&lt;set $array to [1, &quot;word&quot;, true]&gt;&gt;
    &lt;&lt;set $inventory to [&quot;pen&quot;, &quot;coins&quot;, &quot;apple&quot;]&gt;&gt;

→ Object:
    &lt;&lt;set $object to {}&gt;&gt; → defined but empty
    &lt;&lt;set $object to {number: 1, string: &quot;word&quot;, boolean: true}&gt;&gt;
    &lt;&lt;set $mc to {age: 51, hair: &quot;bald&quot;, degree: true}&gt;&gt;
}}}
After an object is defined, you can add any property to it, even if they were not listed when the main variable was set. You can also change the value of an already defined property the same way you would a regular variable.
{{{
    &lt;&lt;set $object.newproperty = &quot;value of your choice&quot;&gt;&gt;
    &lt;&lt;set $object.definedproperty = &quot;new value&quot;&gt;&gt;
}}}

As for arrays, adding or removing elements require methods, which you can learn about [[in this page|Method-Array]].
\
&lt;h3&gt;Going further:&lt;/h3&gt;\
You can also use [[functions|Functions]] and [[methods|Methods]] when setting a variable, or edit its value. 
They are most useful when changing the formatting of a string (upper/lowercase), or with statistics (e.g. health level).

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Base Macro Menu|Macro-Basic]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="30" name="Macro-Unset" tags="page" position="1200,800" size="100,100">&lt;h1&gt;Unsetting Variables with {{{&lt;&lt;unset&gt;&gt;}}}&lt;/h1&gt;
To avoid bloating the loading time of passages (lag), it is recommended to keep the number of variables set at any time to a minimum. One way is to use [[temporary variables|Variables-Base]] {{{_temp}}}, which disappear automatically when the player moves to another passage, another is to rely more on [[functions|Functions]]. The one covered here focuses on unseting permanant variables {{{$var}}} you don&#39;t need anymore, with the {{{&lt;&lt;unset&gt;&gt;}}} macro.
{{{
    &lt;&lt;unset $variable&gt;&gt;

→ multiple at once:
    &lt;&lt;unset $var, $var2, $var3&gt;&gt;
}}}
The macro can be used as is, or inside other container macros, like a {{{&lt;&lt;link&gt;&gt;}}} or a {{{&lt;&lt;button&gt;&gt;}}}.
\
&lt;h3&gt;Using the {{{&lt;&lt;run&gt;&gt;}}} macro.&lt;/h3&gt;\
The {{{&lt;&lt;run&gt;&gt;}}} macro will, as the name suggest, [[run|Macro-Script-Run]] any one-line JavaScript/jQuery code given. It can also help unset (or delete) variables from the game state. This is particularly helpful in cases where the {{{&lt;&lt;unset&gt;&gt;}}} macro doesn&#39;t work: like unseting a property of an opject ({{{$object.property}}}).

Currently, trying to unset a property inside an object ({{{&lt;&lt;unset $object.property&gt;&gt;}}}) will not just delete that property, but also unset the whole object variables (so all the other properties saved inside). To resolve this, you should use the {{{&lt;&lt;run&gt;&gt;}}} macro coupled with the JavaScript {{{delete}}} operator:  
{{{&lt;&lt;run delete $object.property&gt;&gt;}}}

Assuming that {{{$mc = {name: &quot;Jane&quot;, nickname: &quot;Janie&quot;, age: 10} }}}:
{{{
    &lt;&lt;run delete $mc.nickname&gt;&gt;
→ will only remove the {nickname} property from the object

    &lt;&lt;run delete $mc.nickname, delete $mc.age&gt;&gt;
→ this will remove both the {nickname} and {age} properties from the object 
}}}
&gt; &#39;&#39;Note&#39;&#39;: you can also unset any other variable with this method.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Base Macro Menu|Macro-Basic]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="31" name="Macro-If" tags="page" position="1200,700" size="100,100">&lt;h1&gt;More Conditional Statements&lt;/h1&gt;
While the {{{is}}} operator will often cover many situations where you would need a [[conditional statement|Macro-If-Basic]], there are other operators that can include more than one specific condition at a time. Since SugarCube is based on JavaScript, you can use either form, or mix-n-match:
&lt;&lt;nobr&gt;&gt;
    &lt;table class=&quot;ifses&quot;&gt;
        &lt;tr&gt;
            &lt;th&gt;SugarCube&lt;/th&gt;&lt;th&gt;JavaScript&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;th&gt;Example&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{is}}}&lt;/td&gt;&lt;td&gt;{{{===}}}&lt;/td&gt;&lt;td&gt;Check if //strickly// equal&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test is 1&gt;&gt;}}} {{{&lt;&lt;if $test === 1&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{isnot}}}&lt;/td&gt;&lt;td&gt;{{{!==}}}&lt;/td&gt;&lt;td&gt;Check if //strickly// NOT equal&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test isnot &quot;apple&quot;&gt;&gt;}}} {{{&lt;&lt;if $test !== &quot;apple&quot;&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{eq}}}&lt;/td&gt;&lt;td&gt;{{{==}}}&lt;/td&gt;&lt;td&gt;Check if equivalent&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test eq 45&gt;&gt;}}} {{{&lt;&lt;if $test == 45&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{neq}}}&lt;/td&gt;&lt;td&gt;{{{!=}}}&lt;/td&gt;&lt;td&gt;Check if NOT equivalent&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test neq &quot;dinner&quot;&gt;&gt;}}} {{{&lt;&lt;if $test != &quot;dinner&quot;&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{gt}}}&lt;/td&gt;&lt;td&gt;{{{&gt;}}}&lt;/td&gt;&lt;td&gt;Check if greater than&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test gt 12&gt;&gt;}}} {{{&lt;&lt;if $test &gt; 12&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{gte}}}&lt;/td&gt;&lt;td&gt;{{{&gt;=}}}&lt;/td&gt;&lt;td&gt;Check if greater or equal&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test gte $tries&gt;&gt;}}} {{{&lt;&lt;if $test &gt;= $tries&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{lt}}}&lt;/td&gt;&lt;td&gt;{{{&lt;}}}&lt;/td&gt;&lt;td&gt;Check if lower than&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test lt ($tries + 2)&gt;&gt;}}} {{{&lt;&lt;if $test &lt; ($tries +2)&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{lte}}}&lt;/td&gt;&lt;td&gt;{{{&lt;=}}}&lt;/td&gt;&lt;td&gt;Check if lower or equal&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test lte $listparticipant.length&gt;&gt;}}} {{{&lt;&lt;if $test &lt;= $listparticipant.length&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{def}}}&lt;/td&gt;&lt;td&gt;/&lt;/td&gt;&lt;td&gt;Check if variable is defined&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if def $test&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{ndef}}}&lt;/td&gt;&lt;td&gt;/&lt;/td&gt;&lt;td&gt;Check if variable is NOT defined&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if ndef $test&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{not}}}&lt;/td&gt;&lt;td&gt;{{{!}}}&lt;/td&gt;&lt;td&gt;Check if condition is //false// or Falsy&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if not $test&gt;&gt;}}} {{{&lt;&lt;if !$test&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{ }}}&lt;/td&gt;&lt;td&gt;{{{ }}}&lt;/td&gt;&lt;td&gt;Check if condition is //true// or Truthy&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{and}}}&lt;/td&gt;&lt;td&gt;{{{&amp;&amp;}}}&lt;/td&gt;&lt;td&gt;Evaluate if //all// conditions are true&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test is 1 and $name is &quot;Jane&quot;&gt;&gt;}}} {{{&lt;&lt;if $test === 1 &amp;&amp; $name === &quot;Jane&quot;&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;{{{or}}}&lt;/td&gt;&lt;td&gt;{{{||}}}&lt;/td&gt;&lt;td&gt;Evaluate if //one// of the conditions is true&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;if $test is 1 or $test if 4&gt;&gt;}}} {{{&lt;&lt;if $test === 1 || $test === 4&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;&lt;/nobr&gt;&gt;\
&lt;h3&gt;Ordering your Conditional Statements&lt;/h3&gt;\
When checking for multiple conditions with one {{{&lt;&lt;if&gt;&gt;}}} block, you need to order the conditional statements from &#39;&#39;most strict&#39;&#39; to //least//. This is because Twine reads code from top to bottom, so the program will stop at the first fulfilled condition, even if there is a more fitting situation below. For example:
{{{
    &lt;&lt;if $turn gt 3&gt;&gt;
        The Code will stop here and only show this text...
    &lt;&lt;elseif $turn gt 3 &amp;&amp; $turn lt 5&gt;&gt;
        ... even if the value of $turn is 4.
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if $turn gt 3 &amp;&amp; $turn lt 5&gt;&gt;
        But this code will only show if the value of $turn is 4...
    &lt;&lt;elseif $turn gt 3&gt;&gt;
        ...while this one will show if the value of $turn is greater then 3 
        and does not meet the condition above.
    &lt;&lt;/if&gt;&gt;
}}}
\
&lt;h3&gt;Mixing AND and OR&lt;/h3&gt;\
Instead of having a long list of {{{&lt;&lt;elseif&gt;&gt;}}} to show the same variation of text for each condition to be met, you can merge conditional statements with linking operator. 
If a variation requires multiple conditions to be met, you can merge them into one statement using the {{{and}}} operator (or {{{&amp;&amp;}}}). For a variation that could be applied to different conditions, you can merge them into one statement using the {{{or}}} operator (or {{{||}}}). 
It is also possible to mix and match those operators for more complex merge of conditional statements (see below). To organise the different conditions, it is recommended to uses parentheses {{{( )}}}.
&gt; &#39;&#39;Note:&#39;&#39; you must remember that the order of which the operators are applied, work like maths. Inside parentheses first, then layers by layers.
{{{
    &lt;&lt;if ($turn is 1) and ($name is &quot;Jane&quot;)&gt;&gt;
→ will only work if $turn has a value of 1 &gt;AND&lt; $name is &quot;Jane&quot;

    &lt;&lt;if ($turn is 3) or ($pet is &quot;dog&quot;)&gt;&gt;
→ will work if $turn has the value of 3 &gt;OR&lt; $pet is &quot;dog&quot;

    &lt;&lt;if ($turn is 4 or $pet is &quot;dog&quot;) &amp;&amp; ($name is &quot;Jane&quot; or $credit gt ($cost * 2))&gt;&gt;
→ will only work if one of the conditions in &gt;EACH&lt; block is true:
    → if $turn has the value of 4 &gt;OR&lt; $pet is &quot;dog&quot;
    → if $name is &quot;Jane&quot; &gt;OR&lt; the value of $credit is greater than 
      the value of $cost multiplied by 2
}}}
&gt; &#39;&#39;Note:&#39;&#39; for example 1 and 2, the parentheses are not mandatory, but it IS for example 3 to work as explained.
\
&lt;h3&gt;True/False and Truthy/Falsy&lt;/h3&gt;\
There is a difference between //True/False// and //Truthy/Falsy//:
* //True/False// is strickly related to Boolean values and situations
** {{{$var is true}}} or {{{hasVisited(&quot;PASSAGE&quot;) is false}}}
* //Truthy/Falsy// will look at whether a variable is defined, and what types of value it holds (including //True/False//)
&lt;table id=&quot;truthy&quot;&gt;
    &lt;tr&gt;
        &lt;th&gt;Truthy values&lt;/th&gt;&lt;th&gt;Falsy values&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;true
        any number that is not 0
        any filled string (inc. &#39;false&#39; and &#39;0&#39;)
        {{{[]}}} (defined but empty arrays)
        {{{{}}}} (defined but empty objects)
        &lt;/td&gt;
        &lt;td&gt;false
        0
        {{{&#39;&#39;}}} (empty string)
        null
        undefined
        NaN
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;\
Assuming that {{{$test = &#39;&#39;}}}:
{{{
    &lt;&lt;if $test&gt;&gt;
        This text will not show because $test is an empty string, and so a falsy condition.
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if !$test&gt;&gt;
        This text //will// show, because $test is an empty string, and so a falsy condition.
    &lt;&lt;/if&gt;&gt;

Note:
    &lt;&lt;if def $test&gt;&gt;
        This text //will// show, because $test is defined, even as an empty string.
    &lt;&lt;/if&gt;&gt;
}}}
&lt;style&gt;.ifses td:nth-child(1), .ifses td:nth-child(2) {text-align:center;}.ifses th:nth-child(3), .ifses td:nth-child(3) {width: 33%;} #truthy td:first-child {width: 260px;}&lt;/style&gt;
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Base Macro Menu|Macro-Basic]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="32" name="Macro-Print" tags="page" position="1100,900" size="100,100">&lt;h1&gt;Display Variables, the {{{&lt;&lt;print&gt;&gt;}}} Macro and Variants&lt;/h1&gt;
There are essentially four ways of displaying a variable:
* [[bare|Markup-Variable]]: {{{$variable}}}
* with the {{{&lt;&lt;print&gt;&gt;}}} macro: {{{&lt;&lt;print $variable&gt;&gt;}}}
* with the {{{&lt;&lt;=&gt;&gt;}}} macro: {{{&lt;&lt;= $variable&gt;&gt;}}}
* with the {{{&lt;&lt;-&gt;&gt;}}} macro: {{{&lt;&lt;- $variable&gt;&gt;}}}

Unlike the bare version, the macros will display [[special variables|Variables-Base]] and functions attached to variables. 

Assuming that {{{$choice = &quot;dog&quot;}}}: &lt;&lt;set $choice = &quot;dog&quot;&gt;&gt;
{{{$choice}}} → $choice
{{{&lt;&lt;print $choice&gt;&gt;}}} → &lt;&lt;print $choice&gt;&gt;
{{{&lt;&lt;= $choice&gt;&gt;}}} → &lt;&lt;= $choice&gt;&gt;
{{{&lt;&lt;- $choice&gt;&gt;}}} → &lt;&lt;- $choice&gt;&gt;

Assuming that {{{$name = &quot;jane&quot;}}}: &lt;&lt;set $name = &quot;jane&quot;&gt;&gt;
{{{$name.toUpperCase()}}} → $name.toUpperCase()
{{{&lt;&lt;print $name.toUpperCase()&gt;&gt;}}} → &lt;&lt;print $name.toUpperCase()&gt;&gt;
{{{&lt;&lt;= $name.toUpperCase()&gt;&gt;}}} → &lt;&lt;= $name.toUpperCase()&gt;&gt;
{{{&lt;&lt;- $name.toUpperCase()&gt;&gt;}}} → &lt;&lt;- $name.toUpperCase()&gt;&gt;
&gt; &#39;&#39;Note:&#39;&#39; For more functions, [[see this page|Functions]].
\
All three macros are interchangeable, aside from one distinction: the {{{&lt;&lt;-&gt;&gt;}}} macro will show HTML markup and some nested SugarCube code as regular characters.
Assuming that {{{$example = &quot;&lt;i&gt;this&lt;/i&gt;&quot;}}} &lt;&lt;set $example = &quot;&lt;i&gt;this&lt;/i&gt;&quot;&gt;&gt;
{{{$example}}} → $example
{{{&lt;&lt;print $example&gt;&gt;}}} → &lt;&lt;print $example&gt;&gt;
{{{&lt;&lt;= $example&gt;&gt;}}} → &lt;&lt;= $example&gt;&gt;
{{{&lt;&lt;- $example&gt;&gt;}}} → &lt;&lt;- $example&gt;&gt;

Assuming that {{{$test = &quot;&lt;&lt;SomeWidget&gt;&gt;&quot;}}} and the widget {{{&lt;&lt;widget &quot;SomeWidget&quot;&gt;&gt;Wow Some Text&lt;&lt;/widget&gt;&gt;}}}: &lt;&lt;set $test = &quot;&lt;&lt;SomeWidget&gt;&gt;&quot;&gt;&gt;
{{{$test}}} → $test
{{{&lt;&lt;print $test&gt;&gt;}}} → &lt;&lt;print $test&gt;&gt;
{{{&lt;&lt;= $test&gt;&gt;}}} → &lt;&lt;= $test&gt;&gt;
{{{&lt;&lt;- $test&gt;&gt;}}} → &lt;&lt;- $test&gt;&gt;
\
&lt;h3&gt;Display all the values of an object:&lt;/h3&gt;\
To print whole object variables on the page, you need to use a bit of JavaScript:
Assuming that {{{$npc = {name: &#39;Jane&#39;, age: &#39;53&#39;} }}}: &lt;&lt;set $npc = {name: &#39;Jane&#39;, age: &#39;53&#39;}&gt;&gt;
{{{&lt;&lt;print Object.values($npc)&gt;&gt;}}} → &lt;&lt;print Object.values($npc)&gt;&gt;
{{{&lt;&lt;print JSON.stringify($npc)&gt;&gt;}}} → &lt;&lt;print JSON.stringify($npc)&gt;&gt;
&lt;&lt;unset $choice, $name, $example, $test, $npc&gt;&gt;
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Base Macro Menu|Macro-Basic]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="33" name="Markup" tags="chapter menu" position="800,600" size="200,100">&lt;h1&gt;SugarCube Markup and Basic Styling&lt;/h1&gt;
Whether to format text or code in a specific way, SugarCube includes some special markup code, separate from HTML and macros. The ones mentioned in the listed pages below would be most relevant to basic and starting projects. For more advanced Markup, see [[this page|Markup-Int]].

* [[Showing the Value of a Variable|Markup-Variable]]
* [[Using a Variable inside a Link|Markup-Link]] 
* [[Display an Image, and turn an Image into a Link|Markup-Image]]s
* [[Removing a Line-break|Markup-Nobr]] (Empty space on the page)
* [[Basic Text Styling|Markup-Styling]] (long) 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="34" name="Markup-Variable" tags="page" position="800,700" size="100,100">&lt;h1&gt;Showing the Value of a Variable&lt;/h1&gt;
While you may be tempted to use a [[macro|Macro-Print]] to display the value of a variable, there is a much simpler way to do so. You only need to code the variable as such {{{$variable}}} in the passage.

Assuming that {{{$name}}} was set with the value {{{&quot;Jane&quot;}}}, you would see here its value:&lt;&lt;set $name to &quot;Jane&quot;&gt;&gt;
{{{$name}}} → $name

For [[arrays|Variables-Base]], you can print either the full list of values or a specific value on the page. Assuming that {{{$list}}} has been set with the following values {{{[1, 9, 3, 4, 7]}}}, you would see:&lt;&lt;set $list = [1, 9, 3, 4, 7]&gt;&gt;
&gt; //the whole array//:
{{{$list}}} → $list
&gt; //one specific value// (here, the third in the list):
{{{$list[2]}}} → $list[2]
&gt; &#39;&#39;Note:&#39;&#39; the first value inside an array is at position {{{[0]}}}, the second has the position {{{[1]}}}, etc...

For [[objects|Variables-Base]], there are two ways to show a stored value: indicating the specific propery inside square brackets {{{[&#39; &#39;]}}} or after a dot {{{.}}}. Assuming {{{$npc}}} has been set as {{{$npc = {name: &#39;Jane&#39;, age: &#39;53&#39;} }}}: &lt;&lt;set $npc = {name: &#39;Jane&#39;, age: &#39;53&#39;}&gt;&gt;
&gt; //property after a dot://
{{{$npc.name}}} → $npc.name
&gt; //property inside brackets://
{{{$npc[&#39;age&#39;]}}} → $npc[&#39;age&#39;]
&gt; &#39;&#39;But&#39;&#39; you can&#39;t show the whole object as is:
{{{$npc}}} → $npc

&gt; &#39;&#39;Note:&#39;&#39; See [[the Print Macro page|Macro-Print]] for other ways to show a value on the page.
&lt;&lt;unset $name, $list, $npc&gt;&gt;
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="35" name="Markup-Link" tags="page" position="900,700" size="100,100">&lt;h1&gt;Using a Variable inside a Link&lt;/h1&gt;
Aside from [[storing information|Macro-Set-Basic]], or being used in [[conditional statements|Macro-If-Basic]], you can use a variable inside links: to display a spefic text or send the player to a specific passage.
Assuming that {{{$passage = &quot;Garden&quot;}}} and {{{$text = &quot;Go take a walk&quot;}}}:
{{{
[[$text|$passage]]
    → will work the same way as
[[Go take a walk|Garden]]
}}}
&gt; &#39;&#39;Note:&#39;&#39; using a variable to send the player to a passage is quite useful as a //Back to the Story// link for Codex pages (like [[this|Long-Return-JS]]).

You can also display the value of a variable with another string of text inside a link, by wrapping the text in quotes. Assuming that {{{$name = &quot;Jane&quot;}}}:&lt;&lt;set $name to &quot;Jane&quot;&gt;&gt;
{{{[[&quot;I am &quot; + $name|Passage]]}}} → [[&quot;I am &quot; + $name|Passage]]
{{{[[&quot;She is &quot; + $name + &quot;, a friend.&quot;|Passage]]}}} → [[&quot;She is &quot; + $name + &quot;, a friend.&quot;|Passage]]
&gt; &#39;&#39;Note:&#39;&#39; Do not use this markup as {{{[[&quot;Text&quot; + $var]]}}}, as it will break the game!
&gt; Note 2: You can use apostrophes {{{&#39; &#39;}}} instead of quotes {{{&quot; &quot;}}}.

If your link includes a quoted sentence and a variable, or a combination of straight quotes and apostrophes, you may run into issue with the printed link. I recommend using the curly types of quotes {{{“ ”}}} and apostrophes {{{‘ ’}}} for the text itself, as it is not recognised as code by Twine/SugarCube, and the straight version for the code. 
It is also possible to use {{{\}}} before the non-code character, as shown below:
{{{[[&quot;\&quot;She\&#39;s &quot; + $name + &quot;, a friend.\&quot;&quot;|Passage]]}}} → [[&quot;\&quot;She\&#39;s &quot; + $name + &quot;, a friend.\&quot;&quot;|Passage]]
&lt;&lt;unset $name&gt;&gt;
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="36" name="Markup-Image" tags="page" position="800,800" size="100,100">&lt;h1&gt;Display an Image, and turn an Image into a Link&lt;/h1&gt;
The Markup code to display an image works similarly to the [[Link Markup|Markup-Link]], though you will need to include the [[URL of an image|URL-Types]] for it to work:
{{{[img[URL]]}}}
&gt; &#39;&#39;Note:&#39;&#39; When compiling the code into an HTML file, the code will transorm the SugarCube markup into the HTML version: {{{&lt;img src=&quot;URL&quot;&gt;}}}

This required URL can be an absolute, relative or online [[URL|URL-Types]]:
{{{
→ absolute URL:
    [img[C:/Users/YourAcount/Documents/Folder/image/garden.png]]

→ relative URL:    
    [img[images/garden.png]]

→ online URL:
    [img[https://your-domain.com/garden.png]]
}}}
&gt; &#39;&#39;Note:&#39;&#39; I do not recommend using absolute URLs, especially if you are sharing your project with others, as it is easy for the link to break.

The URL of the image can also be stored inside a variable. Assuming that {{{$url = &quot;garden.png&quot;}}}:
{{{
[img[$url]]
    → will work the same way as
[img[garden.png]]
}}}

You can also turn the image into a clickable one, sending the player to another passage, like you would have with the [[Link Markup|Markup-Link]]. For example, the image below will send you to the Wikipedia website:
[img[https://upload.wikimedia.org/wikipedia/en/8/80/Wikipedia-logo-v2.svg][https://en.wikipedia.org/wiki/Main_Page]]
{{{
    [img[URL][PASSAGE]]
}}}
&gt; //using variables//: {{{$passage = &quot;Garden&quot;}}} and {{{$url = &quot;garden.png&quot;}}}
{{{
[img[$url][$passage]]
    → will work the same way as
[img[garden.png][Garden]]
}}}
You can go even further and set a variable inside that Image Link:
{{{[img[URL][PASSAGE][$var to true]]}}}

&gt; &#39;&#39;Note:&#39;&#39; for the Image Link, I would recomment using the {{{&lt;&lt;link&gt;&gt;}}} macro with the {{{&lt;img&gt;}}} HTML markup instead.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="37" name="Markup-Nobr" tags="page" position="900,800" size="100,100">&lt;h1&gt;Removing a Line-break&lt;/h1&gt;
Everytime you start a new line (of code or text) in a passage, Twine will automatically add a {{{&lt;br&gt;}}} HTML markup (also called a line-break) to match. This can become an issue when using macros or fomatted text (header, lists, etc..), as Twine may create more extra space than wanted. 

If you want to remove a line-break, you can do so with a backslash {{{\}}}:
{{{
    This is bat of a sentence... \
    ... that is broken in two.

or 

    This is bat of a sentence... 
    \... that is broken in two.

→ will show as:
    This is bat of a sentence... ... that is broken in two.
}}}
&gt; &#39;&#39;Note:&#39;&#39; Though the backslash is quite useful, the {{{&lt;&lt;nobr&gt;&gt;}}} [[macro|Macro-Nobr-Silent]], the {{{nobr}}} [[special tag|Special-Tags]], or the [[Config setting|Basic-API-Config]] can help remove more {{{&lt;br&gt;}}} at once.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="38" name="Markup-Styling" tags="page" position="800,900" size="100,100">&lt;h1&gt;Basic Text Styling&lt;/h1&gt;
From using headers to changing the colour of one word, you can use some HTML (coupled with some CSS) OR use some formatting markup...
&gt; &#39;&#39;Note:&#39;&#39; when {{{Beginning a line with...}}} is indicated, that character has to be the first on the line. If you have a space or an intentation at the start of the line, the text will not transform. 
&gt; Also, if the text, passage, or project uses one of the [[Line-Break features|Markup-Nobr]], the Style Markup will not work. However, the HTML markup will!
\
&lt;h3&gt;Headings&lt;/h3&gt;\
Beginning a line with an exclamation point {{{!}}}, you can define different levels of headings. Starting with one (for the largest heading), all the way to 6 (for the smallest one), each new exclamation point will decrease the importance and size of the header.
{{{
        Markup          HTML
          --             --
    !Level 1        → &lt;h1&gt;&lt;/h1&gt;
    !!Level 2       → &lt;h2&gt;&lt;/h2&gt;
    !!!Level 3      → &lt;h3&gt;&lt;/h3&gt;
    !!!!Level 4     → &lt;h4&gt;&lt;/h4&gt;
    !!!!!Level 5    → &lt;h5&gt;&lt;/h5&gt;
    !!!!!!Level 6   → &lt;h6&gt;&lt;/h6&gt;
}}}
\
&lt;h3&gt;Styling&lt;/h3&gt;\
To render a text &#39;&#39;bold&#39;&#39; or //italics//, you need to wrap the text with special characters. You can mix and match the different stylings, as long as you nest one inside the other(s).
{{{
    //Italics//         → &lt;em&gt;&lt;/em&gt;
    &#39;&#39;Bold&#39;&#39;            → &lt;strong&gt;&lt;/strong&gt;
    __Underline__       → &lt;u&gt;&lt;/u&gt;
    ==Strikethrough==   → &lt;s&gt;&lt;/s&gt;
    ^^Superscript^^     → &lt;sup&gt;&lt;/sup&gt;
    ~~Subscript~~       → &lt;sub&gt;&lt;/sub&gt;
}}}
&gt; //Nesting styles//
{{{&#39;&#39;//Bold and Italics//&#39;&#39;}}} → &#39;&#39;//Bold and Italics//&#39;&#39;
&gt; &#39;&#39;Note:&#39;&#39; using styling markup (SugarCube or HTML) to style some text inside a [[Link Markup|Markup-Link]] often leads to strange results (or plainly won&#39;t work). The use of the {{{&lt;&lt;link&gt;&gt;}}} [[macro|Macro-Link]] in this case is recommended.
\
&lt;h3&gt;Lists - ordered and unordered&lt;/h3&gt;\
Beginning the line with an asterisk {{{*}}} or a number/pound sign {{{#}}}, you can create respectively unordered or ordered lists of items (or code). Similarly the headings, adding more than one character consecutively will define the indentation of the list.
{{{
    * Item 1
    ** Item a
    * Item 2
→ will be the same as:
    &lt;ul&gt;
        &lt;li&gt; List
            &lt;ul&gt;
                &lt;li&gt;List&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/li&gt;
        &lt;li&gt;List&lt;/li&gt;
    &lt;/ul&gt;
}}}
* Item 1
** Item a
* Item 2
{{{
    # Item 1
    ## Item a
    # Item 2
→ will be the same as:
    &lt;ol&gt;
        &lt;li&gt; List
            &lt;ol&gt;
                &lt;li&gt;List&lt;/li&gt;
            &lt;/ol&gt;
        &lt;/li&gt;
        &lt;li&gt;List&lt;/li&gt;
    &lt;/ol&gt;
}}}
# Item 1
## Item a
# Item 2
\
&lt;h3&gt;Horizontal Rule&lt;/h3&gt;\
Beginning the line with four hyphen {{{-}}} characters, will create a horizontal line (like the one at the bottom of the page) marking a thematic break:
{{{
    ---- 
→ will be the same as:
    &lt;hr&gt;
}}}
\
&lt;h3&gt;Blockquotes&lt;/h3&gt;\
Beginning the line with a right angle bracket {{{&gt;}}}, you can create blockquote elements to include quotes on the page. This styling has been used in this quite for &#39;&#39;notes&#39;&#39;.
Similarly the headings, adding more than one character consecutively will define the indentation of the list.
{{{
    &gt;Main 1
    &gt;&gt;Nested 1
    &gt;&gt;Nested 2
    &gt;Main 2
→ will be the same as:
    &lt;blockquote&gt;Line 1&lt;br&gt;
        &lt;blockquote&gt;Nested 1&lt;br&gt;
        Nested 2&lt;br&gt;
        &lt;/blockquote&gt;
    Line 2&lt;br&gt;
    &lt;/blockquote&gt;
}}}
&gt;Main 1
&gt;&gt;Nested 1
&gt;&gt;Nested 2
&gt;Main 2
\
&lt;h3&gt;Custom Style&lt;/h3&gt;\
To create a block (like a {{{&lt;span&gt;}}} or a {{{&lt;div&gt;}}}) to target a spcecific bit of text, you need to wrap it with two at signs{{{@@}}}:
{{{
    @@Text@@ → &lt;span&gt;Text&lt;/span&gt;

    @@
    Text     → &lt;div&gt;Text&lt;div&gt;
    @@

}}}
&gt; &#39;&#39;Note:&#39;&#39; a {{{&lt;div&gt;}}} will create a block of text, while a {{{&lt;span&gt;}}} will stay inside a line.

To further customise a block, you can assign it a class {{{.class}}}, id {{{#id}}}, or CSS rule to it, seperating each and it from the text with a semi-colon {{{;}}}:
{{{
    @@#id;.class;color:red;Text@@ 
→ &lt;span id=&quot;id&quot; class=&quot;class&quot; style=&quot;color:red;&quot;&gt;&lt;/span&gt;

    @@#id;.class;color:red;
    Text
    @@    
→ &lt;div id=&quot;id&quot; class=&quot;class&quot; style=&quot;color:red;&quot;&gt;&lt;div&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; you should only have one id per element, and no element on the page should share the same id. Multiple classes can be added to an element, and can be used for multiple elements at once.
\
&lt;h3&gt;Comments&lt;/h3&gt;\
There are three ways of leaving a note in your passage which will be hidden to the player:
{{{
    /* A comment */     → Passage, JavaScript, Stylesheets
    /% A comment %/     → Passage
    &lt;!-- A comment --&gt;  → Passage, Special Passages
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="39" name="Special-Passage" tags="chapter menu" position="1700,600" size="200,100">&lt;h1&gt;Basic Special Passages&lt;/h1&gt;
Your project can be further customised with the use of Special Passages. Those passages are special because they require a specific name to load built-in code. Some will affect how the page looks, while others can affect how code works.

To use a Special Passage, create a new passage, change the name of that passage for one of the Special Passage Name (as indicated in the [[Documentation|http://www.motoslave.net/sugarcube/2/docs/#special-passages]]), and fill it with what you need!
&gt; &#39;&#39;Note:&#39;&#39; the names are case-sensitive!
\
* [[Headers and Footers|SP-HeaderFooter]]
* [[Special Passages for the UI Bar|SP-UIBar]] 
* [[Setting Important Variables before Start|SP-Init]] 

You can click [[here for the demo|SP-Demo]] to see most of the aforementioned Special Passages in action!

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="40" name="SP-HeaderFooter" tags="page" position="1700,700" size="100,100">&lt;h1&gt;Headers and Footers&lt;/h1&gt;
Whether wanting to display Chapter titles at the top of the page, or links to special passages (like the bottom of this page), the Headers and Footers are respectively attached at the top of and below the main body of the passage. It will [[load along|Events-Passage]] with the story passage.
Those Special Passages, {{{PassageHeader}}} and {{{PassageFooter}}}, will accept anything from simple text to complex code.
For example:
{{{
    :: PassageHeader
        &lt;&lt;if def $chapter&gt;&gt;Chapter $chapter&lt;&lt;/if&gt;&gt;

    :: PassageFooter
        &lt;&lt;if $name is &quot;Jane&quot;&gt;&gt;
            [[Jane&#39;s Curiosities|Inventory]]
        &lt;&lt;else&gt;&gt;
            [[$name + &quot;&#39;s closet&quot;|Inventory]]
        &lt;&lt;/if&gt;&gt;
}}}
\
&gt; &#39;&#39;Note:&#39;&#39; if you are looking to add plain code without output (visible text), {{{PassageReady}}} and {{{PassageDone}}} is preferred. See [[this page|SP-PassageReady-Done]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages Menu|Special-Passage]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="41" name="SP-UIBar" tags="page" position="1800,700" size="100,100">&lt;h1&gt;Special Passages for the UI Bar&lt;/h1&gt;
The sidebar on the left can look pretty bare without some customisation, which can be remedied with the Special Passages mentioned below. From adding images, changing the title, to adding extra text or links, there are //many// ways to customise this block. 
The Special Passages listed below are organised in the other they would appear in the UI Bar (top → bottom).
&gt; &#39;&#39;Note:&#39;&#39; the content of UI Bar will automatically update when the player moves to another passage. 
\
&lt;h3&gt;{{{StoryBanner}}}&lt;/h3&gt;\
As its name implies, this passage allows you to add a banner or icon to the sidebar, located above the title of the game. But you are not limited to adding images, you can also include text or code!
{{{
    : : StoryBanner
    &lt;img src=&quot;extra/logo.png&quot;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you want to edit how this block looks directly from the StyleSheet, you can target the element {{{#story-banner}}}.
\
&lt;h3&gt;{{{StoryDisplayTitle}}}&lt;/h3&gt;\
If this Special Passage is not included in your project, Twine will use the name of the project as the title to display. Whether to include it depends more on how you name projects in Twine. 
If you name projects a certain way but want the title to be something else, then this Special Passage is for you. The passage also allows the inclusion of images and code.
{{{
    :: StoryDisplayTitle
    The Road Not Taken
}}}
&gt; &#39;&#39;Note:&#39;&#39; no matter whether this Special Passage is in use, you can change the formatting of the title in the StyleSheet by targeting the element {{{#story-title}}}.
\
&lt;h3&gt;{{{StorySubtitle}}}&lt;/h3&gt;\
This Special Passage will appear under the title, and is meant to show a tagline for the game. It will also accept images and code.
{{{
    :: StorySubtitle
    It&#39;s time to make a choice!
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you want to edit how this passage looks directly from the StyleSheet, you can target the element {{{#story-subtitle}}}
\
&lt;h3&gt;{{{StoryAuthor}}}&lt;/h3&gt;\
This Special Passage is meant to display the name of the author, but does not limit you to this. You can also include images or code.
{{{
    :: StoryAuthor
    by [[manonamora|https://manonamora.itch.io/]]
}}}
&gt; &#39;&#39;Note:&#39;&#39; this element has some special formatting, which you change in the StyleSheet by targeting the element {{{#story-author}}}
\
&lt;h3&gt;{{{StoryCaption}}}&lt;/h3&gt;\
This Special Passage provides an extra space to include text or other elements. It is often used to show extra links towards side passage, like a Codex, or the state of certain variables, like a health bar.
{{{
    :: StoryCaption
    Coins: $coins
    [[Codex]]
}}}
&gt; &#39;&#39;Note:&#39;&#39; this element has some special formatting, which you change in the StyleSheet by targeting the element {{{#story-caption}}}
\
&lt;h3&gt;{{{StoryMenu}}}&lt;/h3&gt;\
This Special Passage adds a block of links, formatted in the same way as the //Save// and //Restart// buttons. This passage, however, &#39;&#39;only accepts links&#39;&#39; ({{{[[link]]}}}, {{{&lt;&lt;link&gt;&gt;}}} and {{{&lt;a&gt;}}}) and conditional statements (to hide/display the links). If you include text or non-linking macro (incl. buttons), they will not appear.
{{{
    :: StoryMenu
    [[Inventory]]
    [[$name|MC Page]]
}}}
&gt; &#39;&#39;Note:&#39;&#39; this element has some special formatting, which you change in the StyleSheet by targeting the element {{{#menu-story}}}. The //Save// and //Restart// buttons are located inside the element {{{#menu-core}}}.
\
&lt;h3&gt;{{{StoryShare}}}&lt;/h3&gt;\
This Special Passage creates a //Share// button below the //Restart// button and is meant to display social media links in a dialog box. However it can only be filled with links. If you want to display text with your links, I would recommend creating a regular passage and add that to the //StoryMenu// instead.
{{{
    :: StoryShare
    [[itch|https://manonamora.itch.io/]]
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages Menu|Special-Passage]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="42" name="SP-Init" tags="page" position="1700,800" size="100,100">&lt;h1&gt;Setting Important Variables before Start&lt;/h1&gt;
Some projects may require setting some variables in advance, for the game to progress as it should, to track certain information from the start, or to include macros or custom code to load before everything else (like the [[audio macros|Macro-Audio]] or defining stats bars).
{{{StoryInit}}} will accept any type of code, but will //not// display any text on the page.
{{{
    :: StoryInit
    &lt;&lt;set $var to &quot;Jane&quot;&gt;&gt;
    &lt;&lt;set $object to {
        property1: 1,
        property2: &quot;Home&quot;,
        property3: true
    }&gt;&gt;
    &lt;&lt;set setup.treasure to [&#39;coins&#39;, &#39;rubies&#39;, &#39;jewelry&#39;]&gt;&gt;
    &lt;&lt;include &quot;MoreCode&quot;&gt;&gt;
    &lt;&lt;AlsoCodeWidget&gt;&gt;
    &lt;&lt;cacheaudio &quot;rain&quot; &quot;extra/rain.mp3&quot;&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; when //testing// a project (Debug Mode), Twine will display the list of macro used in StoryInit in a greyed box. This only appears in the Debug Mode; it is hidden otherwise.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages Menu|Special-Passage]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="43" name="SP-Demo" tags="sp-demo" position="1800,800" size="100,100">There is not much to say about the demo. I think the Special Passages speak for themselves.

&lt;&lt;back &quot;Click Here to Go back&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="44" name="Base-JS-CSS" tags="chapter page" position="2000,725" size="200,100">&lt;h1&gt;About JavaScript and the StyleSheet&lt;/h1&gt;
To customise your project even futher, Twine gives you the possibility to use JavaScript and CSS, which you can edit in the //JavaScript// and //StyleSheet// passages (under the //Story Menu// in the Twine app).
\
&lt;h3&gt;JS - JavaScript&lt;/h3&gt;\
&#39;&#39;JavaScript&#39;&#39; (or JS) is a coding language used in HTML files that will dictate the behaviour of elements on the page. When you click on a link to change the passage to a new one, it is because the JavaScript code is telling the page to do so. The macros in SugarCube are built on JavaScript.

The most common use for JavaScript in a project is:
* to add custom macro for effect not available in the base SugarCube
* to add settings to change how the project looks/acts for the player 
* to change how the page looks/behaves (ex: removing the history arrows)
You could potentially build a whole SugarCube project by only using JavaScript, though you might as well use [[Snowman|https://videlais.github.io/snowman/#/]]...
\
&gt; &#39;&#39;Notes:&#39;&#39; SugarCube also uses jQuery, which is a sub-language of JavaScript, used for navigation, selecting elements or control animation.
&gt; Java and JavaScript are &#39;&#39;two different coding languages&#39;&#39;, with no link between each other aside from their name!
\
&lt;h3&gt;CSS - Cascading Style Sheet&lt;/h3&gt;\
&#39;&#39;Cascading Style Sheet&#39;&#39; (or CSS) is a coding language used in HTML files to dictate the layout and formatting of the page. From the choice of backgrond to the placement of an element, this is usually done in with CSS. The language allows for alternate rules for different settings or screen size, as well as animation.
&gt; &#39;&#39;Note:&#39;&#39; you can use JavaScript/jQuery to change aspects of the page (add/remove an element, change the colour). But, in most cases, CSS will suffice.
\
The most common use for CSS in a project is:
* to change the basic formatting of a page (ex: colour scheme)
* to have alternate rules for coded settings in the JavaScript (ex: font family)
* to have a different formatting of the page on mobile
&gt; &#39;&#39;Note:&#39;&#39; in SugarCube, you can edit some styling with the [[Markup formatting|Markup-Styling]]. For futher use of CSS, see [[this page|Int-JS-CSS]].
\
&lt;h3&gt;Learn more about JavaScript, jQuery, and CSS&lt;/h3&gt;\
* the [[W3 School|https://www.w3schools.com/]] has the most beginner explanations, and lets you test and edit their examples.
* [[MDN Web Docs|https://developer.mozilla.org/en-US/]] is more technical but provides a more extensive documentation.
* [[jQuery|https://jquery.com/]] has also a special documentation website.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="45" name="URL-Types" tags="chapter page" position="2000,600" size="200,100">&lt;h1&gt;ULRs for Assets and Testing&lt;/h1&gt;
When including any external element into a project (e.g. image, sound, font, etc...), you will need the URL of the file. Twine does not have an import function for assets (and neither does Tweego). This means the URL will be the link between the Twine project and the asset, as it will tell the code where find it and (dis)play it when the game is in use.
There are essentially two locations for assets:
* &#39;&#39;Online&#39;&#39; assets, requiring an Online URL ({{{html://website/file}}})
* &#39;&#39;Local&#39;&#39; assets:
** located in the user&#39;s device, using the &#39;&#39;Absolute&#39;&#39; path URL ({{{C:\User\Documents\Folder\file}}})
** located in the project folder, using &#39;&#39;Relative&#39;&#39; path URL ({{{Folder\file}}})
&gt; &#39;&#39;Note:&#39;&#39; as different players will organise their devices differently, the Absolute path is not recommended for Twine projects meant to be shared (online or otherside).
\
&lt;h3&gt;Online Assets&lt;/h3&gt;\
For assets hosted on third-party platforms, you will only need the URL towards the wanted file. Some of these platforms will even provide you with the needed URL for your projects.
For example, here is the URL for the Google-hosted font //Roboto//:
{{{
    https://fonts.googleapis.com/css2?family=Roboto&amp;display=swap

Importing in the StyleSheet:
    @import url(&#39;https://fonts.googleapis.com/css2?family=Roboto&amp;display=swap&#39;);
}}}

For the logo of the Wikimedia Foundation, the URL will look like this:
{{{
    https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Wikimedia_Foundation_logo_-_vertical.svg/1024px-Wikimedia_Foundation_logo_-_vertical.svg.png
}}}
&gt; &#39;&#39;Note:&#39;&#39; if the project is played offline, those assets will not load.
\
&lt;h3&gt;Relative Path&lt;/h3&gt;\
For assets located in the game folder, you will need their //Relative// paths. This is a path the operating system will take to find the wanted asset, starting from the file (or program) where the code is triggered. For Twine projects, that starting point is the project HTML file.
Assuming that the game folder is as follow:
{{{
    index.html
    images\
        introduction\
            cool.jpg
}}}
\
The image //cool.jpg// is located in the folder //introduction// which is located in the folder //images//. As such from the HTML file, the relative URL for that image would be:
{{{
    images\introduction\cool.jpg
}}}
\
&#39;&#39;But&#39;&#39;, to ensure this will work properly, the back slashes {{{\}}} from the relative path should become forward slashes {{{/}}}:
{{{
    images/introduction/cool.jpg

Using in the StyleSheet:
    background-image: url(&#39;images/introduction/cool.jpg&#39;);
}}}
\
&lt;h3&gt;Note on Case Sensitivity&lt;/h3&gt;\
Both Online URLs and Relative paths are case sensitive: this means that the URL should match the paths in terms of lower- and upper-case characters, or the asset will not load. This is relevant for:
* folder names 
* asset names 
* file extension (.png ≠ .PNG)
It is important that all these aspects are coded in the proper case.
\
&lt;h3&gt;Some Recomendations&lt;/h3&gt;\
To avoid issues with loading assets, I recommend:
* using only plain letters (a-z) and numbers (if necessary), instead of special characters (é, ñ, à, etc…)
* using hyphens {{{-}}} or underscores {{{_}}} to replace space in the folder/file names
* be consistent in the casing (all upper or all lower case)
\
&gt; &#39;&#39;Note:&#39;&#39; While there is no import function in Twine, it is possible to create &quot;asset&quot; passages for Base64-encoded media source, using an [[Asset Tag|Tags-Asset]]. This supports audio, images, video and VTT assets.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="46" name="About" tags="side" position="1200,100" size="200,100">&lt;h1&gt;About Twine and SugarCube&lt;/h1&gt;
//&#39;&#39;Twine&#39;&#39;// is a free and open-source tool to create interactive, non-linear stories, created by Chris Klimas in 2009. It is now maintained by multiple individuals, in [[several repositories|https://github.com/tweecode]]. &#39;&#39;//Twine//&#39;&#39; is also a registered trademark of the [[Interactive Fiction Technology Foundation|https://iftechfoundation.org/]].

&#39;&#39;//Twine//&#39;&#39; offers both a desktop and browser application on [[its website|https://twinery.org]], giving creator a visual representation of each passage in their game. The browser version can be opened on tablets and mobile devices.

Over the years, Twine has had [[multiple story formats|http://mcdemarco.net/tools/hyperfic/twine/catalog/]], among others SugarCube. Twine compiles the code of the chosen format to create a file in the format&#39;s choice (usually HTML) or Twee. The other base formats of Twine 2 are: Harlowe, Chapbook, and Snowman.

&#39;&#39;//SugarCube//&#39;&#39; is a free (gratis and libre) coding format for Twine/Twee created and maintained by Thomas M. Edwards. It is based on JavaScript and jQuery, and can be styled with HTML and CSS.

Thomas M. Edwards is also the creator of //&#39;&#39;Tweego&#39;&#39;//, a free (gratis and libre) command line compiler for Twine/Twee story formats written in Go. It is an alternative to Twine, and can be used with any Integrated development environment (IDE), like VSCode.
This guide was compiled in Tweego.

If you want to support the parties named above, you can find here the links for:
* Chris Klimas (klembot) : [[Patreon|https://www.patreon.com/klembot]]
* Thomas M. Edwards (TME - The Mad Exile) : [[Patreon|https://www.patreon.com/thomasmedwards]] - [[Ko-Fi|https://ko-fi.com/thomasmedwards]]
* The Interactive Fiction Technology Foundation : [[Donations|https://iftechfoundation.org/give/]]
&gt; &#39;&#39;Note:&#39;&#39; to support other parties creating assets and resources for Twine, check this [[list|https://manonamora-if.tumblr.com/post/700577877042888704/]].

&lt;&lt;back&gt;&gt;</tw-passagedata><tw-passagedata pid="47" name="Basics" tags="chapter menu" position="800,100" size="200,100">&lt;h1&gt;Starting with SugarCube&lt;/h1&gt;
When setting up your first project with SugarCube, it is best to start with the Basics. This means linking passages so the player moves to a different part of the story, saving information and players&#39; choices inside [[variables|Variables-Base]], and tracking variables to display variations down the line.

To do this, you essentially need the 3 following macros: {{{&lt;&lt;link&gt;&gt;}}}, {{{&lt;&lt;set&gt;&gt;}}}, and {{{&lt;&lt;if&gt;&gt;}}}.

* [[The Basics of Variables|Variables-Base]]
* [[The Elements on the Page|Basics-UI]]
* [[Linking Passages|Macro-Link-Basic]] 
* [[Tracking Information|Macro-Set-Basic]] 
* [[Display Variation|Macro-If-Basic]]
&gt; &#39;&#39;Note:&#39;&#39; Any code on the page will be displayed top to bottom by the program. Code at the top of the passage can affect code further down.

Want to see this in action? Try this [[Demo|Demo-Basic]] !

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="48" name="Basics-UI" tags="page BasicUI" position="800,200" size="100,100">&lt;h1&gt;The Elements on the Page&lt;/h1&gt;
In a basic SugarCube project, there are essentially 3 main elements on the page:
* the passage (in green)
* the UI-Bar (in red)
* the dialog box (&lt;&lt;link &quot;click here&quot;&gt;&gt;&lt;&lt;popup &quot;Basic-UI-Dialog&quot; &quot;Dialog Box&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;)
\
The content inside the &#39;&#39;passage&#39;&#39; is generated from the story passages created in Twine. Every time the player clicks on a link to advance the story, the passage will refresh to display the new content.

In the &#39;&#39;UI-Bar&#39;&#39;, you will find arrows to go back and forth in the Game History (the visited passages), an arrow to hide/show the UI-Bar/sidebar, and the //Save// and //Restart// buttons. 
The content of the sidebar can be edited through the [[Special Passages|SP-UIBar]], or when adding [[Settings]].

&#39;&#39;Dialog boxes&#39;&#39; are elements that will appear at the forefront of the page. It is used by the Menu buttons (//Save// and //Restart//), but can also contain content from a story passage (like the Lexicon link below) or coded through the passage. To create a dialog box, [[visit this page|Basic-API-Dialog]].

To edit how those elements look, you will need to edit the [[Stylesheet|Int-JS-CSS-Elements]] (intermediate).

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basics Menu|Basics]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="49" name="Macro-Link-Basic" tags="page" position="900,200" size="100,100">&lt;h1&gt;Linking Passages and the {{{&lt;&lt;link&gt;&gt;}}} Macro&lt;/h1&gt;
To move the player from one part of the story to the next, you need to link the passages. This can be done in two ways: the {{{[[Link]]}}} markup or the {{{&lt;&lt;link&gt;&gt;}}} macro. Boths ways will achieve the same thing, but the macro will give you more flexibility with interactivity. 
&gt; &#39;&#39;Note:&#39;&#39; in some cases, the {{{&lt;&lt;link&gt;&gt;}}} macro will not create a visual link between passage blocks in the Twine map of the project.
\
&lt;h3&gt;The {{{[[Link]]}}} markup&lt;/h3&gt;\
To create a link with the {{{[[Link]]}}} markup, you need to wrap the relevant text with double square brackets {{{[[ ]]}}}.
&gt; &#39;&#39;Note:&#39;&#39; in the Twine application, wrapping a bit of text with the square brackers will automatically create a passage with the text inside the brackets as that passage&#39;s name.
{{{
[[Go to the Garden]] 
    → will send the player to the passage called &quot;Go to the Garden&quot;

[[Home234]]
    → will send the player to the passage called &quot;Home234&quot;
}}}

If you want to display something else than the Passage name in the link, you can use a pipe separator {{{ | }}}, or an arrow ({{{-&gt;}}} or {{{&lt;-}}}) to separate the displayed text and the name of the passage. Formatting links this way is pretty useful when you have multiple links going to one same passage.
{{{
[[Go to the Garden|Garden]] 
    → display the text &quot;Go to the Garden&quot; and send the player to the passage called &quot;Garden&quot;

[[Go to the Garden-&gt;Garden]] 
[[Garden&lt;-Go to the Garden]] 
    → the arrow should be pointing towards the passage&#39;s name
}}}
&gt; For more advanced uses of the link markup, see [[the Link Markup page|Markup-Link]].
\
&lt;h3&gt;The {{{&lt;&lt;link&gt;&gt;}}} macro&lt;/h3&gt;\
One of the use of the {{{&lt;&lt;link&gt;&gt;}}} macro is to send the player to a different passage. This can be formatted in different ways.
&gt; //In combination with the link markup://
{{{
&lt;&lt;link [[Go to the Garden]]&gt;&gt;&lt;&lt;/link&gt;&gt; 
    →  will send the player to the passage called &quot;Go to the Garden&quot;

&lt;&lt;link [[Go to the Garden|Garden]]&gt;&gt;&lt;&lt;/link&gt;&gt; 
    → display the text &quot;Go to the Garden&quot; and send the player to the passage called &quot;Garden&quot;
}}}
&gt; //Without the link markup://
{{{
&lt;&lt;link &quot;Go to the Garden&quot; &quot;Garden&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; 
    → display the text &quot;Go to the Garden&quot; and send the player to the passage called &quot;Garden&quot;
}}}
&gt; &#39;&#39;Note:&#39;&#39; Without the link markup, this &#39;&#39;won&#39;t create a visual link between passage blocks&#39;&#39; in the Twine map of the project.

Since the {{{&lt;&lt;link&gt;&gt;}}} macro is a container macro (with an opening and a closing block), you can add more code inside the blocks, like another macro or pure JavaScript code.
{{{
    &lt;&lt;link &quot;Text&quot;&gt;&gt;  ← opening block
        /*Code Here*/
    &lt;&lt;/link&gt;&gt;        ← closing block

Example:
    &lt;&lt;link &quot;Take Coin&quot;&gt;&gt;&lt;&lt;unset $coin&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; you can switch the {{{&lt;&lt;link&gt;&gt;}}} macro for the {{{&lt;&lt;button&gt;&gt;}}} macro, as their only difference is how they are formatted on the page (a simple link or a button).
\
&gt; For more advanced uses of the link macro, see [[the Link Macro page|Macro-Link]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basics Menu|Basics]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="50" name="Macro-Set-Basic" tags="page" position="800,300" size="100,100">&lt;h1&gt;Tracking Information and the {{{&lt;&lt;set&gt;&gt;}}} Macro&lt;/h1&gt;
To track information and choices made by the player, you need to set [[variables|Variables-Base]], and save the tracked information as a value in the variable, by using the {{{&lt;&lt;set&gt;&gt;}}} Macro.

While there are multiple ways to [[store information|Variables-Base]], the most relevant way is through using &#39;&#39;temporary&#39;&#39; or &#39;&#39;permanent&#39;&#39; variables. As their name suggests, a temporary variable is temporary, disappearing when the player moves to another passage, while the permanant variable will stick around (until you [[destroy|Macro-Unset]] it or change its value).
{{{
    &lt;&lt;set $variable to 5&gt;&gt;
    &lt;&lt;set $variable to &#39;some words&#39;&gt;&gt;
    &lt;&lt;set $variable to true&gt;&gt;
    &lt;&lt;set _temporary to 5&gt;&gt;
}}}

You can also set multiple variables at once, by separating each with a {{{,}}} comma:
{{{
    &lt;&lt;set $var to 5, $var2 to &#39;some words&#39;, $var3 to true, _temp to 5&gt;&gt;

    &lt;&lt;set 
        $var to 5, 
        $var2 to &#39;some words&#39;, 
        $var3 to true, 
        _temp to 5
    &gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; the type of value stored in a variable is not set in stone when the variable is first set.
&gt; You can set a variable as an //integer// (number), before setting it as a //string// (words) a few passages later, without needing the unset it in between.

If you want to track the player&#39;s choice of action, before the passage changes, you will need to set a variable inside a link. This method is often the best way to store information, and avoid a variable to change value if the player revisit a passage.
&gt; &#39;&#39;Note:&#39;&#39; setting a temporary variable in a forwarding link is useless...
{{{
Link markup:
    [[Displayed Text|PassageName][$var to {value}]]

    [[Pick apples|Garden][$apple to 5]]
    [[Displayed Text|PassageName][$variable to 5, $var2 to &#39;some words&#39;, $var3 to true]]
}}}
{{{
Link macro:
    &lt;&lt;link [[Displayed Text|PassageName]]&gt;&gt;&lt;&lt;set $variable to 5&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;link [[Displayed Text|PassageName]]&gt;&gt;
        &lt;&lt;set $var to 5, $var2 to &#39;some words&#39;, $var3 to true, _temp to 5&gt;&gt;
    &lt;&lt;/link&gt;&gt;
}}}

For other mathematical operators or advanced uses of the {{{&lt;&lt;set&gt;&gt;}}} Macro, [[see the Set Macro page|Macro-Set]].
For setting up links, [[see this page|Macro-Link-Basic]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basics Menu|Basics]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="51" name="Macro-If-Basic" tags="page" position="900,300" size="100,100">&lt;h1&gt;Display Variation and the {{{&lt;&lt;if&gt;&gt;}}} Macro&lt;/h1&gt;
Following a player&#39;s choice, you may want to show a specific variant of the next passage, based on that choice. This will be possible with &#39;&#39;conditional statements&#39;&#39;, through the {{{&lt;&lt;if&gt;&gt;}}} Macro (you will need to [[set a variable|Macro-Set-Basic]] first).
&gt; &#39;&#39;Note:&#39;&#39; the example below showcase different types of [[values|Variables-Base]].
\
&gt; //A single variation://
{{{
    &lt;&lt;if $choice is 1&gt;&gt;
        This text will only show if the value of variable $choice is 1.
    &lt;&lt;/if&gt;&gt;
}}}
&gt; //Two variations://
{{{
    &lt;&lt;if $choice is true&gt;&gt;
        This text will show if the variable $choice is true.
    &lt;&lt;else&gt;&gt;
        If not, this text will show.
    &lt;&lt;/if&gt;&gt;
}}}
&gt; //Two specific variations://
{{{
    &lt;&lt;if $choice is &quot;stone&quot;&gt;&gt;
        This text will show if the value of variable $choice is &quot;stone&quot;.
    &lt;&lt;elseif $choice is &quot;grass&quot;&gt;&gt;
        But if the value of the variable $choice is &quot;grass&quot;, then this text will show.
    &lt;&lt;/if&gt;&gt;
}}}
&gt; //Three variations://
{{{
  At the store you picked &lt;&lt;if $pet is &quot;dog&quot;&gt;&gt;a dog&lt;&lt;elseif $pet is &quot;car&quot;&gt;&gt;a cat&lt;&lt;else&gt;&gt;a bird&lt;&lt;/if&gt;&gt;.
}}}
&gt; &#39;&#39;Note:&#39;&#39; the code of the examples above are indented to showcase it better.

Conditional statements can also be nested inside one another:
{{{
    &lt;&lt;if $choice is 1&gt;&gt;       ← first contidional 
        &lt;&lt;if $pet is &quot;dog&quot;&gt;&gt;  ← nested conditional
            This will show this sentence on the page.
        &lt;&lt;elseif $pet is &quot;cat&quot;&gt;&gt;
            Or maybe this one.
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;else&gt;&gt;
        Otherwise it will be this one.
    &lt;&lt;/if&gt;&gt;
}}}

For other operators and more advanced uses of the {{{&lt;&lt;if&gt;&gt;}}} Macro, see [[this page|Macro-If]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basics Menu|Basics]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="52" name="Variables-Base" tags="page" position="800,400" size="100,100">&lt;h1&gt;Variables and Values in SugarCube&lt;/h1&gt;
&lt;h3&gt;Value Types&lt;/h3&gt;\
Values are bits of data stocked inside variables. There are different types of values, which are affected by macros and will affect how macros behave.

The different types of values are:
* numbers (also called //integer//)
* words (also called //strings//)
* Boolean ({{{true/false}}})
* functions (advanced - covered [[here|Functions]])
&gt; &#39;&#39;Note:&#39;&#39; You can have numbers in a string ({{{&quot;1&quot; ≠ 1}}}), but you won&#39;t be able to change the value of this number (unless you transform the value into an integer).
\
&lt;h3&gt;Variable Types&lt;/h3&gt;\
To track and organise those values, there are three types of variables to consider:
* //basic//: only one value
** {{{var = value}}}
* //array//: a list of values, each with a set position
** {{{var = [value, value, value]}}}
* //object//: values linked to properties
** {{{var = {property : value, property : value}}}}
Depending on the amount of information tracked within a project, the last two options can be helpful in keeping those values organised. However, they are not necessary (especially in simple IF projects). To set a variable, see [[the Set Macro|Macro-Set-Basic]] chapter.

In SugarCube, variables can been viewed as followed:
{{{
    basic: 
        $variable = 5
        $variable = &quot;some words&quot;
        $variable = true
    array:
        $variable = [5, &quot;some words&quot;, true]
    object:
        $variable = {number: 5, string: &#39;some words&#39;, boolean: true}
}}}
\
&lt;h3&gt;Variable Storage&lt;/h3&gt;\
Aside from different types of variables, there are multiple ways to store those variables in the code. Depending on the need, a certain kind will be more useful than another. The differnt storage types are:
* temporary ({{{_temporary}}}), so the variable disappears when moving to a new passage
* permanant ({{{$variable}}}), so the variable is stored until you [[destroy|Macro-Unset]] it
* settings ({{{settings.var}}}), or variables related to the [[Settings]]
* setup ({{{setup.var}}} - should be set in StoryInit), which is meant for unchanging values (ex: the price of an object)
&gt; &#39;&#39;Note:&#39;&#39; for a simple project, you will not need the last two types. You may not even need variables at all.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basics Menu|Basics]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="53" name="Demo-Basic" tags="page demo" position="900,400" size="100,100">A simple choice.

In front of you sit three boxes: a blue one, a green one, and a red one. Inside each box but one, there is a treat.

//Which box do you choose?//
* [[the blue box|Demo-Basic-Reveal][$box to &quot;blue&quot;]]
* [[the green box|Demo-Basic-Reveal][$box to &quot;green&quot;]]
* [[the red box|Demo-Basic-Reveal][$box to &quot;red&quot;]]
* [[no box|Demo-Basic-Reveal][$box to false]]
&lt;hr&gt;
&lt;&lt;message &quot;Code&quot;&gt;&gt;
{{{
    A simple choice.

    In front of you sit three boxes: a blue one, a green one, and a red one. Inside each box but one, there is a treat.

    //Which box do you choose?//
    * [[the blue box|Demo-Basic-Reveal][$box to &quot;blue&quot;]]
    * [[the green box|Demo-Basic-Reveal][$box to &quot;green&quot;]]
    * [[the red box|Demo-Basic-Reveal][$box to &quot;red&quot;]]
    * [[no box|Demo-Basic-Reveal][$box to false]]
}}}
&lt;&lt;/message&gt;&gt;</tw-passagedata><tw-passagedata pid="54" name="Demo-Basic-Reveal" tags="page demo" position="1000,400" size="100,100">&lt;&lt;if $box is false&gt;&gt;You did not choose a box.&lt;&lt;else&gt;&gt;You chose the &lt;&lt;if $box is &quot;blue&quot;&gt;&gt;blue box, and found a cookie.&lt;&lt;elseif $box is &quot;red&quot;&gt;&gt;red box, but found nothing.&lt;&lt;else&gt;&gt;green box, and found an apple&lt;&lt;/if&gt;&gt;&lt;&lt;/if&gt;&gt;

* [[Try again?|Demo-Basic]]
&lt;hr&gt;
&lt;&lt;message &quot;Code&quot;&gt;&gt;
{{{
    &lt;&lt;if $box is false&gt;&gt;You did not choose a box.&lt;&lt;else&gt;&gt;You chose the &lt;&lt;if $box is &quot;blue&quot;&gt;&gt;blue box, and found a cookie.&lt;&lt;elseif $box is &quot;red&quot;&gt;&gt;red box, but found nothing.&lt;&lt;else&gt;&gt;green box, and found an apple&lt;&lt;/if&gt;&gt;&lt;&lt;/if&gt;&gt;

    * [[Try again?|Demo-Basic]]
}}}
&lt;&lt;/message&gt;&gt;

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basics Menu|Basics]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="55" name="API-Adv" tags="chapter menu" position="1100,1100" size="200,100">&lt;h1&gt;Going Further with Basic APIs and More&lt;/h1&gt;
While most of the Basic API were listed [[here|Basic-API]], this chapter will cover more advanced elements for the Dialog Box and the UI SideBar, as well as extra APIs dealing with elements on the screen.

Those APIs are JavaScript-based code that should either be included in the JavaScript or within the {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}} macros to work.

* [[More Popups APIs|API-Dialog]] 
* [[More UIBar APIs|API-UIBar]] 
* [[The Template APIs|TemplateAPI]] 
* [[(Un)Locking the Loading Screen|API-Lock]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="56" name="API-Dialog" tags="page" position="1100,1200" size="100,100">&lt;h1&gt;More Popups APIs&lt;/h1&gt;
\
&lt;h3&gt;targeting and Appending a Popup&lt;/h3&gt;\
\
&lt;h4&gt;{{{Dialog.body()}}}&lt;/h4&gt;\
This API will be most used to target the body element of a popup, especially with jQuery code.
&gt; //Adding text to the popup://
{{{
    jQuery(Dialog.body()).append(&quot;Cry &#39;Havoc!&#39;, and let slip the &lt;em&gt;ponies&lt;/em&gt; of &lt;strong&gt;friendship&lt;/strong&gt;.&quot;);

    jQuery(Dialog.body()).wiki(&quot;Cry &#39;Havoc!&#39;, and let slip the //ponies// of &#39;&#39;friendship&#39;&#39;.&quot;);
}}}
&gt; &#39;&#39;Note:&#39;&#39; {{{.append()}}} will not parse SugarCube Markup or run macros. You will need to use {{{.wiki()}}} for that.
\
&lt;h4&gt;{{{Dialog.append()}}}&lt;/h4&gt;\
This API will append any given content to the body of the popup. This can be helpful when using a popup for multiple situations, but one requires some extra elements.
It is a shortcut for {{{jQuery(Dialog.body()).append(…)}}}. Like the jQuery {{{.append}}}, you &#39;&#39;cannot include&#39;&#39; any SugarCube Markup or macro as content, but use the {{{Dialog.wiki()}}} [[API|Basic-API-Dialog]] instead.
&gt; //Example://
{{{
    Dialog.append(&quot;Cry &#39;Havoc!&#39;, and let slip the &lt;em&gt;ponies&lt;/em&gt; of &lt;strong&gt;friendship&lt;/strong&gt;.&quot;);
}}}
&lt;&lt;button &quot;Click for Action&quot;&gt;&gt;&lt;&lt;run UI.restart()&gt;&gt;&lt;&lt;run Dialog.append(&quot;Look at what I added here!&lt;br&gt;But we shouldn&#39;t mess up with this popup. This is just for an example.&quot;);&gt;&gt;&lt;&lt;/button&gt;&gt;
\
&lt;h3&gt;{{{Dialog.isOpen()}}}&lt;/h3&gt;\
If there is code that should only be executed when a popup is (not) open (e.g. for a macro), you can use this API to check. {{{Dialog.isOpen()}}} also let you check if a particular popup is open, by indicating its class.
{{{
    Dialog.isOpen([classNames])
}}}
&gt; //Examples://
{{{
    if (Dialog.isOpen()) {
        /* code to execute if the dialog is open… */
    }

    if (Dialog.isOpen(&quot;saves&quot;)) {
        /* code to execute if the Saves dialog is open… */
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; For code that should be triggered every time a popup is opened, it is recommended to use the [[Dialog Event|Events-Dialog]] instead.

\
&lt;h3&gt;Creating an Alert Popup&lt;/h3&gt;\
While the [[Dialog API|Basic-API-Dialog]] has many elements and options to customise a popup, there is a quicker way to include an Alert Popup, with {{{UI.alert()}}}. With this one-line API, a popup titled //Alert// will appear on the screen, with an //OK// button to close it.
&gt; &#39;&#39;Note&#39;&#39;: this should not be confused with the JavaScript {{{alert()}}} which will create a browser popup.
{{{
    UI.alert(message [, options [, closeFn]])
}}}
\
The API has 3 parameters:
* {{{message}}}, which will be displayed to the player.
** this cannot include any SugarCube macro.
* {{{options}}} (optional) 
** namely {{{ {top: [value]} }}}, to affect the top margin of the popup.
* {{{closeFn}}} (option), the function to execute whenever the popup is closed
\
&gt; //Example://
{{{
    UI.alert(&quot;You smell of elderberries!&quot;);

    UI.alert(&quot;You smell of elderberries!&quot;, { top : 500});
}}}
&lt;&lt;button &quot;Alert Hi&quot;&gt;&gt;&lt;&lt;run UI.alert(&quot;You smell of elderberries!&quot;);&gt;&gt;&lt;&lt;/button&gt;&gt; | &lt;&lt;button &quot;Alert Low&quot;&gt;&gt;&lt;&lt;run UI.alert(&quot;You smell of elderberries!&quot;, { top : 500});&gt;&gt;&lt;&lt;/button&gt;&gt;

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the API Menu|API-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="57" name="API-UIBar" tags="page" position="1200,1200" size="100,100">&lt;h1&gt;More UIBar APIs&lt;/h1&gt;
\
&lt;h3&gt;{{{UIBar.update()}}}&lt;/h3&gt;\
This API will let you update the whole of the SideBar outside of [[Navigation Update|Events-Passage]]. Runing this API will refresh any element coded in [[Special Passages|SP-UIBar]] (e.g. {{{StoryBanner}}}, {{{StoryCaption}}}, etc...).
{{{
    UIBar.update();
}}}
&gt; &#39;&#39;Note:&#39;&#39; this should be used sparingly, as the refresh does not target a single element. If you need to update the SideBar, it is recommended to target that specific element instead of the whole, or move the player to a new passage. 
\
&lt;h3&gt;{{{UIBar.isHidden()}}} and {{{UIBar.isStowed()}}}&lt;/h3&gt;\
These API will check whether the SideBar is currently hidden or stowed respectively, using boolean values as results. These states are particularly useful when wanting to trigger code, whether in JavaScript or with SugarCube macros.
{{{
    if (UIBar.isHidden()) {
	    /* code to execute if the UI bar is hidden… */
    }

    if (!UIBar.isStowed()) {
	    /* code to execute if the UI bar is not stowed… */
    }

    &lt;&lt;if !UIBar.isHidden()&gt;&gt; ... &lt;&lt;/if&gt;&gt;

    &lt;&lt;if UIBar.isStowed()&gt;&gt; ... &lt;&lt;/if&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; these API will be useless if you removed the SideBar.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the API Menu|API-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="58" name="TemplateAPI" tags="page" position="1100,1300" size="100,100">&lt;h1&gt;The Template APIs&lt;/h1&gt;
Used in combination with the [[Template Markup|Markup-Template]], the Template APIs allows the inclusion of templates to display specific strings on the page. When defined, the Template API will look for any Template Markup ({{{?this}}}) and see if it can display a string instead.
This can be used to a wide range of elements and variation, but it might be the most useful for Pronouns display.
\
&lt;h3&gt;Creating a Template&lt;/h3&gt;\
This API will allow you to define a template in your project. You can include as many as you want, as long as each template is named differently.
&gt; &#39;&#39;Note:&#39;&#39; this API is case-sensitive!
{{{
    Template.add(name , definition);
}}}
The API has 2 parameters:
* {{{name}}}, the name (or array of names) of the template
** it must consist of basic Latin characters (A → Z) and start with a letter.
** it can include numbers, underscores, or hyphens
* {{{definitition}}}, what could be outputed when the template is used
** this can be a function, a string, or an array of either 
** if the definition is an array, the output will be randomly selected between all listed options
** functions should always produce string values
*** functions can use {{{this}}} to refer to the template&#39;s {{{name}}}
\
&gt; //Basic Examples://
{{{
→ String template named ?sunrise:
    Template.add(&#39;sunrise&#39;, &#39;sunset&#39;);

→ Array template named ?pie-filling:
Template.add(&#39;pie-filling&#39;, [&#39;cherry&#39;, &#39;apple&#39;, &#39;chocolate&#39;, &#39;pumpkin&#39;]);

→ Function template named ?pet:
Template.add(&#39;pet&#39;, function () {
	return either(&#39;a dog&#39;, &#39;a cat&#39;, &#39;a turtle&#39;);
});
}}}
&gt; &#39;&#39;Note:&#39;&#39; a Function template is used for [[HiEv&#39;s Pronoun Template|https://hiev-heavy-ind.com/Sample_Code/Sample_Code.html#Pronoun%20Templates]] 
\
&gt; //Mixed Array Example://
{{{
→ Mixed array template (string + function) named ?cmyk:
Template.add(&#39;cmyk&#39;, [
	&#39;Cyan&#39;,
	function () {
		return either(&#39;Magenta&#39;, &#39;Yellow&#39;);
	},
	&#39;Black&#39;
]);
}}}
&gt; //Function Example with context object// {{{this}}}:
{{{
→ Multi-Named template, whose output depends on the name:
Template.add([&#39;color&#39;, &#39;Color&#39;], function () {
	var color = either(&#39;red&#39;, &#39;green&#39;, &#39;blue&#39;);
	return this.name === &#39;Color&#39; ? color.toUpperFirst() : color;
});
}}}
&gt; &#39;&#39;Note:&#39;&#39; in this last example, the function will randomly select between //red//, //green//, and //blue//. Then it will look at whether the Template Markup is either {{{?color}}} or {{{?Color}}} to format the output (capitalised or lowercase).
\
&lt;h3&gt;Removing a Template&lt;/h3&gt;\
To remove a template (or multiple), you need to use {{{Template.delete()}}}. Please note that deleting a template will affect any future iteration of that specific Template Markup.

The template has 1 parameter:
* {{{name}}}, the name (or arrays of names) of the template(s) to remove.
&gt; //Examples://
{{{
→ Removes the template for ?sunrise
    Template.delete(&#39;sunrise&#39;);

→ Removes the templates ?color and ?Color
    Template.delete([&#39;color&#39;, &#39;Color&#39;]);
}}}
\
&lt;h3&gt;Other Template APIs&lt;/h3&gt;\
&lt;h4&gt;{{{Template.size}}}&lt;/h4&gt;\
This API can tell how many templates exist within the code.
{{{
    if (Template.size === 0) {
        /* If no templates exist, run code */
    }
}}}
\
&lt;h4&gt;{{{Template.has()}}}&lt;/h4&gt;\
This API will check whether a template, for which you need to indicate the name, exists within the code.
{{{
    Template.has()

    if (Template.has(&#39;sunrise&#39;)) {
	    /* if ?sunrise is defined, run code */
    }
}}}
\
&lt;h4&gt;{{{Template.get()}}}&lt;/h4&gt;\
This API will indicate the definition of the template, whether it be a function ({{{[function]}}}), a string ({{{&#39;word&#39;}}}) or an array (list all elements), or will return NULL if the template is not defined.
{{{
    Template.get(name)

    var sunrise = Template.get(&#39;sunrise&#39;);
}}}
&gt; &#39;&#39;Note:&#39;&#39; if {{{?sunrise}}} is defined as the first example on this page, this API will show {{{sunset}}} as a value.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the API Menu|API-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="59" name="API-Lock" tags="page" position="1200,1300" size="100,100">&lt;h1&gt;(Un)Locking the Loading Screen&lt;/h1&gt;
While the Loading Screen will stay visible until all coded assets are imported, like the [[Audio|Macro-Audio]], or loading [[StyleSheets or Scrips|Function-JS]], you can force it to stay locked for a longer period of time. During that time, the player will not be able to interact with the game.
This can be useful when wanting to display multiple elements as a loading sequence, or to run more code at the start. It can also be used during the story.
\
&lt;h3&gt;{{{LoadScreen.lock()}}}&lt;/h3&gt;\
You can lock the screen by simply adding {{{LoadScreen.lock();}}} inside the JavaScript or within the {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}} macros directly in a passage. The Loading Screen will then appear on the screen. 

Each use of the {{{LoadScreen.lock()}}} will return a ID (number). It is also preferable to save this id inside a (JavaScript) variable, for when you want to unlock the screen:
{{{
    var lockID = LoadScreen.lock();
}}}
\
&lt;h3&gt;{{{LoadScreen.unlock()}}}&lt;/h3&gt;
To unlock the screen, and remove the Loading Screen, you will need to use {{{LoadScreen.unlock()}}} and indicate the lock ID:
{{{
    LoadScreen.unlock(lockId);

    LoadScreen.unlock(2);
}}}
&gt; &#39;&#39;Note:&#39;&#39; the ID must be a number, or an integer variable, saving that number.
\
&gt; //Examples://
{{{
    var lockID = LoadScreen.lock();

    setTimeout(function(){
        LoadScreen.unlock(lockID);
        /* Other functions that could affect the loading screen */
    }, 5000);
}}}
{{{
    var lockID = LoadScreen.lock();

    /* Do something whose timing is unpredictable 
    that should be hidden by the loading screen */

    LoadScreen.unlock(lockID);
}}}
\
&lt;h3&gt;Loading Screens and Config API&lt;/h3&gt;\
If your goal is only to delay the dismissal of the loading screen (e.g. to avoid it flashing at the start if too quick), the APIs above are somewhat unnecessary. You can use the {{{Config.loadDelay}}} API instead.

{{{Config.loadDelay}}} will add a timer to the dismissal of the loading screen (indicated in milliseconds), which should normally happen once the game is ready to play. 
&gt; //Example://
{{{
→ Adding 2s of delay:    
    Config.loadDelay = 2000;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the API Menu|API-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="60" name="Basic-API" tags="chapter menu" position="3500,1100" size="200,100">&lt;h1&gt;Some Useful Basic APIs&lt;/h1&gt;
Along with macros, there are further APIs to trigger an event in the game, such as undoing an action, opening a popup, or configuring some functionalities in the engine. For more Basic APIs, see [[this page|API-Adv]].

Those APIs are JavaScript-based code that should either be included in the JavaScript or within the {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}} macros to work.

* [[Moving back and forth in the History|Basic-API-Engine]]
* [[Create a PopUp|Basic-API-Dialog]] 
* [[Handle the SideBar|Basic-API-UIBar]]
* [[Open the JumpTo, Restart, Saves, and Settings PopUp|Basic-API-UI]] 
* [[Overriding the Navigation to a Passage|Basic-Config-Navig]]
* [[Some Useful Configuration API for your Project|Basic-API-Config]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="61" name="Basic-API-Engine" tags="page" position="3500,1200" size="100,100">&lt;h1&gt;Moving back and forth in the History&lt;/h1&gt;
Moving back and forth in the Player&#39;s History is possible in the base SugarCube UI with the History buttons at the top of the SideBar. They are represented with the {{{←}}} and {{{→}}} arrows in the base styling. 

However, if those buttons are removed, through the [[Config API|Basic-API-Config]] or because the SideBar was removed (with {{{StoryInterface}}} or the [[UIBar API|Basic-API-UIBar]]), it is still possible for the player to undo/redo an action: with the {{{Engine.backward()}}} and {{{Engine.forward()}}}, nested inside a {{{&lt;&lt;link&gt;&gt;}}} or a {{{&lt;&lt;button&gt;&gt;}}}.
{{{
    &lt;&lt;run Engine.backward()&gt;&gt;
    &lt;&lt;script&gt;&gt;Engine.forward()&lt;&lt;/script&gt;&gt;

Inside a link/button:
    &lt;&lt;link &quot;Back&quot;&gt;&gt;&lt;&lt;run Engine.backward()&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;button &quot;Forward&quot;&gt;&gt;&lt;&lt;script&gt;&gt;Engine.forward()&lt;&lt;/script&gt;&gt;&lt;&lt;/button&gt;&gt;
}}}

While this API can also be used without player interaction, by simply including the API in a non-interactive macro (e.g. {{{&lt;&lt;timed&gt;&gt;}}}), to automatically rewind/redo the action, I would not recommend it.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basic API Menu|Basic-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="62" name="Basic-API-Dialog" tags="page" position="3600,1200" size="100,100">&lt;h1&gt;Create a PopUp&lt;/h1&gt;
Instead of moving to another passage to show a bit of text to the player, the Dialog API is here to create &lt;&lt;link &quot;PopUps&quot;&gt;&gt;&lt;&lt;popup &quot;Basic-UI-Dialog&quot; &quot;Dialog Box&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;!
\
&lt;h3&gt;The Basics of Popups&lt;/h3&gt;\
To create a popup, you will need 3 APIs, in this order:
* {{{Dialog.setup()}}}, to prepare the popup, and add a title (optional) and a class (optional)
* {{{Dialog.wiki()}}}, to include text in the popup
* {{{Dialog.open()}}}, to open the dialog box
\
{{{
    Dialog.setup(&#39;This a PopUp&#39;);
    Dialog.wiki(&quot;And here is the text. Even some //italics// and &#39;&#39;bold&#39;&#39;!&quot;);
    Dialog.open();
}}}
&gt;&#39;&#39; Note:&#39;&#39; be mindful of quotes in {{{Dialog.wiki()}}}, as it could start issues.

For longer popups, you can use {{{Story.get().processText()}}} to pull the content of a separate passage. This is quite handy when you want to avoid messy code blocks, have a bit more control over the text (like line breaks), or when including interactive macros.
{{{
    Dialog.wiki(Story.get(&quot;Passage Name&quot;).processText());
}}}
\
&lt;h3&gt;Customise the Popup&lt;/h3&gt;\
For {{{Dialog.setup()}}} and {{{Dialog.open()}}}, it is possible to add parameters to customise a popup further. This can take multiple forms, from adding a CSS class to the whole popup, changing where the popup is positioned, or triggering a function when closing the popup.

The {{{Dialog.setup()}}} has 2 parameters:
* {{{title}}} (optional): the title displayed for the popup
* {{{classNames}}} (optional): classes to attach to the popup, separated with a space
{{{
    Dialog.setup(&#39;This is a PopUp Title&#39;, &#39;a-class and-another-one&#39;);
}}}
&gt; &#39;&#39;Note:&#39;&#39; you can target this class in the StyleSheet to change how the popup looks 

The {{{Dialog.open()}}} has also 2 parameters:
* {{{options}}} (optional) 
** namely {{{ {top: [value]} }}}, to affect the top margin of the popup.
* {{{closeFn}}} (option), the function to execute whenever the popup is closed
{{{
    Dialog.open({top : 500}, myFunction())
}}}

&gt;&#39;&#39; Note:&#39;&#39; Chapel has created a [[Macro Set|https://github.com/ChapelR/custom-macros-for-sugarcube-2/blob/master/docs/dialog-api-macro-set.md]] to make the process of coding Popups easier. This macro is used in this guide.
\
&lt;h3&gt;{{{Dialog.close();}}}&lt;/h3&gt;\
While the Dialog box has a built-in //Close// button in its top-right corner, or can be closed by clicking outside of the dialog box, there is a third way to make the popup disappear: {{{Dialog.close()}}}.
If the popup has interactive elements, especially some triggering more code (e.g. moving to a new passage), this API will automatically close the popup for the player.
{{{
    Dialog.close();

    &lt;&lt;button &quot;Move Forward?&quot;&gt;&gt;
        &lt;&lt;if $ready is true&gt;&gt;
            &lt;&lt;goto &quot;Forest&quot;&gt;&gt;
            &lt;&lt;run Dialog.close();&gt;&gt;
        &lt;&lt;else&gt;&gt;
            /* Some code :P */
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/button&gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basic API Menu|Basic-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="63" name="Basic-UI-Dialog" tags="popup" position="700,200" size="100,100">You found the dialog box!</tw-passagedata><tw-passagedata pid="64" name="Basic-API-UIBar" tags="page" position="3500,1300" size="100,100">&lt;h1&gt;Handle the SideBar&lt;/h1&gt;
Thanks to the APIs below, you can control when/where the SideBar will appear on the page. These can be included directly on the passage (with either {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}}), or in the JavaScript.

{{{UIBar.hide()}}} will hide the SideBar on the page, and stay hidden until {{{UIBar.show()}}} is triggered. Even if it won&#39;t appear on the page, the element {{{#ui-bar}}} will still be included in the HTML, but with a display value of {{{none}}} when hidden.

Similarly, {{{UIBar.stow()}}} will stow the SideBar to the side (but still visible), and stay stowed until {{{UIBar.unstow()}}} is triggered. The element {{{#ui-bar}}} will receive a special class {{{.stowed}}}, and transition from one state to another with a smooth animation.

{{{UIBar.destroy()}}}, on the other hand will remove the the element {{{#ui-bar}}} completely.
&gt;&#39;&#39; Note:&#39;&#39; if {{{StoryInterface}}} is in use, and does not include the element {{{#ui-bar}}} within this Special Passage, there is no need to include this API.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basic API Menu|Basic-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="65" name="Basic-API-UI" tags="page" position="3600,1300" size="100,100">&lt;h1&gt;Open the JumpTo, Restart, Saves, and Settings PopUp&lt;/h1&gt;
The elements above are included in the base SugarCube UI, as buttons in the menu (if they are populated), but can be called at any time with the APIs below:
* {{{UI.jumpto()}}}, will open the JumpTo Menu, allowing the player to go back in the History to a [[bookmarked passage|Tags-Built]].
** This will &#39;&#39;undo any action&#39;&#39; made by the player since the bookmark. 
* {{{UI.restart()}}}, will open a popup asking the player if they would like to Restart the Game.
** To restart without a popup, you will want to use the [[Engine API|Engine-Restart]].
* {{{UI.saves()}}}, will open the Save popup.
* {{{UI.settings()}}}, will open the Settings popup.
* {{{UI.share()}}}, will open the Share popup.

Those APIs are most useful inside a {{{&lt;&lt;link&gt;&gt;}}} or {{{&lt;&lt;button&gt;&gt;}}} when:
* the UI of the project doesn&#39;t include the built-in SideBar 
* when the menu has been removed from the SideBar
* in a Starting Menu Passage or an Ending Passage

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basic API Menu|Basic-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="66" name="Basic-Config-Navig" tags="page" position="3500,1400" size="100,100">&lt;h1&gt;Overriding the Navigation to a Passage&lt;/h1&gt;
While moving from passage to passage is dictated by the Passage Name inside a link or in a {{{&lt;&lt;goto&gt;&gt;}}} macro, it is still possible to override the original destination, sending the player to a new passage. This can be done with {{{Config.navigation.override}}}:
{{{
    Config.navigation.override = function (dest) {
	    /* code */
    };
}}}
&gt;&#39;&#39; Note:&#39;&#39; this requires a bit of JavaScript knowledge to fill in the Config (or edit the example below).

Assuming that you want to send the player to an End Screen ({{{&quot;You Died&quot;}}}) because their {{{$health}}} is too low (0 or less):
{{{
    Config.navigation.override = function (dest) {
        var sv = State.variables;
        if (sv.health &lt;= 0) {
            return &quot;You Died&quot;;
        }
    };
}}}
&gt;&#39;&#39; Note:&#39;&#39; {{{State.variables}}} is how to code a variable (here {{{$health}}}) in JavaScript that was set in a SugarCube passage.

If there are multiple situations where the player should be sent to a special passage:
{{{
    Config.navigation.override = function (dest) {
        var sv = State.variables;
        if (sv.health &lt;= 0) {
            return &quot;You Died&quot;;
        }
        else if (sv.coins = 0) {
            return &quot;You Poor&quot;;
        }
    };
}}}

&#39;&#39;An important Note:&#39;&#39; if there is a link to a different passage in the End Screen and the variable still has a value that would run the code above, the Navigation will be overriden again when that link is clicked. You can avoid this by:
* change the value of the variable 
* unset the variable 
* remove any link that would move the player to a new passage
\
&lt;h3&gt;A non-JavaScript Alternative&lt;/h3&gt;\
While the method above is prefered, this navigation override is also possible to do in SugarCube code, inside the {{{PassageReady}}} with a couple of conditional statements and {{{&lt;&lt;goto&gt;&gt;}}} macros:
{{{
    ::PassageReady
    &lt;&lt;if !$ending&gt;&gt;
        &lt;&lt;if $health &lt;= 0&gt;&gt;
            &lt;&lt;set $ending to true&gt;&gt;
            &lt;&lt;goto &quot;You Died&quot;&gt;&gt;
        &lt;&lt;elseif $coins = 0&gt;&gt;
            &lt;&lt;set $ending to true&gt;&gt;
            &lt;&lt;goto &quot;You Poor&quot;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
}}}
Since this runs before the passage is [[fully rendered|SP-PassageReady-Done]], it is important that the {{{$ending}}} variable is included here, and set as true before the {{{&lt;&lt;goto&gt;&gt;}}} macro, otherwise the player will run into an endless loop of reloading the ending passage.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basic API Menu|Basic-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="67" name="Basic-API-Config" tags="page" position="3600,1400" size="100,100">&lt;h1&gt;Some Useful Configuration API for your Project&lt;/h1&gt;
To customise your project further, here are a few Config APIs you might find useful.
\
&lt;h3&gt;Remove the History Buttons&lt;/h3&gt;\
To force players to move forwards, it is possible to remove the //Forward// and //Backwards// buttons at the top of the SideBar, with the following code in the JavaScript:
{{{
    Config.history.controls = false;
}}}
&gt;&#39;&#39; Note:&#39;&#39; this is only useful if the Base UI is in use or the element {{{#ui-bar-history}}} appears on the page. If the UIBar has been removed from editing the {{{StoryInterface}}}, you will not need this API.
&gt; When removing these controls, you may want to give the player ways to go backward and forward in the story (especially relevant if you have codexes).
\
&lt;h3&gt;Change the Max Amount of States&lt;/h3&gt;\
To avoid the player rewinding too much, you change the maximum number of state the history can save. These are active passages visited the player can go back to by pressing the //Backwards// button. If the player has visited more passage than the limit, the earlier visited states are moved to an &quot;Expired&quot; state, and won&#39;t be available to go back to with the back arrow or {{{Engine.backward()}}}.
{{{
    Config.history.maxStates = 40; //(default)
    Config.history.maxStates = 1; //(will not allow player to go backward)
}}}
&gt;&#39;&#39; Note:&#39;&#39; the larger the {{{maxStates}}}, the bigger the chance of lag when loading new passages.
\
&lt;h3&gt;Change the Number of Save Slots&lt;/h3&gt;\
With a default of 8 save slots (+ autosave and export), players have many opportunities to save a play through. Still, the number of save slots can be modified:
{{{
    Config.saves.slots = 4;
}}}
&gt;&#39;&#39; Note:&#39;&#39; the higher the number, the more the game will save in the player&#39;s cache. 
&gt; For more Save Config, see [[this page|Config-Saves]].
\
&lt;h3&gt;Removing Unwanted Blank Space&lt;/h3&gt;\
Aside from using the {{{&lt;&lt;nobr&gt;&gt;}}} macro or {{{nobr}}} tag, there are two Config APIs which will remove the unnecessary blank space in your project: {{{Config.cleanupWikifierOutput}}} and {{{Config.passages.nobr}}}.

{{{Config.cleanupWikifierOutput}}} will transform any {{{&lt;br&gt;}}} on the page into empty {{{&lt;p&gt;}}} (thus, &quot;disappear&quot;), as well as wrap any non {{{&lt;div&gt;}}} elements with {{{&lt;p&gt;}}}.
&gt;&#39;&#39; Note:&#39;&#39; {{{Config.cleanupWikifierOutput}}} runs into strange issues sometimes, like working strangely with the {{{&lt;&lt;cycle&gt;&gt;}}} macro ([[this can be fixed|Accessibility-Cycle]]).

On the other hand, {{{Config.passages.nobr}}} will only remove any break on the page. This means that you will need to wrap every paragraph or bit of text with a block HTML makrup (i.e. {{{&lt;p&gt;}}}, {{{&lt;div&gt;}}}, {{{&lt;h1&gt;}}}, etc...) manually.
{{{
    Config.cleanupWikifierOutput = true;
    Config.passages.nobr = true;
}}}
&gt;&#39;&#39; Note:&#39;&#39; if both are included, no matter the order, {{{Config.passages.nobr}}} will remove all breaks on the page. 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Basic API Menu|Basic-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="68" name="Functions" tags="chapter menu" position="2300,1100" size="200,100">&lt;h1&gt;Harness the Power of Functions&lt;/h1&gt;
Functions are JavaScript blocks of code designed to do a specific task, from importing outside scripts, to save information, or setting variables. While some of the functions explained in this chapter can be used in any passage in combination with SugarCube macros, some should be restricted to the JavaScript passage only.

* [[Cloning Variables, and Random Values Functions|Function-Clone-Random]]
* [[Using Play, Passage, and Tags information|Function-Pass-Tag]]  
* [[Memorizing Information and Metadata|Function-Metadata]]
* [[JavaScript-only Functions|Function-JS]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="69" name="Function-Clone-Random" tags="page" position="2300,1200" size="100,100">&lt;h1&gt;Cloning Variables, and Random Values Functions&lt;/h1&gt;
SugarCube has a handful of functions to set variables, from cloning objects to randomising a value.
\
&lt;h3&gt;The {{{clone()}}} function&lt;/h3&gt;\
Unlike simple variables or arrays, copying an object in another variable will not just copy the current value of the orginal variable but any future changes to that original variable. Assuming that {{{$object = {turn : 1} }}}:
{{{
    &lt;&lt;set $var to $object&gt;&gt;
    &lt;&lt;set $object.turn to 6&gt;&gt;

    → $object.turn = 6
    → $var.turn = 6
}}}
This is where the {{{clone()}}} function comes in. The function will clone the values of an object, but not any future change. 
{{{
    &lt;&lt;set $var to clone($object)&gt;&gt;
    &lt;&lt;set $object.turn to 6&gt;&gt;

    → $object.turn = 6
    → $var.turn = 1
}}}
\
&lt;h3&gt;Random Values Functions&lt;/h3&gt;\
To randomise a value, there are two main functions: {{{either()}}} for strings and arrays, and {{{random()}}}/{{{randomFloat()}}} for integer (only). Both functions can be used in setting variables or simply printed on the page:
{{{
    &lt;&lt;set $var to either(&#39;Blueberries&#39;, &#39;Cherries&#39;, &#39;Peaches&#39;)&gt;&gt;
→ this will set $var with one of the listed values

    &lt;&lt;print random(5)&gt;&gt;
→ this will print on the page a number between 0 and 5 (incl)

    &lt;&lt;set _temp to randomFloat(0.0, 5.0)&gt;&gt;
→ this will set _temp a number between 0.0 and 4.99999...
}}}
&gt; &#39;&#39;Note:&#39;&#39; {{{either()}}} will also accept integer and boolean values.
\
Instead of listing values, other variables can be used inside the functions. Assuming that {{{_min = 0}}}, {{{_max = 10}}}, {{{_array = [&quot;Apple&quot;, &quot;Chocolate&quot;]}}}, {{{_array2 = [1, 2]}}}:
{{{
    &lt;&lt;set
        $var to either(_array),
        $var2 to either(_array, _array2),
        $var3 to either(_array, &quot;Peaches&quot;),
        $var4 to random(_max),
        $var5 to random(_min, _max)
    &gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Functions Menu|Functions]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="70" name="Function-Pass-Tag" tags="page" position="2400,1200" size="100,100">&lt;h1&gt;Using Play, Passage, and Tags information&lt;/h1&gt;
SugarCube functions can also track where players have (or have not) been, or how many times they have visited a certain passage. These can be useful to show variation, whether certain links appear in a menu, or changing the content of the Header/Footer depending on a location.
\
&lt;h3&gt;Using the {{{tags()}}} and {{{visitedTags()}}} functions&lt;/h3&gt;\
To track where the player is or has been based on the tags coded on the passages, we can use respectively the {{{tags()}}} and {{{visitedTags()}}} functions. This is quite useful when trying to target a group of passages rather than a handful of them (and having to list those). 

{{{tags()}}} should mainly be used in Special Passages, widgets, or JavaScript code outside of the passage, as it contains the list of tags of the current passage. As passages may have multiple tags, it should be treated as if they were an array variable.
{{{
    :: PassageHeader
    &lt;&lt;if tags().includes(&#39;forest&#39;)&gt;&gt;The Dark Forest
    &lt;&lt;elseif tags().includes(&#39;town&#39;)&gt;&gt;The Lovely Town 
    &lt;&lt;elseif tags().includes(&#39;tavern&#39;)&gt;&gt;The Thick Table Tavern :P
    &lt;&lt;/if&gt;&gt;

Display tags:
    &lt;&lt;print tags()&gt;&gt;

Set as a value:
    &lt;&lt;set $var to tags()&gt;&gt;
}}}

{{{visitedTags()}}} will save all the different tags attached to the previously visited passages, and should be mainly be used in conditional statements:
{{{
    &lt;&lt;if visitedTags(&quot;forest&quot;)&gt;&gt; … &lt;/if&gt;&gt;
→ has visited at least one passage tagged &#39;forest&#39;

    &lt;&lt;if visitedTags(&quot;forest&quot;, &quot;haunted&quot;) is 1&gt;&gt; … &lt;&lt;/if&gt;&gt;
→ has visited a passage tagged with both &#39;forest&#39; and &#39;haunted&#39; exactly once

    &lt;&lt;if visitedTags(&quot;forest&quot;, &quot;burned&quot;) gt 3&gt;&gt; … &lt;&lt;/if&gt;&gt;
→ has visited a passage tagged with both &#39;forest&#39; and &#39;burned&#39; more than three times
}}}
&gt; &#39;&#39;Note:&#39;&#39; this functions works similarly to the {{{visited()}}} function. As such, when using more strict conditional statements, as players may unknowingly visit a passage more than once (see {{{&lt;&lt;return&gt;&gt;}}} [[macro|Macro-Back-Return]] or the [[Arbitrarily Long Return|Long-Return-JS]]).
\
&lt;h3&gt;Using the Passage-related functions&lt;/h3&gt;\
One can track where the player is or has been based on the passages&#39; name. Aside from {{{passage()}}}, all other functions deal with past events, with {{{visited()}}} and {{{lastVisited()}}} handling both current and past events.

{{{passage()}}} will &#39;&#39;only&#39;&#39; look at the current passage. It can be used both in conditional statements, setting variables, or reloading a page:
{{{
    &lt;&lt;if passage() is &quot;Forest&quot;&gt;&gt;...&lt;&lt;/if&gt;&gt;
    &lt;&lt;set $var to passage()&gt;&gt;
    &lt;&lt;link &quot;Reload&quot; `passage()`&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; while it is possible to reload as passage with {{{passage()}}}, this is not recommended, as issues may arise from reloading one passage too many times. If used, it should be done so parsimoniously.
&gt; It is best to use {{{&lt;&lt;replace &#39;.passage&#39;&gt;&gt;&lt;&lt;include `passage()`&gt;&gt;&lt;&lt;/replace&gt;&gt;}}} instead.

{{{previous()}}} will log the most recent previous passage. It will be most useful in conditional statements or links:
{{{
    &lt;&lt;if previous() is &quot;Forest&quot;&gt;&gt;...&lt;&lt;/if&gt;&gt;
    &lt;&lt;link &quot;Go Back&quot; `previous()`&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; using {{{previous()}}} in a link will be the same as using the {{{&lt;&lt;back&gt;&gt;}}} [[macro|Macro-Back-Return]]. 

{{{visited()}}} will look at the amount of time a passage has been visited, and is mainly used in conditional statements. When landing on a passage, the {{{visited()}}} counter will increase by 1. The following examples will check if:
{{{
    &lt;&lt;if visited() is 2&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ this is currently the second visit on this passage

    &lt;&lt;if visited(&#39;Tavern&#39;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has visited the passage &quot;Tavern&quot; at least once 

    &lt;&lt;if visited(&#39;Tavern&#39;) is 2&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has visited the passage &quot;Tavern&quot; exactly two times 

    &lt;&lt;if visited(&#39;Tavern&#39;, &#39;Forest&#39;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has visited the passages &quot;Tavern&quot; AND &quot;Forest&quot; at least once
}}}
&gt; &#39;&#39;Note:&#39;&#39; when using more strict conditional statements, as players may unknowingly visit a passage more than once (see {{{&lt;&lt;return&gt;&gt;}}} [[macro|Macro-Back-Return]] or the [[Arbitrarily Long Return|Long-Return-JS]]).

{{{lastVisited()}}} works similarly to the {{{previous()}}} function, though it will look at the length of turns between the current passage and the one in question. The following examples will check if:
{{{
    &lt;&lt;if lastVisited(&#39;Tavern&#39;) is 0&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player is currently in the passage &quot;Tavern&quot;

    &lt;&lt;if lastVisited(&#39;Tavern&#39;) is -1&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has not yet visited the passage &quot;Tavern&quot;

    &lt;&lt;if lastVisited(&#39;Tavern&#39;) is 1&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the previous passage visited by the player is &quot;Tavern&quot;

    &lt;&lt;if lastVisited(&#39;Tavern&#39;, &#39;Forest&#39;) is 2&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has visited BOTH the &quot;Tavern&quot; and &quot;Forest&quot; passage, most recently 2 turns ago
}}}
&gt; &#39;&#39;Note:&#39;&#39; the {{{lastVisited()}}} function will look at all passages visited in the order they were visited, even if those passages are not part of the story (i.e. Codex).
&gt; To avoid seeing those passages in the history, consider avoiding using the {{{&lt;&lt;return&gt;&gt;}}} [[macro|Macro-Back-Return]] or a regular link with the the [[Arbitrarily Long Return|Long-Return-JS]], favouring the {{{&lt;&lt;back&gt;&gt;}}} [[macro|Macro-Back-Return]] instead.

{{{hasVisited()}}} will only check if a passage has been visited or not. The following examples will check if:
{{{
    &lt;&lt;if hasVisited(&#39;Tavern&#39;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has visited the passage &#39;Tavern&#39;

    &lt;&lt;if not hasVisited(&#39;Tavern&#39;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has not yet visited the passage &#39;Tavern&#39;

    &lt;&lt;if hasVisited(&#39;Tavern&#39;, &#39;Forest&#39;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has visited BOTH the passages &#39;Tavern&#39; and &#39;Forest&#39;

    &lt;&lt;if not hasVisited(&#39;Tavern&#39;, &#39;Forest&#39;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ the player has not visited &#39;Tavern&#39;, or not visited &#39;Forest&#39;, or not visited both
}}}
\
&lt;h3&gt;Other Play Functions&lt;/h3&gt;\
{{{turns()}}} will look at the amount of turns a player has taken since the start of the playthrough. It will count all passages visited as a singular path (including starting menus and codexes). As such, rewound/undone actions are not counted. It can be used to display said count on the page, in conditional statements, or saved in a variable.
{{{
    &lt;&lt;= turns()&gt;&gt; 
→ will print the number of turns 

    &lt;&lt;print &quot;Turn #&quot; + turns()&gt;&gt;
→ will print the number of turns, with some extra text 

    &lt;&lt;if turns() gt 5&gt;&gt;...&lt;&lt;/if&gt;&gt;
    &lt;&lt;set $var to turns()&gt;&gt;
}}}

{{{time()}}} will look at the time spent in the current passage, in milliseconds. It can be useful in forcing the player to do quick decisions, or track how long a player goes through a section.
{{{
    &lt;&lt;set $time += time()&gt;&gt;

    &lt;&lt;if time() lt 5000&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ if the time spent on the passage is less than 5 seconds.

    &lt;&lt;link &quot;Run Away!&quot;&gt;&gt;
        &lt;&lt;if time() lt 5000&gt;&gt;
            &lt;&lt;goto &quot;Escaped&quot;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;goto &quot;Caught&quot;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/link&gt;&gt;
}}}
    
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Functions Menu|Functions]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="71" name="Function-Metadata" tags="page" position="2300,1300" size="100,100">&lt;h1&gt;Memorizing Information and Metadata&lt;/h1&gt;
Aside form the Built-In Saves, SugarCube has another way of saving information, in the story metadata. While it &#39;&#39;is not&#39;&#39; a save and &#39;&#39;should not&#39;&#39; replace saves, the following functions can be useful for tracking achievements or statistics, or having a New Game+ feature.
&gt; &#39;&#39;Note:&#39;&#39; this //will not work with private browsing//, and may affect how the game progresses.
&gt; It will also affect all playthroughs of the game.
{{{
    memorize() → save information
    recall()   → bring up information 
    forget()   → delete information
}}}

The functions will need the {{{&lt;&lt;run&gt;&gt;}}} macro to be used and is set as follow:
* the function 
* the name of the information to save/edit/delete, as a string
* (optional) the value of the information, can be a boolean, string or integer
{{{
    &lt;&lt;run function(&#39;name&#39;: value)&gt;&gt;
}}}
{{{
    &lt;&lt;run memorize(&#39;achievement1&#39;: true)&gt;&gt;
    &lt;&lt;run forget(&#39;achievement1&#39;)&gt;&gt;
}}}

The {{{recall}}} function can also be used in conditional statements and saving the information in variables:
{{{
    &lt;&lt;if recall(&#39;achievement&#39;) is true&gt;&gt;
        You already achieved this.
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;set $variable to recall(&#39;achievement&#39;)&gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Functions Menu|Functions]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="72" name="Function-JS" tags="page" position="2400,1300" size="100,100">&lt;h1&gt;JavaScript-only Functions&lt;/h1&gt;
The functions below can only be used in the JavaScript tab or inside a {{{&lt;&lt;script&gt;&gt;}}} macro.
\
&lt;h3&gt;Importing outside code&lt;/h3&gt;\
SugarCube functions allows for importing JavaScript and CSS from outside sources, to use in a project:
{{{
To import JavaScript:
    importScripts(URL);

To import CSS:
    importStyles(URL);
}}}

You can import multiple scripts or styles in one import:
{{{
    importScripts(
        &quot;https://somesite/a/path/a.js&quot;,
        &quot;https://somesite/a/path/b.js&quot;,
        &quot;https://somesite/a/path/c.js&quot;,
        &quot;https://somesite/a/path/d.js&quot;
    );
    importStyles([
        &quot;https://somesite/a/path/a.css&quot;,
        &quot;https://somesite/a/path/b.css&quot;,
        &quot;https://somesite/a/path/c.css&quot;,
        &quot;https://somesite/a/path/d.css&quot;
    ]);
}}}
&gt; &#39;&#39;Note:&#39;&#39; the use of square {{{[ ]}}} brackets will determine whether the sheets should be loaded one after the other or not.
\
&lt;h3&gt;Calling SugarCube variables in JS code&lt;/h3&gt;\
Sometimes, your JavaScript code will need a variable set in SugarCube to run. This is where {{{temporary()}}} and {{{variables()}}} come in.
&gt; &#39;&#39;Note:&#39;&#39; knowledge of JavaScript is required.
{{{
    temporary().test    → _test
    variables().colour  → $colour
}}}
&gt; &#39;&#39;Note:&#39;&#39; those functions are equivalent to {{{State.temporary}}} and {{{State.variables}}}
{{{
    if (variables().hasGoldenKey) {
	    temporary().unlock = true
    }
→ if the variable $hasGoldenKey is true, the code will change the value of _unlock to true
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Functions Menu|Functions]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="73" name="Int-JS-CSS" tags="chapter menu" position="3200,1100" size="200,100">&lt;h1&gt;Going further in Styling with CSS and JavaScript&lt;/h1&gt;
When wanting to change how a page looks or behave, you will need to edit either the StyleSheet, the JavaScript or a combination of both. If it is behaviour that needs setting, then you will most likely need the JavaScript. For most visual elements, you should turn to the StyleSheet.

While editing the StyleSheet, you may find the Inspect Tool of your browser to be a useful thing. From testing for different screen sizes and accessibility, to view the source code (HTML/CSS) of the displayed passage, or even messing with the CSS rules without going back and forth between the StyleSheet and the file, the tool will let you ensure a great visual for your project.

* [[The Different Targetable Elements|Int-JS-CSS-Elements]] 
** [[The Full List of Targetable Elements|HTML-Full-List]] 
* [[Ensuring that Elements Start at the Top when Opened|Int-JS-CSS-Events]]
* [[Import and Change the Font|Int-JS-CSS-Font]] 
* [[Using the Root and CSS var|Int-JS-CSS-Root]] 
* [[Formating for Different Screen Size|Int-JS-CSS-Media]] 
* [[Intro to Animation|Int-JS-CSS-Animation]]
* [[Creating Stats, Meter, and Progress Bars|Int-JS-CSS-Stat]] (long) 
* [[Editing the Loading Screen|Int-JS-CSS-LoadingScreen]] 
* [[A Note on Interface Accessibility|Accessibility]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="74" name="Int-JS-CSS-Elements" tags="page" position="3200,1200" size="100,100">&lt;h1&gt;The Different Targetable Elements&lt;/h1&gt;
With its [[base UI|http://www.motoslave.net/sugarcube/2/docs/#html]], SugarCube creates multiple elements on the page, which can be targeted in the StyleSheet with some CSS or in the JavaScript.

The elements have also relationships with one another, as they are nested within one another. Depending on where they are located within the nesting, and how the Built-In StyleSheet targets them, any edit made may affect more than the targeted elements.
&gt; &#39;&#39;Note:&#39;&#39; when an element is located inside another, the first is called a child of the second, while the second is the parent of the first. CSS rules in the parent element may affect the child element.
\
&lt;h3&gt;Main Block Elements&lt;/h3&gt;\
&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;Selector&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;th&gt;Relationship&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{html}}}&lt;/td&gt;
        &lt;td&gt;The document element, necessary to set up the HTML page. &#39;&#39;Should not be included inside&#39;&#39; {{{StoryInterface}}}.
        If a story-passage is tagged, {{{data-tags}}} will be added to this element.
        If the project includes Settings, classes and attributes will be added to this element. 
        The element sets the font size for the whole document.&lt;/td&gt;
        &lt;td&gt;{{{html}}} is the parent element to all elements below, but most closely to {{{body}}}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{body}}}&lt;/td&gt;
        &lt;td&gt;The body of the page. &#39;&#39;Should not be included in&#39;&#39; {{{StoryInterface}}}.
        If a story-passage is tagged, the {{{data-tags}}} and special classes will be added to this element.
        The element sets the default background and font colours.&lt;/td&gt;
        &lt;td&gt;{{{body}}} is the child element of {{{html}}}, and the parent element of all the elements below, most closely {{{#ui-dialog}}}, {{{#ui-bar}}}, and {{{#story}}}.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{#ui-dialog}}}&lt;/td&gt;
        &lt;td&gt;The popup element container. &#39;&#39;Should not be included in&#39;&#39; {{{StoryInterface}}}.&lt;/td&gt;
        &lt;td&gt;{{{#ui-dialog}}} is the child element of {{{body}}}, and the parent element of {{{#ui-dialog-titlebar}}} and {{{#ui-dialog-body}}}. &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{#ui-bar}}}&lt;/td&gt;
        &lt;td&gt;The left sidebar. Can be included in {{{StoryInterface}}}, if want to be kept.
        This element will affect how {{{#story}}} is positionned on the page.&lt;/td&gt;
        &lt;td&gt;{{{#ui-bar}}} is a child element of {{{body}}}, and the parent element of the Special Passage elements, among others.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{#story}}}&lt;/td&gt;
        &lt;td&gt;Container for the {{{#passages}}} element.
        This element&#39;s width and position is affected by {{{#ui-bar}}}&#39;s position on the page.&lt;/td&gt;
        &lt;td&gt;{{{#story}}} is the child element of {{{body}}}, and the parent of {{{#passages}}}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{#passages}}}&lt;/td&gt;
        &lt;td&gt;Container for the passage element. &#39;&#39;HAS TO BE included in&#39;&#39; {{{StoryInterface}}}.
        All created passages will appear as a children of this element, in {{{.passage}}}.&lt;/td&gt;
        &lt;td&gt;{{{#passages}}} is the child element of {{{#story}}}, and the parent element of {{{.passage}}}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;{{{.passage}}}&lt;/td&gt;
        &lt;td&gt;The passage element. &#39;&#39;Should not really be included&#39;&#39; in {{{StoryInterface}}}.
        The active story-passage will determine the ID of this element.
        If a story-passage is tagged, the {{{data-tags}}} and special classes will be added to this element.&lt;/td&gt;
        &lt;td&gt;{{{.passage}}} is the child element of {{{#passages}}}, and the parent element of any element coded in the story-passage.&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&gt; &#39;&#39;Note:&#39;&#39; When using the base UI, the {{{StoryInterface}}} [[Special Passage|SP-StoryInterface]] is not a necessary passage to have in your project.
&gt; You can find the complete list of targetable elements in a base UI [[here|HTML-Full-List]].
\
&lt;h3&gt;Notes on the Links Elements and Special Link Classes&lt;/h3&gt;\
targeting the links with the element {{{a}}} or the buttons with {{{button}}} without including a parent element before, the CSS rules will affect every link and button in the project (the passage, the sidebar, and the dialog box). On the other hand, if you indicate {{{.passage a}}} or {{{.passage button}}} in the StyleSheet, it will only target the links or buttons in the passage element.

The {{{a}}} element will affect any interactive macro using a link, such as {{{&lt;&lt;link&gt;&gt;}}}, {{{&lt;&lt;linkappend&gt;&gt;}}}, {{{&lt;&lt;linkprepend&gt;&gt;}}}, {{{&lt;&lt;linkreplace&gt;&gt;}}}, and the {{{&lt;&lt;cycle&gt;&gt;}}} macros, as well as the {{{[[link]]}}} markup. targeting a certain macro can be done as follow: {{{a.macro-[name]}}} or {{{.macro-[name]}}}.
&gt; &#39;&#39;Note:&#39;&#39; targeting the macro class will not affect the [[link]] markup.

To differenciate internal and external links, aside from the icon at the end of the link, a specific class is added to every link(-related) element: {{{.link-internal}}} or {{{.link-external}}}. Only the links going to another website will get the second class, all others will get the first.
&gt; &#39;&#39;Note:&#39;&#39; the macros listed in the paragraph above will have the {{{.link-internal}}} class. 

To change how a link looks when hovered/in focus/being clicked on, compared to the link when not in use, you can add a special selector to the link: {{{:hover}}}, {{{:focus}}}, and {{{:active}}}. If all these three states will look the same, {{{a:hover, a:focus { /* CSS rules */ }}}} will be sufficient.

If the {{{a}}} has not been modified in the StyleSheet, you may notice some links going nowhere will be formatted differently than working links. This is because those &quot;broken&quot; links have a special class: {{{.link-broken}}}.
If you did modify {{{a}}} in the StyleSheet, you can always add {{{a.link-broken}}} to it to be able to see those broken link during testing/playing.

When using the macro {{{&lt;&lt;choice&gt;&gt;}}}, links will become disabled, and get the class {{{.link-disabled}}} attached to them. It is possible to add this class to other links on the screen with a [[DOM Macro|Macro-DOM-Adv]].
&gt; &#39;&#39;Note:&#39;&#39; this should not be mistaken for the {{{.disabled}}} class added by the {{{&lt;&lt;disable&gt;&gt;}}} [[Custom Macro from Chapel|https://github.com/ChapelR/custom-macros-for-sugarcube-2/blob/master/docs/disable-macro.md]].

If the project should display to the player whether a passage has been visited through the link, you can target the {{{.link-visited}}} class.
&gt; &#39;&#39;Note:&#39;&#39; the class is not enabled by default, but should be unlocked with {{{Config.addVisitedLinkClass = true;}}} in the JavaScript. See more about it, [[here|Config-Misc]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="75" name="HTML-Full-List" tags="page" position="3300,1200" size="100,100">&lt;h1&gt;The Full List of Targetable Elements&lt;/h1&gt;\
This page includes the full list of targetable elements (with a defined {{{#id}}} or {{{.class}}}) in a Basic SugarCube project (i.e. no custom UI, macro, elements). The HTML page contains other &quot;hidden&quot; element, like the Story date, which are not visible on the page.
&gt; &#39;&#39;Note:&#39;&#39; you can also find the wanted element to target by using the Inspect Tool.
\
The targetable elements are organised as follow:
* the base elements of a page
* the base elements of the Built-In Menus
* the HTML elements defined in the StyleSheet
* the macro classes

To see how all these elements are styled by default or when special events happen, see the [[Built-In StyleSheets|http://www.motoslave.net/sugarcube/2/docs/#css-built-ins]].
\
&lt;h3&gt;The Base Elements of the Page&lt;/h3&gt;\
Assuming that you have not changed the Base UI with {{{StoryInterface}}} and are using all SideBar Special Passages, here are the base targetable elements inside a basic page, including the parent/child order.
Inside the {{{html}}} wrapper you will find:
* {{{body}}}
** {{{#init-screen}}} (hidden after the game is loaded)
*** {{{#init-loading}}}
** {{{#ui-overlay}}} (hidden when no popup is active)
** {{{#ui-dialog}}} (hidden when no popup is active)
*** {{{#ui-dialog-titlebar}}}
**** {{{h1#ui-dialog-title}}}
**** {{{button#ui-dialog-close}}}
*** {{{#ui-dialog-body}}}
** {{{#ui-bar}}}
*** {{{#ui-bar-tray}}}
**** {{{button#ui-bar-toggle}}}
**** {{{#ui-bar-history}}}
***** {{{button#history-backward}}}
***** {{{button#history-jumpto}}}
***** {{{button#history-forward}}}
*** {{{#ui-bar-body}}}
**** {{{#title}}}
***** {{{#story-banner}}}
***** {{{h1#story-title}}}
***** {{{#story-subtitle}}}
***** {{{#story-title-separator}}}
***** {{{p#story-author}}}
**** {{{#story-caption}}}
**** {{{nav#menu}}}
***** {{{ul#menu-story}}}
***** {{{ul#menu-core}}}
****** {{{li#menu-item-saves}}}
****** {{{li#menu-item-settings}}}
****** {{{li#menu-item-restart}}}
****** {{{li#menu-item-share}}}
** {{{#story}}}
*** {{{#passages}}}
*** {{{.passage}}}
** {{{#debug-bar}}} (for Testing/Debug Mode)
\
&gt; &#39;&#39;Note:&#39;&#39; when targetting a base element, you don&#39;t have to indicate the type of element ({{{div}}}/{{{h1}}}/{{{button}}}/etc...). However, their specific default CSS settings may affect how they look (e.g. margin).
\
&lt;h3&gt;The Base Elements of the Built-In Menus&lt;/h3&gt;\
The targetable elements below can be found in the //Saves//, //Settings//, and //Restart// menus.
\
&lt;h4&gt;The Saves Menu&lt;/h4&gt;\
In the body of the //Saves// menu ({{{.saves}}} class), you will find:
* {{{table#saves-list}}}
** {{{ ... }}}
*** {{{button#saves-load-[i]}}} or {{{button#saves-save-[i]}}}
*** {{{div.datestamp}}}
*** {{{button#saves-delete-[i]}}}
* {{{ul.buttons}}}
** {{{button#saves-export}}}
** {{{button#saves-import}}}
** {{{button#saves-clear}}}
&gt; &#39;&#39;Note:&#39;&#39; since the //Saves// menu includes more than one save slot (and the autosave), replace the [1] with the number of the relevant save slot (starting with 0) or {{{auto}}} (for autosave).
&gt; Other targetable elements includes the rows and cells of the save tables, and the {{{li}}} elements for the buttons.
\
&lt;h4&gt;The Settings Menu&lt;/h4&gt;\
The elements inside the //Settings// Menu will depend on what settings were coded in the project&#39;s JavaScript. 
Each setting will be coded as follow, with [setting] being the defined name of the setting:
* {{{#setting-body-[setting]}}}
** {{{label#setting-label-[setting]}}}
** {{{#setting-control-[setting]}}} (attached to {{{input}}}, {{{select}}} or {{{button}}})
** {{{p#setting-desc-[setting]}}}
As for the Header, [header] will use the sluggified version of the header text:
* {{{#header-body-[header]}}}
** {{{h2#header-heading-[header]}}}
** {{{p#header-desc-[header]}}}
The bottom of the //Settings// Menu also includes:
* {{{ul.buttons}}}
** {{{button#settings-ok}}}
** {{{button#settings-reset}}}
\
&lt;h4&gt;The Restart Menu&lt;/h4&gt;\
The //Restart// Menu only includes on main block inside the body of the popup ({{{.restart}}} class):
* {{{ul.buttons}}}
** {{{button#restart-ok}}}
** {{{button#restart-cancel}}}
\
&lt;h3&gt;The HTML Elements Defined in the StyleSheet&lt;/h3&gt;\
Below are the different HTML elements defined in the StyleSheet. 
* clickables: {{{a}}}, {{{button}}}
* interactive: {{{input}}}, {{{select}}}, {{{textarea}}}
* headers: {{{h1}}}, {{{h2}}}
* horizontal rule: {{{hr}}}
* lists: {{{ul}}}, {{{li}}}, {{{ol}}}
* tables: {{{table}}}, {{{tr}}}, {{{th}}}, {{{td}}}
* multimedia: {{{img}}}, {{{audio}}}, {{{video}}}
* other: {{{area}}}, {{{canvas}}}, {{{progress}}}
&gt; &#39;&#39;Note:&#39;&#39; this is not an exhaustive list of HTML elements, and you can even create your own (ex: {{{&lt;y&gt;}}}).
\
&lt;h3&gt;The Macro Classes&lt;/h3&gt;\
Some macros, mainly the interactive ones with outputs, will add an extra class to elements to indicate it is an interactive element created by a macro, or that certain outputs were added on the page with a macro.
{{{
    .macro-[name of the macro]
}}}
&gt; //Examples://
{{{
    .macro-link 
    .macro-button
    .macro-linkappend
    .macro-linkprepend
    .macro-replace
    .macro-include
    .macro-type
    .macro-checkbox
    .macro-cycle 
    .macro-listbox
    {...}
}}}
For linking macros and markups, the element can be defined with these classes:
{{{
    .link-internal
    .link-external

    .link-broken
    .link-disabled
    .link-visited
}}}
Similarly, some macros may see their class change depending on their use.
&gt; //Examples://
{{{
    .macro-linkappend-insert
    .macro-linkprepend-insert
    .macro-linkreplace-insert
    .macro-append-insert
    .macro-prepend-insert
    .macro-replace-insert
    .macro-repeat-insert
    .macro-timed-insert
→ adding new element to the page

    .macro-linkappend-in
    .macro-linkprepend-in
    .macro-linkreplace-in
    .macro-append-in
    .macro-prepend-in
    .macro-replace-in
    .macro-repeat-in
    .macro-timed-in
→ the starting class for page addition 
  when {t8n} is an argument
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="76" name="Int-JS-CSS-Events" tags="page" position="3200,1300" size="100,100">&lt;h1&gt;Ensuring that Elements Start at the Top when Opened&lt;/h1&gt;
When going from one long passage to another, or opening a multiple popups whose content does not fit the container, the system might not automatically scroll the element to the top of the page/element. 
&gt; &#39;&#39;Note:&#39;&#39; This should mainly apply to modified UI.

However, this can be easily fixed with a bit of jQuery in the JavaScript passage, and [[Events]]:
{{{
    $(document).on(&quot;:passagedisplay&quot;, function() {
        $(&quot;#passages&quot;).scrollTop(0);
    });
}}}
&gt; //For the Dialog Box://
{{{
    $(document).on(&quot;:dialogopened&quot;, function() {
        $(&quot;#ui-dialog-body&quot;).scrollTop(0);
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; you can change {{{#passages}}} with any other relevant container, like {{{#story}}}.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="77" name="Int-JS-CSS-Font" tags="page" position="3300,1300" size="100,100">&lt;h1&gt;Import and Change the Font&lt;/h1&gt;
As different device come with different fonts, you may want to have a unified experience accross the playerbase through one-same font. For this, you will need to import the chosen font(s) and set it in the StyleSheet.
As with [[images|URL-Types]], how to import fonts will depend on the location of the font. A local import will require a different rule than an import from a third-party server (e.g. Google).

&gt; &#39;&#39;IMPORTANT:&#39;&#39; the import of a font should be &#39;&#39;the first thing&#39;&#39; in your StyleSheet, before any other CSS rules!
\
&lt;h3&gt;The Different Imports&lt;/h3&gt;\
For a server import, the {{{@import url()}}} should be used. You only need to add the relevant URL of the font. For example, Google will provide one on their GoogleFont website, just as the one below.
{{{
    @import url(&#39;https://fonts.googleapis.com/css2?family=Georgia:wght@400;700&amp;display=swap&#39;);
}}}
&gt; &#39;&#39;Note:&#39;&#39; when selecting multiple fonts (type or families), Google will provide one link for all selected fonts.
\
Depending on the services used, the URL for the font may look differently. For comparison, here&#39;s the one of an old FontAwesome version:
{{{
    @import url(&#39;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css’);
}}}
&gt; &#39;&#39;Note:&#39;&#39; you should ensure to always get the official import URL.

On the other hand, local import will use the {{{@font-face}}}, with a relative URL, and require a few more information. This will include the name of the font-family, the URL, the format of the file, the style (normal/italic) and the weight (400-normal/700-bold).
&gt; &#39;&#39;Note:&#39;&#39; while it requires a few more lines of code, local imports are not dependent on server up-times or shared user information.
\
For example, trying to import an OpenDyslexic font (normal, italics, bold, bold+italic):
{{{
    @font-face {
        font-family: &quot;Dyslexic&quot;;
        src: url(fonts/OpenDyslexic-Regular.otf) format(&quot;opentype&quot;);
        font-style: normal;
        font-weight: 400;
    }
    @font-face {
        font-family: &quot;Dyslexic&quot;;
        src: url(fonts/OpenDyslexic-Italic.otf) format(&quot;opentype&quot;);
        font-style: italic;
        font-weight: 400;
    }
    @font-face {
        font-family: &quot;Dyslexic&quot;;
        src: url(fonts/OpenDyslexic-BoldItalic.otf) format(&quot;opentype&quot;);
        font-style: italic;
        font-weight: 700;
    }
    @font-face {
        font-family: &quot;Dyslexic&quot;;
        src: url(fonts/OpenDyslexic-Bold.otf) format(&quot;opentype&quot;);
        font-style: normal;
        font-weight: 700;
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; a new {{{@font-face}}} is required for each new font type.
\
&lt;h3&gt;Changing the Font of the project&lt;/h3&gt;\
In the Base UI, the font is defined inside the {{{html}}} element. If the new font should apply to the whole project, you can simply do: 
{{{
    html {
        font-family: &#39;Font-Name&#39;, type;
    }

→ For the OpenDyslexic, &quot;imported&quot; above:
    html {
        font-family: &#39;Dyslexic&#39;, sans-serif;
    }
}}}

If the font should only apply to a specific element, you must target that element instead. 
For example, if you want to change the font of the header:
{{{
    h1 {
        font-family: &#39;Roboto&#39;, sans-serif;
    }

→ to target the title of the popup:
    #ui-dialog-title {
        font-family: &#39;Bacasime Antique&#39;, serif;
    }
}}}
\
&lt;h3&gt;Let the Player Change the Font*&lt;/h3&gt;\
*from a preset list of fonts that you set up in the code.

To accomodate players, you can let them change the reading font through a [[List Setting|SettingsList]], within which you have indicated a list of imported fonts (serif, sans-serif, monospace) to choose from.
For accessibility, it is recommended to have multiple legible //serif// and //sans-serif// fonts, especially for story text.
&gt; &#39;&#39;Note:&#39;&#39; you can find a Font setting in my [[Setting Template|https://manonamora.itch.io/twine-sugarcube-templates]].

Assuming that a font //Georgia//, //Montserrat// and //OpenDyslexic// have been imported, the code below could be added to the JavaScript:
{{{
    var settingFontFamily = [&quot;Georgia&quot;, &quot;Montserrat&quot;, &quot;OpenDyslexic&quot;];
    var fontFamily = function() {
        var $html = $(&quot;html&quot;);
            $html.removeClass(&quot;sansserif serif opendyslexic&quot;);
        switch (settings.fontFamily) {
            case &quot;Georgia&quot;:
                $html.addClass(&quot;serif&quot;);
                break;
            case &quot;Montserrat&quot;:
                $html.addClass(&quot;sansserif&quot;);
                break;
            case &quot;OpenDyslexic&quot;:
                $html.addClass(&quot;opendyslexic&quot;);
                break;
        }
    };
    Setting.addList(&quot;fontFamily&quot;, {
        label       : &quot;Change font style.&quot;,
        list        : settingFontFamily,
        default     : &quot;Georgia&quot;,
        onInit      : fontFamily,
        onChange    : fontFamily
    });
}}}
And in the CSS:
{{{
    .sansserif body {font-family: var(–sansserif);}
    .opendyslexic body {font-family: var(–opendyslexic);}
    .serif body {font-family: var(–serif);}
}}}
&gt; &#39;&#39;Note:&#39;&#39; this will affect all elements on the page. Change the {{{body}}} to another element.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="78" name="Int-JS-CSS-Root" tags="page" position="3200,1400" size="100,100">&lt;h1&gt;Using the Root and CSS var&lt;/h1&gt;
As the UI gets more complex, whether because of its base customisation, or with the addition of [[Settings]], you may want to organise certain values within the StyleSheet, like colours, fonts, or asset URL. This can be done through the creation of CSS variables ({{{--var}}}) inside the {{{:root}}} selector.
&gt; &#39;&#39;Note:&#39;&#39; this is used quite often in templates, to make changing colours of the UI easier for the user. Instead of finding all the different iterations of a value, there is only one to change!
\
In your StyleSheet, after any imported element:
{{{
    :root {
        /* the listed variable */
    }

    :root {
        --sansserif: &#39;Montserrat&#39;, sans-serif;
        --font-colour: #000;
        --dm-font-colour: #eee;
        --width: 50px;
        --timer: 3s;
        --gradient: linear-gradient(-90deg, blue, green, red);
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; new versions of {{{:root}}} can be included inside the {{{@media}}} selector if a certain variable need to change for a different screen size.

The CSS variable can then be used as many times as needed in relevant CSS rules in other elements:
{{{
    .passage {
        color: var(--font-colour);
    }
    .dm #ui-dialog-body {
        color: var(--dm-font-colour);
    }
    .sansserif .passage {
        font-family: var(--sansserif);
    }
}}}
&gt;&#39;&#39;Note:&#39;&#39; the classes {{{.dm}}} and {{{.sansserif}}} would have been created with a [[Setting API|SettingsList]].
\
Setting a CSS variables can also be done outside of {{{:root}}}:
{{{
    .parent-element {
        --color: blue;
    }
    .child-element-1 {
        background : var(--color);
    }
    .child-element-2 {
        color: var(--color);
    }
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="79" name="Int-JS-CSS-Media" tags="page" position="3300,1400" size="100,100">&lt;h1&gt;Formating for Different Screen Size&lt;/h1&gt;
While the Base UI of SugarCube is already optimised for different screens/devices, any change in the interface, whether it be changing the size and display of elements in the StyleSheet or in {{{StoryInterface}}}, will need to be fitted for those different screen sizes. 

This can be done with the {{{@media}}} rule inside the StyleSheet.
{{{
    @media screen and (size) {
        [element] {
            /* CSS Rule */
        }
    }
}}}
Inside the {{{(size)}}}, you can target a specific range or screen size or ratio to apply different CSS rules. You will need to use as many {{{@media}}} rules as your interface would require (it will depend on the elements on the page). Each iteraction of this rule should be ordered from most-restrictive size/ratio range to most-inclusive.
&gt; //Example://
{{{
    #passages {
        width: 50vw;
    }

    @media screen and (max-width: 585px) {
        #passages {
            width: 100%;
        }
    }

    @media screen and (max-width: 800px) {
        #passages {
            width: 85%;
        }
    }
}}}
If the screen used is 585px wide or smaller, the width of the passage will take the whole screen. For screen size is larger than wider than 585px but 800px wide or smaller, the width of the passage will take 85% of the screen. If the screen size is larger than 800px, the width of the passage will be half of the screen width.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="80" name="Int-JS-CSS-Animation" tags="page" position="3200,1500" size="100,100">&lt;h1&gt;Intro to Animation&lt;/h1&gt;
To elevate your project and customize it further, you can decide to animate elements on the page of your game (e.g. text, images, other...). Animations can be as simple as a flicker, to more complex movement over the page. 
It might seem daunting to create animations, as animation code published on CodePen and the like can look quite complicated. But, animations rests only on three essential elements in the StyleSheet:
* the {{{@keyframes}}}: defining the trajectory of the animation (e.g. change of position, or colour, or opacity, etc...)
* the {{{animation}}} CSS rule: linking and setting the animation to the relevant block (e.g. length, looping, delay, etc...)
* the element targeted: which can be an HTML markup ({{{h1}}}, {{{span}}}), a class ({{{.class}}}), or an ID ({{{#id}}})
&gt; &#39;&#39;Note:&#39;&#39; certain animations may require the element to have {{{display: block}}}, {{{display: inline-block}}}, {{{display: absolute}}} to work.
\
&lt;h3&gt;{{{@keyframes}}}&lt;/h3&gt;\
Every keyframe is set up in the same way:
{{{
    @keyframes animation-name {
        keyframes-selector {css-styles;}
    }
}}}
As such, you will need to indicate the following:
* {{{animation-name}}}: or the name you will give to the animation. 
** For example, let&#39;s take {{{flicker}}}.
* {{{keyframes-selector}}}: the percentage in the animation sequence where something changes for the element.
** can be set with percentages ({{{0-100%}}}), or with {{{from}}}/{{{to}}} (same as 0% and 100%), or a combination of both.
*** Here, let&#39;s have the flicker happen half-way through the animation (50%).
* {{{css-styles}}}: or the css rules to indicate what changes at that step. 
** Here, the flickering will need {{{opacity}}}.
\
If we combine it all, we get the following example:
{{{
    @keyframes flicker {
        0% { opacity:1; }
        50% { opacity:0; } 
        100% { opacity:1; }
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; Testing and tweaking is &#39;&#39;very important&#39;&#39; here.
\
&lt;h3&gt;The {{{animation}}} Rule&lt;/h3&gt;\
Linking the animation to an element is necessary for the animation to display on the page. The {{{animation}}} CSS rule is a compiled version of 8 different separate rules ({{{animation-[insertname]}}}):
{{{
    animation: name duration timing-function delay iteration-count direction fill-mode play-state;
}}}
To function, it only requires at minimum the following:
{{{
    animation: name duration iteration-count;
}}}
\
So, you will need to define:
* {{{name}}} (or {{{animation-name}}}): the name of the keyframe animation. 
** Here, we defined it as {{{flicker}}}.
* {{{duration}}} (or {{{animation-duration}}}): the duration of the whole animation.
** Let&#39;s make it {{{1 second}}} here.
* {{{iteration-count}}} (or {{{animation-iteration-count}}}): how many times the animation goes. 
** Let&#39;s make it {{{infinite}}}.
{{{
    animation: flicker 1s infinite;
}}}
\
If you want to go further, you can also defined the following aspects:
* {{{timing-function}}} (or {{{animation-timing-function}}}): indicates the curve of the animation speed (slow start, slow end, etc...) 
* {{{delay}}} (or {{{animation-delay}}}): delaying the start of an animation.
* {{{direction}}} (or {{{animation-direction}}}): whether an animation should be played forward, backward, or alternating.
* {{{fill-mode}}} (or {{{animation-fill-mode}}}): define whether an animation takes the styling in the start of the animation or the one at the end.
* {{{play-state}}} (or {{{animation-play-state}}}): define whether the animation is playing or paused.
\
&lt;h3&gt;Linking to an element&lt;/h3&gt;\
Finally, we need to add the {{{animation}}} rule in an element, to make it flicker.
&gt; Assuming the passage has the following block:
{{{
    &lt;span class=&quot;flickering&quot;&gt;Some Text&lt;/span&gt;
}}}
&gt; //In the StyleSheet//:
{{{
    .flickering {
        animation: flicker 1s infinite;
    }
→ the {flicker} animation was added to the span class {flickering}
}}}
&gt; Giving the following result: 
&lt;span class=&quot;flickering&quot;&gt;Some Text&lt;/span&gt;
\
&lt;h3&gt;A note on Accessibility&lt;/h3&gt;\
While animations can be quite fun to have, giving some spice to the displayed elements, some players may not find it comfortable. Fast moving elements, flickering animation, or bright flashes, may causes sensory issues for some. It is generally a good idea to warn player of such animation before they start the game, as well as create an [[Accessible Setting|SettingsToggle]], so player can toggle on/off the animation.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="81" name="Int-JS-CSS-Stat" tags="page" position="3300,1500" size="100,100">&lt;h1&gt;Creating Stats, Meter, and Progress Bars&lt;/h1&gt;
Whether to show a character&#39;s abilities or affections, or a visual timer for quick-time event actions, these bars will allows for a meaningful visual to display the value of a variable, aside from a number.
There are different ways of achieving this, namely:
* using the {{{&lt;progress&gt;}}} or the {{{&lt;meter&gt;}}} HTML elements 
* building it from scratch with {{{&lt;div&gt;}}} or {{{&lt;span&gt;}}} elements 
* using custom macros (like [[Chapel&#39;s|https://github.com/ChapelR/custom-macros-for-sugarcube-2/blob/master/docs/meter-macros.md]]), which often ends up doing one of the options above but with more pazaaz and less HTML to deal with.
** See the macro&#39;s documentation for use.
\
&lt;h3&gt;The {{{&lt;progress&gt;}}} HTML element&lt;/h3&gt;\
Like it&#39;s name suggests, {{{&lt;progress&gt;}}} is an HTML element used to create a progress bar. While it //can// be used for static bars, this element is more meant to represent the completion of a task/a timer.
&lt;progress max=&quot;100&quot;&gt;&lt;/progress&gt; (indeterminate form)
&lt;progress value=&quot;43&quot; max=&quot;100&quot;&gt;&lt;/progress&gt; (determinate form)
&gt; &#39;&#39;Note:&#39;&#39; when unstyled, the progress bar will look different between browsers.
\
The element had two specific attributes:
* {{{max}}} (optional) to indicate the completion value.
** default is 1.0
* {{{value}}} to indicate the current state of the progress. 
** must either be {between 0.0 and 1.0 incl.} or {less than or equal to the {{{max}}}}
** if used but left empty, you will get its indeterminate form 
** if not indicated, you will get its indeterminate form
&gt; &#39;&#39;Note:&#39;&#39; the minimum will always be 0.
{{{
    &lt;progress value=&quot;&quot; max=&quot;100&quot;&gt;&lt;/progress&gt;
    &lt;progress max=&quot;100&quot;&gt;&lt;/progress&gt; 
→ indeterminate form

    &lt;progress value=&quot;43&quot; max=&quot;100&quot;&gt;&lt;/progress&gt; 
    &lt;progress value=&quot;0.43&quot;&gt;&lt;/progress&gt; 
→ determinate form
}}}
If either the {{{value}}} or the {{{max}}} should be related to the value of a set variable, you will need to use the {{{@}}} [[directive|Markup-Attribute]] to link it.
Assuming that {{{&lt;&lt;set $intext to 42&gt;&gt;}}}: &lt;&lt;set $intext to 42&gt;&gt;
{{{
    &lt;progress @value=&quot;$intext&quot; max=&quot;100&quot;&gt;&lt;/progress&gt;
}}}
→ will render as: &lt;progress @value=&quot;$intext&quot; max=&quot;100&quot;&gt;&lt;/progress&gt;

The {{{&lt;progress&gt;}}} element will also accept other global attributes, such as {{{.class}}}, {{{#id}}}, or ARIA-related elements. These attribues can make it easier to target a specific progress bar during styling.

If you want the {{{&lt;progress&gt;}}} element to look the same across browsers, you will need to edit the StyleSheet:
* {{{progress}}} to target the {{{&lt;progress&gt;}}} elements as a whole 
* {{{progress:not([value])}}} to target the {{{&lt;progress&gt;}}} if {{{value}}} is not indicated
* {{{progress:indeterminate}}} to target {{{&lt;progress&gt;}}} elements if {{{value}}} is not indicated or defined
* {{{progress[value]}}} to target {{{&lt;progress&gt;}}} elements if {{{value}}} is indicated (defined or empty)
\
To edit the value bar however, you will need to use browser specific Pseudo-Code:
* For Chrome and Chromium browsers:
** {{{::-webkit-progress-bar}}} to edit the appearance of the background bar 
** {{{::-webkit-progress-value}}} to edit the appearance of the value bar
* For Firefox :
** {{{no-pseudo-code}}} to edit the appearance of the background bar 
** {{{::-moz-progress-bar}}} to edit the appearance of the value bar
&gt; //Example, if the progress bar has the id:// {{{#test-bar}}}
{{{
#test-bar {
    background: #0b1f0b;
    width: 100%;
    height: 2em;
    border-radius: 20px;
    border: 2px solid #013c01;
}
→ will set the base for the whole element
  + the background for Firefox

#test-bar::-moz-progress-bar {
  background: linear-gradient(-90deg, #00800078, #6ecfff, #00800078);
  border-radius: 20px;
}
→ will set the appearance of the value bar in Firefox

#test-bar::-webkit-progress-bar {
	background: #0b1f0b;
    border-radius: 20px;
}
→ will set the appearance of the background in Chromium

#test-bar::-webkit-progress-value {
    background: linear-gradient(-90deg, #00800078, #6ecfff, #00800078);
    border-radius: 20px;
}
→ will set the appearance of the value bar in Chromium
}}}
&lt;progress id=&quot;test-bar&quot; @value=&quot;$intext&quot; max=&quot;100&quot;&gt;&lt;/progress&gt;

\
&lt;h3&gt;The {{{&lt;meter&gt;}}} HTML element&lt;/h3&gt;\
The {{{&lt;meter&gt;}}} element is meant to showcase static values, when the range is known, like the capacity of a device or the health of a character. 
&lt;meter @value=&quot;$intext&quot; min=&quot;0&quot; low=&quot;10&quot; optimum=&quot;50&quot; high=&quot;90&quot; max=&quot;100&quot;&gt;&lt;/meter&gt; | &lt;meter value=&quot;12&quot; min=&quot;0&quot; low=&quot;20&quot; optimum=&quot;50&quot; high=&quot;90&quot; max=&quot;100&quot;&gt;&lt;/meter&gt; | &lt;meter value=&quot;25&quot; min=&quot;0&quot; low=&quot;50&quot; optimum=&quot;85&quot; high=&quot;75&quot; max=&quot;100&quot;&gt;&lt;/meter&gt;
&gt; &#39;&#39;Note:&#39;&#39; when unstyled, the meter bar will look different between browsers.
\
The element has 6 specific attributes:
* {{{value}}} to indicate the current value of the measured range
** must be between {{{min}}} and {{{max}}}
* {{{min}}} (optional) to indicate the minimum value of the range 
** default is 0
** can be any value (even negative) as long as it is lower than {{{max}}}
* {{{max}}} (optional) to indicate the maximum value of the range 
** default i 1.0
** can be any value (even negative) as long as it is higher than {{{max}}}
* {{{low}}} (optional) to specify what is a low value in the range 
** must be higher than {{{min}}}, but lower than {{{high}}} and {{{max}}}
* {{{high}}} (optional) to specify what is a high value in the range 
** must be lower than {{{max}}}, but higher than {{{low}}} and {{{min}}}
* {{{optimum}}} (optional) to specifiy the optimal value in the range
** if used along {{{low}}} and {{{high}}}, it will indicate the preferred zone for the range
** can be any value within the {{{min}}}/{{{max}}} range
&gt; &#39;&#39;Note:&#39;&#39; when {{{high}}}, {{{low}}}, and {{{optimum}}} are used, it will change the colour of the meter bar. See examples above.
{{{
    &lt;meter value=&quot;0.5&quot;&gt;&lt;/meter&gt;

    &lt;meter value=&quot;50&quot; min=&quot;0&quot; max=&quot;100&quot;&gt;&lt;/meter&gt;

    &lt;meter value=&quot;42&quot; min=&quot;0&quot; low=&quot;10&quot; optimum=&quot;50&quot; high=&quot;90&quot; max=&quot;100&quot;&gt;&lt;/meter&gt;
}}}
If any of those attributes should be related to the value of a set variable, you will need to use the {{{@}}} [[directive|Markup-Attribute]] to link it.
Assuming that {{{&lt;&lt;set $intext to 42&gt;&gt;}}}: &lt;&lt;set $intext to 42&gt;&gt;
{{{
    &lt;meter @value=&quot;$intext&quot; min=&quot;0&quot; max=&quot;100&quot;&gt;&lt;/meter&gt;
}}}
→ will render as: &lt;meter @value=&quot;$intext&quot; min=&quot;0&quot; max=&quot;100&quot;&gt;&lt;/meter&gt;

The {{{&lt;meter&gt;}}} element will also accept other global attributes, such as {{{.class}}}, {{{#id}}}, or ARIA-related elements. These attribues can make it easier to target a specific progress bar during styling.

If you want the {{{&lt;meter&gt;}}} element to look the same across browsers, you will need to edit the StyleSheet:
* {{{meter}}} to target the {{{&lt;meter&gt;}}} elements as a whole 
* {{{meter:not([value])}}} to target the {{{&lt;meter&gt;}}} if {{{value}}} is not indicated
* {{{meter[value]}}} to target {{{&lt;meter&gt;}}} elements if {{{value}}} is indicated (defined or empty)
\
To edit the value bar however, you will need to use browser specific Pseudo-Code:
* For Chrome and Chromium browsers:
** {{{::-webkit-meter-bar}}} to edit the appearance of the background bar 
** {{{::-webkit-meter-optimum-value}}} to edit the appearance of the value bar
* For Firefox :
** {{{no-pseudo-code}}} to edit the appearance of the background bar  
** {{{::-moz-meter-bar}}} to edit the appearance of the value bar
&gt; &#39;&#39;Note:&#39;&#39; if you are using {{{high}}}/{{{low}}}/{{{optimum}}}, and want to change how the meter looks depending on where the value is in the range, you can also use the Pseudo-Elements:
&gt; For Chromium: {{{::-webkit-meter-suboptimum-value}}}, {{{::-webkit-meter-even-less-good-value}}}
&gt; For Firefox: {{{:-moz-meter-optimum}}}, {{{:-moz-meter-sub-optimum}}}, {{{:-moz-meter-sub-sub-optimum}}}
\
&gt; //Example, if the progress bar has the id:// {{{#test-metbar}}}
{{{
#test-metbar {
    background: #1d0b1f;
    width: 100%;
    height: 2em;
    border-radius: 20px;
    border: 2px solid #3a013c;
}
→ will set the base for the whole element
  + the background for Firefox

#test-metbar::-moz-meter-bar {
    background: linear-gradient(-90deg, #76008078, #ffe26e, #76008078);
    border-radius: 20px;
}
→ will set the appearance of the value bar in Firefox

#test-metbar::-webkit-meter-bar {
    background: #1d0b1f;
    border-radius: 20px;
    height: 2em;
    border: 2px solid #3a013c;
}
→ will set the appearance of the background in Chromium

#test-metbar::-webkit-meter-optimum-value {
    background: linear-gradient(-90deg, #76008078, #ffe26e, #76008078);
    border-radius: 20px;
}
→ will set the appearance of the value bar in Chromium
}}}
&lt;meter id=&quot;test-metbar&quot; @value=&quot;$intext&quot; min=&quot;0&quot; max=&quot;100&quot;&gt;&lt;/meter&gt;

\
&lt;h3&gt;Build your own from {{{&lt;div&gt;}}} and {{{&lt;span&gt;}}}&lt;/h3&gt;\
While progress and meter bars can be pretty neat to use, they do have some issues with compatibility with older browsers (especially {{{&lt;meter&gt;}}}), and require the use of Pseudo-Code to style the bar for the different browsers. And, if you are looking to add some [[animations|Int-JS-CSS-Animation]] to your bar, you would most likely require some JavaScript code.
&gt; &#39;&#39;Note:&#39;&#39; the examples below will only use {{{&lt;div&gt;}}} but you could technically use any block elements. Though you may need to add a few more CSS rules.

This bit of a headache can be avoided if you build your start bar from scratch with basic elements. Something like this:
{{{
    &lt;div class=&quot;statBarContainer&quot;&gt;
        &lt;div class=&quot;statBar&quot; style=&quot;width:33%&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
}}}
&lt;div class=&quot;statBarContainer&quot;&gt;&lt;div class=&quot;statBar&quot; style=&quot;width:33%&quot;&gt;&lt;/div&gt;&lt;/div&gt;
&gt; //In the StyleSheet//:
{{{
    .statBarContainer {
        background: #660303;
        width: 100%;
        height: 2em;
        border-radius: 20px;
        border: 2px solid #a40606;
    }
    .statBar {
        background: linear-gradient(-90deg, #ff489e78, #6effc2, #ff489e78);
        border-radius: 20px;
        height: inherit;
    }
}}}

If any attribute defined in those {{{&lt;div&gt;}}} should be related to the value of a set variable, you will need to use the {{{@}}} [[directive|Markup-Attribute]] to link it.
{{{
    &lt;div class=&quot;statBarContainer&quot;&gt;
        &lt;div class=&quot;statBar&quot; @style=&quot;&#39;width:&#39; + $intext + &#39;%;&#39;&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;

→ the quotes are required to parse the value of the variable.
  otherwise it will not work.
}}}
&lt;div class=&quot;statBarContainer&quot;&gt;&lt;div class=&quot;statBar&quot; @style=&quot;&#39;width: &#39; + $intext + &#39;%;&#39;&quot;&gt;&lt;/div&gt;&lt;/div&gt;

Instead of an attribute directive, you can also use some JavaScript/jQuery.
The example below assumes the stat-bar is coded as follow:
{{{
    &lt;div class=&quot;statBarContainer&quot;&gt;
        &lt;div id=&quot;#intext&quot; class=&quot;statBar&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
}}}
{{{
    $(document).on(&quot;:passagedisplay&quot;, function() {
        var attributeStat = State.getVar(&quot;$intext&quot;) + &quot;%&quot;;
        $(&quot;#intext&quot;).attr(&quot;style&quot;, &quot;width: &quot; + attributeStat);
    });
}}}

&lt;h3&gt;Using a {{{&lt;&lt;widget&gt;&gt;}}}&lt;/h3&gt;
If you are planning on adding multiple stat bars in one spot and want to avoid cluttering a passage with code, you can use the {{{&lt;&lt;widget&gt;&gt;}}} [[macro|Macro-Widget]].

Assuming we want to use the {{{&lt;div&gt;}}} stat bar introduced above, but want to assign a different {{{#id}}} and link it to the relevant stat variable:
{{{
    &lt;div class=&quot;statBarContainer&quot;&gt;
        &lt;div id=&quot;#intext&quot; class=&quot;statBar&quot; @style=&quot;&#39;width:&#39; + $intext + &#39;%;&#39;&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
}}}
The widget could look something like this, requiring 2 arguments, one for the {{{#id}}} and one for the relevant stat variable:
{{{
    :: Widget [widget]
    &lt;&lt;widget &quot;StatBars&quot;&gt;&gt;
        &lt;div class=&quot;statBarContainer&quot;&gt;
            &lt;div @id=&quot;_args[1]&quot; class=&quot;statBar&quot; @style=&quot;&#39;width:&#39; + _args[0] + &#39;%;&#39;&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;&lt;/widget&gt;&gt;

    :: Passage 
    &lt;&lt;StatBar $statValue &quot;#idForTheBar&quot;&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; this is a basic example. You could add more {{{&lt;div&gt;}}} to include a label for the bar, or the numerical value of the stat.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="82" name="Int-JS-CSS-LoadingScreen" tags="page" position="3200,1600" size="100,100">&lt;h1&gt;Editing the Loading Screen&lt;/h1&gt;
If you are looking to change how the Loading Screen looks, to fit your project better, you will need to use a combination of JavaScript/jQuery and CSS. Since there is not Special Passage to edit the content of the Loading Screen, JavaScript/jQuery will help you empty the Built-In elements and add the one you wish.
\
&lt;h3&gt;The Loading Screen&lt;/h3&gt;\
The Loading Screen is composed of two elements: {{{#init-loading}}} nested inside {{{#init-screen}}}. {{{#init-loading}}} is the animated element: a rounded square, where only the top and bottom borders are coloured, with a spinning animation
{{{
    html[data-init=&quot;loading&quot;] #init-loading {
        display: block;
        border: 24px solid transparent;
        border-radius: 50%;
        border-top-color: #7f7f7f;
        border-bottom-color: #7f7f7f;
        width: 100px;
        height: 100px;
        animation: init-loading-spin 2s linear infinite;
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; there are more CSS rules at play here. You may want to [[lock to Loading Screen|API-Lock]] and use the Inspect Tool when testing code.
\
If you just want to edit what is already there, you can do so in the JavaScript:
{{{
    $(&quot;#init-loading&quot;).css({ animation: &quot;none&quot;, border: &quot;none&quot;, width: &quot;100%&quot;, height: &quot;100%&quot; });
→ this will remove the current loading aninmation
  and size the element to the screen
}}}
Or directly in the StyleSheet:
{{{
    html[data-init=&quot;loading&quot;] #init-loading {
        /* New CSS code */
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you are planning to add things to {{{#init-loading}}}, you may want to edit its CSS rules too.

If you are looking to add elements to {{{#init-loading}}}, like the logo of SugarCube bouncing around, you will need the following:
{{{
    $(&quot;#init-loading&quot;).empty().append(&#39;/* the new elements */&#39;);
}}}
Inside the {{{.append()}}}, you should indicate the HTML elements to add. A {{{&lt;div&gt;}}}, a {{{&lt;span&gt;}}}, an {{{&lt;img&gt;}}}... Whatever you end up adding should be edited in the StyleSheet.
{{{
    #init-loading [element] {
        /* CSS rules */
    }
}}}
\
&lt;h3&gt;Adding a Splash Screen&lt;/h3&gt;\
A Splash Screen is a a graphical element appearing when a program/game is launching. It will often contain an image or logo of the program/game or developer/company. 
In SugarCube, you can create a Splash screen which would fade in-and-out, with some JavaScript and CSS, by adding an overlay on the page.
&gt; &#39;&#39;Note:&#39;&#39; the code below was taken from this [[Forum page|https://twinery.org/forum/discussion/7910/intro-screen]], and assumes an image should appear on the screen and the Base SugarCube StyleSheet is used.
\
&gt; In the JavaScript
{{{
    (function () {
        // Duration of the splash image&#39;s fade in.
        var fadeIn  = 3000; // in milliseconds

        // Delay before the splash screen begins to fade out.
        var linger  = 6000; // in milliseconds

        // Duration of the splash screen&#39;s fade out.
        var fadeOut = 3000; // in milliseconds

        // Splash image.
        var $image  = $(&#39;&lt;img src=&quot;splash-image.jpg&quot;&gt;&#39;).hide();

        // Display the splash screen.
        $(document.body)
            .append(&#39;&lt;div id=&quot;splash-screen&quot;&gt;&lt;/div&gt;&#39;)
            .find(&#39;#splash-screen&#39;)
                .append($image)
                .find(&#39;img&#39;)
                    .fadeIn(fadeIn)
                    .end()
                .delay(linger)
                .fadeOut(fadeOut);

        // Set up the removal of the splash screen.
        setTimeout(function () {
            $(&#39;#splash-screen&#39;).remove();
        }, fadeIn + linger + fadeOut + 1000);
    })();
}}}
&gt; In the StyleSheet:
{{{
    #splash-screen {
        position: fixed;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: 100;
        background-color: #111;
        color: #eee;
    }
    #splash-screen &gt; img {
        display: block;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translateX(-50%) translateY(-50%);
    }
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="83" name="Accessibility" tags="page" position="3300,1600" size="100,100">&lt;h1&gt;A Note on Interface Accessibility&lt;/h1&gt;
While SugarCube was deliberately built with ARIA (Accessibility) support, any change in the Interface or inclusion of external elements will affect the accessibility of your project. Below are some elements to take into account when creating a project and editing the Built-In Interface.
\
&lt;h3&gt;Colour Compatibility and Contrast&lt;/h3&gt;\
As fun as it is to create crazy interface with strange palettes, some colours are not compatible with one another, rendering things difficult to read on the screen because of the poor contrast. For example, &lt;span id=&quot;bad-idea&quot;&gt;this text has really poor readability&lt;/span&gt;. When editing the page, you must be mindful of colour combination.

To help figure out what colour work best together, the WCAG has set [[standards|https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html]] in the minimum contrast for text readability. The minimum contrast of plain text should be of 4.5 between the text colour and the background. For even better contrast, a ration of 7.0 should be reached.
To check whether you achieved those ratio, you can use an [[online contrast checker|https://app.contrast-finder.org/?lang=en]] or use the Inspect Tool of your browser.
&gt; &#39;&#39;Note:&#39;&#39; this [[checker|https://www.myndex.com/APCA/]] goes even further that the WCAG minimum, by including font size and weight into the mix.
\
&lt;h4&gt;Colour Contrast and Image Background&lt;/h4&gt;\
This contrast is even more important when the text is brought before an image background. Due to the often varied range of colours in images, it is sometimes difficult to find the correct text colour for a good contrast.
While avoiding busy background altogether is preferred, there are ways to keep your pie and eat it. One option is to add a blurry shadow behing the text with the {{{text-shadow}}} CSS rule. Another is adding a border around each letter, like an outline (again with {{{text-shadow}}} or with {{{-webkit-text-stroke}}}). 
An even easier option is to add a &quot;sreen&quot; between the image and the text:
{{{
    #passages {
        background: #HexcodeWithSomeOpacity;
    }

→ if #passages already has a background 
  you can add a {:before} pseudo-element 
    #passages {
        position: relative;
    }
    #passages:before {
        content: &quot;&quot;;
        position: absolute;
        z-index: -1;
        width: 100%;
        height: 100%;
        background: #HexcodeWithSomeOpacity;
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; it is not recommended to add a background to {{{.passage}}} as it will refresh along with the content of the passage (flash).
\
&lt;h4&gt;Light and Dark Themes&lt;/h4&gt;\
Because your project may be played by others, you may want to consider adding multiple themes for comfort. Light mode (bright colours closer to white) tend to be superior for readability and provising less eye straints in bright environment. On the other hand, dark mode (darker colours closer to black) make it easier to the eyes in darker environment, and reduces exposure to blue screen light. Individuals also have their personal preference between light and dark mode.
&gt; &#39;&#39;Note:&#39;&#39; many SugarCube templates will include a Theme [[Setting|SettingsList]] within its code, with a light and dark mode.
\
&lt;h3&gt;Font Choices and Alternatives&lt;/h3&gt;\
We all love Papyrus as a font, but it does not make for a legible font for plain text. When considering to use a different font for your project than the one included in the Base StyleSheet (which is {{{Helmet/Freesans/sans-serif}}}), legibility should be a priority. This is extra important for players with dyslexia and other visual impairment, as similarly shaped letters and characters and short ascenders and descenders combinations may increase confusion.

So decorative and overly stylized fonts, such as cursive fonts, which can be difficult to read even for non-impaired users, should be avoided (or an alternative should be provided). Serif fonts, like Times New Roman or Calibri, are preferred for printed items (i.e. books), but doesn&#39;t display as nicely on screens as sans-serif fonts do (though those two are still very legible).

Fonts like {{{Arial}}} (sans-serif), {{{Calibri}}} (serif), {{{Georgia}}} (serif), {{{Helvetica}}} (sans-serif), {{{Lucida Sans}}}/{{{Lucida Grande}}} (sans-serif), {{{Tahoma}}} (sans-serif), {{{Times New Roman}}} (serif), and {{{Verdana}}} (sans-serif) are often among lists of recommended fonts. 
There are also fonts created specifically for dyslexic and visually impared users, though many are under copyright or are not free for use. [[OpenDyslexic|https://opendyslexic.org/]] and [[Atkinson Hyperlegible|https://brailleinstitute.org/freefont]] are two freely available sans-serif fonts.

For Twine projects, you may want to consider adding multiple serif and sans-serif fonts, letting the player decided which one they would prefer to use, through a [[Setting|SettingsList]].
&gt; &#39;&#39;Note:&#39;&#39; along with font families, you may want to add different font sizes for player to choose from as well!
\
&lt;h3&gt;Animated Content&lt;/h3&gt;\
While animations can help elevate a project, some may also hinder it. Ill-timed animations can become a distraction, too many animations at once could bring confusion on where the eye should focus, poorly designed animations may work fine on computers but may not translate on mobile devices, and certain types of animations (e.g. rapid flashing) could present accessibility issues to users (e.g. espilepsy, visual impairments, etc...).

When including animation, even as simple as the {{{&lt;&lt;type&gt;&gt;}}} macro, you may want to code a [[Toggle Setting|SettingsToggle]] to hide the animated elements. This can be done either in the StyleSheet through a class, or directly in the passage with a conditional statement.
\
&lt;h3&gt;Images and Alternative Text&lt;/h3&gt;\
When including assets like images into your project, you must remember that they may not be accessible to users with impairments.

Alternative texts, thanks to the {{{alt}}} attribute, may alleviate this issue for screen readers:
{{{
    &lt;img src=&quot;URL&quot; alt=&quot;this is the image&quot;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; a recommended Alternative text length should be about 125 characters. 
&gt; Extensive and verbose descriptions should be included in the page itself.
For inconsequential elements, such as a fancy paragraph break as an image, you can use an empty {{{alt}}} attribute to &quot;hide&quot; the image from screen readers:
{{{     &lt;img src=&quot;URL&quot; alt=&quot;&quot;&gt;}}} 
&gt; &#39;&#39;Note:&#39;&#39; if not indicated, the screen reader will say //Image//.
\
&lt;h3&gt;Some Links about Accessibility and Guidelines&lt;/h3&gt;\
* [[ARIA - Accessibility - MDN|https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA]]
* [[HTML: A good basis for accessibility - MDN|https://developer.mozilla.org/en-US/docs/Learn/Accessibility/HTML]]
* [[HTML5 Accessibility - Support Status (2022)|https://stevefaulkner.github.io/HTML5accessibility/]]
* [[Web Accessibility Initiative Guidelines 2.2 - WCAG|https://www.w3.org/TR/WCAG22/]]
* [[Game Accessibility Guidelines|https://gameaccessibilityguidelines.com/]]
* [[Can I Use ?|https://caniuse.com/]] (features accepted by which browser)
* [[APCA Contrast Simulator|https://www.myndex.com/APCA/]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Styling Menu|Int-JS-CSS]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="84" name="Macro-Interact-Adv" tags="chapter menu" position="1400,1100" size="200,100">&lt;h1&gt;More Interactivity Macros&lt;/h1&gt;
While a previous chapter touched upon the [[Base Interactive Macros|Macro-Interact]], SugarCube also includes more intermediate interactive macros. These will give the project a different kind of interactivity, or more flexibility in said interactivity.

* [[DOM Macros and Revealing Text in Targeted Spots|Macro-ApPreRepCopy]] 
* [[Single-Use Choice Lists|Macro-Action-Choice]]
* [[Delaying Displaying Text or Running Code|Macro-Timed]]
* [[Displaying Text Letter by Letter|Macro-Type]] 
* [[Using Custom Macro|Custom-Macro]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="85" name="Macro-ApPreRepCopy" tags="page" position="1400,1200" size="100,100">&lt;h1&gt;DOM Macros and Revealing Text in Targeted Spots&lt;/h1&gt;
DOM (Document Object Model) Macros target HTML elements on a page and affect the displayed content of that element. Those macros have the same functionality as the {{{&lt;&lt;link[insert-DOM]&gt;&gt;}}} [[macros|Macro-Link-AppPreRep]], but have more flexibility and do not require a link to work.

There are four main macros and one extra:
* {{{&lt;&lt;append&gt;&gt;}}}, which will add content after the targeted element. 
* {{{&lt;&lt;prepend&gt;&gt;}}}, which will add content before the targeted element.
* {{{&lt;&lt;replace&gt;&gt;}}}, which will replace the content of the targeted element.
* {{{&lt;&lt;remove&gt;&gt;}}}, which will remove the targeted element.
* {{{&lt;&lt;copy&gt;&gt;}}}, which will copy the content of the targeted element.
\
The macros have each argument:
* the element to target: which can be an {{{#id}}}, a {{{.class}}} or an HTML {{{element}}}, or a combination.
&gt; &#39;&#39;Note:&#39;&#39; if you are targeting an element that is on the page multiple time, the macro will affect all these elements.
\
{{{
	&lt;&lt;append &quot;#chocolate&quot;&gt;&gt;
		This text will append the element with the ID &quot;chocolate&quot;.
		It will appear after the content inside that element.
	&lt;&lt;/append&gt;&gt;
	
	&lt;&lt;prepend h1&gt;&gt;
		This text will prepend every h1 element.
		It will appear before the content inside that element.
	&lt;&lt;/prepend&gt;&gt;
	
	&lt;&lt;replace &quot;.dog&quot;&gt;&gt;
		This text will replace the content of 
		the element with the Class &quot;dog&quot;.
	&lt;&lt;/replace&gt;&gt;
	
	&lt;&lt;remove p.test&gt;&gt; 
→ will remove the element &lt;p class=&quot;test&quot;&gt; from the page
	
	&lt;&lt;copy span#sweet&gt;&gt; 
→ will copy the content of the element &lt;span id=&quot;sweet&quot;&gt;
}}}
&gt; &#39;&#39;Notes:&#39;&#39; if the element you are trying to target is //not// on the page, you will get an error.
&gt; If you want to empty an element, it is best to use an empty {{{&lt;&lt;replace&gt;&gt;}}} than a {{{&lt;&lt;remove&gt;&gt;}}}.
\
&lt;h3&gt;Transition or no transition&lt;/h3&gt;\
Like with their {{{&lt;&lt;link[insert-DOM]&gt;&gt;}}} counterparts, {{{&lt;&lt;append&gt;&gt;}}}, {{{&lt;&lt;prepend&gt;&gt;}}} and {{{&lt;&lt;replace&gt;&gt;}}} have an optional extra argument:
* {{{t8n}}} or {{{transition}}} (optional) whether to show the new text with a transition.
{{{
	&lt;&lt;append &quot;#chocolate&quot; t8n&gt;&gt;
		This text will append the element with the ID &quot;chocolate&quot;.
		It will do so with a transition.
	&lt;&lt;/append&gt;&gt;
}}}
&lt;span id=&quot;coco&quot;&gt;This is a sentence.&lt;/span&gt;
	&lt;&lt;link &quot;Replace as is&quot;&gt;&gt;&lt;&lt;replace &quot;#coco&quot;&gt;&gt;This replaces the element without a transition.&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt; | &lt;&lt;link &quot;Replace with transition&quot;&gt;&gt;&lt;&lt;replace &quot;#coco&quot; t8n&gt;&gt;This replaces the element with a transition.&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;
\
&lt;h3&gt;In combination with other macros&lt;/h3&gt;\
The DOM macros are best used in combination with other interative elements, like {{{&lt;&lt;link&gt;&gt;}}}, {{{&lt;&lt;button&gt;&gt;}}}, or even {{{&lt;&lt;timed&gt;&gt;}}}. Here are some examples:
&lt;span id=&quot;dog&quot;&gt;The dog is barking&lt;/span&gt;.
	&lt;&lt;link &quot;Throw a ball&quot;&gt;&gt;&lt;&lt;append &quot;#dog&quot;&gt;&gt; at the ball&lt;&lt;/append&gt;&gt;&lt;&lt;/link&gt;&gt;
{{{
Code:
	&lt;span id=&quot;dog&quot;&gt;The dog is barking&lt;/span&gt;.
	&lt;&lt;link &quot;Throw a ball&quot;&gt;&gt;&lt;&lt;apprend &quot;#dog&quot;&gt;&gt; at the ball&lt;&lt;/append&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
&gt; //Replacing a list of links with more text://
{{{
	&lt;span id=&quot;choices&quot;&gt;
		&lt;&lt;link &quot;Go Home&quot;&gt;&gt;
			&lt;&lt;replace &quot;#choices&quot;&gt;&gt;
				You went home. Nothing much happened.
				[[Next|Next Day]] 
			&lt;&lt;/replace&gt;&gt;
		&lt;&lt;/link&gt;&gt;
		&lt;&lt;link &quot;Go to the Cinema&quot;&gt;&gt;
			&lt;&lt;replace &quot;#choices&quot;&gt;&gt;
				You went to the Cinema, and met Charlie after the movie ended.
				[[Next|Convo Charlie]] 
			&lt;&lt;/replace&gt;&gt;
		&lt;&lt;/link&gt;&gt;
	&lt;/span&gt;
}}}
&gt; //Copying and Pasting://
{{{
	This is a &lt;span class=&quot;one&quot;&gt;terrible&lt;/span&gt; idea!
	Well, I think this is &lt;span class=&quot;two&quot;&gt;a grand idea!&lt;/span&gt;

	&lt;&lt;link &quot;Or is it?&quot;&gt;&gt;
		&lt;&lt;replace &quot;.two&quot;&gt;&gt;actuall a &lt;&lt;copy &quot;.one&quot;&gt;&gt; as well...&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;
}}}
\
&lt;h3&gt;An important note on DOM Macros&lt;/h3&gt;\
Since the macros require the targeted element to be on the page, they &#39;&#39;cannot&#39;&#39; be coded as is on the page, due to how the [[page renders|SP-PassageReady-Done]]. As such, you will need either to:
* use the {{{&lt;&lt;link&gt;&gt;}}} or {{{&lt;&lt;button&gt;&gt;}}} macro, letting the player interact with the element,
* use the {{{&lt;&lt;done&gt;&gt;}}} [[macro|Macro-Done]], which will trigger when the page is fully rendered,
* use the {{{&lt;&lt;timed&gt;&gt;}}} [[macro|Macro-Timed]], which will delay the trigger long after the page is rendered,
* code it inside the {{{PassageDone}}} [[special passage|SP-PassageReady-Done]] (same as the {{{&lt;&lt;done&gt;&gt;}}} macro, but will trigger at every passage render).

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced interactive Macro Menu|Macro-Interact-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="86" name="Macro-Action-Choice" tags="page" position="1500,1200" size="100,100">&lt;h1&gt;Single-Use Choice Lists&lt;/h1&gt;
SugarCube has two macros that will automatically create lists of links, which will disappear when used: the {{{&lt;&lt;actions&gt;&gt;}}} and the {{{&lt;&lt;choice&gt;&gt;}}} macros. 
&lt;&lt;actions [[You won&#39;t be able to go there|LOL]] [[This one also doesn&#39;t work|LOL]] [[But here is a list of actions|LOL]]&gt;&gt;\
\
While both macros are coded and are formatted  the same, they actually work differently:
* {{{actions}}} will only remove the links where the passages have already been visited by the player.
* {{{choice}}} will deactivate all listed links when one of them is clicked.

The macros have only 1 argument:
* the passage(s) you want listed
{{{
Indicating the passages names only:  
	&lt;&lt;actions &quot;Home&quot; &quot;Garden&quot; &quot;Cinema&quot;&gt;&gt;
→ this will list the passages as links 

Using the Link Markup:
	&lt;&lt;choice [[Go Home|Home]] [[Go to the Garden|Garden]] [[Go to the Cinema|Cinema]]&gt;&gt;

Using the Image Markup:
	&lt;&lt;actions [img[URL][PassageName]]&gt;&gt;
}}}

&gt; &#39;&#39;Note:&#39;&#39; Both macros are quite limiting, both in terms of coding and player use. 
&gt; If the player needs to go back to the passage where the macro is coded, or has visited every passage of the listed options, they will get stuck.
&gt; If the code required is more complex than the base Link Markup (i.e. setting variables or conditional display of a link), you will get an error.
&gt; In general, using regular links and manually formatting them into a list (with potential conditional statements) will be preferable. 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced interactive Macro Menu|Macro-Interact-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="87" name="Macro-Timed" tags="page" position="1400,1300" size="100,100">&lt;h1&gt;Delaying Displaying Text or Running Code&lt;/h1&gt;
If a text should be displayed with some delay or a bit of code should not be triggered as soon as the passage is loaded, the {{{&lt;&lt;timed&gt;&gt;}}} macro should be used. As its name suggest, the macro will run a timer before triggering the code and displaying text.

&lt;&lt;timed 4s&gt;&gt;//Whoop, there it is!//&lt;&lt;/timed&gt;&gt;
The macro has 2 arguments for its container, and 1 for the submacro:
* {{{&lt;&lt;timed&gt;&gt;}}}:
** the delay before the macro triggers, can be indicated in seconds or milliseconds.
*** the minumum delay is 40ms.
** {{{t8n}}}/{{{transition}}}, whether the text appearing does so like the transition between passages.
* {{{&lt;&lt;next&gt;&gt;}}}:
** (optional) the delay before the next part of the macro triggers, can be indicated in seconds or milliseconds.
*** the minumum delay is 40ms.
*** if not indicated, it will take the delay from the {{{&lt;&lt;timed&gt;&gt;}}} macro.

{{{
	&lt;&lt;timed 2s t8b&gt;&gt;
		This will appear with a transition after 2 seconds.
	&lt;&lt;next&gt;&gt;
		And this will appear 2 seconds after the previous text.
	&lt;&lt;next 4s&gt;&gt;
		While this will appear 4 seconds after the previous block.
	&lt;&lt;/timed&gt;&gt;
}}}

Aside from displaying text, you can use the {{{&lt;&lt;timed&gt;&gt;}}} macro to trigger code:
{{{
→ sending the player to another passage:
	&lt;&lt;timed 10s&gt;&gt;&lt;&lt;goto &quot;END&quot;&gt;&gt;&lt;&lt;/timed&gt;&gt;

→ replacing some text on the page:
	Can I by some &lt;span id=&quot;text&quot;&gt;eggs&lt;/span&gt;?
	&lt;&lt;timed 2s&gt;&gt;&lt;&lt;replace &quot;#text&quot;&gt;&gt;milk&lt;&lt;/replace&gt;&gt;&lt;&lt;/timed&gt;&gt;
}}}
\
&gt; &#39;&#39;Note:&#39;&#39; When using this macro, it is important to test the passage extensively, to ensure it works as intended.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced interactive Macro Menu|Macro-Interact-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="88" name="Macro-Type" tags="page" position="1500,1300" size="100,100">&lt;h1&gt;Displaying Text Letter by Letter&lt;/h1&gt;
Whether wanting to emulate a computer monitor or a typewriter, by displaying a text letter by letter, the {{{&lt;&lt;type&gt;&gt;}}} macro will do the job!

&lt;&lt;type 80ms&gt;&gt;Here is the macro in action! It can also do [[links|Macro-Type]] and &#39;&#39;formatting&#39;&#39;...&lt;&lt;/type&gt;&gt;
\
The macro has 8 arguments:
* speed: the amount of time between each letter, can be indicated in seconds or milliseconds.
** 20-60ms is a good printing rate. 0s will show the whole text with a flash.
* {{{start}}} (optional): adding a delay before the typing starts, indicated in seconds or milliseconds
** if only {{{start}}} is indicated, the default will be 400ms.
* {{{class}}} (optional): will assign an extra CSS {{{.class}}} to the typing container.
* {{{id}}} (optional): will assign a CSS {{{#id}}} to the typing container.
* {{{element}}} (optional): will transform the container from a {{{&lt;div&gt;}}} to another HTML element.
* {{{keep}}} (optional): will keep the cursor even after the typing is complete.
* {{{none}}} (optional): will not use the cursor during typing.
* {{{skipkey}}} (optional): when the key is pressed, the typing will display the whole text immediately.
** If only {{{skipkey}}}, the default value must be indicated with the {{{Config.macros.typeSkipKey}}} [[API|Confic-Macro]].
\
{{{
	&lt;&lt;type 40ms&gt;&gt;I ate an apple.&lt;&lt;/type&gt;&gt;
→ The base required, with characters showing every 40 milliseconds.

	&lt;&lt;type 40ms start 2s none&gt;&gt;Oh no, I&#39;m late...&lt;&lt;/type&gt;&gt;
→ After a 2-second delay, this will show characters every 40 milliseconds, without the cursor.

	&lt;&lt;type 40ms class &quot;menu&quot;&gt;&gt;[[Start Now!]]&lt;&lt;/type&gt;&gt;
→ This will type the characters of the link every 40 milliseconds, and add the class &#39;.menu&#39; to the container.

	&lt;&lt;type 40ms element &quot;span&quot; keep&gt;&gt;Now I&#39;m a span!&lt;&lt;/type&gt;&gt;
→ Instead of the base container, this will be a &#39;&lt;span&gt;&#39;. When all text is displayed, the cursor will stay on the page.

	&lt;&lt;type 40ms id &quot;words&quot; skipkey &quot;Enter&quot;&gt;&gt;Last one!&lt;&lt;/type&gt;&gt;
→ This will type the characters every 40 milliseconds, unless the key &#39;Enter&#39; is pressed to display everything at once. The container will also get the id &#39;#words&#39; added to it.
}}}
\
&lt;h3&gt;Order of triggers&lt;/h3&gt;\
You can have as many iteration of {{{&lt;&lt;type&gt;&gt;}}} inside one passage, thought they will trigger one after the other.
If you nest a {{{&lt;&lt;type&gt;&gt;}}} macro inside another one, the nested {{{&lt;&lt;type&gt;&gt;}}} will only start &#39;&#39;after all non-nested&#39;&#39; iteration have been completed.
{{{
	&lt;&lt;type 40ms&gt;&gt;First.
		&lt;&lt;type 40ms&gt;&gt;Fourth.
			&lt;&lt;type 40ms&gt;&gt;Sixth.&lt;&lt;/type&gt;&gt;
		&lt;&lt;/type&gt;&gt;
	&lt;&lt;/type&gt;&gt;
	&lt;&lt;type 40ms&gt;&gt;Second.&lt;&lt;/type&gt;&gt;
	&lt;&lt;type 40ms&gt;&gt;Third.
		&lt;&lt;type 40ms&gt;&gt;Fifth.&lt;&lt;/type&gt;&gt;
	&lt;&lt;/type&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; Because the macro is time dependant, it is important to test the passages extensively, to ensure it works as wanted.
\
&lt;h3&gt;Customising the typed text with CSS&lt;/h3&gt;\
While the typed text does not have default styling (aside from the cursor), the macro includes special classes you can target and edit:
* {{{.macro-type}}}, to change the base styling of the macro (e.g. colour, font...)
* {{{.macro-type-done}}}, to change the styling when all iteractions of the macro are complete
* {{{.macro-type-cursor:after}}}, to edit the cursor
{{{
	.macro-type {
		color: limegreen;
		font-family: monospace, monospace;
	}
	.macro-type-cursor:after {
		color: limegreen;
		content: &quot;\269C\FE0F&quot;; /* Fleur-de-lis emoji */
		font-family: monospace, monospace;
	}
}}}

&gt; &#39;&#39;Note:&#39;&#39; for even more advanced customisation of the macro, you can also add custom JavaScript code with the [[Typing Events|Events-Type]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced interactive Macro Menu|Macro-Interact-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="89" name="Custom-Macro" tags="page" position="1400,1400" size="100,100">&lt;h1&gt;Using Custom Macro&lt;/h1&gt;
Aside from the built-in macros, there are many custom ones created by other SugarCube users, from official [[add-ons|http://www.motoslave.net/sugarcube/2/]] on the SugarCube page, to code repositories (mainly on GitHub - see &lt;&lt;link &quot;Credits&quot;&gt;&gt;&lt;&lt;popup &quot;Credits&quot; &quot;Credits&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;). These custom macros will almost always have their specific documentation, with examples or guides on how to use them.

As they are not included with SugarCube, you will need to &quot;install&quot; the custom macro by copy-pasting the relevant code into the JavaScript tab, the StyleSheet tab, or inside a [[Widget Passage|Macro-Widget]]. Not including this code inside the project (in the correct place) will trigger errors on the page.

&gt; &#39;&#39;Note:&#39;&#39; when using multiple macros, it is important to check that &#39;&#39;no two macros have the same name&#39;&#39;. Otherwise, it will create issues when loading the game.
\
&lt;h3&gt;Creating your own Macro&lt;/h3&gt;\
If you need a custom macro for your project, because it cannot be done with base SugarCube or with the {{{&lt;&lt;script&gt;&gt;}}} [[macro|Macro-Script-Run]], and you have enough knowledge of JavaScript and jQuery, you could attempt to create your own Macro.
&gt; &#39;&#39;Note:&#39;&#39; this option should be for very advanced users with JavaScript knowledge. Many game functionalities do not require a custom macro, or may have already been created by someone. See the Masterlist link in the Credits for a non-exhaustive list of macro creators.

To do so, you will need to use the [[Macro API|Macro]] and code away!
The most important things to remember will be to:
* ensure the name of the macro is different to the Base SugarCube macrs (or other custom ones you may be using)
* test it extensively 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced interactive Macro Menu|Macro-Interact-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="90" name="Localization" tags="chapter menu" position="3800,1100" size="200,100">&lt;h1&gt;Edit the Built-In Text or Change the Game&#39;s Language&lt;/h1&gt;
Further customisation of a SugarCube project can be done with the {{{l10nStrings}}}, bits of JavaScript code that will change what text the Built-In elements will show. This can affect the buttons on the Sidebar, as well as the Restart, Saves, and Settings Popup. You can edit these strings to fit the vibe of your project, change its language entirely, or link them to a function to provide translation of your work. 

* [[l10nStrings, and How to Edit Them|Local-L10n]]
* [[Localization, and Pre-Translated Templates|Local-Trans]]
* [[Providing Multiple Languages In-Game|Local-Setting]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="91" name="Local-L10n" tags="page" position="3800,1200" size="100,100">&lt;h1&gt;{{{l10nStrings}}}, and How to Edit Them&lt;/h1&gt;
{{{l10nStrings}}} are strings of words which can only be edited in JavaScript. These strings populate your project pages in very specific spots, as defined by the property attached to it. Depending on the property chosen, it can affect visible text on the screen, text only visible when hovering over an element, text inside a browser alert, or when the game is in Debugging Mode (Test).
{{{
    l10nStrings.property = &quot;New Text&quot;;
}}}
&gt; //For example://
{{{
    l10nStrings.restartTitle = &quot;Restart&quot;;
    l10nStrings.restartTitle = &quot;Are You Sure?&quot;;
}}}
&gt; &#39;&#39;Note:&#39;&#39; any {{{l10nStrings}}} added to your JavaScript will override the built-in text. If multiple iteration of the same property is edited in your file, only the last one will be shown on the page.

You can find the whole list of accepted property on [[this page|https://github.com/tmedwards/sugarcube-2/blob/develop/locale/l10n-template.js]] of the SugarCube repository. 
Just Copy-Paste the necessary lines into your JavaScript, and edit the text. The code will accept any [[Unicode Character and Symbols|https://en.wikipedia.org/wiki/List_of_Unicode_characters]] (testing for fonts advised).
&gt; &#39;&#39;Note:&#39;&#39; If you remove an element in the UI, like the backward button, the related {{{l10nStrings.propery}}} (here {{{l10nStrings.uiBarBackward}}}) will not need to be included in your project.

You can also use the text of other properties inside an {{{l10nStrings}}} to avoid writing it multiple times, either by using the property itself ({{{l10nStrings.propery}}}) or creating a template ({{{l10nStrings._template}}}). For example, in the Built-In {{{l10nStrings}}}:
{{{
    l10nStrings.identity = &#39;game&#39;;

    l10nStrings._warningIntroLacking  = &#39;Your browser either lacks or has disabled&#39;;

    l10nStrings._warningOutroDegraded = &#39;, so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.&#39;;

    l10nStrings.warningNoWebStorage   = &#39;{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}&#39;;
}}}
The three first {{{l10nStrings}}} (one a property, the two others templates) are used by the last string to create the following text:
&gt; //Your browser either lacks or has disabled// the Web Storage API, //so this &#39;&#39;game&#39;&#39; is running in a degraded mode. You may be able to continue, however, some parts may not work properly.//

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Localization Menu|Localization]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="92" name="Local-Trans" tags="page" position="3900,1200" size="100,100">&lt;h1&gt;Localization, and Pre-Translated Templates&lt;/h1&gt;
If your project is not in English and you want the Built-In text to reflect this, you will need to include and edit most of the [[l10nStrings|Local-L10n]] defined in the format&#39;s code. This can be done by Copy-Pasting into your JavaScript the code from [[this page|https://github.com/tmedwards/sugarcube-2/blob/develop/locale/l10n-template.js]] of the SugarCube repository, and edit the text.
&gt; &#39;&#39;Note:&#39;&#39; you can forgo the first and last line of the code in that page (i.e. the {{{function()}}}).

There may be a faster way to translate this built-in text if your language is included in the following list:
{{{
    Arabic (ar-EG)
    Chinese (chs)
    German (de)
    Spanish (es-ES)/(es-UNKNOWN)
    French (fr)
    Italian (it-IT)
    Dutch (nl)
    Polish (pl)
    Portuguese (pt-BR)/(pt-PT)
    Russian (ru)
    Turk (tr)
}}}
&gt; &#39;&#39;Note:&#39;&#39; this was last checked on 3-Dec-2023.
These languages already have a Localization package, downloadable on the [[SugarCube website|http://www.motoslave.net/sugarcube/2/#downloads]], that you can Copy-Paste without needing to translate.
&gt; &#39;&#39;Note:&#39;&#39; you //may// want to check the translated version fits with your project, or whether some edits may be required.

If your language (or its regional version) is unfortunately not included in the list above, you will need to edit every {{{l10nStrings}}} manually.
&gt; &#39;&#39;Note:&#39;&#39; You may also want to provide this translation to TME, so it may be included in this list for future users. This can be done by forking the GitHub repository, edit [[this folder|https://github.com/tmedwards/sugarcube-2/tree/master/locale]] to include your translation, and open a pull request.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Localization Menu|Localization]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="93" name="Local-Setting" tags="page" position="3800,1300" size="100,100">&lt;h1&gt;Providing Multiple Languages In-Game&lt;/h1&gt;
If you want to include more than one language to your project, how to code it will depend on the UI of your project (Base or Custom) and whether the functionalities in your game (i.e. Settings, Saves, ...) use the [[Built-In text|Local-L10n]]. It may be as simple as creating seperate passage paths per language (with a starting screen displaying a list of available languages), to more complex, like having a Setting the player can use to change the language at anytime.
\
&lt;h3&gt;No Built-In Text and Language Choice at Start&lt;/h3&gt;\
In this first case (which can be attainable by removing the Sidebar or creating a Custom UI), an easy way to achieve including localization would be to start with a passage where the player can choose the language from a list of links, each of which would send the player to a path of passages for that specific language:
{{{
    :: Start
    THIS IS A GAME, REALLY...
    [[English|EN-Passage]]
    [[Français|FR-Passage]]
    [[Español|ES-Passage]]
    [[Nederlands|NL-Passage]]

    :: EN-Passage
    This passage is English.
    [[Continue|EN-Next]]

    :: FR-Passage
    Ce Passage est en Français. 
    [[Continuer|FR-Next]]
    
    :: EN-Passage
    Este pasaje esta en español.
    [[Continuar|ES-Next]]
    
    :: EN-Passage
    Deze passage is in het Nederlands.
    [[Doorgaan|NL-Next]] 
}}}
You can also choose to merge every translated passage into one, tracking the language choice through a variable:
{{{
    :: Start
    THIS IS A GAME, REALLY...
    [[English|Passage][$language to &quot;English&quot;]]
    [[Français|Passage][$language to &quot;French&quot;]]
    [[Español|Passage][$language to &quot;Spanish&quot;]]
    [[Nederlands|Passage][$language to &quot;Dutch&quot;]]

    :: Passage
    &lt;&lt;switch $language&gt;&gt;&lt;&lt;case &quot;English&quot;&gt;&gt;
        This passage is English.
        [[Continue|Next]]
    &lt;&lt;case &quot;French&quot;&gt;&gt;
        Ce Passage est en Français. 
        [[Continuer|Next]]
    &lt;&lt;case &quot;Spanish&quot;&gt;&gt;
        Este pasaje esta en español.
        [[Continuar|Next]]
    &lt;&lt;case &quot;Dutch&quot;&gt;&gt;    
        Deze passage is in het Nederlands.
        [[Doorgaan|Next]]
    &lt;&lt;/switch&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; this last example can work with a Custom UI, where other UI elements need to be displayed in the chosen language.
\
&lt;h3&gt;Built-In Text and Settings&lt;/h3&gt;\
If Built-In Text appears on the page (throug the Base UI or while using Settings or Saves), you will need to not only show the proper Story Text within passages, but the correct version of this Built-In text. This should be done via JavaScript and include [[l10nStrings|Local-L10n]].

While you may choose to built your own, TME has already created a custom version ([[code here|https://gist.github.com/tmedwards/33f3b4b7ada317fc9cc70aa8580c03f0]]), which includes a Setting for the player to switch from one language to another at any time, and explained below.
\
&lt;h4&gt;TME Internalization Code&lt;/h4&gt;\
First, Copy-Paste the JavaScript code between the {{{:: Language Switching [script]}}} and {{{:: Start}}} lines into your project&#39;s JavaScript. Then, edit the code to fit your project&#39;s need. 
Two parts are the most important: changing the list of languages to choose from, and changing the Built-In text for each language. 
&gt; &#39;&#39;Note:&#39;&#39; TME indicates where to edit the code with his {{{// &#39;&#39;Note:&#39;&#39; User customization required here.}}} comment.
{{{
    langs : {
        // &#39;&#39;Note:&#39;&#39; User customization required here.

		&#39;Deutsche&#39; : &#39;de&#39;,
		&#39;English&#39;  : &#39;en&#39;,
		&#39;Français&#39; : &#39;fr&#39;,
	},
}}}
In this part, you will want to list the languages you want to display, followed by a language code. This is required for the latter part of the code to work.
You will need to remove unnecessary cases as well. 

{{{
    switch (setup.i18n.langs[settings.lang]) {
		/*
			NOTE 1: User customization required here.
			NOTE 2: The `l10nStrings` properties shown in the cases below are an
			abbreviated set for example purposes.  There are many more properties
			within the `l10nStrings` object which you&#39;ll need to handle.
		*/
		case &#39;de&#39;:
			l10nStrings.settingsTitle = &#39;Einstellungen&#39;;
			l10nStrings.settingsOff   = &#39;Deaktivieren&#39;;
			l10nStrings.settingsOn    = &#39;Aktivieren&#39;;
			l10nStrings.settingsReset = &#39;Auf Standardeinstellung zurücksetzen&#39;;
			break;

		case &#39;fr&#39;:
			l10nStrings.settingsTitle = &#39;Paramètres&#39;;
			l10nStrings.settingsOff   = &#39;Désactiver&#39;;
			l10nStrings.settingsOn    = &#39;Activer&#39;;
			l10nStrings.settingsReset = &#39;Réinitialiser les paramètres par défaut&#39;;
			break;
	}
}}}
In this part, you will need to create the relevant cases with the language codes you created in the first part of the code, and list the relevant {{{l10nStrings}}}, so the Built-In text is shown in the chosen language.
The {{{case &#39;en&#39;:}}} is not listed here, since it already uses the Built-In text. If you want to change any of the [[l10nStrings|Local-L10n]] for English, you will need to add its case there.
&gt; &#39;&#39;Note:&#39;&#39; you can find [[pre-translated packages|Local-Trans]] for the {{{l10nStrings}}}.
\
&lt;h4&gt;Setting up the Passages&lt;/h4&gt;\
After the JavaScript code is set, you will have to set the passages. While similar to the first method, this way requires an empty passage to act as an anchor for the JavaScript code. From that anchor, the code will check the langugage chosen, add the relevant language code as a suffic to the anchor, and display the corresponding passage. 
For example, with the passage {{{Start}}}:
# Anchor {{{Start}}}
# Language: {{{English}}}
# Code into Suffix: {{{en}}} -&gt; {{{_en}}}
# Passage to display: {{{Start_en}}}
So, you will need to create as many passages as there are defined languages, on top of the anchor (e.g. 3 languages = 4 passages). In a project, it will look like this:
{{{
    :: Start
        /* You can add code, macros and notes here, but no text will show. */
    
    :: Start_de
        Deutsche.
        [[Nächster|Next]]

    :: Start_en
        English.
        [[Next]]

    :: Start_fr
        Français.
        [[Prochain|Next]]

}}}
And so on and so forth...
&gt; &#39;&#39;Note:&#39;&#39; The links to the next passage MUST go towards the anchor passage. If you link it to a suffixed passage ({{{Start_en}}}), it will add another suffix ({{{Start_en_en}}}) and display and error.
\
&lt;h4&gt;Language Choice at Start and Window Reload&lt;/h4&gt;\
While the player can go into the settings to change the language of the game, it is also possible to give the player the option to choose a language as a starting passage. You will need to create a link, where you save the language choice in a setting variable.
{{{
    &lt;&lt;link &quot;Français&quot; &quot;Next&quot;&gt;&gt;
        &lt;&lt;set settings.lang to &quot;Français&quot;&gt;&gt;
        &lt;&lt;run Setting.save()&gt;&gt;
    &lt;&lt;/link&gt;&gt;
}}}

If you are using Build-in elements or the Base UI, you will need to force a page refresh to ensure the next page loads {{{l10nStrings}}} correctly. This is because this method links the {{{l10nStrings}}} to the {{{lang}}} attribute attached to {{{&lt;html&gt;}}}, so changing the setting without changing the attribute is not enough for those elements. A page refresh, however, will be able to fix that.
This can be done by adding a tad extra code:
{{{
    &lt;&lt;link &quot;Français&quot; &quot;Next&quot;&gt;&gt;
        &lt;&lt;set settings.lang to &quot;Français&quot;&gt;&gt;
        &lt;&lt;run Setting.save()&gt;&gt;
        &lt;&lt;run window.location.reload()&gt;&gt;
    &lt;&lt;/link&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; In a fully Custom UI, this //may// not be necessary. Though a refresh is still recommended.
\
&lt;h4&gt;Edit Settings Language or Other Custom Elements&lt;/h4&gt;\
While TME&#39;s code allows the automation in displaying different version of Built-In text through the {{{l10nStrings}}}, you will need to do the same for custom text, such as Settings lables and descriptions, or whatever element you created on the page (e.g. Custom Menu in the UI). This, however, can easily be remedied with the {{{&lt;&lt;switch&gt;&gt;}}} macro.
&gt; //In a Non-Story Passage://
{{{
    &lt;&lt;switch settings.lang&gt;&gt;
        &lt;&lt;case &quot;English&quot;&gt;&gt;Settings
        &lt;&lt;case &quot;Français&quot;&gt;&gt;Paramètres
    &lt;&lt;/switch&gt;&gt;
}}}
&gt; //In JavaScript Settings://
{{{
    Setting.addList(&#39;lang&#39;, {
		label    : `&lt;&lt;switch settings.lang&gt;&gt;&lt;&lt;case &quot;English&quot;&gt;&gt;Language&lt;&lt;case &quot;Français&quot;&gt;&gt;Langue&lt;&lt;/switch&gt;&gt;`,
        desc     : `&lt;&lt;switch settings.lang&gt;&gt;&lt;&lt;case &quot;English&quot;&gt;&gt;Select the wanted language&lt;&lt;case &quot;Français&quot;&gt;&gt;Choisissez la langue voulue&lt;&lt;/switch&gt;&gt;`,
		list     : setup.i18n.labels(),
		default  : setup.i18n.labelFromCode(&#39;en&#39;),
		onInit   : initLanguage,
		onChange : changeLanguage
	});
}}}
&gt; &#39;&#39;Note:&#39;&#39; the backticks {{{` `}}} allows the includions of SugarCube code inside JavaScript here.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Localization Menu|Localization]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="94" name="Macro-Audio" tags="chapter menu" position="2900,1100" size="200,100">&lt;h1&gt;Adding Sound with the Audio Macros&lt;/h1&gt;
Adding any asset to a project can be daunting, especially when it can involve so many macros. But adding audio is actually quite simple and, at the minimum, only requires the use of 2 macros: {{{&lt;&lt;audio&gt;&gt;}}} and {{{&lt;&lt;cacheaudio&gt;&gt;}}}.

* [[Setting up the Audio Tracks|CacheAudio]]
* [[Create Track Groups and Playlists|Macro-Group-Playlist]]
* [[Playing Tracks in a Passage|Audio-Macro]]
* [[Other Audio Macros|Audio-Other]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="95" name="CacheAudio" tags="page" position="2900,1200" size="100,100">&lt;h1&gt;Setting up the Audio Tracks&lt;/h1&gt;
To use audio tracks in your project, SugarCube requires you to cache the tracks at the start of the game by using the {{{&lt;&lt;cacheaudio&gt;&gt;}}} macro in the {{{StoryInit}}} [[Special Passage|SP-Init]].

The macro has 2 arguments:
* the ID for the track, as a reference
* the [[URL|URL-Types]] of the file, or files if a track has multiple formats.
{{{
        :: StoryInit
        &lt;&lt;cacheaudio &quot;boom&quot; &quot;music/explosion.mp3&quot;&gt;&gt;
        &lt;&lt;cacheaudio &quot;synth&quot; &quot;music/synth.mp3&quot; &quot;music/synth.wav&quot; &quot;music/synth.aac&quot;&gt;&gt;
}}}
&gt;&#39;&#39; Note:&#39;&#39; if possible, take into account browser support when adding audio tracks to a project. [[Not every format is compatible|https://caniuse.com/?search=audio%20format]].
\
&lt;h3&gt;Pre-loading some tracks&lt;/h3&gt;\
If some tracks will be played from the first few screens and should be pre-loaded, the {{{&lt;&lt;waitforaudio&gt;&gt;}}} macro will do just that, by increasing the loading screen until the track(s) is(are) ready to play. 

Place the macro in {{{StoryInit}}} below the necessary tracks, to load ahead. The tracks below the macro will only be cached.
{{{
       :: StoryInit
        &lt;&lt;cacheaudio &quot;boom&quot; &quot;music/explosion.mp3&quot;&gt;&gt;
        &lt;&lt;waitforaudio&gt;&gt;
        &lt;&lt;cacheaudio &quot;synth&quot; &quot;music/synth.mp3&quot;&gt;&gt;
        &lt;&lt;cacheaudio &quot;wind&quot; &quot;music/wind.mp3&quot;&gt;&gt;
        &lt;&lt;cacheaudio &quot;water&quot; &quot;music/water.mp3&quot;&gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Audio Macros Menu|Macro-Audio]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="96" name="Macro-Group-Playlist" tags="page" position="3000,1200" size="100,100">&lt;h1&gt;Create Track Groups and Playlists&lt;/h1&gt;
On top of adding audio tracks to your project, you can also create groups of tracks, for a better control over multiple tracks at once, and playlists. The first is set by the {{{&lt;&lt;createaudiogroup&gt;&gt;}}} macro, while the second is done through {{{&lt;&lt;createplaylist&gt;&gt;}}}. Both macros need to be set in {{{StoryInit}}} &#39;&#39;after&#39;&#39; the tracks are cached (with {{{&lt;&lt;cacheaudio&gt;&gt;}}}).
\
&lt;h3&gt;Create a Track Group&lt;/h3&gt;\
The macro only has one argument for the container, and one arugment for the sub-macro:
* {{{&lt;&lt;createaudiogroup&gt;&gt;}}}
** the name of the group, starting with {{{:}}}
* {{{&lt;&lt;track&gt;&gt;}}}
** the ID of the track(s)
Assuming that the tracks {{{beep}}}, {{{boop}}}, and {{{swish}}} were defined above:
{{{
       &lt;&lt;createaudiogroup &quot;:controls&quot;&gt;&gt;
                &lt;&lt;track &quot;beep&quot;&gt;&gt;
                &lt;&lt;track &quot;boop&quot;&gt;&gt;
                &lt;&lt;track &quot;swish&quot;&gt;&gt;
        &lt;&lt;/createaudiogroup&gt;&gt; 
}}}
&gt;&#39;&#39; Note:&#39;&#39; You cannot name your group with the following: {{{:all}}}, {{{:looped}}}, {{{:muted}}}, {{{:not}}}, {{{:paused}}}, {{{:playing}}}, as they are used for [[audio control|Audio-Macro]].
\
&lt;h3&gt;Create a Playlist&lt;/h3&gt;\
The macro only has one argument for the container, and three arugment for the sub-macro:
* {{{&lt;&lt;createplaylist&gt;&gt;}}}
** the ID of the playlist
* {{{&lt;&lt;track&gt;&gt;}}}
** the ID of the track
** {{{volume}}} (optional), to set the volume of the track, set from 0 (for 0%) to 1 (for 100%).
** {{{own}}} (optional), to create an independant copy of the track for the playlist
Assuming that the tracks {{{beep}}}, {{{boop}}}, and {{{swish}}} were defined above:
{{{
       &lt;&lt;createplaylist &quot;controls&quot;&gt;&gt;
                &lt;&lt;track &quot;beep&quot; own&gt;&gt;
                &lt;&lt;track &quot;boop&quot; volume 0.5&gt;&gt;
                &lt;&lt;track &quot;swish&quot; volume 0.3 own&gt;&gt;
        &lt;&lt;/createplaylist&gt;&gt; 
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Audio Macros Menu|Macro-Audio]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="97" name="Audio-Macro" tags="page" position="2900,1300" size="100,100">&lt;h1&gt;Playing Tracks in a Passage&lt;/h1&gt;
After setting tracks in {{{StoryInit}}}, you can those tracks to a passage with the {{{&lt;&lt;audio&gt;&gt;}}} macro. You also use this macro to target track groups, as well as controling the playback (ex: pause, volume change...).

The macro can be coded as is in a passage, or can be nested inside other macros, like a {{{&lt;&lt;link&gt;&gt;}}} or with a delay in {{{&lt;&lt;timed&gt;&gt;}}}.

When started, a track will play until it ends or another action is set with the {{{&lt;&lt;audio&gt;&gt;}}} macro.

The macro has 2 main arguments:
* the ID of the track or the group
* the list of action to perform (can be combined)
{{{
        &lt;&lt;audio &quot;ID&quot; action&gt;&gt;
}}}
\
&lt;h3&gt;Action List&lt;/h3&gt;\
There are 14 actions that can be included in the {{{&lt;&lt;audio&gt;&gt;}}} macro to control how a track or group of tracks is played:
&lt;&lt;nobr&gt;&gt;
&lt;table id=&quot;audio&quot;&gt;
        &lt;tr&gt;
                &lt;th&gt;Argument&lt;/th&gt;&lt;th&gt;Explanation&lt;/th&gt;&lt;th&gt;Example&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{play}}}&lt;/td&gt;&lt;td&gt;Start/Restart to play the track(s)&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; play&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{pause}}}&lt;/td&gt;&lt;td&gt;Pause the track(s)&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; pause&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{stop}}}&lt;/td&gt;&lt;td&gt;Stop the track(s)&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; stop&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{mute}}}&lt;/td&gt;&lt;td&gt;Reduce the volume to 0, without pausing the track&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; mute&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{volume}}}&lt;/td&gt;&lt;td&gt;Change the volume of the track(s)&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; volume 0.5&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{loop}}}&lt;/td&gt;&lt;td&gt;Set the track(s) to repeat when reahcing the end&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; loop&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{unloop}}}&lt;/td&gt;&lt;td&gt;Remove the looping (default)&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; unloop&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{fadein}}}&lt;/td&gt;&lt;td&gt;Start/Continue to play the track(s), fading in from their current volume to max over 5 seconds&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; fadein&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{fadeout}}}&lt;/td&gt;&lt;td&gt;Start/Continues to play the track(s), fading out from their current volume to 0 over 5 seconds&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; fadeout&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{fadeoverto}}}&lt;/td&gt;&lt;td&gt;Start/Continue to play the track(s), fading it over a set amount of seconds to a certain volume level &lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; 5 0.5&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{fadeto}}}&lt;/td&gt;&lt;td&gt;Start/Continue to play the track(s), fading to a certai volume level over 5 seconds&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; fadeto 0.9&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{goto}}}&lt;/td&gt;&lt;td&gt;Send the player to a certain passage at the end of the track(s)&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; goto &quot;Home&quot;&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
                &lt;td&gt;{{{time}}}&lt;/td&gt;&lt;td&gt;Move the play of the track to a certain amount of seconds from 0 (start) to the max of the file.&lt;/td&gt;&lt;td&gt;{{{&lt;&lt;audio &quot;track&quot; time 60&gt;&gt;}}}&lt;/td&gt;
        &lt;/tr&gt;
&lt;/table&gt;
&lt;&lt;/nobr&gt;&gt;
Assuming that the track {{{space}}}, inside the group {{{:space}}}, has been cached, here are some extra examples:
{{{
        &lt;&lt;audio &quot;:space&quot; play&gt;&gt;
→ Will start to play the group of tracks called :space, all at the same time.

        &lt;&lt;audio &quot;space&quot; volume 0.65 play&gt;&gt;
→ Will start playing the track {space} at 65% volume

        &lt;&lt;audio &quot;space&quot; time 92 play&gt;&gt;
→ Will start playing the track {space} from the 92th second

        &lt;&lt;audio &quot;space&quot; loop play&gt;&gt;
→ Will start playing the track {space} on repeat

        &lt;&lt;audio &quot;space&quot; volume 10 fadein&gt;&gt;
→ Will start playing the track {space}, fading in from 10% to max volume

        &lt;&lt;audio &quot;space&quot; volume 0.15 fadeto 0.78&gt;&gt;
→ Will start playing the track {space}, fading from 15% to 78% volume 

        &lt;&lt;audio &quot;space&quot; volume 0.04 fadeoverto 27 0.96&gt;&gt;
→ Will start playing the track {space}, fading from 4% to 96% volume over 27 seconds 

        &lt;&lt;audio &quot;space&quot; play goto &quot;Home&quot;&gt;&gt;
→ Will start playing the track {space}, and send the player to the passage &quot;Home&quot; when the track ends.
}}}
&lt;h3&gt;Group IDs&lt;/h3&gt;\
Aside from targeting groups, the {{{&lt;&lt;audio&gt;&gt;}}} macro can also target the state of tracks.
{{{
        &lt;&lt;audio &quot;:paused&quot; play&gt;&gt;
→ Will start playing all tracks previously paused

        &lt;&lt;audio &quot;:playing&quot; pause&gt;&gt;
→ Will pause all tracks currently playing

        &lt;&lt;audio &quot;:playing&quot; stop&gt;&gt;
→ Will stop all tracks currently playing

        &lt;&lt;audio &quot;:all&quot; stop&gt;&gt;
→ Will stop all tracks (playing and paused)

        &lt;&lt;audio &quot;:playing:not(:space)&quot; stop&gt;&gt;
→ Will stop all tracks currently playing, except the ones in the &quot;:space&quot; group

        &lt;&lt;audio &quot;:all:not(:space)&quot; volume 0.40&gt;&gt;
→ Will change the volume of all tracks not in the &quot;:space&quot; group to 40%
}}}
\
&lt;h3&gt;The {{{&lt;&lt;playlist&gt;&gt;}}} macro&lt;/h3&gt;\
This macro will work similarly to the {{{&lt;&lt;audio&gt;&gt;}}} macro, aside from targeting playlists set in {{{StoryInit}}} instead of groups or single tracks.  

The macro has 2 main arguments:
* the ID of the playlist 
* the list of action to perform (can be combined)
{{{
        &lt;&lt;playlist &quot;ID&quot; action&gt;&gt;
}}}
On top of the actions mentioned above for {{{&lt;&lt;audio&gt;&gt;}}}, this macro has three extra: 
* {{{shuffle}}}, shuffling the order of the tracks
* {{{unshuffle}}}, reorganising the order of the tracks to its original form
* {{{skip}}}, skipping the next track in the playlist 
{{{
        &lt;&lt;playlist &quot;playlist&quot; shuffle&gt;&gt;
        &lt;&lt;playlist &quot;playlist&quot; unshuffle&gt;&gt;
        &lt;&lt;playlist &quot;playlist&quot; skip&gt;&gt;
}}}
&gt;&#39;&#39; Note:&#39;&#39; The action {{{goto}}} will not work with {{{&lt;&lt;playlist&gt;&gt;}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Audio Macros Menu|Macro-Audio]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="98" name="Audio-Other" tags="page" position="3000,1300" size="100,100">&lt;h1&gt;Other Audio Macros&lt;/h1&gt;
There are three extra macros that can affect the played audio.
\
&lt;h3&gt;{{{&lt;&lt;masteraudio&gt;&gt;}}}&lt;/h3&gt;\
This macro will control the master volume of the game (overall volume), as well as affect all registered tracks, regardless of their state.

This macro only has one argument, the action:
* {{{mute}}} and {{{unmute}}}, muting or unmuting the master volume of the game.
* {{{muteonhide}}} and {{{nomuteonhide}}}, which will either mute or unmute (default) the master volume when the player moves to another tab or minimize the browser.
* {{{stop}}}, which will stop all registered tracks.
* {{{volume}}}, which will change the master volume to a specified level
{{{
        &lt;&lt;masteraudio action&gt;&gt;
}}}
&gt;&#39;&#39; Note:&#39;&#39; the master audio volume can be changed at will by the player with a [[Slider Setting|SettingsRange]].
\
&lt;h3&gt;{{{&lt;&lt;removeaudiogroup&gt;&gt;}}}&lt;/h3&gt;\
This macro will delete a track group, which was previously set with {{{&lt;&lt;createaudiogroup&gt;&gt;}}}, by targeting the ID of the group. As with the latter macro, it will not accept the following IDs: {{{:all}}}, {{{:looped}}}, {{{:muted}}}, {{{:not}}}, {{{:paused}}}, {{{:playing}}}.
{{{
        &lt;&lt;removeaudiogroup &quot;:space&quot;&gt;&gt;
}}}
\
&lt;h3&gt;{{{&lt;&lt;removeplaylist&gt;&gt;}}}&lt;/h3&gt;\
This macro will delete a playlist, which was previously set with {{{&lt;&lt;createplaylist&gt;&gt;}}}, by targeting the ID of the playlist.
{{{
        &lt;&lt;removeplaylist &quot;playlist&quot;&gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Audio Macros Menu|Macro-Audio]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="99" name="Macro-Conv" tags="chapter menu" position="1700,1100" size="200,100">&lt;h1&gt;Macros of Convenience&lt;/h1&gt;
Whether for a more convinent way to format code and passages, send players to a specific part of the story, or include more JavaScript in the story, SugarCube has a handful of very convenient macros. 

* [[An Alternative to Conditional Statements|Macro-Switch]] 
* [[Removing Blank Space and Hiding Code|Macro-Nobr-Silent]]
* [[Including a Passage inside another|Macro-Include]] 
* [[Creating and Using a Widget|Macro-Widget]] 
* [[Going Back or Returning to a Passage with a Special Link|Macro-Back-Return]]
** [[Arbitrarily Long Returns|Long-Return-JS]]
* [[Sending the Player to a Passage|Macro-Goto]]
* [[Using JavaScript in the Passage|Macro-Script-Run]]  

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="100" name="Macro-Switch" tags="page" position="1700,1200" size="100,100">&lt;h1&gt;An Alternative to Conditional Statements&lt;/h1&gt;
If you are looking at multiple values from one variable or function, with the conditional statement only looks at one variable/function for the whole block, the {{{&lt;&lt;switch&gt;&gt;}}} macro might be a useful alternative to the {{{&lt;&lt;if&gt;&gt;}}} macro.

The Macro has one argument for the container, and one for the submacro:
* {{{&lt;&lt;switch&gt;&gt;}}}:
** the element whose value you want to check.
* {{{&lt;&lt;case&gt;&gt;}}}
** the value(s) of the element for the particular case.
* {{{&lt;&lt;default&gt;&gt;}}} (optional) does not have an argument, works exactly like {{{&lt;&lt;else&gt;&gt;}}}
\
&gt; //Using a variable://
{{{
    &lt;&lt;switch $dice&gt;&gt;
        &lt;&lt;case 1&gt;&gt;You rolled a 1, this is a critical failure...
        &lt;&lt;case 2&gt;&gt;You rolled a 2, this is a failure.
        &lt;&lt;case 5&gt;&gt;You rolled a 5, this is a success.
        &lt;&lt;case 6&gt;&gt;You rolled a 6, this is a critical success!
        &lt;&lt;default&gt;&gt;You rolled a $dice. Nothing happens.
    &lt;&lt;/switch&gt;&gt;

→ the &lt;&lt;switch&gt;&gt; will look at the value of $dice and display the text depending on the value.
}}}
&gt; //Using a function://
{{{
    &lt;&lt;switch previous()&gt;&gt;
        &lt;&lt;case &quot;Home&quot;&gt;&gt;Leaving your house, you soon arrive at the park.
        &lt;&lt;case &quot;Work&quot;&gt;&gt;Finally done with work, you skip towards the park.
        &lt;&lt;case &quot;Cinema&quot; &quot;Theater&quot;&gt;&gt;Waking up after a boring movie, you sluggishly walk towards the park.
    &lt;&lt;/switch&gt;&gt;

→ here, the macro will look at the name of the previously visited passage, and if this name is either &quot;Home&quot;, &quot;Work&quot; or &quot;Cinema&quot;/&quot;Theater&quot;, it will display the text. For any other case, it will not display anything.
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="101" name="Macro-Nobr-Silent" tags="page" position="1800,1200" size="100,100">&lt;h1&gt;Removing Blank Space and Hiding Code&lt;/h1&gt;
It can be //very// frustrating to code and format a whole passage, only to realise when playing it that unwanted blank space is everywhere. While some of it can be resolved with the [[nobr Markup|Markup-Nobr]], for longer block of text or code, you may want to use the {{{&lt;&lt;nobr&gt;&gt;}}} and {{{&lt;&lt;silently&gt;&gt;}}} macros. 
\
&lt;h3&gt;{{{&lt;&lt;nobr&gt;&gt;}}} or {{{&lt;&lt;silently&gt;&gt;}}}&lt;/h3&gt;\
Both macros will remove any blank space created by the code inside its container, making them quite useful when indenting the code for a clearer read through (especially for complex code).

The main difference between the macros is whether an output is expected within the macro. As in: is there text inside the container that should appear on the screen where the macro is coded?

{{{&lt;&lt;silently&gt;&gt;}}} will run any code inside the macro, but will not print anything on the page (unless you play the game in //Test/Debug// mode). {{{&lt;&lt;nobr&gt;&gt;}}} will run the code inside the macro, as well show any output on the page, without any linebreak (like the [[nobr Markup|Markup-Nobr]]). 
&gt; //An example for// {{{&lt;&lt;nobr&gt;&gt;}}}
{{{
    I&#39;d like a &lt;&lt;nobr&gt;&gt;
        &lt;&lt;if $feeling eq &quot;blue&quot;&gt;&gt;
            blueberry
        &lt;&lt;else&gt;&gt;
            cherry
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/nobr&gt;&gt; pie.

→ will show the result in one line
}}}
&gt; //An example for// {{{&lt;&lt;silently&gt;&gt;}}}
{{{
    &lt;&lt;silently&gt;&gt;
    	You&#39;ll never see any of this! But this code will run...
        &lt;&lt;set _time to &quot;9s&quot;&gt;&gt;
        &lt;&lt;timed _time&gt;&gt;
            &lt;&lt;goto &quot;END&quot;&gt;&gt;
        &lt;&lt;/timed&gt;&gt;
    &lt;&lt;/silently&gt;&gt;

→ will send you to the passage &quot;END&quot; but nothing will appear on the page
}}}
\
&gt; &#39;&#39;Note:&#39;&#39; another method is to enable the [[nobr Config API|Basic-API-Config]], which will remove ALL line breaks inside the project.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="102" name="Macro-Include" tags="page" position="1700,1300" size="100,100">&lt;h1&gt;Including a Passage inside another&lt;/h1&gt;
The {{{&lt;&lt;include&gt;&gt;}}} macro is quite helpful when it comes to including a bit of text or code inside multiple passages, or simple helping organising the content of a passage (especially if it includes quite a bit of code) to avoid unnecessary clutter. It essentially includes the content of a passage inside the one where the macro is coded.

The macro has 2 arguments:
* the passage name 
* the HTML element type (optional) to wrap the included passage (ex: h1, div, p, etc...)
{{{
    &lt;&lt;include &quot;Passage Name&quot;&gt;&gt;
    &lt;&lt;include [[Passage Name]]&gt;&gt; ← will create an arrow in Twine
    &lt;&lt;include &quot;Passage Name&quot; &quot;div&quot;&gt;&gt; ← will wrap the passage in a &#39;div&#39;
    &lt;&lt;include [[Passage Name]] &quot;h1&quot;&gt;&gt; ← will wrap the passage in the largest header 
}}}

You can use {{{&lt;&lt;include&gt;&gt;}}} in any passage you want, even the [[Special Passages|Special-Passage]]! It can be pretty practical for {{{StoryInit}}} if you have a lot of variables or macros to set up and want to organise them.

If an HTML element is included in the macro, that element will also include a class (if you want to edit it with some CSS). That class will be defined after the name of the included passage, only in lowercases, with hyphens {{{-}}} replacing spaces, and removing any punctuation.
So {{{Passage Name}}} will have the class {{{passage-passage-name}}}, or {{{To the Left !}}} will look like {{{passage-to-the-left-}}}.
&gt; &#39;&#39;Note:&#39;&#39; It is not recommended to use punctuation in a passage name.
{{{
    :: Start 
    This is the Start. 
    &lt;&lt;include &quot;Left&quot;&gt;&gt;

    :: Left 
    And now you go left!

→ will appear on the page as:
    This is the Start.
    And now you go left!
}}}
&gt; &#39;&#39;Note:&#39;&#39; unlike the {{{&lt;&lt;widget&gt;&gt;}}} [[macro|Macro-Widget]], {{{&lt;&lt;include&gt;&gt;}}} will add the whole passage called to the page, whether it is one line or a hundred long (space, line breaks and all).

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="103" name="Macro-Widget" tags="page" position="1800,1300" size="100,100">&lt;h1&gt;Creating and Using a Widget&lt;/h1&gt;
Widgets are a pretty practical macro that lets you create &quot;special macros&quot; with basic SugarCube. You can call bits of texts or codes as many times as you want, or create containers to format text, without cluttering the code of the passage. A defined widget can be used as many times as you want inside a project, or even within a passage.
The {{{&lt;&lt;widget&gt;&gt;}}} macro is also useful for: creating shortcuts for pronouns, grouping list of links to appear on multiple passages (e.g. exposition conversation), adding special hovertext of elements (e.g. images, translation), formatting dialogue with character portraits...

For widgets to work they need to be:
* set inside a non-story passage [[tagged|Tags-Built]] with {{{widget}}}
** the passage can have any non-[[Special|Special-Passage]] name.
* called inside another passage:
** the name of the widget wrapped with double arrowheads {{{&lt;&lt;WIDGETNAME&gt;&gt;}}}
\
You can have as many widgets as you want inside one widget-tagged passage. You can also have multiple widget passages (though they should be kept to a minimum).
It is recommended to either wrap the code inside the {{{&lt;&lt;widget&gt;&gt;}}} with [[line-break remover macro|Macro-Nobr-Silent]] or add the {{{nobr}}} [[tag|Tags-Built]] to the widget passage. This will remove any unwanted space.

The macro has 2 arguments:
* the name of the widget, which:
** has to be one word
** is case sensitive
** canot include punctuation 
** cannot start with a number
** cannot have the same name as a Base SugarCube Macro or any custom macro included in your JavaScript
* {{{container}}} (optional), to create a container macro.
{{{
    &lt;&lt;widget &quot;Name&quot; container&gt;&gt;
        /* Your code */
    &lt;&lt;/widget&gt;&gt;
}}}
&gt; //Example://
{{{
    :: Widget [widget]
    &lt;&lt;widget &quot;SimonSays&quot;&gt;&gt;
        &lt;&lt;set _array to [&quot;Raise your hands!&quot;, &quot;Jump!&quot;, &quot;Dance!&quot;]&gt;&gt;
        &lt;&lt;print _array.random()&gt;&gt;
    &lt;&lt;/widget&gt;&gt;

    :: Story Passage 
    &gt; Simon says: &lt;&lt;SimonSays&gt;&gt;
}}}
&gt; Simon says: &lt;&lt;SimonSays&gt;&gt; [ [[Reload|Macro-Widget]] ]
\
&lt;h3&gt;Arguments and Contents&lt;/h3&gt;\
Aside from using basic SugarCube code (or even JavaScript/jQuery inside a {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}} [[macro|Macro-Script-Run]]), widgets allows the use of exta arguments when called, as well as becoming containers.
This is possible thanks to the special temporary variables: {{{_args[]}}} and {{{_contents}}} 

An argumented widget is used to create more complex but general macros. Arguments can be in the form of base value or variables, and will be stored in an array called {{{_args[]}}} (starting with the position 0).
&gt; //Example://
{{{
    :: Widget [widget]
    &lt;&lt;widget &quot;SimonSpecialSay&quot;&gt;&gt;
        &lt;&lt;if _args[0]&gt;&gt;
            &lt;&lt;print _args[0]&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;SimonSays&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/widget&gt;&gt;

→ this will check whether an argument has been included when calling the widget, and if so show the content of the argument.

    :: Story Passage
    &gt; Simon says? &lt;&lt;SimonSpecialSay&gt;&gt;
    &gt; Simon says: &lt;&lt;SimonSpecialSay &quot;Fooled you!&quot;&gt;&gt;
}}}
&gt; Simon says: &lt;&lt;SimonSpecialSay&gt;&gt;
&gt; Simon says: &lt;&lt;SimonSpecialSay &quot;Fooled you!&quot;&gt;&gt;

A container widget will create a special &quot;macro&quot;, with an opening and closing brackets that can be wrapped around some text in the main passage to format it in a special way. It uses the variable {{{_contents}}} to link that text with the macro. 
&gt; //Example://
{{{
    :: Widget [widget]
    &lt;&lt;widget &quot;SimonDoes&quot; container&gt;&gt;
        &lt;div class=&quot;simon&quot;&gt;
            &lt;hr class=&quot;before-simon&quot;&gt;
            &lt;p class=&quot;simon-does&quot;&gt;_contents&lt;/p&gt;
        &lt;/div&gt;
    &lt;&lt;/widget&gt;&gt;

    :: StyleSheet [sheet]
    .simon {
        width: 134px;
        margin: auto;
    }
  
    hr.before-simon {
        border-color: darkgreen;
    }
  
    .simon-does {
        text-transform: capitalize;
    }

    :: Story Passage
    &lt;&lt;SimonDoes&gt;&gt;And so he does!&lt;&lt;/SimonDoes&gt;&gt;
}}}
&lt;&lt;SimonDoes&gt;&gt;And so he does!&lt;&lt;/SimonDoes&gt;&gt;
\
It is also possible to combine both types of widgets, making is an argumented container widget.
&gt; //Example from the Documentation://
{{{
    &lt;&lt;widget &quot;say&quot; container&gt;&gt;
        &lt;div class=&quot;say-box&quot;&gt;
            &lt;img class=&quot;say-image&quot; @src=&quot;&#39;images/&#39; + _args[0].toLowerCase() + &#39;.png&#39;&quot;&gt;
            &lt;p class=&quot;say-text&quot;&gt;_contents&lt;/p&gt;
        &lt;/div&gt;
    &lt;&lt;/widget&gt;&gt;

    &lt;&lt;say &quot;Chapel&quot;&gt;&gt;
        Tweego is a pathway to many abilities some consider to be… unnatural.
    &lt;&lt;/say&gt;&gt;
}}}
This code will create a dialogue box ({{{&lt;div&gt;}}}), showing an image ({{{&lt;img&gt;}}}) next to the text ({{{&lt;p&gt;}}}). The url of image is pulled by the argument ({{{images/chapel.png}}}).

Though it should not be abused, you can call a widget inside another widget:
{{{
    &lt;&lt;widget &quot;Test&quot;&gt;&gt;This is a test&lt;&lt;/widget&gt;&gt;

    &lt;&lt;widget &quot;whoops&quot;&gt;&gt;
        &lt;&lt;if $var is 0&gt;&gt;
            &lt;&lt;Test&gt;&gt;
        &lt;&lt;else&gt;&gt;
            This is a bug.
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/widget&gt;&gt;
}}}

&gt; &#39;&#39;Note:&#39;&#39; this macro differs from the {{{&lt;&lt;include&gt;&gt;}}} [[macro|Macro-Include]], in that {{{&lt;&lt;include&gt;&gt;}}} will include the whole passage on the page, while {{{&lt;&lt;widget&gt;&gt;}}} will only call what is defined inside the macro.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="104" name="Macro-Back-Return" tags="page" position="1700,1400" size="100,100">&lt;h1&gt;Going Back or Returning to a Passage with a Special Link&lt;/h1&gt;
Whether it is to return to the story from a codex page, or going back to a certain location, the {{{&lt;&lt;back&gt;&gt;}}} and {{{&lt;&lt;return&gt;&gt;}}} macros create an easy link towards previously visited passages.
&gt; &#39;&#39;Note:&#39;&#39; If the player has not visited the coded passage, they //will// get an error message.
\
Both macros are formatted the same way and only requires 1 argument:
* (optional) the text to display on the page, the passage to send the player, or the image to show
{{{
→ Going back one passage:
    &lt;&lt;back&gt;&gt;
    &lt;&lt;return&gt;&gt;

→ Going back one passage, showing the text &quot;Home&quot; in the link:
    &lt;&lt;back &quot;Home&quot;&gt;&gt;
    &lt;&lt;return &quot;Home&quot;&gt;&gt;

→ Going back to a passage with the Link Markup:
    &lt;&lt;back [[Home]]&gt;&gt;
    &lt;&lt;return [[Going Home|Home]]&gt;&gt;

→ Going back to a passage with an image:
    &lt;&lt;back [img[URL]]&gt;&gt;
    &lt;&lt;return [img[URL][Home]]&gt;&gt;  
}}}
&gt; &#39;&#39;Note:&#39;&#39; Going back one passage is essentiall the same as {{{[[Text|previous()]]}}}, see the {{{previous()}}} [[function|Functions]].
\
&lt;h3&gt;{{{&lt;&lt;back&gt;&gt;}}} or {{{&lt;&lt;return&gt;&gt;}}}?&lt;/h3&gt;\
Though they seem to perfrom the same action (going to a specific passage), the macros behave differently under the hood. The {{{&lt;&lt;back&gt;&gt;}}} macro goes back in the player history, undoing any action made between the current passage and the targeted one. The {{{&lt;&lt;return&gt;&gt;}}} macro goes to the passage by going forward in the player history (like a regular {{{&lt;&lt;link&gt;&gt;}}}), keeping any action performed between the two passages safe.

For example, the player goes to &quot;NPC Codex Page&quot; from the &quot;Tavern&quot; passage. Their history would look like this:
{{{State.history = [&quot;Tavern&quot;, &quot;NPC Codex Page&quot;]}}}
In the Codex page, if the player clicks on the {{{&lt;&lt;return&gt;&gt;}}} macro, the history would look liks this:
{{{State.history = [&quot;Tavern&quot;, &quot;NPC Codex Page&quot;, &quot;Tavern&quot;]}}}
On the other hand, if the player clicks on the {{{&lt;&lt;back&gt;&gt;}}} macro, the history would look like this:
{{{State.history = [&quot;Tavern&quot;]}}}
\
&lt;h3&gt;Using a variable as the targeted passage&lt;/h3&gt;\
If your project includes Codex pages, and you want to send the player back to the story with one easy link, you can use the [[Long Arbitrarily Return|Long-Return-JS]] in combination with the {{{&lt;&lt;back&gt;&gt;}}} or {{{&lt;&lt;return&gt;&gt;}}} macros. Thanks to that code, you can include a variable where the last visited Story Passage is stored.
This method is particularly helpful to avoid neverending loops.
{{{
    &lt;&lt;back [[Return to the Story|$passage]]&gt;&gt;
    &lt;&lt;return [[Return to the Story|$passage]]&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; since Twine automatically creates a new passage when using the {{{[[link]]}}} Markup, you will need to delete the new passage (here {{{$passage}}}) after coding the macros. Otherwise, the player will be sent to a blank page instead of the wanted passage. Or you can use the {{{&lt;&lt;link&gt;&gt;}}} macro instead.
&gt; {{{&lt;&lt;link &quot;Return to the Story&quot; $passage&gt;&gt;&lt;&lt;/link&gt;&gt;}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="105" name="Long-Return-JS" tags="page" position="1800,1400" size="100,100">&lt;h1&gt;Arbitrarily Long Returns&lt;/h1&gt;
While the {{{&lt;&lt;return&gt;&gt;}}} macro or {{{previous()}}} function can be useful in sending the player back to the Story when visiting a Codex or Inventory page, it can also create inescapable loops, making it impossible for the player to go back to the Story. 

This can be solved in different ways:
* Using the {{{&lt;&lt;back&gt;&gt;}}} macro as is or the {{{Engine.backwards()}}} API,
** If multiple non-Story passages are clicked, the player will have to click each //Back// link.
* Creating Popups to display those non-Story passages,
** This will avoid navigating between passages.
* Using the JavaScript code below.
\
&lt;h3&gt;How to Code the Arbitrarily Long Return&lt;/h3&gt;\
The //Arbitrarily Long Return// will record the last Story passage the player visited and store it in a variable, which can then be used inside a link, to send the player back to the Story. We will call here the variable {{{$return}}}.

The code also requires something to differenciate Story and non-Story passages: a tag. We will calle it here {{{noreturn}}}. 

When all your non-Story passages are tagged correctly, add this code in your JavaScript passage:
{{{
    $(document).on(&#39;:passagestart&#39;, function (ev) {
        if (!ev.passage.tags.includes(&#39;noreturn&#39;)) {
            State.variables.return = ev.passage.title;
        }
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; you may change the name of the variable or the tag, if you prefer another name for either.
&gt; If you want to use multiple tags instead of one, change {{{!ev.passage.tags.includes(&#39;one-tag&#39;)}}} into {{{!ev.passage.tags.includesAny(&#39;one-tag two-tags&#39;)}}}.

When this is set, you can add your links in the non-Story passages to send the player back to the Story:
* {{{[[Return|$return]]}}}
* {{{&lt;&lt;link &quot;Return&quot; $return&gt;&gt;&lt;&lt;/link&gt;&gt;}}}
* {{{&lt;&lt;return $return&gt;&gt;}}} / {{{&lt;&lt;return [[Return|$return]]&gt;&gt;}}}
* {{{&lt;&lt;back $return&gt;&gt;}}} / {{{&lt;&lt;back [[Return|$return]]&gt;&gt;}}}
&gt; &#39;&#39;Note:&#39;&#39; since Twine automatically creates a new passage when using the {{{[[link]]}}} Markup, you will need to delete the new passage (here {{{$passage}}}) after coding the macros. Otherwise, the player will be sent to a blank page instead of the wanted passage. Or you can use the {{{&lt;&lt;link&gt;&gt;}}} macro instead.
\
&lt;h3&gt;A Note on Navigating to a Previous Passage&lt;/h3&gt;\
Navigating back to a previously visited passage can be problematic, especially when code could run into issues when re-executing the content of the passage. Code may have some side-effect, like changing the value of a variable, or printing a different text on the page (ex: using the [[-visited() functions|Function-Pass-Tag]] to display variation). 

This can be avoided if you:
* ensure the passages contain no code with side effect,
* wrap the code in something to prevent re-execution,
** ex: {{{&lt;if visited() is 1&gt;&gt;only show on the first view&lt;&lt;/if&gt;&gt;}}}
* use the code above with {{{&lt;&lt;back&gt;&gt;}}} macro to send the player back to the passage, erasing the record of visiting the non-Story passages,
** ex: {{{&lt;&lt;back $return&gt;&gt;}}} / {{{&lt;&lt;back [[Return|$return]]&gt;&gt;}}}
* move the non-Story passages into a PopUp with the Dialog API.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="106" name="Macro-Goto" tags="page" position="1700,1500" size="100,100">&lt;h1&gt;Sending the Player to a Passage&lt;/h1&gt;
The [[Link Markup|Markup-Link]] and {{{&lt;&lt;link&gt;&gt;}}} [[macro|Macro-Link]] are not the only macros to send the player to a specific passage. You also have {{{&lt;&lt;goto&gt;&gt;}}}.
While it should not be overused, as it adds to the player history, and is alreayd included as an argument in the {{{&lt;&lt;link&gt;&gt;}}} macro, there are situations where {{{&lt;&lt;goto&gt;&gt;}}} is necessary. Like the destination of the next passage being conditional.
&gt; &#39;&#39;Note:&#39;&#39; using {{{&lt;&lt;goto&gt;&gt;}}} outside of a macro (like a {{{&lt;&lt;link&gt;&gt;}}}, {{{&lt;&lt;button&gt;&gt;}}}, or {{{&lt;&lt;timed&gt;&gt;}}}) will send the player to that passage without loading the previous passage completely. Both the incomplete and new passage will be included in the player&#39;s visited passages.

The macro has 1 argument:
* the name of the wanted passage, variable or function
{{{
    &lt;&lt;goto &quot;PassageName&quot;&gt;&gt;
    &lt;&lt;goto [[PassageName]]&gt;&gt; ← will create an arrow in Twine
    &lt;&lt;goto $passage&gt;&gt;
    &lt;&lt;goto [[$passage]]&gt;&gt;
    &lt;&lt;goto `previous()`&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; on Twine, using the Link Markup with the variable will automatically create a passage. When using the variable or function, don&#39;t forget to remove that newly created passage.
\
&gt; //Some example of uses://
{{{
    &lt;&lt;link &quot;Attack!&quot;&gt;&gt;
        &lt;&lt;if $attack gt 5&gt;&gt;
            &lt;&lt;goto &quot;Success&quot;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;goto &quot;Failure&quot;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/link&gt;&gt;

    &lt;&lt;timed 3s&gt;&gt;
        &lt;&lt;goto &quot;No Action&quot;&gt;&gt;
    &lt;&lt;/timed&gt;&gt;
}}}
\
&gt; &#39;&#39;Note:&#39;&#39; in some instances, it is preferrable to use the [[Navigation Override|Basic-Config-Navig]] instead of {{{&lt;&lt;goto&gt;&gt;}}}.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="107" name="Macro-Script-Run" tags="page" position="1800,1500" size="100,100">&lt;h1&gt;Using JavaScript in the Passage&lt;/h1&gt;
While you can add JavaScript or jQuery code inside the JavaScript tab, it is sometimes necessary to include it directly inside the passage. This can be done inside the {{{&lt;&lt;script&gt;&gt;}}} or the {{{&lt;&lt;run&gt;&gt;}}} macro.

While both macros will run code, {{{&lt;&lt;run&gt;&gt;}}} is usually used for one-line type of codes (e.g. calling SugarCube [[APIs|Basic-API]], functions defined in the JavaScript tab, etc..), while {{{&lt;&lt;script&gt;&gt;}}} is more fitted for longer and more complex code.
&gt; &#39;&#39;Note:&#39;&#39; some knowledge of JavaScript/jQuery is necessary to have, especially if the code runs into issues.

If added as is on the page, the code will triggers as soon at the passage is loaded. But it can also be included inside a {{{&lt;&lt;link&gt;&gt;}}} macro, or triggered at a later time with the {{{&lt;&lt;timed&gt;&gt;}}} macro.
{{{
    &lt;&lt;script&gt;&gt;
        /*Your JavaScript/jQuery code*/
    &lt;&lt;/script&gt;&gt;

    &lt;&lt;script&gt;&gt;
        setup.Hi = function (name) {
            if (name == undefined) {
                return &quot;Hi.&quot;;
            } else {
                return &quot;Hi, &quot; + name + &quot;.&quot;;
            }
        };
    &lt;&lt;/script&gt;&gt;

    &lt;&lt;run $(document.body).append(&#39;&lt;div id=&quot;report-down&quot;&gt;&lt;/div&gt;&#39;).find(&#39;#report-down&#39;)&gt;&gt;
    &lt;&lt;run setup.ScrollDown()&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; when using the {{{&lt;&lt;script&gt;&gt;}}} macro with {{{&lt;&lt;nobr&gt;&gt;}}}, the latter macro will transform the code into one line. If comments are included with backslash {{{//}}}, it will render the rest of the code unuseable. {{{/* Comments */}}} is prefered in this case.
\
&gt; &#39;&#39;Note:&#39;&#39; the {{{&lt;&lt;script&gt;&gt;}}} macro has the same use as the {{{&lt;script&gt;}}} HTML markup, though the latter will only work inside the {{{StoryInterface}}} passage.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Convenient Macro Menu|Macro-Conv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="108" name="Markup-Int" tags="chapter menu" position="800,1100" size="200,100">&lt;h1&gt;More SugarCube Markup&lt;/h1&gt;
While [[Markup]] can help format text on the screen, display an image or create a link, it can also be useful in affecting HTML elements on the page (like stats bars), or display small variation (like pronouns).

* [[Special Attributes and Directives|Markup-Attribute]] 
* [[Displaying Code and Verbatim Text|Markup-Code-Verbatim]] 
* [[Display Small Variation with Templates|Markup-Template]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="109" name="Markup-Attribute" tags="page" position="800,1200" size="100,100">&lt;h1&gt;Special Attributes and Directives&lt;/h1&gt;
While macros allow for interaction or affect elements on the page, it is also possible to link variables or passages directly to HTML elements, and enable special behaviour unatainable with built-in macros.
\
&lt;h3&gt;Special Attributes&lt;/h3&gt;\
SugarCube provides some special HTML attributes to enable special behaviour from HTML elements. There are two main ones: {{{data-passage}}} and {{{data-setter}}}. While the latter will set a variable to a value (like {{{&lt;&lt;set&gt;&gt;}}}), the former will behave differently depending on the element (i.e. create a link towards a passage or display the content of the passage).
\
&lt;h4&gt;{{{data-setter}}}&lt;/h4&gt;\
The {{{data-setter}}} attribute can be added to interactive elements like a link ({{{&lt;a&gt;}}}), a button ({{{&lt;button&gt;}}}) or an area inside a clickable image ({{{&lt;area&gt;}}}). It will set any SugarCube variable to a wanted value:
{{{
    data-setter=&quot;$var to &#39;value&#39;&quot;
}}}
&gt; &#39;&#39;Note:&#39;&#39; be mindful when using quotes/apostrophes, or the attribute will not work!
{{{
    &lt;a data-passage=&quot;Passage&quot; data-setter=&quot;$checked to true&quot;&gt;Check the Room&lt;/a&gt;

    &lt;button data-passage=&quot;Passage&quot; data-setter=&quot;$thing to &#39;done&#39;&quot;&gt;Do the thing&lt;/button&gt;

    &lt;area shape=&quot;rect&quot; coords=&quot;25,25,75,75&quot; data-passage=&quot;Passage&quot;
	data-setter=&quot;$treasure to &#39;empty&#39;&quot;&gt;
}}}
\
&lt;h4&gt;{{{data-passage}}}&lt;/h4&gt;\
The {{{data-passage}}} will link a passage to an element, creating either a link between passages (like a {{{&lt;&lt;link&gt;&gt;}}}), displaying images or videos, or playing audio. 
    
Using {{{data-passage}}} to create a link between passages can be used for elements such as a link ({{{&lt;a&gt;}}}), a button ({{{&lt;button&gt;}}}) or an area inside a clickable image ({{{&lt;area&gt;}}}). It is most useful for map images, or custom elements to hide a link.
{{{
    &lt;a data-passage=&quot;PassageName&quot;&gt;Do the thing&lt;/a&gt;

    &lt;button data-passage=&quot;PassageName&quot;&gt;Do the thing&lt;/button&gt;

    &lt;area shape=&quot;rect&quot; coords=&quot;25,25,75,75&quot; data-passage=&quot;PassageName&quot;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; This method will not create an arrow between passages on the Twine app.

As for multi-media elements, such as {{{&lt;audio&gt;}}}, {{{&lt;img&gt;}}}, {{{&lt;source&gt;}}} or {{{&lt;video&gt;}}}, {{{data-passage}}} will become the link between the element and the asset to use in the passage. These can be helpful when wanting to include external online assets.
&gt; &#39;&#39;Note:&#39;&#39; this should be used in combination with the [[Asset Passage Tags|Tags-Asset]]
{{{
    &lt;audio data-passage=&quot;AudioPassageName&quot;&gt;

    &lt;img data-passage=&quot;ImagePassageName&quot;&gt;

    &lt;source data-passage=&quot;AudioOrVideoPassageName&quot;&gt;

    &lt;video data-passage=&quot;VideoPassageName&quot;&gt;
}}}
\
&lt;h3&gt;Attribute Directive&lt;/h3&gt;\
SugarCube also allows variables to affect the class or id of an element, how they are styled, or even how they behave. It can be used for any attribute of an element, except for {{{data-setter}}}.

It is particularly useful when wanting to use HTML interactive element not included in SugarCube (e.g. slider in passage), creating stat bars without diving into JavaScript code, or formatting an element depending on the state of the game.

The directives can be coded two ways: {{{sc-eval:}}} or {{{@}}} before the relevant attribute.
Assuming that {{{_id = &quot;foo&quot;}}}:
{{{
    &lt;span sc-eval:id=&quot;_id&quot;&gt;…&lt;/span&gt;
    &lt;span @id=&quot;_id&quot;&gt;…&lt;/span&gt;

→ will work the same as:
    &lt;span id=&quot;foo&quot;&gt;…&lt;/span&gt;
}}}
Assuming that {{{$stat = 45}}}
{{{
    &lt;progress @value=&quot;$stat&quot; max=&quot;100&quot;&gt;&lt;/progress&gt;
→ will display a simple stats bar
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup-Int]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="110" name="Markup-Code-Verbatim" tags="page" position="900,1200" size="100,100">&lt;h1&gt;Displaying Code and Verbatim Text&lt;/h1&gt;
This page might not be the most useful for game projects, as it involve displaying code or text without formatting. However, for projects like this guide, the markup below will prove quite helpful.

To do so, you can follow the Code Markup, with triple curvy brakets {{{ { } }}}, or the Verbatim Markup with triple quotes {{{ &quot; &quot; }}}. The difference between the markups will be on how it is translated into HTML.

The Code Markup will take two forms: an in-line one (HTML: {{{&lt;code&gt;&lt;/code&gt;}}}) and a block one (HTML: {{{&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;}}}). This guide has displayed both form with the different coloured blocks elements when showcasing code examples.
&gt; //In-Line Code//:
{{{
    {{{&lt;&lt;set $var to true&gt;&gt;}}}

→ will be rended into:

    &lt;code&gt;&lt;&lt;set $var to true&gt;&gt;&lt;/code&gt;
}}}
&gt; //Block Code//:
{{{
    {{{
        &lt;&lt;set $var to true&gt;&gt;
    }}}

→ will be rended into:

    &lt;pre&gt;&lt;code&gt;&lt;&lt;set $var to true&gt;&gt;&lt;/code&gt;&lt;/pre&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; there should not be any space after the opening bracket or before the closing bracket. Othewise the code will be displayed as //in-line//. 

The Verbatim Markup will require triple quotes {{{ &quot; &quot; }}} (HTML: {{{&lt;nowiki&gt;&lt;/nowiki&gt;}}})
{{{
    &quot;&quot;&quot;No //format//&quot;&quot;&quot;

→ will be rended into:
    &lt;nowiki&gt;No //format//&lt;/nowiki&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup-Int]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="111" name="Markup-Template" tags="page" position="800,1300" size="100,100">&lt;h1&gt;Display Small Variation with Templates&lt;/h1&gt;
The Template makrup is essentially a text replacement code that will display small variation (usually of one word). It works in combination with the [[Template API|TemplateAPI]], where the variation is defined. It is most useful for displaying pronouns, especially pronoun sets defined before player input.
&gt; &#39;&#39;Note:&#39;&#39; For an example of Pronoun Template, see [[Chapel&#39;s Macro|https://github.com/ChapelR/custom-macros-for-sugarcube-2/blob/master/docs/pronoun-templates.md]] or [[HiEv&#39;s Widget|https://hiev-heavy-ind.com/Sample_Code/Sample_Code.html#Pronoun%20Templates]]. 

The markup is set with a question mark {{{?}}} before the defined template name ({{{?this}}}). If a Template has been defined in JavaScript, the code will look for any template markup on the page, and display the relevant element on the screen.
&gt; &#39;&#39;Note:&#39;&#39; if the API is not set or the element is not defined in the Template, the markup will display the text as is, like {{{?this}}.}

Assuming that the template sets {{{?He}}} into //She// and {{{?his}}} into //her://
{{{
    ?He was always willing to lend ?his ear to anyone.
→ will be rended into:
    She was always willing to lend her ear to anyone.
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Markup Menu|Markup-Int]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="112" name="Methods" tags="chapter menu" position="2600,1100" size="200,100">&lt;h1&gt;Using Methods to change Variables&lt;/h1&gt;
Methods are [[functions|Functions]], JavaScript blocks of code designed to do a specific task, linked to a reciever, like a variable, to run.
{{{
    &lt;reciever&gt;.method()
Example:
    $var.first()
}}}

In SugarCube, they are mainly used to handle arrays, change the formatting of strings values, or handle numbers.
* [[Methods and String Variables|Method-String]]
* [[Methods and Numbers|Method-Number]]
* [[Methods and Arrays|Method-Array]] (long!)
&gt; &#39;&#39;Note:&#39;&#39; Other native JavaScript or jQuery methods can be used with SugarCube, but requires knowledge of those languages. The ones listed in this guide would be the most useful.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="113" name="Method-String" tags="page" position="2600,1300" size="100,100">&lt;h1&gt;Methods and String Variables&lt;/h1&gt;
The methods below are mainly useful to change the formatting of string variables, or see if certain characters are included in the strings. With the methods below, the code will look at a string as if it was an array of character (including space and punctuation), with the first having the position 0.
\
&lt;h3&gt;Changing the Formatting of Strings.&lt;/h3&gt;\
Whether to change the string to its upper or lowercase version, or just tranform the frist character, you would need to use one of the following methods: {{{.toLowerCase()}}}/{{{.toLocaleLowerCase()}}}, {{{.toUpperCase()}}}/{{{.toLocaleUpperCase()}}}, {{{.toUpperFirst()}}}/{{{.toLocaleUpperFirst()}}}
&gt; &#39;&#39;Note:&#39;&#39; the {{{.toLocale-()}}} method transforms the string in accordance to the user&#39;s language and region in their device.
Assuming that {{{$jane = &quot;jane&quot;}}} and {{{$john = &quot;John&quot;}}} 
{{{
    &lt;&lt;print $jane.toUpperFirst()&gt;&gt; → Jane
    &lt;&lt;print $jane.toUpperCase()&gt;&gt;  → JANE
    &lt;&lt;print $john.toLowerCase()&gt;&gt;  → john
}}}
You can also save this information into a variable or use them in conditional statements:
{{{
    &lt;&lt;set $name to $jane.toUpperFirst()&gt;&gt;
→ $name will have the value &quot;Jane&quot;

    &lt;&lt;if $john.toLowerCase() is &quot;john&quot;&gt;&gt;...&lt;&lt;/if&gt;&gt;
}}}
\
&lt;h3&gt;Get the First or Last Character of a String&lt;/h3&gt;\
To find the first or last character of a string variable, you would need to use respectively {{{.first()}}} and {{{.last()}}}. Assuming that {{{$var = &quot;Hello, World :D&quot;}}}:
{{{
    &lt;&lt;print $var.first()&gt;&gt; → H
    &lt;&lt;print $var.last()&gt;&gt;  → D
}}}
\
&lt;h3&gt;Find if or how many times a Substring is included in a String Variable&lt;/h3&gt;\
Similarly to [[arrays|Method-Array]], to find if a substring is included in a variable, you would need to use {{{.includes()}}}. With this method, you can do a wide search, or start it at a certain number. Assuming that {{{$var = &quot;Hello, World :D&quot;}}}:
{{{
    &lt;&lt;if $var.includes(&#39;lo&#39;)&gt;&gt;.this will show.&lt;&lt;/if&gt;&gt;
    &lt;&lt;if $var.includes(&#39;lo&#39;, 2)&gt;&gt;.this won&#39;t show.&lt;&lt;/if&gt;&gt;
    &lt;&lt;if $var.includes(&#39;lo&#39;, 6)&gt;&gt;.this won&#39;t show.&lt;&lt;/if&gt;&gt;
    &lt;&lt;if $var.includes(&#39;love&#39;)&gt;&gt;.this won&#39;t show either.&lt;&lt;/if&gt;&gt;
}}}
On the other hand, {{{.count()}}} will look at how many times a substring is included in a variable. Assuming that {{{$var = &quot;Hello, World :D&quot;}}}:
{{{
    &lt;&lt;print $var.count(&#39;l&#39;)&gt;&gt; → 3
    &lt;&lt;print $var.count(&#39;l&#39;, 5)&gt;&gt; → 1
}}}
&gt; &#39;&#39;Note:&#39;&#39; the method cannot be left empty. If you are looking to check the length of a string, you should use {{{.length}}} instead.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Methods Menu|Methods]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="114" name="Method-Number" tags="page" position="2700,1200" size="100,100">&lt;h1&gt;Methods and Numbers&lt;/h1&gt;
Mathematical methods can be quite useful in a project, especially when dealing with player statistics and stat bars, to ensure a value does not exceed or go below a certain range.
\
&lt;h3&gt;{{{Math.round()}}} &lt;/h3&gt;\
This method will round the numerical value of a variable or equation to the nearest full number. It is most useful when wanting to keep the results of statistic calculations to a round value.
{{{
    Math.round(value)
    Math.round(5.5)  → 6
    Math.round(-5.5) → -5
}}}
&gt; &#39;&#39;Note:&#39;&#39; this method is native to [[JavaScript|https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/round]].

While the use of this method can be as simple as rounding the value of a variable, you can use it for more complex equations:
{{{
    &lt;&lt;set $stoic to Math.round($stoic)&gt;&gt;
→ will round the value of the value of $stoic to the nearest full number.

    &lt;&lt;set $stoic to Math.round( $stoic + ( ( 100 - $stoic ) * ( _increase / 100 ) ) )&gt;&gt;
→ will increase the value of $stoic by a percentage set by _increase, then round it to the nearest number.
}}}
&gt; &#39;&#39;Note:&#39;&#39; This last calculation is a recreation of the ChoiceScript Fairmath system.
\
&lt;h3&gt;{{{Math.trunc()}}}&lt;/h3&gt;\
This method will remove any decimal from the value.
{{{
    Math.trunc(value)
    Math.trunc(5.5)    → 5
    Math.trunc(12.678) → 12
}}}
&gt; &#39;&#39;Note:&#39;&#39; this method is native to [[JavaScript|https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/trunc]].
\
&lt;h3&gt;{{{Math.clamp()}}}&lt;/h3&gt;\
This method will check whether the value is within a set range, and calculate a new value within the bounds. It is most useful when when wanting to ensure the value of a variable stays between bounds (ex: a stat not going above 100% or lower than 0%).
{{{
    Math.clamp(value, min, max)
    Math.clamp($var, 6, 300)
}}}
The method alone will not change the value of a variable, this needs to be done with a {{{&lt;&lt;set&gt;&gt;}}} macro:
{{{
    &lt;&lt;set $stoic to Math.clamp($stoic, 0, 100)&gt;&gt;
    &lt;&lt;set $stoic to Math.clamp(($stoic + 4) * 5, 0, 100)&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; for simple clamping without further calculation, this can also be done with {{{&lt;Number&gt;.clamp()}}}, {{{&lt;&lt;set $stoic to $stoic.clamp(0, 100)&gt;&gt;}}}.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Methods Menu|Methods]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="115" name="Method-Array" tags="page" position="2600,1200" size="100,100">&lt;h1&gt;Methods and Arrays&lt;/h1&gt;
Arrays are where the methods are the most useful, as they are the main way to edit them or check its content. These methods can be used with the {{{&lt;&lt;set&gt;&gt;}}}/{{{&lt;&lt;run&gt;&gt;}}} macros, or in conditional statements.
&gt; &#39;&#39;Note:&#39;&#39; These methods do not need to be attached to a variable, they can be attached to a non-saved array (see the {{{&lt;Array&gt;.includes()}}} examples).
\
&lt;h2&gt;Add elements to an array&lt;/h2&gt;\
There are multiple ways to add elements to an array, but the methods listed below will do so differently.
The examples below will assume that {{{_array = [&#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;]}}} and {{{_array2 = [1, 2, 3]}}}
&lt;h4&gt;{{{&lt;Array&gt;.concat()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.concat()}}} will merge other arrays or lists of values to the original array, with the new values added at the end of the orginal array:
{{{
    _array.concat(value/variable)
}}}
{{{
    _array.concat(_array2) 
        → [&#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, 1, 2, 3]

    _array.concat(_array2, &#39;words&#39;)
        → [&#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, 1, 2, 3, &#39;words&#39;]

    _array.concat(&#39;words&#39;)
        → [&#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, &#39;words&#39;]
}}}
As the method will not edit the original variable, you would need to use the {{{&lt;&lt;set&gt;&gt;}}} macro for the change the stay constant:
{{{&lt;&lt;set _array to _array.concat(_array2)&gt;&gt;}}}
&gt; &#39;&#39;Note:&#39;&#39; if you want to only include new values to the array, you would need to use {{{&lt;Array&gt;.concatUnique()}}}
&lt;h4&gt;{{{&lt;Array&gt;.push()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.push()}}} will add values to the original array, with the new values to be added at the end of the orignal array:
{{{
    _array.push(value/variable)
}}}
{{{
    _array.push(_array2)
        → [&#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, 1, 2, 3]

    _array.push(_array2, &#39;words&#39;)
        → [&#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, 1, 2, 3, &#39;words&#39;]

    _array.push(&#39;words&#39;)
        → [&#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, &#39;words&#39;]
}}}
The method can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.push(_array2)&gt;&gt;
    &lt;&lt;set _array.push(_array2)&gt;&gt;
    &lt;&lt;run _array.push(_array2)&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you want to only include new values to the array, you would need to use {{{&lt;Array&gt;.pushUnique()}}}
&lt;h4&gt;{{{&lt;Array&gt;.unshift()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.unshift()}}} will add values to the original array, with the new values to be added at the &#39;&#39;beginning&#39;&#39; of the orignal array:
{{{
    _array.unshift(value/variable)
}}}
{{{
    _array.unshift(_array2)
        → [1, 2, 3, &#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;]

    _array.unshift(_array2, &#39;words&#39;)
        → [1, 2, 3, &#39;words&#39;, &#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;]

    _array.unshift(&#39;words&#39;)
        → [&#39;words&#39;, &#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;]
}}}
The method can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.unshift(_array2)&gt;&gt;
    &lt;&lt;set _array.unshift(_array2)&gt;&gt;
    &lt;&lt;run _array.unshift(_array2)&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you want to only include new values to the array, you would need to use {{{&lt;Array&gt;.unshiftUnique()}}}
\
&lt;h3&gt;Remove elements from an array&lt;/h3&gt;\
There are multiple ways to remove elements from an array, but the methods listed below will do so differently.
The examples below will assume that {{{_array = [&#39;Apple&#39;, &#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, 1, 2, 3]}}} and {{{_array2 = [1, 2, 3]}}}
\
&lt;h4&gt;{{{&lt;Array&gt;.delete()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.delete()}}} will remove any instance of the targeted value.
{{{
    _array.delete(value/variable)
}}}
{{{
    _array.delete(_array2)
        → [&#39;Apple&#39;, &#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;]
    _array.delete(_array2, &#39;Apple&#39;)
        → [&#39;Potatoe&#39;, &#39;Sausage&#39;]
    _array.delete(&#39;Apple&#39;)
        → [&#39;Potatoe&#39;, &#39;Sausage&#39;, 1, 2, 3]
}}}
The method can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.delete(_array2)&gt;&gt;
    &lt;&lt;set _array.delete(_array2)&gt;&gt;
    &lt;&lt;run _array.delete(_array2)&gt;&gt;
}}}
&lt;h4&gt;{{{&lt;Array&gt;.deleteAt()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.deleteAt()}}} will work similarly to the previous method, but will target the element at a certain position in the array.
&gt; &#39;&#39;Note:&#39;&#39; the first element in an array starts at 0.
&gt; You can use an array filled with numbers instead of of multiple values.
{{{
    _array.deleteAt(value/variable)
}}}
{{{
    _array.deleteAt(_array2)
        → [&#39;Apple&#39;, 1, 2, 3]
    _array.deleteAt(0, _array2)
        → [1, 2, 3]
    _array.deleteAt(6)
        → [&#39;Apple&#39;, &#39;Apple&#39;, &#39;Potatoe&#39;, &#39;Sausage&#39;, 1, 2,]
}}}
The method can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.deleteAt(_array2)&gt;&gt;
    &lt;&lt;set _array.deleteAt(_array2)&gt;&gt;
    &lt;&lt;run _array.deleteAt(_array2)&gt;&gt;
}}}
&lt;h4&gt;{{{&lt;Array&gt;.pluck()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.pluck()}}} and {{{&lt;Array&gt;.pluckMany()}}} are two methods what will respectively remove an element/multiple elements from the array in a random manner.
&gt; &#39;&#39;Note:&#39;&#39; for {{{&lt;Array&gt;.pluckMany()}}}, you can use an integer variable to indicate the number of elements you want to remove.
{{{
    _array.pluck()
    _array.pluckMany(number/variable)
}}}
{{{
    _array.pluckMany(3)
    _array.pluckMany(_var)
}}}
These methods can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.pluck(_array2)&gt;&gt;
    &lt;&lt;set _array.pluckMany(_array2)&gt;&gt;
    &lt;&lt;run _array.pluck(_array2)&gt;&gt;
}}}
&lt;h4&gt;{{{&lt;Array&gt;.pop()}}} and {{{&lt;Array&gt;.shift()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.pop()}}} and {{{&lt;Array&gt;.shift()}}} will remove respectively the last and first element in an array.
{{{
    _array.pop()
→ will remove the element &quot;3&quot; from the array

    _array.shift()
→ will remove the element &quot;Apple&quot; from the array
}}}
These methods can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.pluck(_array2)&gt;&gt;
    &lt;&lt;set _array.pluckMany(_array2)&gt;&gt;
    &lt;&lt;run _array.pluck(_array2)&gt;&gt;
}}}
\
&lt;h3&gt;Check the properties of an array&lt;/h3&gt;\
There are multiple ways to check the properties of an array. Depending on what you are looking for, you may find one method working better than another. 
&lt;h4&gt;{{{&lt;Array&gt;.includes()}}} and its alternatives&lt;/h4&gt;\
{{{&lt;Array&gt;.includes()}}} will check whether an element is included in the array. It also comes in two other flavours: {{{&lt;Array&gt;.includesAll()}}}, which will check if all listed elements are included in an array, and {{{&lt;Array&gt;.includesAny()}}}, which will check whether one of the elements listed is included in an array.
{{{
    &lt;Array&gt;.includes(value, position)
    &lt;Array&gt;.includesAll(value/variable)
    &lt;Array&gt;.includesAny(value/variable)
}}}
&gt; &#39;&#39;Note:&#39;&#39; the {{{position}}} parameter of {{{&lt;Array&gt;.includes()}}} will start the search for the wanted element starting that position in the array.
\
The method is best used in conditional statements:
{{{
    &lt;&lt;if _array.includes(&quot;Apple&quot;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ since the array has the element &quot;Apple&quot;, it will run the content
    &lt;&lt;if _array.includes(&quot;Apple&quot;, 3)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ this won&#39;t run, since the elements &quot;Apple&quot; are in positions 0 and 1

    &lt;&lt;if _array.includesAll(_array2, &quot;Apple&quot;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ since the array has those elements, it will run the content
    &lt;&lt;if _array.includesAll(_array2, 4)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ won&#39;t run, since the array does not have the element 4

    &lt;&lt;if _array.includesAny(_array2, &quot;Apple&quot;)&gt;&gt;...&lt;&lt;/if&gt;&gt;
    &lt;&lt;if _array.includesAny(_array2, 4)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ since the array has those elements, it will run the content

Using a non-variable array as the receiver:
    &lt;&lt;if [&quot;John&quot;, &quot;Jane&quot;, &quot;Sylvia&quot;].includes($var)&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ if the value of the variable is included in this array, the code will run.
}}}
&gt; &#39;&#39;Note:&#39;&#39; this last example can be useful to block certain names from being used by the player when setting their character.
\
&lt;h4&gt;{{{&lt;Array&gt;.first()}}} and {{{&lt;Array&gt;.last()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.first()}}} and {{{&lt;Array&gt;.last()}}} will return respectively the element in the first and last position in the array.
{{{
    &lt;Array&gt;.first()
    &lt;Array&gt;.last()
}}}
Among other, they can be used in conditional statements or setting another variable:
{{{
    &lt;&lt;if _array.first() is &quot;Apple&quot;&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ this will run, since the first element of the array is &quot;Apple&quot;
    &lt;&lt;if _array.first() is 1&gt;&gt;...&lt;&lt;/if&gt;&gt;
→ this won&#39;t run

    &lt;&lt;set $var to _array.last()&gt;&gt;
→ the value of $var will be &quot;3&quot;
}}}
&lt;h4&gt;{{{&lt;Array&gt;.count()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.count()}}} will check how many times an element is included in the array. You can indicate a {{{position}}} to start the search at said position in the array
{{{
    &lt;Array&gt;.count(value, position)
}}}
{{{
    _array.count(&quot;Apple&quot;)    → 2
    _array.count(&quot;Apple&quot;, 4) → 0
→ the elements &#39;Apple&#39; are at position 0 and 1
}}}
&gt; &#39;&#39;Note:&#39;&#39; the method cannot be left empty. If you are looking to check the length of an array, you should use {{{.length}}} instead.
\ 
&lt;h3&gt;Other Array Methods&lt;/h3&gt;\
There are handful of other methods one can use with arrays.
&lt;h4&gt;{{{&lt;Array&gt;.random()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.random()}}} will take a value from the array at random (but not modify the orignal array), and {{{&lt;Array&gt;.randomMany()}}} will do the same thing but take as many as indicated:
{{{
    &lt;Array&gt;.random()
    &lt;Array&gt;.randomMany(number)
}}}
&gt; &#39;&#39;Note:&#39;&#39; it words similarly to the [[function|Function-Clone-Random]] {{{either()}}}.
You can use these methods in conditional statements, to set variable, or simply print on the screen:
{{{
    &lt;&lt;set $var to _array.random()&gt;&gt;
    &lt;&lt;= _array.randomMany(3)&gt;&gt;
    &lt;&lt;if _array.random() is &quot;Apple&quot;&gt;&gt;...&lt;&lt;/if&gt;&gt;
}}}
&lt;h4&gt;{{{&lt;Array&gt;.shuffle()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.shuffle()}}} wiill shuffle the order of the values in the array, at random.
{{{
    _array.shuffle()
}}}
The method can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.shuffle()&gt;&gt;
    &lt;&lt;set _array.shuffle()&gt;&gt;
    &lt;&lt;run _array.shuffle()&gt;&gt;
}}}
&lt;h4&gt;{{{&lt;Array&gt;.flat()}}}&lt;/h4&gt;\
{{{&lt;Array&gt;.flat()}}} will flatten an array containing sub-arrays.
{{{
    &lt;Array&gt;.flat(depth)
}}}
&gt; &#39;&#39;Note:&#39;&#39; the {{{depth}}} parameter is optional, if omitted, it will default to 1.
Assuming that {{{_array3 = [[&quot;Alfa&quot;, &quot;Bravo&quot;], [[&quot;Charlie&quot;, &quot;Delta&quot;], [&quot;Echo&quot;]], &quot;Foxtrot&quot;]}}}
{{{
    _array.flat()   → [&quot;Alfa&quot;, &quot;Bravo&quot;, [&quot;Charlie&quot;, &quot;Delta&quot;], [&quot;Echo&quot;], &quot;Foxtrot&quot;]
    _array.flat(2)  → [&quot;Alfa&quot;, &quot;Bravo&quot;, &quot;Charlie&quot;, &quot;Delta&quot;, &quot;Echo&quot;, &quot;Foxtrot&quot;]
}}}
The method can be run on either the {{{&lt;&lt;set&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} macros.
{{{
    &lt;&lt;set _array to _array.flat()&gt;&gt;
    &lt;&lt;set _array.flat(2)&gt;&gt;
    &lt;&lt;run _array.flat(3)&gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Methods Menu|Methods]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="116" name="Special-Tags" tags="chapter menu" position="2000,1100" size="200,100">&lt;h1&gt;More Special Passages and Tags&lt;/h1&gt;
Aside from the [[Basic Special Passages|Special-Passage]], your project can be customised even further with more Special Passage Names and Special tags.

* [[Special Tags creating Special Passages and Functionalities|Tags-Built]]
* [[Process Code Before and After Rendering a Passage|SP-PassageReady-Done]]
* [[Changing the UI of the Project|SP-StoryInterface]]
* [[Customising Passages with Tags|Tags-CSS]]
* [[Including Assets with Tags|Tags-Asset]] 
* [[The Special Variables|SP-Variables]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="117" name="Tags-Built" tags="page" position="2000,1200" size="100,100">&lt;h1&gt;Special Tags creating Special Passages and Functionalities&lt;/h1&gt;
Along with [[Special Passages|Special-Passage]], SugarCube uses special passage tags to either create new Special Passages or affect the passage itself.
&gt; &#39;&#39;Note:&#39;&#39; only use those tags when needed, as it can affect how Twine loads the project.
\
To add a tag to a passage on Twine, open the relevant passage, click {{{+ Tag}}} in the passage menu, and fill in the blanks. If a tag has been assigned to another passage, it will show in the {{{Add Tag}}} listbox. You can also assign a colour to the tag.
For Twee files, add the tag inside {{{[ ]}}} next to the passage name. For tags with multiple words, add a {{{-}}} between them ({{{[like-this]}}}) For multiple tags, add a space in between ({{{[nobr widget]}}}).
\
&lt;h3&gt;{{{nobr}}}&lt;/h3&gt;\
Like the [[macro of the same name|Macro-Nobr-Silent]], the {{{nobr}}} tag removes every break to a new line in the passage. However, unlike the macro, it will affect the whole passage, rather than what was added inside the macro. This tag is most useful in passages with a lot of code, like a widget passage.
{{{
    :: Passage [nobr]
    This passage will not have line breaks.
    Even if the code is formatted with line breaks.
}}}
&gt; &#39;&#39;Note:&#39;&#39; to target the whole project rather than a passage, it is best to use the [[Config.nobr|Basic-API-Config]] API instead.
\
&lt;h3&gt;{{{widget}}}&lt;/h3&gt;\
As the name suggest, this tag is meant to create a special passage to set up {{{&lt;&lt;widget&gt;&gt;}}} [[macros|Macro-Widget]]. 
{{{
    :: Some Widgets [widget]
    &lt;&lt;widget &quot;Test&quot;&gt;&gt;this is a test widget&lt;&lt;/widget&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; while you can have multiple passages with this tag, it is recommended to keep it to a minimum.
\
&lt;h3&gt;{{{bookmark}}}&lt;/h3&gt;\
This widget is meant to populate the [[JumpTo Functionlity|Basic-API-UI]], to go back in the player history.
{{{
    :: Passage [bookmark]
    If the player read this passages, it will appear in the JumpTo dialog box.
}}}
&gt; &#39;&#39;Note:&#39;&#39; if JumpTo is not used in a project, you can also use this tag as if it were a &quot;regular&quot; tag.
\
&lt;h3&gt;{{{script}}}&lt;/h3&gt;\
This tag is meant to tell Twine that this passage only contains JavaScript code. It is not necessary for Twine users, as JavaScript code should be placed in the {{{Edit JavaScript}}} passage, in the //Story// menu. 

As for Twee files, it is only necessary if the file should be imported into the Twine app, and only one passage should be tagged as such. If you are using a compile (like Tweego), it is recommended to simply use a separate {{{.js}}} file (or multiple files) rather than create a {{{script}}} tagged passage. The files will be loaded in alphabetical order.
{{{
    :: The JavaScript Code [script]
}}}
&gt; &#39;&#39;Note:&#39;&#39; you cannot change the name of the JavaScript passage on Twine.
\
&lt;h3&gt;{{{stylesheet}}}&lt;/h3&gt;\
This tag is meant to tell Twine that this passage only contains CSS code. It is not necessary for Twine users, as CSS code should be placed in the {{{Edit Stylesheet}}} passage, in //Story// the menu. 

As for Twee files, it is only necessary if the file should be imported into the Twine app, and only one passage should be tagged as such. If you are using a compile (like Tweego), it is recommended to simply use a separate {{{.css}}} file (or multiple files) rather than create a {{{stylesheet}}} tagged passage. The files will be loaded in alphabetical order.
{{{
    :: The CSS Code [stylesheet]
}}}
&gt; &#39;&#39;Note:&#39;&#39; you cannot change the name of the StyleSheet passage on Twine.
\
&lt;h3&gt;{{{init}}}&lt;/h3&gt;\
This tag is meant to be used for add-ons/library, as it loads at the beginning initialization. It creates a passage that works like {{{StoryInit}}}. However, for 99% of projects created in Twine, this tag is unnecessary. Instead, the Special passage {{{StoryInit}}} should be used.
{{{
    :: initialization [init]
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages and Tags Menu|Special-Tags]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="118" name="SP-PassageReady-Done" tags="page" position="2100,1200" size="100,100">&lt;h1&gt;Process Code Before and After Rendering a Passage&lt;/h1&gt;
{{{PassageReady}}} and {{{PassageDone}}} are two Special Passages that will trigger respectively before and after the story passage renders. Those passages will not render any output (i.e. text) on the page, but will run code for every new story passage visited. 
They are best used for code meant to be used for multiple passages during the game, such as checking the location of the player to trigger some code or change the display of the page.
{{{
    :: PassageReady 
    &lt;&lt;if $var is 0&gt;&gt;&lt;&lt;goto &quot;END&quot;&gt;&gt;&lt;&lt;/if&gt;&gt;
    &lt;&lt;if $points is 100&gt;&gt;&lt;&lt;set $level++, $point to 0&gt;&gt;&lt;&lt;/if&gt;&gt;
    &lt;&lt;if not tags().includes(&#39;noreturn&#39;)&gt;&gt;&lt;&lt;set $return to passage()&gt;&gt;&lt;&lt;/if&gt;&gt;

    :: PassageDone
    &lt;&lt;if tags().includes(&#39;bar&#39;)&gt;&gt;&lt;&lt;addclass &quot;.bottle&quot; &quot;empty&quot;&gt;&gt;&lt;&lt;/if&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; for some functionality (like [[overriding navigations|Basic-Config-Navig]] or [[Arbitrarily long returns|Long-Return-JS]]), it may be best to use JavaScript instead.
\
&lt;h3&gt;{{{PassageReady}}} or {{{PassageDone}}}&lt;/h3&gt;\
While the passages will allow most code on the page (aside from DOM macros ([[text|Macro-ApPreRepCopy]]/[[class|Macro-DOM-Adv]]), which should only be added to {{{PassageDone}}}), whether a code is loaded before or after the passage is rendered will affect the development of the story.
{{{
Loading order:
    → PassageReady
    → PassageHeader
    → the content of the current Passage
    → PassageFooter
    → PassageDone
}}}
&gt; The full ordered lists of events happening when a new passage is rendering can be found in the [[documentation|http://www.motoslave.net/sugarcube/2/docs/#events-navigation]].

Because of the loading order, placing code in {{{PassageReady}}} or {{{PassageDone}}} will not only affect the currently displayed passage, but also code from the previous passage.
Assuming that {{{$var is 2}}} before moving to a passage:
{{{
    :: Next Passage 
    &lt;&lt;if $var is 2&gt;&gt;
        The dog sleeps in the cottage.
    &lt;&lt;elseif $var is 1&gt;&gt;
        The dog yaps at the door.
    &lt;&lt;else&gt;&gt;
        The dog is not here.
    &lt;&lt;/if&gt;&gt;
}}}
If the value of {{{$var}}} is changed inside {{{PassageReady}}}, the code above will be affected, and the displayed sentence will be different. However, if the value of {{{$var}}} is changed inside {{{PassageDone}}}, the code above will not be affected, but it may affect future passages.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages and Tags Menu|Special-Tags]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="119" name="SP-StoryInterface" tags="page" position="2000,1300" size="100,100">&lt;h1&gt;Changing the UI of the Project&lt;/h1&gt;
If you want to ditch the basic SugarCube UI and have something more custom for your project, you will need to use the Special Passage {{{StoryInterface}}}. This passage only accepts HTML, and JavaScript inside a {{{&lt;script&gt;}}} markup at the bottom of the passage.
&gt; &#39;&#39;Note:&#39;&#39; while knowledge of HTML and CSS is necessary to create your own UI, there are many templates available to use as is. See &lt;&lt;link &quot;Credits&quot;&gt;&gt;&lt;&lt;popup &quot;Credits&quot; &quot;Credits&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; for the Masterlist. Still, it is heavily recommended to understand the basics of both languages, when starting on your own.

This passage only has one requirement to run properly: include the {{{#passages}}} element.
{{{
    :: StoryInterface 
    &lt;div id=&quot;passages&quot;&gt;&lt;/div&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; do not include anything inside the {{{#passages}}} div. It is the element that display the passage.

You can add any other element inside {{{StoryInterface}}}, even nesting elements inside one another:
{{{
    &lt;div id=&quot;header&quot;&gt;
        &lt;h1&gt;Title of the Game&lt;/h1&gt;
    &lt;/div&gt;
}}}
&gt; //For a full example://
{{{
    &lt;div id=&quot;parent&quot;&gt;
        &lt;div id=&quot;passages&quot;&gt;&lt;/div&gt;
        &lt;div id=&quot;menu&quot; data-passage=&quot;sidemenu&quot;&gt;
            &lt;!--Side menu, editable in the sidemenu passage--&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;script&gt;
        function myFunction() {
            document.getElementById(&quot;myMenu&quot;).classList.toggle(&quot;show&quot;);
        }
            
        /*Close the dropdown menu if the user clicks outside of it*/
        window.onclick = function(event) {
            if (!event.target.matches(&#39;.dropbtn&#39;)) {
                var dropdowns = document.getElementsByClassName(&quot;dropup-content&quot;);
                var i;
                for (i = 0; i &lt; dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains(&#39;show&#39;)) {
                    openDropdown.classList.remove(&#39;show&#39;);
                    }
                }
            }
        }
    &lt;/script&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; This is the code in my [[One Page Template|https://manonamora.itch.io/twine-sugarcube-templates]].
\
&lt;h3&gt;Formatting the elements&lt;/h3&gt;\
When the wanted and required elements are defined in {{{StoryInterface}}}, you will need some CSS to place them on the page, and to format their contents. 
No matter how edited the interface has been, some elements will still keep their built-in CSS rules:
* {{{#passages}}} and its child {{{.passage}}}
* {{{#ui-overlay}}}, {{{#ui-dialog}}} and its children (the elements in a the dialog box)
\
If other [[base IDs and classes|http://www.motoslave.net/sugarcube/2/docs/#html]] were used when adding elements inside {{{StoryInterface}}}, those elements will also be displayed according to their respective built-in CSS rules.
&gt; &#39;&#39;Note:&#39;&#39; like with the base UI, those rules can be changed in the StyleSheet.
{{{
    #parent {
        width: 50vh;
        margin: auto;
        display: flex;
    }
    #passages {
        width: 75%;
    }
    #menu {
        width: 25%;
    }
}}}
\
When setting sizes or placements of elements, it is important to keep in mind that your project may be viewed on &#39;&#39;different screens/browser window sizes&#39;&#39;. This will affect the actual placement and display of elements on the screen. Testing the UI for different screen sizes can be done via the Inspect Tool of your browser.
&gt; &#39;&#39;Note:&#39;&#39; testing on both Chromium and non-Chromium browsers should be done as well, as different CSS rules (ex: overflow) will render differently on screen. 
\
To help take this into account, the {{{@media}}} CSS rule will let you define different sizes and placement of elements on the page depending on the size of the window or device opening the project. See [[this page|Int-JS-CSS-Media]].
{{{
    @media screen and (max-width: 500px) {
        #parent {
            width: 100vw;
        }
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; this should be placed at the bottom of the StyleSheet, and in order of most-restricting to most-inclusive.
\
&lt;h3&gt;Linking an Element to a passage&lt;/h3&gt;\
To keep the code in {{{StoryInterface}}} simple, or because you need SugarCube code inside an element (which won&#39;t work inside that passage), you can create links between an element and a non-story passage. That passage will then display text and/or run the relevant code inside that element.
This can be done with either {{{data-passage}}} or {{{data-init-passage}}}.
{{{
    &lt;div class=&quot;menu&quot; data-passage=&quot;sidemenu&quot;&gt;
        &lt;!--Side menu, editable in the sidemenu passage--&gt;
    &lt;/div&gt;
    &lt;div class=&quot;title&quot; data-init-passage=&quot;title&quot;&gt;
        &lt;!-- Title, editable in the &quot;title&quot; passage--&gt;
    &lt;/div&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; any text coded inside the elements in {{{StoryInterface}}} will be overriden by the content of the linked passage.
\
While these two links seem interchangeable, there is a major difference between the two: {{{data-init-passage}}} will load at the start of the game and &#39;&#39;never&#39;&#39; change, while {{{data-passage}}} will update with every new passage visited (if an update is necessary).
&gt; &#39;&#39;Note:&#39;&#39; you can also use {{{data-passages}} with [[Special Asset Passages|Tags-Asset]]: {{{&lt;img data-passage=&quot;TheCube&quot;&gt;}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages and Tags Menu|Special-Tags]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="120" name="Tags-CSS" tags="page" position="2100,1300" size="100,100">&lt;h1&gt;Customising Passages with Tags&lt;/h1&gt;
Aside from [[creating Special Passages or Functionalities|Tags-Built]], tags can also be used to customise how a passage looks. For example, if multiple passages are set in a forest, one can add a tag called {{{forest}}} to those passages, and use this tag to set an image of a forest in the background of those passages.

To add a tag to a passage on Twine, open the relevant passage, click {{{+ Tag}}} in the passage menu, and fill in the blanks. If a tag has been assigned to another passage, it will show in the {{{Add Tag}}} listbox. You can also assign a colour to the tag.
For Twee files, add the tag inside {{{[ ]}}} next to the passage name. For tags with multiple words, add a {{{-}}} between them ({{{[like-this]}}}) For multiple tags, add a space in between ({{{[nobr widget]}}}).

Adding a tag to a passage creates:
* a data-tag on {{{html}}}, {{{body}}}, and {{{.passage}}}
* a CSS class on {{{body}}} and {{{.passage}}}

Both the data-tag and class can be used in the Stylesheet to edit aspects of the page, but are coded differently. The data-tag will keep the formatting of the inserted tag (case-sensitive and punctuation), while the class will transform it into a lowercase string and without punctuation (save for {{{-}}}).
{{{
For a tag called: The-Name-Of-The-Tag:
    [data-tags~=&quot;The-Name-Of-The-Tag&quot;]
    .the-name-of-the-tag

For a tag called: Super!
    [data-tags~=&quot;Super!&quot;]
    .super
For a tag called: This-1
    [data-tags~=&quot;This-1&quot;]
    .this-1
}}}
&gt; &#39;&#39;Note:&#39;&#39; if you are unsure how a tag or class has been formatted, use the Inspect Tool of your browser and select the {{{&lt;body&gt;}}}.
\
As for positioning the data-tag or class on an element, you need to take into account the order of CSS rules and where the tags are located. For example:
{{{
    html[data-tags~=&quot;forest&quot;] { background-image: url(forest-bg.jpg); }
→ will change the background to an image of a forest, because there is a data-tag on &quot;html&quot;

    html.forest { background-image: url(forest-bg.jpg); }
→ will not do anything, because there is no class on &quot;html&quot;

    html .forest { background-image: url(forest-bg.jpg); }
→ will add the image as a background to every element inside &quot;html&quot; with the class &quot;forest&quot;
}}}
&gt; &#39;&#39;Note:&#39;&#39; it is recommended to be specific when targeting an element (so not like the last example), to avoid adding unnecessary rules to elements.
\
&gt; &#39;&#39;Note:&#39;&#39; class can also be added to the {{{html}}} element, in the JavaScript passage, jQuery code or [[DOM Macros|Macro-DOM-Adv]].
\
&gt; //Other examples://
{{{
→ Targeting a child element:
    html[data-tags~=&quot;forest&quot;] .passage { color: darkgreen; }
        → will change the font colour of &quot;.passage&quot; if the passage is tagged &quot;forest&quot;
    body[data-tags~=&quot;forest&quot;] a { color: green; }
        → will change the colour of every link inside &quot;body&quot;

→ Targeting an element without &quot;body&quot;:
    [data-tags~=&quot;forest&quot;] #ui-bar {background: red;}
    .forest #ui-bar {background: red;}
        → will change the background colour of the sidebar
}}}
&gt; &#39;&#39;Note:&#39;&#39; Data-Tags are prefered over classes, because it is more stable (i.e. won&#39;t be messed up by custom macros or third party code).

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages and Tags Menu|Special-Tags]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="121" name="Tags-Asset" tags="page" position="2000,1400" size="100,100">&lt;h1&gt;Including Assets with Tags&lt;/h1&gt;
While you cannot import assets through the Twine app, it is possible with SugarCube to create //Media Passages// through a passage tag. The media embeded in your project, you can inclde those assets into other passages thanks to the {{{data-passage}}} [[attribute|Markup-Attribute]]. 
&gt; &#39;&#39;Note:&#39;&#39; while it is meant for [[Base64-encoded|https://en.wikipedia.org/wiki/Data_URI_scheme]] media source {{{data:type/extension;format,code}}}, the passage will also accept URL.

These media passages will support audio, image, video, and VTT elements. Each of those get a special tag:
* {{{Twine.audio}}}, will register the passage as an audio passage
* {{{Twine.image}}}, will register the passage as an image passage
* {{{Twine.video}}}, will register the passage as a video passage. 
* {{{Twine.vtt}}}, will register the passage as a VTT passage.
&gt; &#39;&#39;Note:&#39;&#39; you can only include one asset per passage. 
&gt; In Twine 2, it is strongly recommended to only create a handful of media passage, and use small sources.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages and Tags Menu|Special-Tags]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="122" name="SP-Variables" tags="page" position="2100,1400" size="100,100">&lt;h1&gt;The Special Variables&lt;/h1&gt;
SugarCube includes special variables, which can be used in the JavaScript passage or within the {{{&lt;&lt;script&gt;&gt;}}} [[macro|Macro-Script-Run]].
\
&lt;h3&gt;The API Variables&lt;/h3&gt;\
The different APIs included in SugarCube are defined as Special Variables:
* {{{Config}}} refers to the Configuration API
* {{{Dialog}}} refers to the Dialog API (popups)
* {{{Engine}}} refers to the Engine API 
* {{{Fullscreen}}} refers to the Fullscreen API
* {{{LoadScreen}}} refers to the LoadScreen API
* {{{Macro}}} refers to the Macro API
* {{{Passage}}} refers to the Passage API
* {{{Save}}} refers to the Save API
* {{{Setting}}} refers to the Setting API
* {{{SimpleAudio}}} refers to the SimpleAudio API
* {{{State}}} refers to the State API
* {{{Story}}} refers to the Story API
* {{{Template}}} refers to the Template API
* {{{UI}}} refers to the UI API
* {{{UIBar}}} refers to the UIBar API
\
&lt;h3&gt;Other Special Variables&lt;/h3&gt;\
* {{{jQuery}}} will refer to the jQuery library function, with {{{$}}} being an alias 
** the alias should not be confused with story variables {{{$var}}}, which should be called via {{{State.variables}}} or {{{State.getVar()}}}
* {{{l10nStrings}}} refers to the Strings localization
* {{{settings}}} are player setting object, set through the Setting API 
* {{{setup}}} are objects used for static data

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Special Passages and Tags Menu|Special-Tags]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="123" name="Config-API" tags="chapter menu" position="2300,1800" size="200,100">&lt;h1&gt;More Configuration APIs to Customise Interaction&lt;/h1&gt;
To configure even more how your project should run, like saving playthroughs or changing how some macros work, here are the rest of the Configuration APIs not mentioned in [[this chapter|Basic-API-Config]].

Those APIs are JavaScript-based code that should be included in the JavaScript (though some can be used along with the {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}} macros inside a passage).

* [[Macro-relevant Configurations|Confic-Macro]] 
* [[Editing the Behaviour and Display of Passage Elements|Config-Passage]] 
* [[Save Configurations|Config-Saves]] 
* [[Other Config APIs|Config-Misc]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="124" name="Confic-Macro" tags="page" position="2300,1900" size="100,100">&lt;h1&gt;Macro-relevant Configurations&lt;/h1&gt;
The APIs listed below will affect with specific macros, namely {{{&lt;&lt;for&gt;&gt;}}}, {{{&lt;&lt;type&gt;&gt;}}}, and {{{&lt;&lt;audio&gt;&gt;}}}.
\
&lt;h3&gt;{{{Config.macros.maxLoopIterations}}}&lt;/h3&gt;\
This API will set the maximum number of iterations allowed for the {{{&lt;&lt;for&gt;&gt;}}} macro, before the macro is terminated with an error message. This setting exists to prevent making the browser unresponsive if a loop is not configured correctly.
The default number is 1.000.
{{{
    Config.macros.maxLoopIterations = 5000;
→ changes the default to 5.000 iterations
}}}
\
&lt;h3&gt;{{{Config.macros.typeSkipKey}}}&lt;/h3&gt;\ 
This API will change the default key to press to skip the typing of the {{{&lt;&lt;type&gt;&gt;}}} macro, meaning it will display the rest of the content immediately. The default is {{{&quot; &quot;}}} (the space key).
{{{
    Config.macros.typeSkipKey = &quot;Control&quot;;
→ the SkipKey will become {Ctrl}
}}}
&gt; &#39;&#39;Note:&#39;&#39; this is only relevant if the {{{skipkey}}} argument was not included in the [[macro|Macro-Type]].
/
&lt;h3&gt;{{{Config.macros.typeVisitedPassages}}}&lt;/h3&gt;\
This API will determine whether to trigger the {{{&lt;&lt;type&gt;&gt;}}} macro on previously visited passages or display the text as is. This is enabled by default, meaning the macro will type out the content even if the passage had previously been visited.
{{{
    Config.macros.typeVisitedPassages = false;
→ will not type out the text as is on visited passages
}}}
\
&lt;h3&gt;{{{Config.audio.pauseOnFadeToZero}}}&lt;/h3&gt;
This API will automatically pause any track who&#39;ve been faded to volume 0 (silent). This is enabled by default.
{{{
    Config.audio.pauseOnFadeToZero = false;
→ will not pause the track when faded to 0
}}}
\
&lt;h3&gt;{{{Config.audio.preloadMetadata}}}&lt;/h3&gt;\
This API will attempt to preload the metadata of any track [[cached|CacheAudio]] in the project, meaning the information about the track(s). This element is enabled by default.
&gt; &#39;&#39;Note:&#39;&#39; it is unlikely you will ever need to disable this setting.
{{{
    Config.audio.preloadMetadata = false;
→ will not preload metadata
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Config API Menu|Config-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="125" name="Config-Passage" tags="page" position="2400,1900" size="100,100">&lt;h1&gt;Editing the Behaviour and Display of Passage Elements&lt;/h1&gt;
The APIs listed below will affect how a passage could behave or how its different elements are displayed.
\
&lt;h3&gt;{{{Config.passages.descriptions}}}&lt;/h3&gt;\
In the Saves and Jump To menus, passages are described by an excerpt of the passage&#39;s content. This API will allow you to provide an alternate description, like the passage&#39;s title. This can be defined through:
* the {{{true}}} boolean value, which will use the passage&#39;s title
** you should ensure the title of the passages are meaningful!
* an object, which will replace the description for all listed passages 
* a function, which will either indicate the new description for the passage or use the passage&#39;s excerpt
{{{
    Config.passages.descriptions = true;
→ will use the passage title as description

    Config.passages.descriptions = {
        &quot;PassageName&quot; : &quot;the new description&quot;,
        &quot;DeadOAlex&quot;   : &quot;Where Alex will end up dying lol&quot;
    };
→ will use the new description for the listed passages

    Config.passages.descriptions = function () {
        if (this.title === &quot;title&quot;) {
            return &quot;description&quot;;
        }
    };
→ similar to the object, but as a function
}}}
&gt; &#39;&#39;Note:&#39;&#39; for the Save menu, there is an alternative approach with the {{{Save.onSave.add()}}} [[API|SaveAPI-Events]]

\
&lt;h3&gt;{{{Config.passages.displayTitles}}}&lt;/h3&gt;\
This API can display the title of the passage, along with the story title, in the browser/tab&#39;s titlebar:
{{{Passage Name | Story Name}}}
{{{
    Config.passages.displayTitles = true;
}}}
\
&lt;h3&gt;{{{Config.passages.onProcess}}}&lt;/h3&gt;\
This API allows custom text progressing, like changing words on the page for another. It will trigger with every passage displayed and when the {{{&lt;Passage&gt;.processText()}}} [[method]] is called.
This can be a useful for swears replacement.
{{{
    Config.passages.onProcess = function (p) {
        return p.text.replace(/\bcat(s?)\b/g, &#39;dog$1&#39;);
    };
→ will replace any instance of {cat} for {dog}
}}}
&gt; &#39;&#39;Note:&#39;&#39; knowledge of JavaScript will most likely be required here.
\
&lt;h3&gt;{{{Config.passages.start}}}&lt;/h3&gt;\
This API will indicate which passage should be displayed first.
There will be very few instances where this would be needed, as the Twine app requires you to select the starting passage, and the Twee formating needs this information in the {{{:: StoryData}}}.
{{{
    Config.passages.start = &quot;This Is The Actual Starting Passage&quot;;
}}}
\
&lt;h3&gt;{{{Config.passages.transitionOut}}}&lt;/h3&gt;\
This API will enable transition for outgoing passages. You can either indicate the name of the CSS rule being animated (e.g. opacity), after which the outgoing passage will be removed, or an integer delay (in milliseconds).
You will also need extra CSS, with the {{{.passage-out}}} class to make the transition smoother.
&gt; &#39;&#39;Note:&#39;&#39; this API will mess with the position of the new passage displayed (or when going back in the player history). Extensive testing is required.
{{{
    Config.passages.transitionOut = &quot;opacity&quot;;
→ remove outgoing passage when the opacity animation ends

    Config.passages.transitionOut = 1010;
→ remove outgoing passage after 1010ms (1.01s)
}}}
&gt; &#39;&#39;Note:&#39;&#39; when using an integer delay, it is recommended to indicate a number higher than the transition delay, by at least 10ms. The transition delay in the Built-In style-sheet is 1s. 
\
In the StyleSheet, you should at least indicate the transition&#39;s end state with the {{{.passage-out}}} class.
&gt; //Example:// 
{{{
    .passage-out {
        opacity: 0;
    }
}}}
It is still recommended to add more rules for it to be pleasing to the eye. The example in the Documentation provides the following:
{{{
    #passages {
        position: relative;
    }
    .passage {
        left: 0;
        position: absolute;
        top: 0;
        transition: opacity 1s ease;
    }
    .passage-out {
        opacity: 0;
    }
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Config API Menu|Config-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="126" name="Config-Saves" tags="page" position="2300,2000" size="100,100">&lt;h1&gt;Save Configurations&lt;/h1&gt;
The APIs below will allow you to enable autosaves, as well as restricting the player&#39;s ability to saves, or set up save versions.
&gt; &#39;&#39;Note:&#39;&#39; you may need to use some [[Save API|SaveAPI]] along with these Config.
\
&lt;h3&gt;{{{Config.saves.autoload}}}&lt;/h3&gt;\
This API will check if an autosave exists, and will load said autosave during startup. You can load autosaves automatically, prompt the player about it with a popup, or include a function that could load autosaves at start.
If an autosave cannot be loaded, the player will be shown the starting passage instead.
{{{
    Config.saves.autoload = true;
→ will load the autosave automatically 

    Config.saves.autoload = &quot;prompt&quot;;
→ will prompt the player about loading saves

    Config.saves.autoload = function () {
        /* code */
    };
→ will load the autosave if the function returns truthy
}}}
\
&lt;h3&gt;{{{Config.saves.autosave}}}&lt;/h3&gt;\
This API will determine whether and when a autosave is triggered when passages are displayed. 
It will accept:
* boolean values
** //true// to autosave at every passage
** //false// to never autosave
* an array of strings of tags 
** the autosave will be triggered when a passage with a listed tag is visited
* a function with truthy/falsy values
{{{
    Config.saves.autosave = true;
→ autosave on every passage

    Config.saves.autosave = false;
→ only manual saving

    Config.saves.autosave = [&quot;bookmark&quot;, &quot;autosave&quot;];
→ autosave only on passages taged &quot;bookmark&quot; and &quot;autosave&quot;

    Config.saves.autosave = function () {
        /* code */
    };
→ autosaves only when the function returns truthy
}}}
&gt; //Example://
{{{
    Config.saves.autosave = function () {
        if (settings.autosave) {
            return true
    }};
}}}
&gt; &#39;&#39;Note:&#39;&#39; when using a {{{true}}} value (first example), you may want to use {{{Config.saves.isAllowed}}} to disallow saving on the starting passage (or any non-story screens) to enable the player to load the autosave, or any new playthrough will override the previous one.
\
&lt;h3&gt;{{{Config.saves.id}}}&lt;/h3&gt;\
This API will set a story ID for the saves. Every save is associated with a story ID with Twine, which is automatically generated from the title of the project.
However, if you would like to use a different IF, you can use this API.
{{{
Config.saves.id = &quot;here-is-a-new-ID-because-who-cares-part-40394857&quot;;
}}}
\
&lt;h3&gt;{{{Config.saves.isAllowed}}}&lt;/h3&gt;\
With a defined function, this API will determine saving is allowed depending on the context. It will be triggered every time a save is requested, and will only save if the function allows it.
{{{
    Config.saves.isAllowed = function () {
        /* code */
    };
}}}
&gt; //Example://
{{{
    config.saves.isAllowed = function () {
        if (passage() === &quot;Start&quot; || tags().contains(&quot;nosave&quot;) || State.variables.test &gt; 5) {
            return false;
        }
        return true;
    };

→ this won&#39;t allow saving:
    → on the passage called &quot;Start&quot;
    → with any passage tagged with &quot;nosave&quot;
    → if the variable $test is greated than 5
}}}
&gt; &#39;&#39;Note:&#39;&#39; this API will affect both manual and auto- saves.
\
&lt;h3&gt;{{{Config.saves.tryDiskOnMobile}}}&lt;/h3&gt;\
This API will determine whether you can download a savefile on mobile devices (i.e. smartphones, tablets, ...). It is enabled by default.
&gt; &#39;&#39;Note:&#39;&#39; mobile browsers can be fickle, saving to disk at times may lead to unexpected results. 
{{{
    Config.saves.tryDiskOnMobile = false;
→ will disable saving to disk
}}}
\
&lt;h3&gt;{{{Config.saves.version}}}&lt;/h3&gt;\
With this API, you can set the version of saves.
However, it is only useful if you plan to upgrade out-of-date saves (e.g. missing new variables added in StoryInit), and use the {{{Save.onLoad.add()}}} [[API]] callback.
{{{
→ version as an integer
Config.saves.version = 2;

→ version as a string
Config.saves.version = &quot;v2&quot;;
}}}
&gt; &#39;&#39;Note:&#39;&#39; though the API will accept any form of value, an integer is recommended over other forms.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Config API Menu|Config-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="127" name="Config-Misc" tags="page" position="2400,2000" size="100,100">&lt;h1&gt;Other Config APIs&lt;/h1&gt;
Below are listed the Config APIs not mentioned in other pages of this guide.
\
&lt;h3&gt;{{{Config.ui.stowBarInitially}}}&lt;/h3&gt;\
This API allows you to stow the sidebar when the game starts. You can indicate a boolean value to always/never stow the SideBar at the start, or an integer, which will stow the SideBar if the screen/window size is less wide than the specified number.
&gt; &#39;&#39;Note:&#39;&#39; the default of this API is {{{800}}}, as in the SideBar will start stowed if the screen size is less than 800px. 
\
&gt; //Examples://
{{{
    Config.ui.stowBarInitially = true;
→ Always start stowed

    Config.ui.stowBarInitially = false;
→ Never start stowed (for all screens)

    Config.ui.stowBarInitially = 800;
→ Stows at the start if the width is less than 800px
}}}
\
&lt;h3&gt;{{{Config.ui.updateStoryElements}}}&lt;/h3&gt;\
Usually, elements in the SideBar are update every time the player moves to a new passage. This affects the //displayed title// //banner//, the //subtitle//, the //author//, the //caption//, and the //menu// populated by the [[Special Passages|SP-UIBar]]. If these elements do not ever need updating, you could choose to toggle off this update.
{{{
    Config.ui.updateStoryElements = false;
}}}
&gt; &#39;&#39;Note:&#39;&#39; this API is unnecessary if you have a custom interface or conditional statements in the Special Passages.
\
&lt;h3&gt;{{{Config.addVisitedLinkClass}}}&lt;/h3&gt;\
This API will add a class to links sending the player to an already visited passage (i.e. in the player&#39;s history). With this added class, and some extra code in the StyleSheet, you can provide a visual distinction between visited and still-to-visit passages on the screen.
&gt; &#39;&#39;Note:&#39;&#39; turning on this API will still require you to style the visited links, as none is provided by default.
{{{
    Config.addVisitedLinkClass = true;
}}}
The added class is called {{{.link-visited}}}, and you may edit it however you like.
{{{
    .link-visited {
        color: green;
        font-size: 75%;
        text-decoration: line-through;
    } 
}}}
\
&lt;h3&gt;{{{Config.debug}}}&lt;/h3&gt;\
This API will indicate whether SugarCube is running in the Test Mode/Debug View. This mode is useful to test code, as it makes the coding markup (i.e. macros) visible on the screen.
&gt; &#39;&#39;Note:&#39;&#39; the Twine app already has a way to trigger the Debug view by either clicking the //Test From Here// button in an passage or the //Test// button under the //Build// menu. In Tweego, you can compile a debug view with {{{-t}}} or {{{--test}}}.
{{{
    Config.debug = true;
}}}
&gt; //Other Examples of use://
{{{
→ Pure JavaScript
    if (Config.debug) {
	    /* do something debug related */
    }

→ TwineScript
    &lt;&lt;if Config.debug&gt;&gt;
        /* do something debug related */
    &lt;&lt;/if&gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Config API Menu|Config-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="128" name="Engine-API" tags="chapter menu" position="1700,1800" size="200,100">&lt;h1&gt;The Engine APIs&lt;/h1&gt;
Aside from [[moving back and forth|Basic-API-Engine]] in the player history, the Engine APIs has some useful functions to customize the gameplay of your project. Some of these APIs are more useful in JavaScript code than in TwineScript code in the relevant passage.

* [[Checking the State of the Game|Engine-State]]
* [[Move through the Player&#39;s History|Engine-Go]]
* [[(Re-)Play a Passage|Engine-Play]]
* [[Restarting without the Built-In PopUp|Engine-Restart]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="129" name="Engine-State" tags="page" position="1700,1900" size="100,100">&lt;h1&gt;Checking the State of the Game&lt;/h1&gt;
There are instences where knowing the state of the game before triggering a certain bit of code is important, such as with macros needing the passage to be fully idle to change something on the screen, or if the game has a server connection, this set of Engine API will show whether the game is in one of the following three states:
* {{{idle}}}: the page is idle (default)
* {{{playing}}}: nagivation to a new passage has been triggered
* {{{rendering}}}: a passage is rendering on the screen 

You can check which state the game is currently at with {{{Engine.state}}}:
{{{
    &lt;&lt;print Engine.state&gt;&gt;

in JavaScript:
    if (Engine.state === &quot;rendering&quot;) { /* your JS code */ }
}}}

SugarCube has also three other Engine API to check for a specific state:
* {{{Engine.isIdle()}}}, checking if the page is idle
* {{{Engine.isPlaying()}}}, checking is the navigation to a new passage has been triggered
* {{{Engine.isRendering()}}}, checking if a passage is rendering on the screen
{{{
    if (Engine.isIdle()) { /* your JS code */ }
    else if (Engine.isRendering()) { /* your JS code */ }
}}}

&gt; &#39;&#39;Note:&#39;&#39; while those are useful, if you are looking to target a more specific time during the redering of a passage or element, you may want to check the [[Events]], instead.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Engine API Menu|Engine-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="130" name="Engine-Go" tags="page" position="1800,1900" size="100,100">&lt;h1&gt;Move through the Player&#39;s History&lt;/h1&gt;
While there are already [[options to go back and forth|Basic-API-Engine]] in the player&#39;s history, you can move further back and forth with the {{{Engine.go()}}} API. 
{{{
    Engine.go(number)
}}}
By indicating a number - positive to move forward, negative to move back - you will be telling the engine to undo or redo the player&#39;s actions as many times as the number. For example:
{{{
    Engine.go(2)   → Redoes two moments, forwards the player twice
    Engine.go(-4)  → Undoes four moments, send the player back four times
}}}

Another method, to target a specific turn in the player&#39;s history is to use {{{Engine.goTo()}}}:
{{{
    Engine.goTo(number)
}}}
Unlike the previous method, the number indicates the specific passage in the player&#39;s history, with {{{0}}} being the starting page.
{{{
    Engine.goTo(0)  → Goes to the first screen
    Engine.goTo(9)  → Goes to the tenth screen
}}}
&gt; &#39;&#39;Note:&#39;&#39; it is hard to predict how a player will interact with a game, and what path they take, so this method can be quite unreliable.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Engine API Menu|Engine-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="131" name="Engine-Play" tags="page" position="1700,2000" size="100,100">&lt;h1&gt;(Re-)Play a Passage&lt;/h1&gt;
While you can use links to move the player to a new passage, there is as well an Engine API to show said passage to the player:
{{{
    Engine.play(&quot;PassageName&quot; [, noHistory])
}}}

In a passage, you will need to use the API the {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}} macro:
{{{
    &lt;&lt;run Engine.play(&quot;PassageName&quot;)&gt;&gt;
}}}
The passage will then load, and will be added to the history of the player.

&gt; &#39;&#39;Note:&#39;&#39; if you want to know when the last time {{{Engine.play()}}} was used, {{{Engine.lastPlay}}} will give you that information.
\
&lt;h3&gt;Not adding to the History&lt;/h3&gt;\
{{{Engine.play()}}} allows showing a passage without adding to the player&#39;s history. To do so, you need to code it as follow:
{{{
    Engine.play(&quot;PassageName&quot;, true)
}}}
&gt; &#39;&#39;Note:&#39;&#39; if the passage you want to show is the same as the current passage (a sort of refreshing the page), you can use {{{Engine.show()}}} instead.

When triggered, the page will display the new passage. It will also change the value of variables if coded, which may affect what is displayed ont the screen. For example:
{{{
    :: StoryInit
    &lt;&lt;set $words = &#39;I say hello&#39;&gt;&gt;

    :: Passage
    &lt;&lt;print $words&gt;&gt;
    &lt;&lt;button &quot; Click&quot;&gt;&gt;
        &lt;&lt;set $words = &#39;You say goodbye&#39;&gt;&gt;
        &lt;&lt;run Engine.play(&#39;beat&#39;, true)&gt;&gt;
    &lt;&lt;/button&gt;&gt;
}}}
When the passage is first displayed, the page will show {{{I say hello}}}. After clicking on the button, the passage will refresh and will now show: {{{You say goodbye}}}.

&#39;&#39;HOWEVER&#39;&#39;, any changed value in the previous passage or the currently displayed one &#39;&#39;won&#39;t&#39;&#39; save until a new moment is created in the player&#39;s history. If the player refreshed the browser tap (F5) after {{{Engine.play(&quot;PassageName&quot;, true)}}} has been triggered, any action done or change in value since the display of the original passage will be lost.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Engine API Menu|Engine-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="132" name="Engine-Restart" tags="page" position="1800,2000" size="100,100">&lt;h1&gt;Restarting without the Built-In PopUp&lt;/h1&gt;
Outside of the base [[Restart API|Basic-API-UI]], SugarCube has another way to restart a game, withe {{{Engine.restart()}}}. Unlike its counterpart {{{UI.restart()}}}, which will create a popup warning the player to save their progress, {{{Engine.restart()}}} will restart the file when triggered and without warning.

This method can useful when wanting a more custom Restart screen, if the game does not have any saves, or at an end screen.
Whatever reason for its use, {{{Engine.restart()}}} should be triggered through a link or a button, inside the {{{&lt;&lt;run&gt;&gt;}}} or {{{&lt;&lt;script&gt;&gt;}}} macro:
{{{
    &lt;&lt;button &quot;Restart&quot;&gt;&gt;
        &lt;&lt;run Engine.restart()&gt;&gt;
    &lt;&lt;/button&gt;&gt;
}}}
Another way to edit the Built-In PopUp is to change the relevant [[l10nStrings|Local-L10n]] in the JavaScript.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Engine API Menu|Engine-API]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="133" name="Events" tags="chapter menu" position="2600,1800" size="200,100">&lt;h1&gt;Trigger Code with Special Events&lt;/h1&gt;
Events are messages sent by the code within the game file to notify other bits of code that something has happened (automated or through player interaction). These are built-in the code of SugarCube, and can be used when creating a [[Custom Macro|Macro]], or wanting to customise elements on the page at a very specific moment (e.g. having a sound when closing a popup).

Each event is formatted as an object and contains information about the state at the moment of the event and what happened during the event. You can find these events used plainly in JavaScript (e.g. scroll back to the top) or within macros.
&gt; &#39;&#39;Note:&#39;&#39; The events discussed here are specific to SugarCube. The format, however, does accept more [[standardized browser events|https://developer.mozilla.org/en-US/docs/Web/Events]].
\
* [[Dialog Events|Events-Dialog]]
* [[Passage and Navigation Events|Events-Passage]]
* [[System Events|Events-System]]
* [[Type Macro Events|Events-Type]] 
/* [[Audio Events|Events-Audio]]*/
&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="134" name="Events-Dialog" tags="page" position="2600,1900" size="100,100">&lt;h1&gt;Dialog Events&lt;/h1&gt;
The following events allow the execution of JavaScript code at specific points during the opening and closing of popups. The events will be triggered when using the [[Dialog API|Basic-API-Dialog]]. They happen in the following order:
{{{
    :dialogopening
    :dialogopened 

        //Player Interaction inside the Dialog Box//

    :dialogclosing
    :dialogclosed
}}}
&gt; &#39;&#39;Note:&#39;&#39; The events are triggered by the body element of the popup {{{#ui-dialog-body}}}. 
\
&lt;h3&gt; {{{:dialogopening}}}&lt;/h3&gt;\
This event is triggered as the popup is opening (as the first step of {{{Dialog.open()}}}). You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:dialogopening&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.
\
&lt;h3&gt; {{{:dialogopened}}}&lt;/h3&gt;\
This event is triggered when the popup is fully rendered (as the last step of {{{Dialog.open()}}}). You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:dialogopened&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.
An useful example, where any new popup with overflow will have its text displayed from the top.
{{{
    $(document).on(&#39;:dialogopened&#39;, function (ev) {
        $(&quot;#ui-dialog-body&quot;).scrollTop(0);
    });
}}}
\
&lt;h3&gt; {{{:dialogclosing}}}&lt;/h3&gt;\
This event is triggered as the popup is closing (as the first step of {{{Dialog.close()}}}). You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:dialogclosing&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.
\
&lt;h3&gt; {{{:dialogclosed}}}&lt;/h3&gt;\
This event is triggered when the popup is fully closed (as the last step of {{{Dialog.close()}}}). You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:dialogclosed&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Events Menu|Events]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="135" name="Events-Passage" tags="page" position="2700,1900" size="100,100">&lt;h1&gt;Passage and Navigation Events&lt;/h1&gt;
The following events allow the execution of JavaScript code at specific points during the rendering of a passage, as well as [[Special Passages|Special-Passage]], a.k.a passage navigation. The order of those events go as follow:
{{{
1- Passage initiation (before change in history)
    :passageinit event

2- Passage start (before passage rendering)
    PassageReady
    :passagestart event
    PassageHeader

3- Passage render (after passage rendering)
    PassageFooter
    :passagerender event

4- Passage display (after passage displayed)
    PassageDone
    :passagedisplay event

5- UI bar special passages update (if relevant)
    StoryBanner
    StoryDisplayTitle 
    StorySubtitle 
    StoryAuthor 
    StoryCaption 
    StoryMenu
    
6- Passage end (end of passage navigation)
    :passageend event
}}}
\
&lt;h3&gt;{{{:passageinit}}}&lt;/h3&gt;\
This event is triggered before the player&#39;s history is modified (a.k.a just after the start to navigation is called). It also will contain the elements of the passage to display next.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:passageinit&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.
\
&lt;h3&gt;{{{:passagestart}}}&lt;/h3&gt;\
This event is triggered before the rendering of the incoming passage. It will also contain the elements of the passage to display next, and the HTML (currently empty) elements to render.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:passagestart&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.
\
&lt;h3&gt;{{{:passagerender}}}&lt;/h3&gt;\
This event is triggered after the rendering of the incoming passage. It will also contain the elements of the passage rendering, and the HTML elements rendered.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:passagerender&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.
\
&lt;h3&gt;{{{:passagedisplay}}}&lt;/h3&gt;\
This event is triggered after the incoming passage is displayed. It will also contain the elements of the passage displayed, and the HTML elements rendered.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:passagedisplay&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.
An example where the incoming passage with overflow will be displayed from the top, useful when the previous passage required some scrolling.
{{{
    $(document).on(&quot;:passagedisplay&quot;, function() {
        $(&quot;#passages&quot;).scrollTop(0);
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; this is especially useful with custom UI.
\
&lt;h3&gt;{{{:passageend}}}&lt;/h3&gt;\
This event is triggered at the end of the passage navigation. It will also contain the elements of the passage displayed, and the HTML elements rendered.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:passageend&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; to execute the code only once throughout the whole game, replace {{{.on}}} by {{{.one}}}.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Events Menu|Events]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="136" name="Events-System" tags="page" position="2600,2000" size="100,100">&lt;h1&gt;System Events&lt;/h1&gt;
The following events allow the execution of JavaScript code at specific points during story startup and restart.
\
&lt;h3&gt;{{{:storyready}}}&lt;/h3&gt;\
This is a global event that will be triggered just before the loading screen disappears at startup.
You can include any JavaScript code inside the following container:
{{{
    $(document).one(&#39;:storyready&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
\
&lt;h3&gt;{{{:enginerestart}}}&lt;/h3&gt;\
This is a global event that will be triggered just before the page is reloaded when using {{{Engine.restart()}}}.
You can include any JavaScript code inside the following container:
{{{
    $(document).one(&#39;:enginerestart&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}

&gt; &#39;&#39;Note:&#39;&#39; these events are only triggered &#39;&#39;once&#39;&#39;.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Events Menu|Events]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="137" name="Events-Type" tags="page" position="2700,2000" size="100,100">&lt;h1&gt;Type Macro Events&lt;/h1&gt;
The {{{&lt;&lt;type&gt;&gt;}}} macro has events allowing the execution of JavaScript code at specific points during typing. They are sequenced as follow:
{{{
    :typingstart
    :typingstop
    :typingcomplete
}}}
&gt; &#39;&#39;Note:&#39;&#39; every new addition of the {{{&lt;&lt;type&gt;&gt;}}} macro after a {{{:typingcomplete}}} is triggered will start the sequence again.
\
&lt;h3&gt;{{{:typingstart}}}&lt;/h3&gt;\
This is a local event that will be triggered when the typing of a section starts.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:typingstart&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
&gt; //Adding a Mouse Click as a SkipKey//
{{{
    (function () {
        var skipKeyEv = jQuery.Event(&#39;keydown&#39;, {
            key : Config.macros.typeSkipKey
        });

        jQuery(document).on(&#39;:typingstart&#39;, function (ev) {
            jQuery(ev.target).one(&#39;mousedown&#39;, function (ev) {
                ev.stopImmediatePropagation();
                ev.preventDefault();
                jQuery(document.body).trigger(skipKeyEv);
            });
        });
    })();
}}}
\
&lt;h3&gt;{{{:typingstop}}}&lt;/h3&gt;\
This is a local event that will be triggered when the typing of a section stops.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:typingstop&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}
\
&lt;h3&gt;{{{:typingcomplete}}}&lt;/h3&gt;\
This is a global event that will be triggered all the {{{&lt;&lt;type&gt;&gt;}}} macros within a passage have been completed.
You can include any JavaScript code inside the following container:
{{{
    $(document).on(&#39;:typingcomplete&#39;, function (ev) {
	    /* JavaScript code */
    });
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Events Menu|Events]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="138" name="FullScreen" tags="chapter page" position="3500,1800" size="200,100">&lt;h1&gt;Getting the FullScreen Experience&lt;/h1&gt;
The FullScreen API provides you access to the player&#39;s browser&#39;s fullscreen abilities. It comes with some built-in limitations, namely the fullscreen request having to be initiated by the player, through player interaction with the page (e.g. link, button, etc...). Running the executing APIs listed below in the Browser Console will not work, returning errors instead.

&lt;&lt;link &quot;Toggle FullScreen&quot;&gt;&gt;&lt;&lt;run Fullscreen.toggle()&gt;&gt;&lt;&lt;/link&gt;&gt;

When the fullscreen mode is active, it will save the current and whole HTML page inside the {{{Fullscreen.element}}} object. If the fullscreen mode is not active, {{{Fullscreen.element}}} will return null.
&gt; &#39;&#39;Note:&#39;&#39; Pressing F11 won&#39;t activate the fullscreen mode, but it will deactivate it. 
\
&lt;h3&gt;Checking for FullScreen&lt;/h3&gt;\
\
&lt;h4&gt;{{{Fullscreen.isEnabled()}}}&lt;/h4&gt;\
This API will check whether fullscreen is both supported and available for the device.
{{{
    Fullscreen.isEnabled()
}}}
\
&lt;h4&gt;{{{Fullscreen.isFullscreen()}}}&lt;/h4&gt;\
This API will check whether the fullscreen mode is currently active.
{{{
    Fullscreen.isFullscreen()
}}}
\
&lt;h3&gt;(De-)Activating the FullScreen Mode&lt;/h3&gt;\
\
&lt;h4&gt;{{{Fullscreen.request()}}}&lt;/h4&gt;\
This API will request the browser to enter fullscreen mode.
{{{
    Fullscreen.request([options [, requestedEl]])
}}}
It has 2 parameters:
* {{{options}}} (optional), the fullscreen options 
** {{{navigationUI}}}, dtermines the fullscreen navigation UI preference 
*** only valid values: {{{auto}}} (no preference), {{{hide}}} (hidden navigation), {{{show}}} (shown navigation)
*** this may not be honoured by the browser
* {{{requestedEl}}} (optional), the element to enter fullscreen mode
** if omitted, it will show the entire page.
\
&gt; //Examples://
{{{
    Fullscreen.request();
→ Basic usage (recommended)

    Fullscreen.request({ navigationUI : &quot;show&quot; }, myElement);
→ Usage with option (show the navigation UI)
  and given an element
}}}
&gt; &#39;&#39;Note:&#39;&#39; it may be easier to use {{{Fullscreen.toggle()}}}, as it will merge both this API and {{{Fullscreen.exit()}}}
\
&lt;h4&gt;{{{Fullscreen.exit()}}}&lt;/h4&gt;\
This API will request the browser to exit the fullscreen mode.
{{{
    Fullscreen.exit()
}}}
&gt; &#39;&#39;Note:&#39;&#39; it may be easier to use {{{Fullscreen.toggle()}}}, as it will merge both this API and {{{Fullscreen.request()}}}
\
&lt;h4&gt;{{{Fullscreen.toggle()}}}&lt;/h4&gt;\
This API will toggle the fullscreen mode, entering or exiting the mode depending on the current state.
{{{
    Fullscreen.toggle([options [, requestedEl]])
}}}
It has 2 parameters:
* {{{options}}} (optional), the fullscreen options 
** {{{navigationUI}}}, dtermines the fullscreen navigation UI preference 
*** only valid values: {{{auto}}} (no preference), {{{hide}}} (hidden navigation), {{{show}}} (shown navigation)
*** this may not be honoured by the browser
* {{{requestedEl}}} (optional), the element to enter fullscreen mode
** if omitted, it will show the entire page.
\
&gt; //Examples://
{{{
    Fullscreen.toggle();
→ Basic usage (recommended)

    Fullscreen.toggle({ navigationUI : &quot;show&quot; }, myElement);
→ Usage with option (show the navigation UI)
  and given an element
}}}
This API is the one used in the interactive element at the top of the page:
{{{
    &lt;&lt;link &quot;Toggle FullScreen&quot;&gt;&gt;&lt;&lt;run Fullscreen.toggle()&gt;&gt;&lt;&lt;/link&gt;&gt;
}}}
\
&lt;h3&gt;FullScreen Mode and Event Handlers&lt;/h3&gt;\
\
&lt;h4&gt;{{{Fullscreen.onChange()}}}&lt;/h4&gt;\
This API will attach an event handler to the fullscreen.
{{{
    Fullscreen.onChange(handlerFn [, requestedEl])
}}}
It has 2 parameters:
* {{{handlerFn}}}, the function to invoke when the fullscreen mode changes 
* {{{requestedEl}}}, the HTML element to attach the handler to
\
&gt; //Examples//
{{{
    Fullscreen.onChange(function (ev) {
        /* Fullscreen mode changed, so do something. */
    });
→ Basic usage (recommended)

    Fullscreen.onChange(function (ev) {
        /* Fullscreen mode changed on myElement, so do something. */
    }, myElement);
→ With a specified element
}}}
\
&lt;h4&gt;{{{Fullscreen.offChange()}}}&lt;/h4&gt;\
This API will removes an event handler to the fullscreen.
{{{
    Fullscreen.offChange([handlerFn [, requestedEl]])
}}}
It has 2 parameters:
* {{{handlerFn}}}, the function to remove 
** if omitted, it will remove ALL handlers
* {{{requestedEl}}}, the HTML element to remove the handler(s) from
\
&gt; //Examples//
{{{
    Fullscreen.offChange();
    Fullscreen.offChange(originalHandlerFn);
→ Basic usages (recommended)

    Fullscreen.offChange(null, myElement);
    Fullscreen.offChange(originalHandlerFn, myElement);
→ With a specified element
}}}
&gt; &#39;&#39;Note:&#39;&#39; for each case, the first line will remove ALL handlers
\
&lt;h4&gt;{{{Fullscreen.onError()}}}&lt;/h4&gt;\
This API will attach an error handler to the fullscreen mode.
{{{
    Fullscreen.onError(handlerFn [, requestedEl])
}}}
It has 2 parameters:
* {{{handlerFn}}}, the function to invoke when the fullscreen mode encounters an error 
* {{{requestedEl}}}, the HTML element to attach the handler to
\
&gt; //Examples//
{{{
    Fullscreen.onError(function (ev) {
        /* Fullscreen mode changed, so do something. */
    });
→ Basic usage (recommended)

    Fullscreen.onError(function (ev) {
        /* Fullscreen mode changed on myElement, so do something. */
    }, myElement);
→ With a specified element
}}}
\
&lt;h4&gt;{{{Fullscreen.offError()}}}&lt;/h4&gt;\
This API removes an error event handler to the fullscreen mode.
{{{
    Fullscreen.offError([handlerFn [, requestedEl]])
}}}
It has 2 parameters:
* {{{handlerFn}}}, the function to remove 
** if omitted, it will remove ALL handlers
* {{{requestedEl}}}, the HTML element to remove the handler(s) from
\
&gt; //Examples//
{{{
    Fullscreen.offError();
    Fullscreen.offError(originalHandlerFn);
→ Basic usages (recommended)

    Fullscreen.offError(null, myElement);
    Fullscreen.offError(originalHandlerFn, myElement);
→ With a specified element
}}}
&gt; &#39;&#39;Note:&#39;&#39; for each case, the first line will remove ALL handlers

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="139" name="Macro-Adv" tags="chapter menu" position="800,1800" size="200,100">&lt;h1&gt;Advanced Macros&lt;/h1&gt;
Below you will find the last of the macros not discussed in the previous chapters. These macros are considered advanced, as they will either require some HTML/CSS knowledge, or full control of coding logics. They are usually not needed for basic projects. 

* [[DOM Macros and Changing Class of an Element|Macro-DOM-Adv]] 
* [[Loops and Repeats - Two Ways|Macro-For-Repeat]]
* [[Capturing the Value of a Variable|Macro-Capture]]
* [[Emulating PassageDone for one Passage|Macro-Done]]

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="140" name="Macro-DOM-Adv" tags="page" position="800,1900" size="100,100">&lt;h1&gt;DOM Macros and Changing Class of an Element&lt;/h1&gt;
As [[DOM Macros|Macro-ApPreRepCopy]] can affect the content displayed on the page, so can they change //how// elements on the page look, by adding or removing an HTML class from that element. There are three macros in this set:
* {{{&lt;&lt;addclass&gt;&gt;}}}, which will add a class to the targeted element.
* {{{&lt;&lt;removeclass&gt;&gt;}}}, which will remove a class from the targeted element.
* {{{&lt;&lt;toggleclass&gt;&gt;}}}, which will either add or remove a class from the targeted element, depending on whether the class was there in the first place.

&lt;&lt;button &quot;Click Me to Change the Title Colour!&quot;&gt;&gt;
    &lt;&lt;toggleclass &quot;.passage h1&quot; &quot;colour&quot;&gt;&gt;
&lt;&lt;/button&gt;&gt;

The macros have 2 arguments:
* {{{selector}}}, or the targeted element 
* {{{className(s)}}}, the classe(s) to add/remove/toggle from the element 
** This one is optional for {{{&lt;&lt;removeclass&gt;&gt;}}} 
\
The macro will target any element you indicate in the first argument. It can be as simple as {{{h1}}}, which will target //all// large header on the page, to more specific like {{{.passage h1}}}, which will only target the large header in the passage.
{{{
    &lt;&lt;addclass &quot;h1&quot; &quot;colour&quot;&gt;&gt; 
→ will add &quot;.colour&quot; to the &quot;h1&quot; element

    &lt;&lt;removeclass &quot;#passages&quot;&gt;&gt;
→ will remove ALL classes from &quot;#passages&quot;

    &lt;&lt;toggleclass &quot;.dog&quot; &quot;sweet&quot;&gt;&gt;
→ will add/remove the class &quot;.sweet&quot; from the &quot;.dog&quot; element
}}}
&gt; &#39;&#39;Note:&#39;&#39; the element indicated in the macro should be on the page. Otherwise, this will trigger an error.
&gt; When using {{{&lt;&lt;removeclass&gt;&gt;}}} to remove classes, please note that it can also affect class created by the Passage Tags, or in JavaScript settings. You can check what class were removed with the macro via the Inspect Tool of your browser.
\
&lt;h3&gt;An important note on DOM Macros&lt;/h3&gt;\
Since the macros require the targeted element to be on the page, they &#39;&#39;cannot&#39;&#39; be coded as is on the page, due to how the [[page renders|SP-PassageReady-Done]]. As such, you will need either to:
* use the {{{&lt;&lt;link&gt;&gt;}}} or {{{&lt;&lt;button&gt;&gt;}}} macro, letting the player interact with the element,
* use the {{{&lt;&lt;done&gt;&gt;}}} macro, which will trigger when the page is fully rendered,
* use the {{{&lt;&lt;timed&gt;&gt;}}} macro, which will trigger long after the page is rendered,
* code it in the {{{PassageDone}}} special passage (same as the {{{&lt;&lt;done&gt;&gt;}}} macro, but will trigger at every passage render).

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced Macro Menu|Macro-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="141" name="Macro-For-Repeat" tags="page" position="900,1900" size="100,100">&lt;h1&gt;Loops and Repeats - Two Ways&lt;/h1&gt;
There may be situations and mechanics that will require a looping function to repeat code or print elements on the page. This can be done with the {{{&lt;&lt;for&gt;&gt;}}} and {{{&lt;&lt;repeat&gt;&gt;}}} macros.

While both {{{&lt;&lt;for&gt;&gt;}}} and {{{&lt;&lt;repeat&gt;&gt;}}} will loop and repeat their action, they do it in different ways. The {{{&lt;&lt;repeat&gt;&gt;}}} macro will trigger its content at an indicated interval until stopped, while the {{{&lt;&lt;for&gt;&gt;}}} macro will trigger an indicated amount of time (almost) at once. Whether time is involved is the biggest difference.
\
&lt;h3&gt;The {{{&lt;&lt;repeat&gt;&gt;}}} macro&lt;/h3&gt;\
The macro will repeatedly execute its content after the indicated delay. It can be useful as a countdown, check the value of a variable before triggering some code, or replace elements on the page. It can be stopped either by using the {{{&lt;&lt;stop&gt;&gt;}}} macro inside the container or moving to a new passage.

The macro has 2 arguments:
* {{{delay}}}, or the interval between each iteration, should be indicated in seconds or milliseconds.
** the minimum is 40ms
* {{{t8n}}}/{{{transition}}} (optional), whether any insertion on the page should be done with an animation 
{{{
    &lt;&lt;repeat 1s t8n&gt;&gt; 
        /* Your Code */ 
    &lt;&lt;/repeat&gt;&gt;
}}}

When creating a loop, it should be remembered that the macro &#39;&#39;will not stop&#39;&#39; until it encounters a {{{&lt;&lt;stop&gt;&gt;}}} macro within the code (or when moving to a different passage).

An example of a loop, as a countdown timer, updating the text every second, before sending the player to an end passage:
{{{
    &lt;&lt;set $seconds to 10&gt;&gt;

    Countdown: &lt;span id=&quot;countdown&quot;&gt;$seconds seconds&lt;/span&gt; remaining!

	&lt;&lt;repeat 1s&gt;&gt;
		&lt;&lt;set $seconds to --&gt;&gt;
		&lt;&lt;if $seconds is 1&gt;&gt;
            &lt;&lt;replace &quot;#countdown&quot;&gt;&gt;$seconds second&lt;&lt;/replace&gt;&gt;
        &lt;&lt;elseif $seconds gt 0&gt;&gt;
			&lt;&lt;replace &quot;#countdown&quot;&gt;&gt;$seconds seconds&lt;&lt;/replace&gt;&gt;
		&lt;&lt;else&gt;&gt;
			&lt;&lt;replace &quot;#countdown&quot;&gt;&gt;Too Late&lt;&lt;/replace&gt;&gt;
            &lt;&lt;timed 3s&gt;&gt;
                &lt;&lt;goto &quot;Too Late END&quot;&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
			&lt;&lt;stop&gt;&gt;
		&lt;&lt;/if&gt;&gt;
	&lt;&lt;/repeat&gt;&gt;
}}}
\
&lt;h3&gt;The {{{&lt;&lt;for&gt;&gt;}}} macro&lt;/h3&gt;\
The macro will repeatedly execute its content for a certain amount of times, set in three forms: conditional, 3-part conditional, and range. Unless used in combination with the submacros {{{&lt;&lt;break&gt;&gt;}}} and {{{&lt;&lt;continue&gt;&gt;}}}, the loop will execute until the condition in the form is fulfilled.
&gt; &#39;&#39;Note:&#39;&#39; while the macro does not allow for a set number in the macro ({{{&lt;&lt;for 4&gt;&gt;}}} will give an error), there is a way to circumvent it (see end).

This macro is quite useful in displaying content of an inventory, or doing code loop.
\
&lt;h4&gt;The Conditional forms&lt;/h4&gt;\
The conditional forms come in two ways: simple and 3-part. They will execute the content of the macro until the condition is no longer true.
{{{&lt;&lt;for [init]; [conditional]; [post]&gt;&gt;}}}

For this form, the macro has three arguments:
* {{{init}}} (optional), or the initialisation of a counter variable (ex: {{{_i}}})
* {{{conditional}}}, or the conditional expression which should be check at the start of every loop, triggering the code until it is no longer true
* {{{post}}} (optional), the change of value of the counter variable, happening at the end of each loop.
&gt; &#39;&#39;Note:&#39;&#39; the arguments HAVE to be seperated by a semi-colon {{{ ; }}}
\
&gt; //Single Conditional://
{{{
    &lt;&lt;set _filling to [&quot;Apple&quot;, &quot;Chocolate&quot;, &quot;Cherry&quot;, &quot;Pumpkin&quot;]&gt;&gt;
    &lt;&lt;for _done isnot true&gt;&gt;
        &lt;&lt;if _filling.length is 0&gt;&gt;
            &lt;&lt;set _done to true&gt;&gt;
            The Pies Have ALL Been Eaten!
        &lt;&lt;else&gt;&gt;
            &lt;&lt;set _taste to _filling.pluck()&gt;&gt;
            You eat the _taste Pie!
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/for&gt;&gt;

→ This will print //You eat the [type] Pie!// untill all {{{_filling}}} have been listed.
}}}
&gt; //3-Part Conditional://
{{{
    &lt;&lt;set $dwarves to [&quot;Doc&quot;, &quot;Dopey&quot;, &quot;Bashful&quot;, &quot;Grumpy&quot;, &quot;Sneezy&quot;, &quot;Sleepy&quot;, &quot;Happy&quot;]&gt;&gt;

    &lt;ol&gt;
        &lt;&lt;for _i to 0; _i lt $dwarves.length; _i++&gt;&gt;
            &lt;li&gt; $dwarves[_i]&lt;/li&gt;
        &lt;&lt;/for&gt;&gt;
    &lt;/ol&gt;

→ This will print the array as an ordered list
}}}
\
&lt;h4&gt;The Range form&lt;/h4&gt;\
This form will go through all entries of a given collection (ex: values of an array), and stop executing the content when the collection has run out.

There are 4 arguments for this form:
* {{{keyVariable}}} (optional), a temporary variable holding the loop iteration number (starting at 0)
* {{{valueVariable}}}, as a {{{$var}}} or {{{_temp}}}, holding the value of the current loop iteration
* {{{range}}}, required to tell the system this is a range form
* {{{collection}}}, the variable holding as many entries are there will be iterations
** among others, it will accept: arrays, objects, strings (as an array of characters)
{{{
    &lt;&lt;set $dwarves to [&quot;Doc&quot;, &quot;Dopey&quot;, &quot;Bashful&quot;, &quot;Grumpy&quot;, &quot;Sneezy&quot;, &quot;Sleepy&quot;, &quot;Happy&quot;]&gt;&gt;

    &lt;&lt;for _i, _name range $dwarves&gt;&gt;
        &lt;&lt;print _i + 1&gt;&gt;. _name
    &lt;&lt;/for&gt;&gt;

→ will print the content of the array as a list (#. value)
}}}
\
&lt;h4&gt;Using a set number as the amount of iteration&lt;/h4&gt;\
While it is not possible to simply do {{{&lt;&lt;for 4&gt;&gt;}}} to have the loop onyl run four times, you can circumvent this in two ways:
* use Maliface&#39;s {{{&lt;&lt;times&gt;&gt;}}} [[Custom Macro|https://github.com/MalifaciousGames/Mali-s-Macros#the-times-macro]]
* use a widget to &quot;hide&quot; the 3-part contidional form (below)
{{{
    :: Widget [widget]
    &lt;&lt;widget &quot;times&quot; container&gt;&gt;
        &lt;&lt;for _i = 0; _i lt _args[0]; _i++&gt;&gt;
            _contents
        &lt;&lt;/for&gt;&gt;
    &lt;&lt;/widget&gt;&gt;

    :: Story Passage
    &lt;&lt;times 5&gt;&gt;
        → Run code or output stuff five times
    &lt;&lt;/times&gt;&gt;
}}}
\
&lt;h4&gt;Using {{{&lt;&lt;break&gt;&gt;}}} and {{{&lt;&lt;continue&gt;&gt;}}}&lt;/h4&gt;\
The {{{&lt;&lt;for&gt;&gt;}}} macro has also two submacros to skip finishing an iteration or stop the loop altogether before it is completed, respectively with the {{{&lt;&lt;continue&gt;&gt;}}} and {{{&lt;&lt;break&gt;&gt;}}} macros. 

For example, the code below is set to run 10 times, and will check if the number of iteration and:
* not print a number if the iteration is 2, 3, or 5
* stop the looping altogether if the iteration is greater than 8 
{{{
    &lt;&lt;for _i to 0; _i lt 10; _i++&gt;&gt;
        &lt;&lt;if [2,3,5].includes(_i)&gt;&gt;
            &lt;&lt;continue&gt;&gt;
        &lt;&lt;elseif _i gt 8&gt;&gt;
            &lt;&lt;break&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;print _i&gt;&gt;
    &lt;&lt;for&gt;&gt;

→ Printed output:
    0 1 4 6 7 8
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced Macro Menu|Macro-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="142" name="Macro-Capture" tags="page" position="800,2000" size="100,100">&lt;h1&gt;Capturing the Value of a Variable&lt;/h1&gt;
The {{{&lt;&lt;capture&gt;&gt;}}} macro is considered one of the hardest macro to grasp for most Twine users, as its use is pretty limited (to the more complex form of code). Essentially, the macro allows to create a copy of the value of a variable, for the current passage, regardless of whatever happens to that variable later on.

The macro is most useful with interactive macros, loop macros, or delayed ones.

Assuming {{{_n = 1}}} at the start, but changing later down the code:&lt;&lt;nobr&gt;&gt;
	&lt;&lt;set _n = 1&gt;&gt;
	&lt;&lt;button &quot;Non-Captured Value&quot;&gt;&gt;
		&lt;&lt;run alert(_n)&gt;&gt;
	&lt;&lt;/button&gt;&gt;
	&lt;&lt;capture _n&gt;&gt;
        &lt;&lt;button &quot;Captured Value&quot;&gt;&gt;
            &lt;&lt;run alert(_n)&gt;&gt;
        &lt;&lt;/button&gt;&gt;
	&lt;&lt;/capture&gt;&gt;
	&lt;&lt;set _n = 4&gt;&gt;
&lt;&lt;/nobr&gt;&gt;

The macro has 1 argument:
* {{{variableList}}}: the variable, or list of variables, whose value need to be captured 
** the macro will work with both {{{$var}}} and {{{_temp}}}
{{{
    &lt;&lt;capture $var&gt;&gt;...&lt;&lt;/capture&gt;&gt;
    &lt;&lt;capture _var, $var, $varvar&gt;&gt;...&lt;&lt;/capture&gt;&gt;
}}}
\
&lt;h3&gt;Some Examples&lt;/h3&gt;\
&gt; //Below is the code for the interactive example at the top of this passage://
{{{
    &lt;&lt;nobr&gt;&gt;
        &lt;&lt;set _n = 1&gt;&gt;
        &lt;&lt;button &quot;Non-Captured Value&quot;&gt;&gt;
            &lt;&lt;run alert(_n)&gt;&gt;
        &lt;&lt;/button&gt;&gt;
        &lt;&lt;capture _n&gt;&gt;
            &lt;&lt;button &quot;Captured Value&quot;&gt;&gt;
                &lt;&lt;run alert(_n)&gt;&gt;
            &lt;&lt;/button&gt;&gt;
        &lt;&lt;/capture&gt;&gt;
        &lt;&lt;set _n = 4&gt;&gt;
    &lt;&lt;/nobr&gt;&gt;
}}}
While the value of {{{_n}}} changes, only the first button will show the updated value when clicked, as it will take the most recent value of {{{_n}}} (&quot; 4 &quot;). The second button, on the other hand, copied the value of {{{_n}}} before the variable changed (&quot; 1 &quot;), and kept that value.

&gt; //A more complex example involving a loop and an interactive element://
&lt;&lt;nobr&gt;&gt;&lt;&lt;set _what to [&quot;a crab rangoon&quot;, &quot;a gaggle of geese&quot;, &quot;an aardvark&quot;, &quot;the world&#39;s smallest violin&quot;]&gt;&gt;
&lt;&lt;for _i to 0; _i lt _what.length; _i++&gt;&gt;
	&lt;&lt;capture _i&gt;&gt;
		I spy with my little &lt;&lt;linkappend &quot;eye&quot; t8n&gt;&gt;, _what[_i]&lt;&lt;/linkappend&gt;&gt;.
	&lt;&lt;/capture&gt;&gt;
&lt;&lt;/for&gt;&gt;&lt;&lt;/nobr&gt;&gt;
{{{
    &lt;&lt;set _what to [
        &quot;a crab rangoon&quot;,
        &quot;a gaggle of geese&quot;,
        &quot;an aardvark&quot;,
        &quot;the world&#39;s smallest violin&quot;
    ]&gt;&gt;
    &lt;&lt;for _i to 0; _i lt _what.length; _i++&gt;&gt;
        &lt;&lt;capture _i&gt;&gt;
            I spy with my little &lt;&lt;linkappend &quot;eye&quot; t8n&gt;&gt;, _what[_i]&lt;&lt;/linkappend&gt;&gt;.
        &lt;&lt;/capture&gt;&gt;
    &lt;&lt;/for&gt;&gt;
}}}
For each element of the array {{{_what}}}, the loop will create a new sentence, within which is linked a different variable of that array.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced Macro Menu|Macro-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="143" name="Macro-Done" tags="page" position="900,2000" size="100,100">&lt;h1&gt;Emulating PassageDone for one Passage&lt;/h1&gt;
While it is possible to target one single passage with the [[Special Passage|SP-PassageReady-Done]] {{{PassageDone}}}, the same can be achieved with the {{{&lt;&lt;done&gt;&gt;}}} macro inside that particular passage. Instead of having the code run on every visited passage, it will only trigger where {{{&lt;&lt;done&gt;&gt;}}} has been coded.
&gt; &#39;&#39;Note&#39;&#39;: for multiple passages use, {{{PassageDone}}} should be preferred. Or even assigning code to the {{{:passagedisplay}}} [[event|Events-Passage]] in the JavaScript.

This macro is especially useful to trigger DOM Macros whether it is [[adding elements to the page|Macro-ApPreRepCopy]] or [[changing the class of that element|Macro-DOM-Adv]].
&gt; &#39;&#39;Note:&#39;&#39; the player will not see any delay between the rendering of the passage and triggering the macro. For delayed needs, use the {{{&lt;&lt;timed&gt;&gt;}}} macro.
{{{
    @@#spy;@@

    &lt;&lt;done&gt;&gt;
        &lt;&lt;replace &quot;#spy&quot;&gt;&gt;I spy with my little eye, a crab rangoon.&lt;&lt;/replace&gt;&gt;
    &lt;&lt;/done&gt;&gt;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Advanced Macro Menu|Macro-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="144" name="Macro" tags="chapter menu" position="2900,1800" size="200,100">&lt;h1&gt;Creating your Own Macro&lt;/h1&gt;
If you are looking to include a specific behaviour in your project that is not covered by the macros already built in SugarCube or custom ones available on the internet, you may want to consider creating your own.
SugarCube has many API to help you build your custom macros, or even chose to edit already-included macros.
&gt; &#39;&#39;Note:&#39;&#39; Knowledge of JavaScript and understanding of the SugarCube format is very important here! 

* [[The Base APIs for Macros|Macro-API]] 
* [[Using Macro Context Objects in the handler|Macro-Context]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="145" name="Macro-API" tags="page" position="2900,1900" size="100,100">&lt;h1&gt;The Base APIs for Macros&lt;/h1&gt;
\
&lt;h3&gt;{{{Macro.add()}}}&lt;/h3&gt;\
If you want to create a custom macro in SugarCube, you will need to use this API. Knowledge of JavaScript/jQuery and understanding on how SugarCube works is required.

The API has 2 parameters:
* {{{name}}}: the name (or array of names) of the macro to add
** must start with a letter, and consist of characters from the basic Latin alphabet (A → Z)
** you can also use numbers, underscores, and hyphens after the letter 
* {{{definition}}}: how the macro will behave (see below)
** to copy the definition of an existing macro, you can indicate the name of //that// macro instead.
{{{
    Macro.add(name , definition)

    Macro.add([&#39;link&#39;, &#39;button&#39;] , {/* definition code */})
→ &lt;&lt;link&gt;&gt; and &lt;&lt;button&gt;&gt; will behave the same

    Macro.add(&#39;run&#39;, &#39;set&#39;);
→ &lt;&lt;run&gt;&gt; is an alias of &lt;&lt;set&gt;&gt;
}}}

The definition of a macro will be an object with multiple properties:
* {{{skipArgs}}} (optional): disable processing arguments into a discrete form (i.e. use the whole expression as an arguments)
** you can indicate {{{true}}} to affect the macro and macro tags (if defined), or the array of tags where it is relevant.
* {{{tags}}} (optional): will signify that the macro is a container macro (with an opening and closing tag)
** you can indicate an array of child tags (sub-macro) or {{{null}}} for a simpler container
* {{{handler}}}: the macro&#39;s function, called without arguments
** you may need some [[macro context objects|Macro-Context]] to parse the function
&gt; &#39;&#39;Note:&#39;&#39; you can add other properties for internal use (JavaScript knowledge required)
\
&gt; //Example from the Documentation for a simple implementation of// {{{&lt;&lt;if&gt;&gt;}}}
{{{
    Macro.add(&#39;if&#39;, {
        skipArgs : true,
        tags     : [&#39;elseif&#39;, &#39;else&#39;],
        handler  : function () {
            try {
                for (var i = 0, len = this.payload.length; i &lt; len; ++i) {
                    if (
                        this.payload[i].name === &#39;else&#39; ||
                        !!Scripting.evalJavaScript(this.payload[i].args.full)
                    ) {
                        jQuery(this.output).wiki(this.payload[i].contents);
                        break;
                    }
                }
            }
            catch (ex) {
                return this.error(&#39;bad conditional expression: &#39; + ex.message);
            }
        }
    });
}}}
\
&lt;h3&gt;{{{Macro.delete()}}}&lt;/h3&gt;\
Like the code implies, this API will remove any existed macro listed inside its parentheses.
This can be useful if you are looking to edit one of the Built-In [[macros|Macros List]] (by deleting the macro, and using {{{Macro.add()}}} to reintroduce it).
{{{
    Macro.delete(&quot;amacro&quot;)
    Macro.delete([&quot;amacro&quot;, &quot;bmacro&quot;])
}}}
&gt; &#39;&#39;Note:&#39;&#39; The macros targeted &#39;&#39;must be defined prior&#39;&#39; to using this API.
\
&lt;h3&gt;{{{Macro.has()}}}&lt;/h3&gt;\
This API will check whether the indicated macro exists in the code. 
{{{
    Macro.has(&quot;print&quot;)
}}}
\
&lt;h3&gt;{{{Macro.get()}}}&lt;/h3&gt;\
This API will look at the definition of the targeted macro, or return NULL if there is none.
The output of this API is an oject containing the definition of the macro
{{{
    Macro.get(&quot;print&quot;)
}}}
\
&lt;h3&gt;{{{Macro.tags.has()}}}&lt;/h3&gt;\
This API will check whether the indicated macro tag exists - the macro tag being any child macro inside a container macro (e.g. {{{&lt;&lt;else&gt;&gt;}}} and {{{&lt;&lt;elseif&gt;&gt;}}} for {{{&lt;&lt;if&gt;&gt;}}}).
{{{
    Macro.tags.has(&quot;else&quot;)
}}}
\
&lt;h3&gt;{{{Macro.tags.get()}}}&lt;/h3&gt;\
This API will return with the name of the all the macros which have included the targeted macro tag within their definition, or NULL on failure.
{{{
    Macro.tags.get(&quot;option&quot;)
→ will result in [&#39;cycle&#39;, &#39;listbox&#39;]
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Macro API Menu|Macro]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="146" name="Macro-Context" tags="page" position="3000,1900" size="100,100">&lt;h1&gt;Using Macro Context Objects in the handler&lt;/h1&gt;
While Macro [[handlers|Macro-API]] are called with no arguments, you can use {{{this}}} and the context object properties below to refer to different components of the macro (e.g. macro arguments and expressions, data, methods).
\
&lt;h3&gt;Refering to the Macro Arguments and Expressions&lt;/h3&gt;\
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.args}}}&lt;/h4&gt;\
This property will refer to the arguments you can indicate in a macro. It is saved as an array.
&gt; Assuming that {{{&lt;&lt;someMacro &quot;a&quot; &quot;b&quot; &quot;c&quot;&gt;&gt;}}}:
{{{
    this.args.length  → 3
    this.args[0]      → &#39;a&#39;
    this.args[1]      → &#39;b&#39;
    this.args[2]      → &#39;c&#39;
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.args.full}}}&lt;/h4&gt;\
This property will convert the argument into native JavaScript code. It is useful for expression arguments.
&gt; Assuming that {{{&lt;&lt;if &quot;a&quot; is &quot;b&quot;&gt;&gt;}}}:
{{{
    this.args.full  → &#39;&quot;a&quot; === &quot;b&quot;&#39;
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.args.raw}}}&lt;/h4&gt;\
This property will take the unprocessed expression.
&gt; Assuming that {{{&lt;&lt;if &quot;a&quot; is &quot;b&quot;&gt;&gt;}}}:
{{{
    this.args.raw  → &#39;&quot;a&quot; is &quot;b&quot;&#39;
}}}
\
&lt;h3&gt;Referencing the Macro Information&lt;/h3&gt;\
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.name}}}&lt;/h4&gt;\
This property will refer to the name of the macro.
&gt; Assuming that {{{&lt;&lt;someMacro...&gt;&gt;}}}
{{{
    this.name  → &#39;someMacro&#39;
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.self}}}&lt;/h4&gt;\
This property will refer to the definition of the macro, indicated in the second property of {{{Macro.add()}}}
{{{
    this.self → { /* definition object */ }
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.parent}}}&lt;/h4&gt;\
This property will refer to the macro&#39;s parent (or null, if it does not have a parent).
{{{
    this.parent → /* name of parent or NULL */
}}}

\
&lt;h4&gt;{{{&lt;MacroContext&gt;.output}}}&lt;/h4&gt;\
This property references the output element, as an HTML Elment object.
{{{
    this.output
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.parser}}}&lt;/h4&gt;\
This property will refer to the parser instance that generated the macro call.
{{{
    this.parser
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.payload}}}&lt;/h4&gt;\
This property is only useful for container macros, and will not work otherwise. The text of the macro is parsed into discrete payload objects by tag, each having the following properties:
* {{{name}}}: name of the current tag 
* {{{args}}}: similar to {{{&lt;MacroContext&gt;.args}}}, but regarding the current tag
** {{{args.full}}} will be similar to {{{&lt;MacroContext&gt;.args.full}}}, and {{{args.raw}}} to {{{&lt;MacroContext&gt;.args.raw.}}}
* {{{contents}}}: the content between the current tag and the next.
{{{
    this.payload 
    this.payload.name 
    this.payload.args 
    this.payload.contents

    this.payload[0] → the text between the first and second tag of the macro
}}}
\
&lt;h3&gt;Macro Context Methods&lt;/h3&gt;\
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.contextHas()}}}&lt;/h4&gt;\
This method will look at whether the macro&#39;s parent(s) passed the test implemented by the defined filter function.
&gt; //Example for// {{{&lt;&lt;break&gt;&gt;}}}:
{{{
    if (this.contextHas(ctx =&gt; ctx.name === &#39;for&#39;)) {
        TempState.break = this.name === &#39;continue&#39; ? 1 : 2;
    }
    else {
        return this.error(&#39;must only be used in conjunction with its parent macro &lt;&lt;for&gt;&gt;&#39;);
    }
→ if &lt;&lt;break&gt;&gt; is not used inside a &lt;&lt;for&gt;&gt;, you will get an error
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.contextSelect()}}} and {{{&lt;MacroContext&gt;.contextSelectAll()}}}&lt;/h4&gt;\
These two methods work similarly to {{{&lt;MacroContext&gt;.contextHas()}}}, in that it will check whether the macro&#39;s ancestor(s) passed the test implemented byt the given filter function.
If passed:
* {{{&lt;MacroContext&gt;.contextSelect()}}} will return an object of the first ancestor 
* {{{&lt;MacroContext&gt;.contextSelectAll()}}} will return an array of objects of all ancestors 
If failed:
* {{{&lt;MacroContext&gt;.contextSelect()}}} will return NULL
* {{{&lt;MacroContext&gt;.contextSelectAll()}}} will return an empty array 
&gt; //Examples://
{{{
    var includeAncestor = function (ctx) { return ctx.name === &quot;include&quot;; };
    this.contextSelect(includeAncestor);  
→ Returns the first &lt;&lt;include&gt;&gt; macro ancestor

    var includeAncestor = function (ctx) { return ctx.name === &quot;include&quot;; };
    this.contextSelectAll(includeAncestor);  
→ Returns an array of all &lt;&lt;include&gt;&gt; macro ancestors
}}}
\
&lt;h4&gt;{{{&lt;MacroContext&gt;.createShadowWrapper()}}}&lt;/h4&gt;\
&gt; &#39;&#39;Forenote:&#39;&#39; this method is only useful when you have asynchronous callback that invokes code/content that needs to access story and/or temporary variables shadowed by {{{&lt;&lt;capture&gt;&gt;}}}. &#39;&#39;Do not use this if you don&#39;t know what this means&#39;&#39;. /* 
    Honestly, I have no idea what this does really, but it&#39;s macro relevant I guess.
    TME (the creator of SugarCube) REALLY does not recommend using this API unless you are absolutely sure what you are doing. And even then, cases where you would need it are super small... 
*/
This method creates a callback wrapper around the given parameters, which are themselves callbacks, that shadows variables, as necessary, for its first callback parameter. You can use up to 3 parameters (all functions):
* {{{callback}}}: The main callback function, executed when the wrapper is invoked. Receives access to variable shadows.
* {{{doneCallback}}}: (optional) The finalization callback function, executed after the main callback returns. Does not receive access to variable shadows.
* {{{startCallback}}}: (optional) The initialization callback function, executed before the main callback is invoked. Does not receive access to variable shadows.
\
&gt; Basic Example:
{{{
    $someElement.on(
        &#39;some_event&#39;, 
        this.createShadowWrapper(function (ev) {
            /* main asynchronous code */
        })
    );
}}}
&gt; //With an optional doneCallback//
{{{
    $someElement.on(&#39;some_event&#39;, this.createShadowWrapper(
        function (ev) {
            /* main asynchronous code */
        },
        function (ev) {
            /* asynchronous code invoked after the main code */
        }
    ));
}}}
&gt; //With an optional doneCallback and startCallback//
{{{
    $someElement.on(&#39;some_event&#39;, this.createShadowWrapper(
        function (ev) {
            /* main asynchronous code */
        },
        function (ev) {
            /* asynchronous code invoked after the main code */
        },
        function (ev) {
            /* asynchronous code invoked before the main code */
        }
    ));
}}}
&gt; //Example from the macro// {{{&lt;&lt;link&gt;&gt;}}}:
{{{
    $link
		.addClass(`macro-${this.name}`)
		.ariaClick({
			namespace : &#39;.macros&#39;,
			role      : passage != null ? &#39;link&#39; : &#39;button&#39;, // equality for null
			one       : passage != null // lazy equality for null
		}, this.createShadowWrapper(
			this.payload[0].contents !== &#39;&#39;
				? () =&gt; Wikifier.wikifyEval(this.payload[0].contents.trim())
				: null,
			passage != null // lazy equality for null
				? () =&gt; Engine.play(passage)
				: null
		))
		.appendTo(this.output);

→ the code will look at whether there is code to trigger inside the &lt;&lt;link&gt;&gt; macro 
    then it will look at whether there is a passage to go to
}}}

\
&lt;h4&gt;{{{&lt;MacroContext&gt;.error()}}}&lt;/h4&gt;\
This property will render an error message for then the macro can&#39;t be processed. It requires an error message in the form of a string.
&gt; //Assugming that// {{{&lt;&lt;someMacro …&gt;&gt;}}}
{{{
    return this.error(&quot;oops&quot;);

→ will output on the page as:
    &#39;&lt;&lt;someMacro&gt;&gt;: oops&#39;
}}}
The message can include full expressions, including pure JavaScript rendering.
&gt; //Error message from// {{{&lt;&lt;if&gt;&gt;}}}
{{{
    return this.error(`whitespace is not allowed between the &quot;else&quot; and &quot;if&quot; in &lt;&lt;elseif&gt;&gt; clause${i &gt; 0 ? &#39; (#&#39; + i + &#39;)&#39; : &#39;&#39;}`)
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Macro API Menu|Macro]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="147" name="Methods-Adv" tags="chapter menu" position="1100,1800" size="200,100">&lt;h1&gt;More Variable and Interaction Methods&lt;/h1&gt;
In the [[Methods]] chapter, methods were defined JavaScript blocks of code designed to do a specific task, linked to a reciever, like a variable, to run. 
This chapter includes more complex methods, often involving functions. Knowledge of both JavaScript and jQuery is required here.

* [[More Methods to change Variables|Method-Variables]] 
* [[jQuery Methods and Interactivity|Method-jQuery]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="148" name="Method-Variables" tags="page" position="1100,1900" size="100,100">&lt;h1&gt;More Methods to change Variables&lt;/h1&gt;
The methods below should be used with other macros, such as {{{&lt;&lt;set&gt;&gt;}}}, {{{&lt;&lt;run&gt;&gt;}}}, {{{&lt;&lt;print&gt;&gt;}}} or even {{{&lt;&lt;if&gt;&gt;}}}, as well as JavaScript.
\
&lt;h3&gt;String-related Methods&lt;/h3&gt;\
&lt;h4&gt;{{{String.format()}}}&lt;/h4&gt;\
This method will help merge and format strings together, following the coded arguments.
{{{
    String.format(format , arguments…)
}}}
This method had 2 parameters:
* {{{format}}} (string), consisting of normal text and format items.
** {{{index}}}, starting from {{{0}}}, indicating where to place the item 
** {{{alignment}}} (optional), inside the index, length of the field and the alignment of the argument within the field (positive = right, negative = left)
* {{{arguments}}}, a list of arguments, corresponding to the elements to place in the index.
** can be a list of strings {{{&quot;word&quot;, &quot;word&quot;}}} or an array {{{[&#39;word&#39;, &#39;word&#39;]}}}
\
&gt; //Examples://
{{{
→ List of arguments:
    String.format(&quot;{0}, {1}!&quot;, &quot;Hello&quot;, &quot;World&quot;) 
    → returns &quot;Hello, World!&quot;
    
→ Array argumment:
    String.format(&quot;{0}, {1}!&quot;, [ &quot;Hello&quot;, &quot;World&quot; ])
    → returns &quot;Hello, World!&quot;

→ Alignment right:
    String.format(&quot;{0,6}&quot;, &quot;foo&quot;)
    → returns &quot;   foo&quot;

→ Alignment left:
    String.format(&quot;{0,-6}&quot;, &quot;foo&quot;)
    → returns &quot;foo   &quot;
}}}
\
You can also use variables for either parameter.
&gt; //Assuming that// {{{_var = Hello}}} and {{{_var2 = World}}}
{{{
    String.format(&quot;{0}, {1}!&quot;, &quot;_var&quot;, &quot;_var2&quot;)

→ will be the same as:
    String.format(&quot;{0}, {1}!&quot;, [ &quot;Hello&quot;, &quot;World&quot; ])
}}}
&gt; //Using the method inside// {{{&lt;&lt;set&gt;&gt;}}}
{{{
    &lt;&lt;set $var to String.format(&quot;{0}, {1}!&quot;, &quot;_var&quot;, &quot;_var2&quot;)&gt;&gt;
→ will be the same as:
    &lt;&lt;set $var to _var + &quot;, &quot; + _var2 + &quot;!&quot;&gt;&gt;
}}}
\
&lt;h4&gt;{{{RegExp.escape()}}}&lt;/h4&gt;\
This method will take the given string and return an expression where the [[metacharacters|https://www.w3schools.com/jsref/jsref_obj_regexp.asp]] would be ignored.
{{{
    RegExp.escape(&#39;That will be $5 (cash only)&#39;)   
→ returns &#39;That will be \$5 \(cash only\)&#39;
}}}
&gt; &#39;&#39;Note:&#39;&#39; there will only be very specific situations where this method is relevant to a project.
\
&lt;h3&gt;Array-related Methods&lt;/h3&gt;\
\
&lt;h4&gt;{{{&lt;Array&gt;.countWith()}}}&lt;/h4&gt;\
This method will count every element in an array fitting the defined function. It will be useful to count the number of elements in an array for complex conditions requiring functions.
{{{
    &lt;Array&gt;.countWith(predicate [, thisArg])
}}}
It has 2 parameters:
* {{{predicate}}}, the function used to test each member of the array. It is called with 3 arguments:
** {{{value}}}, the processed member 
** {{{index}}} (optional), the index of the member being processed
** {{{array}}} (optional), the array being processed
* {{{thisArg}}} (optional), the value used as {{{this}}}
\
&gt; //Examples://
{{{
→ $fruits = [&quot;Apples&quot;, &quot;Oranges&quot;, &quot;Plums&quot;, &quot;Oranges&quot;]
    
    $fruits.countWith(
        function (fruit) { 
            return fruit === &quot;Oranges&quot;; 
        }
    )
}}}
This will return as 2, since there are 2 counts of {{{Oranges}}} in the array.
{{{
→ $numbers = [1, 2.3, 4, 76, 3.1]

    $numbers.countWith(
        Number.isInteger
    ) 
}}}
This will return as 3, since there are 3 counts of full numbers in the array. 
{{{
→ $items = [
    { name : &#39;Healing potion&#39;, kind : &#39;potion&#39; },
    { name : &#39;Longsword&#39;, kind : &#39;weapon&#39; },
    { name : &#39;Mana potion&#39;, kind : &#39;potion&#39; },
    { name : &#39;Dead rat&#39;, kind : &#39;junk&#39; },
    { name : &#39;Endurance potion&#39;, kind : &#39;potion&#39; },
    { name : &#39;Shortbow&#39;, kind : &#39;weapon&#39; }
    ]

    $items.countWith(
        function (item) { 
            return item.kind === &#39;junk&#39;;
        }
    )  
}}}
This will return as 1, since there is only 1 count of junk object in the array.
\
&lt;h4&gt;{{{&lt;Array&gt;.deleteWith()}}}&lt;/h4&gt;\
This method will remove every element in an array fitting the defined function. It will be useful to remove elements in an array for complex conditions requiring functions.
{{{
    &lt;Array&gt;.deleteWith(predicate [, thisArg])
}}}
It has 2 parameters:
* {{{predicate}}}, the function used to test each member of the array. It is called with 3 arguments:
** {{{value}}}, the processed member 
** {{{index}}} (optional), the index of the member being processed
** {{{array}}} (optional), the array being processed
* {{{thisArg}}} (optional), the value used as {{{this}}}
\
&gt; //Examples, assuming that:// {{{$fruits = [&quot;Apples&quot;, &quot;Apricots&quot;, &quot;Oranges&quot;]}}}
{{{
    $fruits.deleteWith(function (val) {
        return val === &quot;Apricots&quot;;
    })

→ the function removes any instance of [&quot;Apricots&quot;]
    → $fruits = [&quot;Apples&quot;, &quot;Oranges&quot;]
}}}
{{{
    $fruits.deleteWith(function (val) {
        return val.startsWith(&quot;Ap&quot;);
    })

→ the function removes any instance starting with [&quot;Ap&quot;]
    → $fruits = [&quot;Oranges&quot;]
}}}
&gt; //Examples, assuming that:// {{{$fruits = [{ name : &quot;Apples&quot; }, { name : &quot;Apricots&quot; }, { name : &quot;Oranges&quot; }]}}}
{{{
    $fruits.deleteWith(function (val) {
        return val.name === &quot;Apricots&quot;;
    })

→ the function will remove any iteration where {name : &quot;Apricots&quot;}
    → $fruits = [{ name : &quot;Apples&quot; }, { name : &quot;Oranges&quot; }]
}}}
{{{
    $fruits.deleteWith(function (val) {
        return val.name.startsWith(&quot;Ap&quot;);
    })

→ this function will remove any interation where {name} starts with {&quot;Ap&quot;}
    → $fruits = [{ name : &quot;Oranges&quot; }]
}}}
\
&lt;h4&gt;{{{&lt;Array&gt;.flatMap()}}}&lt;/h4&gt;\
This method will flatten an array in accordance to a defined function. 
{{{
    &lt;Array&gt;.flatMap(callback [, thisArg])
}}}
&gt; &#39;&#39;Note:&#39;&#39; it is identical to {{{&lt;Array&gt;.map(…).flat()}}}.
It has 2 parameters:
* {{{callback}}}, the function used to produce members of the edited array. It is called with 3 arguments:
** {{{value}}}, the processed member 
** {{{index}}} (optional), the index of the member being processed
** {{{array}}} (optional), the array being processed
* {{{thisArg}}} (optional), the value used as {{{this}}} when executing {{{callback}}}
&gt; //Assuming that:// {{{$npa = [&quot;Alfa&quot;, &quot;Bravo Charlie&quot;, &quot;Delta Echo Foxtrot&quot;]}}}
{{{
    $npa.flatMap(function (val) {
        return val.split(&quot; &quot;);
    })

→ this function will flatten the array 
  by removing all spaces between words
    → $npa = [&quot;Alfa&quot;, &quot;Bravo&quot;, &quot;Charlie&quot;, &quot;Delta&quot;, &quot;Echo&quot;, &quot;Foxtrot&quot;]
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Methods Menu|Methods-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="149" name="Method-jQuery" tags="page" position="1200,1900" size="100,100">&lt;h1&gt;jQuery Methods and Interactivity&lt;/h1&gt;
\
&lt;h3&gt;{{{&lt;jQuery&gt;.ariaClick()}}}&lt;/h3&gt;\
This method will make the target element WAI-ARIA-compatible clickable. This means the element will get accessibility attributes and can be activated with a mouse click, or key press (enter/return/spacebar).
{{{
    &lt;jQuery&gt;.ariaClick([options ,] handler)
}}}
The method has 2 parameters:
* {{{options}}} (optional), options to be used when creating the clickable
** {{{namespace}}}, list of event namespaces
** {{{one}}}, if indicated, the clickable is single-use 
** {{{selector}}}, if indicated, the selector will filter the descendants that triggered the event.
** {{{data}}}, to be passed to the handler 
** {{{controls}}}, value for {{{aria-controls}}}
** {{{pressed}}}, value for {{{aria-pressed}}}
** {{{label}}}, value for {{{aria-label}}} and {{{title}}}
* {{{handler}}} (function), the callback to invoke when the element is activated.
\
&gt; //Examples//
{{{
→ existing element: &lt;a id=&quot;so-clicky&quot;&gt;Click me&lt;/a&gt;
    $(&#39;#so-clicky&#39;).ariaClick(function (event) {
        /* do stuff */
    });
}}}
{{{
→ creating a basic link + appending output:
    $(&#39;&lt;a&gt;Click me&lt;/a&gt;&#39;)
        .ariaClick(function (event) {
            /* do stuff */
        })
	    .appendTo(output);
}}}
{{{
→ creating a basic button + appending output:
    $(&#39;&lt;button&gt;Click me&lt;/button&gt;&#39;)
        .ariaClick(function (event) {
            /* do stuff */
        })
        .appendTo(output);
}}}
{{{
→ creating a link with options + appending output:
    $(&#39;&lt;a&gt;Click me&lt;/a&gt;&#39;)
        .ariaClick({
            one   : true,
            label : &#39;This single-use link does stuff.&#39;
        }, function (event) {
            /* do stuff */
        })
        .appendTo(output);
}}}
\
&lt;h3&gt;{{{&lt;jQuery&gt;.ariaDisabled()}}}&lt;/h3&gt;\
This method will change the &#39;&#39;disabled&#39;&#39; state of the target WAI-ARIA-compatible clickable element(s).
{{{
    &lt;jQuery&gt;.ariaDisabled(state)
}}}
&gt; &#39;&#39;Note:&#39;&#39; this method will only to work with clickables created via {{{&lt;jQuery&gt;.ariaClick()}}}, which is what SugarCube uses to handle the link markups and macros.
\
&gt; //Examples://
{{{
$(&#39;.macro-link&#39;).ariaDisabled(true)   
    → Disable all &lt;&lt;link&gt;&gt; on the page
$(&#39;.macro-link&#39;).ariaDisabled(false)  
    → Enables  all &lt;&lt;link&gt;&gt; on the page
}}}
\
&lt;h3&gt;{{{&lt;jQuery&gt;.ariaIsDisabled()}}}&lt;/h3&gt;\
This method will check whether the targetted WAI-ARIA-compatible clickable element(s) is(are) disabled.
{{{
    &lt;jQuery&gt;.ariaIsDisabled()
}}}
&gt; &#39;&#39;Note:&#39;&#39; this method will only to work with clickables created via {{{&lt;jQuery&gt;.ariaClick()}}}, which is what SugarCube uses to handle the link markups and macros.
\
&gt; //Examples assuming that an element {{{#so-clicky}}} exists//:
{{{
$(&#39;#so-clicky&#39;).ariaIsDisabled()
  → Returns true if {#so-clicky} is disabled
  → Returns false if {#so-clicky} is enabled
}}}
\
&lt;h3&gt;{{{jQuery.wiki()}}}&lt;/h3&gt;\
This methos will wikify the indicated content source(s) and discard the result (unless there are errors). This is only useful when you want to invoke a macro for its side-effects but don&#39;t need the output.
{{{
    jQuery.wiki()
}}}
It has 1 parameter:
* {{{sources}}}: the list of content sources 
&gt; //Example://
{{{
    $.wiki(&#39;&lt;&lt;somemacro&gt;&gt;&#39;);  
→ Invokes the &lt;&lt;somemacro&gt;&gt; macro, discarding any output
}}}
\
&lt;h3&gt;{{{&lt;jQuery&gt;.wiki()}}}&lt;/h3&gt;\
This method is similar to the previous one, except it will append the output of the content source(s) to the targetted element(s).
{{{
    &lt;jQuery&gt;.wiki(sources…)
}}}
It has 1 parameter:
* {{{sources}}}: the list of content sources 
&gt; //Examplem given the element:// {{{&lt;div id=&quot;the-box&quot;&gt;&lt;/div&gt;}}}
{{{
    $(&#39;#the-box&#39;).wiki(&#39;Who //are// you?&#39;); 
→ will append to {#the-box}
    &quot;Who &lt;em&gt;are&lt;/em&gt; you?&quot;
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Methods Menu|Methods-Adv]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="150" name="PassageAPI" tags="chapter page" position="3500,2000" size="200,100">&lt;h1&gt;Managing Passage Properties with APIs&lt;/h1&gt;
The APIs below deal with properties of the Passage object, which is returned by the {{{Story.get()}}} [[API|StoryAPI]].
&gt; &#39;&#39;Note:&#39;&#39; the information in those properties should be treated as &#39;&#39;read-only&#39;&#39;, as modifying them can lead to unexpected behaviour.
\
&lt;h3&gt;{{{&lt;Passage&gt;.domId}}}&lt;/h3&gt;\
This API keeps the DOM ID of the passage, created from the slugified passage title.
{{{
    &lt;Passage&gt;.domId
}}}
\
&lt;h3&gt;{{{&lt;Passage&gt;.tags}}}&lt;/h3&gt;\
This API keeps the tags of the passage, as an array.
{{{
    &lt;Passage&gt;.tags
}}}
\
&lt;h3&gt;{{{&lt;Passage&gt;.text}}}&lt;/h3&gt;\
This API will return the raw text of the passage.
{{{
    &lt;Passage&gt;.text
}}}
\
&lt;h3&gt;{{{&lt;Passage&gt;.title}}}&lt;/h3&gt;\
This API keeps the title of the passage.
{{{
    &lt;Passage&gt;.title
}}}
\
&lt;h3&gt;{{{&lt;Passage&gt;.description()}}}&lt;/h3&gt;
This API returns the description of the passage, created from either an excerpt of the passage or defined by the {{{Config.passages.descriptions}}} [[setting|Config-Passage]].
&gt; //Example://
{{{
    var passage = Story.get(&quot;The Ducky&quot;);
    passage.description()  
→ returns the description of &quot;The Ducky&quot; passage
}}}
\
&lt;h3&gt;{{{&lt;Passage&gt;.processText()}}}&lt;/h3&gt;\
This API returns the processed text of the passage,  created from applying {{{nobr}}} tag and image passage processing to its raw text.
&gt; //Example://
{{{
    var passage = Story.get(&quot;The Ducky&quot;);
    passage.processText()  
→ returns the fully processed text of &quot;The Ducky&quot; passage
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="151" name="SaveAPI" tags="chapter menu" position="2000,1800" size="200,100">&lt;h1&gt;The Save APIs and Further Saving Configurations&lt;/h1&gt;
While the Config APIs have [[configuration settings|Config-Saves]], it may not be enough for the customisation you may want to achieve. This is where the Save APIs come in.
&gt; &#39;&#39;Note:&#39;&#39; in-browser saves (autosave/slow saves) are largely incompatible with Private Browsing Mode and Cookies/Cache blockers. Users may get an error message on start in those cases.
\
* [[Save Objects and Their Contents|SaveAPI-Objects]] 
* [[The Basic APIs of the Save Elements|SaveAPI-General]] 
* [[Managing the Save Slots|SaveAPI-Slots]] 
* [[Managing the Autosave Slot|SaveAPI-Autosave]] 
* [[Using Save-related Events|SaveAPI-Events]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="152" name="SaveAPI-Objects" tags="page" position="2000,1900" size="100,100">&lt;h1&gt;Save Objects and Their Contents&lt;/h1&gt;
When saved, a playthrough resides in a save object, with multiple property defined specifically for that playthrough.
&gt; &#39;&#39;Note:&#39;&#39; the exported save (Save to Disk) is encoded by default

The save object has 6 properties:
* {{{id}}}, the story&#39;s [[save ID|Config-Saves]]
* {{{state}}}, the marshaled story history 
** {{{history}}}, the arrays of moment objects 
*** {{{title}}}, the title of the associated passage 
*** {{{variables}}}, the current variable store object ({{{State.variables}}})
*** {{{pull}}} (optional), current pull count of SugarCube&#39;s seedable PRNG
** {{{index}}}, the index of active moments 
** {{{expired}}} (optional), the array of expired moments (influenced by the [[Max State|Basic-API-Config]])
** {{{seed}}} (optional), seed of SugarCube&#39;s seedable PRNG
* {{{title}}}, the title of the save.
* {{{date}}}, when the save was created (milliseconds elapsed since epoch)
* {{{metadata}}}, save metadata (end-user specified - JSON serializable)
* {{{version}}}, save [[version|Config-Saves]]
\
&gt; &#39;&#39;Note:&#39;&#39; adding additional properties is not recommended. Instead use the metadata property.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Save APIs Menu|SaveAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="153" name="SaveAPI-General" tags="page" position="2100,1900" size="100,100">&lt;h1&gt;The Basic APIs of the Save Elements&lt;/h1&gt;
\
&lt;h3&gt;The General Save APIs&lt;/h3&gt;\
\
&lt;h4&gt;{{{Save.clear()}}}&lt;/h4&gt;\
This API will delete all slot saves and the autosave (if enabled). This is the code behind the //Delete All// button in the Save Popup.
{{{
    Save.clear()
}}}
\
&lt;h4&gt;{{{Save.get()}}}&lt;/h4&gt;\
This API will return the saves object (all in-browser saves).
{{{
    Save.get()
}}}
\
&lt;h4&gt;{{{Save.ok()}}}&lt;/h4&gt;\
This API will check whether the project includes slot saves and autosaves.
{{{
    Save.ok()

    if (Save.ok()) {
	    /* Code to manipulate saves. */
    }

    &lt;&lt;if Save.ok()&gt;&gt; ... &lt;&lt;/if&gt;&gt;
}}}
\
&lt;h3&gt;Importing and Exporting to Disk&lt;/h3&gt;\
The following APIs are the ones used in the Save Popup, with the //Export to Disk// and //Load from Disk// buttons.
&lt;center&gt; &lt;&lt;link &quot;Export to Disk&quot;&gt;&gt;&lt;&lt;run Save.export()&gt;&gt;&lt;&lt;/link&gt;&gt; | &lt;&lt;link &quot;Load From Disk&quot;&gt;&gt;
        &lt;&lt;script&gt;&gt;
        jQuery(document.createElement(&#39;input&#39;))
            .prop(&#39;type&#39;, &#39;file&#39;)
            .on(&#39;change&#39;, Save.import)
            .trigger(&#39;click&#39;);
        &lt;&lt;/script&gt;&gt;
    &lt;&lt;/link&gt;&gt;&lt;/center&gt;
\
&lt;h4&gt;{{{Save.export()}}}&lt;/h4&gt;\
This API will save the current playthrough (or loaded save) to the device&#39;s disk. The file is saved under the extension {{{.save}}}.
{{{
    Save.export([filename [, metadata]])
}}}
The API has 2 parameters:
* {{{filename}}} (optional), the base filename of the save (slugified), with the datestamp and file extension appended automatically.
** default is the story&#39;s title (slugified)
* {{{metadata}}} (optional), the date to be stored in the save object&#39;s [[metadata|SaveAPI-Objects]] property.
\
&gt; //Examples://
{{{
    Save.export()
→ default filename + no metadata

    Save.export(&quot;Sweet Stuff 2&quot;)
→ custom filename + no metadata
  → sweet-stuff-2-{datestamp}.save

    Save.export(null, someMetadata)
→ default filename + some metadata

    Save.export(&quot;Sweet Stuff 2&quot;, someMetadata)
→ custom filename + some metadata
  → sweet-stuff-2-{datestamp}.save
}}}
\
&lt;h4&gt;{{{Save.import()}}}&lt;/h4&gt;\
This API will load a save file from disk.
&gt; &#39;&#39;Note:&#39;&#39; this must be called by the change vent handler of an {{{&lt;input type=&quot;file&quot;&gt;}}} element.
{{{
    Save.import(event)
}}}
This API has 1 parameter:
* {{{event}}}, the event object passed to the change event handler of the associated {{{&lt;input type=&quot;file&quot;&gt;}}} element.
\
&gt; //Basic usage example from the Documentation://
{{{
→ Assuming you&#39;re creating a file input something like the following
    var input  = document.createElement(&#39;input&#39;);
    input.type = &#39;file&#39;;
    input.id   = &#39;saves-import-file&#39;;
    input.name = &#39;saves-import-file&#39;;

→ Set up Save.import() as the event handler for when a file has been chosen
    jQuery(input).on(&#39;change&#39;, Save.import);
}}}
&gt; //More Complex Documentation Example//
{{{
→ Assuming you&#39;re creating a file input something like the following
    var input  = document.createElement(&#39;input&#39;);
    input.type = &#39;file&#39;;
    input.id   = &#39;saves-import-file&#39;;
    input.name = &#39;saves-import-file&#39;;

→ Set up a custom event handler for when a file has been chosen, which will call Save.import()
    jQuery(input).on(&#39;change&#39;, function (ev) {
        /* You must pass in the event when calling Save.import() manually */
        Save.import(ev);

        /* Put anything else you needed to do here */
    });
}}}
&gt; //Code of the Interactive Example://
{{{
    &lt;&lt;link &quot;Load From Disk&quot;&gt;&gt;
        &lt;&lt;script&gt;&gt;
        jQuery(document.createElement(&#39;input&#39;))
            .prop(&#39;type&#39;, &#39;file&#39;)
            .on(&#39;change&#39;, Save.import)
            .trigger(&#39;click&#39;);
        &lt;&lt;/script&gt;&gt;
    &lt;&lt;/link&gt;&gt;
}}}
\
&lt;h3&gt;Serialize the Save File&lt;/h3&gt;\
\
&lt;h4&gt;{{{Save.serialize()}}}&lt;/h4&gt;\
This API will return a save as a serialized string (or null if saving is now allowed)
{{{
    Save.serialize([metadata])
}}}
It has 1 parameter: 
* {{{metadata}}} (optional), the data to be stored as metadata (JSON-serializable)
\
&gt; //Examples://
{{{
→ Serialize a save with no metadata
    const myGameState = Save.serialize();
    if (myGameState === null) {
        /* Failure.  You&#39;ve disallowed saving. */
    }

→ Serialize a save with metadata someMetadata
    const myGameState = Save.serialize(someMetadata);
    if (myGameState === null) {
        /* Failure.  You&#39;ve disallowed saving. */
    }
}}}
\
&lt;h4&gt;{{{Save.deserialize()}}}&lt;/h4&gt;\
This API will deserialize the given save string, created with {{{Save.serialize()}}}, and load the save. It will also return the bundled metadata (if defined), or NULL if the save could not be deserialize and loaded.
{{{
    Save.deserialize(saveStr)
}}}
It has 1 parameter:
* {{{saveStr}}}, the serialized save string.
\
&gt; //Examples://
{{{
→ Deserialize a save with no metadata
    const loadResult = Save.deserialize(myGameState);
    if (loadResult === null) {
        /* Failure.  An error was displayed to the player. */
    }

→ Deserialize a save with metadata
    const loadResult = Save.deserialize(myGameState);
    if (loadResult !== null) {
        /* Success.  Do something with loadResult, which contains the metadata. */
    }
    else {
        /* Failure.  An error was displayed to the player. */
    }
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Save APIs Menu|SaveAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="154" name="SaveAPI-Slots" tags="page" position="2000,2000" size="100,100">&lt;h1&gt;Managing the Save Slots&lt;/h1&gt;
The APIs below will allow you to manage the available save slots. These can be useful when providing returning players to a quick link to load their saves, or creating your own Save page.
\
&lt;h3&gt;{{{Save.slots.length}}}&lt;/h3&gt;\
This API will return the total number of available slots. It will be influenced by the [[Config API|Basic-API-Config]].
{{{
    Save.slots.length
}}}
\
&lt;h3&gt;{{{Save.slots.count()}}}&lt;/h3&gt;\
This API will count the number of filled save slots.
{{{
    Save.slots.count()
}}}
&gt; //Example://
{{{
    &lt;&lt;if Save.slots.count() gt 0&gt;&gt;
        &lt;&lt;link &quot;Load Save&quot;&gt;&gt;
            &lt;&lt;run UI.saves()&gt;&gt;
        &lt;&lt;/link&gt;&gt;
    &lt;&lt;/if&gt;&gt;
}}}
\
&lt;h3&gt;{{{Save.slots.delete()}}}&lt;/h3&gt;\
This API will delete a save from the given slot. This is what is behind the //Delete// buttons on the Save Popup.
{{{
    Save.slots.delete(slot)
}}}
It has 1 parameter:
* {{{slot}}}, the save slot index (0-based)
\
&gt; //Example://
{{{
    Save.slots.delete(5)  
→ Deletes the sixth slot save
}}}
\
&lt;h3&gt;{{{Save.slots.get()}}}&lt;/h3&gt;\
This API will return a save object from the given slot or NULL if there is no save.
{{{
    Save.slots.get(slot)
}}}
It has 1 parameter:
* {{{slot}}}, the save slot index (0-based)
\
&gt; //Example://
{{{
    Save.slots.get(5)  
→ Returns the sixth slot save
}}}
\
&lt;h3&gt;{{{Save.slots.has()}}}&lt;/h3&gt;\
This API will check whether the given slot is filled.
{{{
    Save.slots.has(slot)
}}}
It has 1 parameter:
* {{{slot}}}, the save slot index (0-based)
\
&gt; //Examples://
{{{
    Save.slots.has(5)  
→ checks the sixth slot save

    if (Save.slots.has(5)) {
        /* Code to manipulate the sixth slot save. */
    }
}}}
\
&lt;h3&gt;{{{Save.slots.isEmpty()}}}&lt;/h3&gt;\
This API will check whether there are any filled slots. It will return with a //true// value if all slots are empty, and a //false// one if at least one slot is filled.
{{{
    Save.slots.isEmpty()
}}}
\
&lt;h3&gt;{{{Save.slots.load()}}}&lt;/h3&gt;\
This API will load a save from the given slot. This is the code behind the //Load// buttons in the Save Popup.
{{{
    Save.slots.load(slot)
}}}
It has 1 parameter:
* {{{slot}}}, the save slot index (0-based)
\
&gt; //Example://
{{{
    Save.slots.load(5)  
→ Loads the sixth slot save
}}}
\
&lt;h3&gt;{{{Save.slots.ok()}}}&lt;/h3&gt;\
This API will check whether the slots saves are available.
{{{
    Save.slots.ok()

    if (Save.slots.ok()) {
        /* Code to manipulate slot saves. */
    }
}}}
\
&lt;h3&gt;{{{Save.slots.save()}}}&lt;/h3&gt;\
This API will save to the given slot. This is the code behind the //Save// buttons in the Save Popup.
{{{
    Save.slots.save(slot [, title [, metadata]])
}}}
It has 3 parameters:
* {{{slot}}}, the save slot index (0-based)
* {{{title}}} (optional), the title of the save
** if omitted or NULL, it defaults to the passage&#39;s description 
* {{{metadata}}} (optional), the data to be stored as metadata (JSON-serializable)
\
&gt; //Examples://
{{{
    Save.slots.save(5)
→ Save to the sixth slot 
  + default title and no metadata

    Save.slots.save(5, &quot;Midgar&quot;)
→ Save to the sixth slot 
  + title &quot;Midgar&quot; and no metadata

    Save.slots.save(5, null, someMetadata)
→ Save to the sixth slot 
  + default title and metadata someMetadata

    Save.slots.save(5, &quot;Midgar&quot;, someMetadata)
→ Save to the sixth slot 
  + title &quot;Midgar&quot; and metadata someMetadata
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Save APIs Menu|SaveAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="155" name="SaveAPI-Autosave" tags="page" position="2100,2000" size="100,100">&lt;h1&gt;Managing the Autosave Slot&lt;/h1&gt;
The APIs below will allow you to manage the autosave slot. These can be useful when providing returning players to a quick link to load their autosave.
\
&lt;h3&gt;Save.autosave.delete()&lt;/h3&gt;\
This API will delete the autosave.
{{{
    Save.autosave.delete()
}}}
\
&lt;h3&gt;{{{Save.autosave.get()}}}&lt;/h3&gt;\
This API will return the save object from the autosave slot, or NULL.
{{{
    Save.autosave.get()
}}}
\
&lt;h3&gt;{{{Save.autosave.has()}}}&lt;/h3&gt;\
This API will check whether the autosave is filled.
{{{
    Save.autosave.has()

    if (Save.autosave.has()) {
        /* Code to manipulate the autosave. */
    }
}}}
\
&lt;h3&gt;{{{Save.autosave.load()}}}&lt;/h3&gt;\
This API will load the autosave (if filled).
{{{
    Save.autosave.load()
}}}
\
&lt;h3&gt;{{{Save.autosave.ok()}}}&lt;/h3&gt;\
This API will check whether the autosave is available.
{{{
    Save.autosave.ok()

    if (Save.autosave.ok()) {
        /* Code to manipulate the autosave. */
    }
}}}
\
&lt;h3&gt;{{{Save.autosave.save()}}}&lt;/h3&gt;\
This API will save to the autosave slot.
{{{
    Save.autosave.save([title [, metadata]])
}}}
It has 3 parameters:
* {{{title}}} (optional), the title of the save
** if omitted or NULL, it defaults to the passage&#39;s description 
* {{{metadata}}} (optional), the data to be stored as metadata (JSON-serializable)
\
&gt; //Examples://
{{{
    Save.autosave.save()
→ Save to the autosave slot 
  + default title and no metadata

    Save.autosave.save(&quot;Midgar&quot;)
→ Save to the autosave slot
  + title &quot;Midgar&quot; and no metadata

    Save.autosave.save(null, someMetadata)
→ Save to the autosave slot
  + default title and metadata someMetadata

    Save.autosave.save(&quot;Midgar&quot;, someMetadata)
→ Save to the autosave slot 
  + title &quot;Midgar&quot; and metadata someMetadata
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Save APIs Menu|SaveAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="156" name="SaveAPI-Events" tags="page" position="2000,2100" size="100,100">&lt;h1&gt;Using Save-related Events&lt;/h1&gt;
\
&lt;h3&gt;Events during Save Load&lt;/h3&gt;\
\
&lt;h4&gt;{{{Save.onLoad.add()}}}&lt;/h4&gt;\
This API will perform any required processing before a save is loaded, like upgrading out-of-date save data. If the defined function encounters an unrecoverable problem during processing, it will give an error to the player and terminate the loading of the save.
{{{
    Save.onLoad.add(handler)
}}}
It has 1 parameter: 
* {{{handler}}}, the function to be executed when loading a save
** {{{save}}}, the save object to be processed
\
&gt; //Example://
{{{
    Save.onLoad.add(function (save) {
        /* code to process the save object before it&#39;s loaded */
    });

→ Updading old saves to be compatible:
    Save.onLoad.add(function (save) {
        const history = save.state.history;
        if (save.version &lt; 14) {
            /* 
                Code to fix all saves upto version 14 
            */
            save.version = 14;
            /* Updating the save file&#39;s version */
        }
    });
}}}
&gt; &#39;&#39;Note:&#39;&#39; the {{{save.version}}} will be defined with the relevant [[Config API|Config-Saves]]
\
&lt;h4&gt;{{{Save.onLoad.clear()}}}&lt;/h4&gt;\
This API will delete all currently defined on-load handlers.
{{{
    Save.onLoad.clear()
}}}
\
&lt;h4&gt;{{{Save.onLoad.delete()}}}&lt;/h4&gt;\
This API will delete the specified on-load handler.
{{{
    Save.onLoad.delete(handler)
}}}
It has 1 parameter:
* {{{handler}}}, the function to be executed when loading a save
&gt; //Assuming that:// {{{myOnLoadHandler = function (save) { /* handler */}}}}
{{{
    Save.onLoad.delete(myOnLoadHandler);
}}}
\
&lt;h4&gt;{{{Save.onLoad.size}}}&lt;/h4&gt;\
This API will give the number of currently registered on-load handlers.
{{{
    Save.onLoad.size
}}}
&gt; //Example://
{{{
    console.log(&#39;There are %d onLoad handlers registered.&#39;, Save.onLoad.size);
}}}
\
&lt;h3&gt;Events during Saving&lt;/h3&gt;\
\
&lt;h4&gt;{{{Save.onSave.add()}}}&lt;/h4&gt;\
This API will perform any required processing before data is saved. It can be useful when wanting to run different code depending on the type of save (auto/slot/disk), or formatting names of saves.
{{{
    Save.onSave.add(handler)
}}}
It has 1 parameter: 
* {{{handler}}}, the function to be executed when saving a save
** {{{save}}}, the save object to be processed
** {{{details}}}, the save operation details object
*** {{{type}}}, representing what cause the save ({{{&#39;autosave&#39;}}}, {{{&#39;disk&#39;}}}, {{{&#39;serialize&#39;}}}, {{{&#39;slot&#39;}}})
\
&gt; //Examples://
{{{
    Save.onSave.add(function (save) {
        /* code to process the save object before it&#39;s saved */
    });

    Save.onSave.add(function (save, details) {
        switch (details.type) {
            case &#39;autosave&#39;: {
                /* Code processed for autosaves */
                break;
            }
            case &#39;disk&#39;: {
                /* Code processed for disk saves */
                break;
            }
            case &#39;serialize&#39;: {
                /* Code processed for serialized saves */
                break;
            }
            default: { 
                /* Code processed for slot saves */
                break;
            }
        }
    });

}}}
&gt; &#39;&#39;Note:&#39;&#39; I use this API to format how saves and autosaves are named in my [[Setting Template|https://manonamora.itch.io/twine-sugarcube-templates]].
\
&lt;h4&gt;{{{Save.onSave.clear()}}}&lt;/h4&gt;\
This API will delete all currently defined on-save handlers.
{{{
    Save.onSave.clear();
}}}
\
&lt;h4&gt;{{{Save.onSave.delete()}}}&lt;/h4&gt;\
This API will delete the specified on-save handler.
{{{
    Save.onSave.delete(handler)
}}}
It has 1 parameter:
* {{{handler}}}, the function to be executed when loading a save
&gt; //Assuming that:// {{{myOnLoadHandler = function (save, details) { /* handler */}}}}
{{{
    Save.onSave.delete(myOnLoadHandler);
}}}
\
&lt;h4&gt;{{{Save.onSave.size}}}&lt;/h4&gt;\
This API will give the number of currently registered on-save handlers.
{{{
    Save.onSave.size
}}}
&gt; //Example://
{{{
    console.log(&#39;There are %d onSave handlers registered.&#39;, Save.onSave.size);
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Save APIs Menu|SaveAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="157" name="Settings" tags="chapter menu" position="1400,1800" size="200,100">&lt;h1&gt;The Settings APIs&lt;/h1&gt;
Settings can be a great way to customise your project, and make it more accessible for players. Whether it is to change the visual aspect (font, theme, etc), the audio (volume, track), or overall mechanics (difficulty, annimation), there are many ways to reach your goal.

While including settings in a project can feel a bit overwhelming, as they //will// require some knowledge of JavaScript, the Setting APIs are there to make things easier. There are also many UI templates out there including some settings. You can find also find a Setting-Only Template [[here|https://manonamora.itch.io/twine-sugarcube-templates]].

The basic Settings API is built in this format:
{{{
    Settings.function(parameters)
}}}
&gt; &#39;&#39;Note:&#39;&#39; The order you add the settings in the JavaScript passage will be the order you will see in the Setting dialog box.
* [[Adding Headers|SettingsHeader]]
* [[Creating a Toggle Setting|SettingsToggle]]
* [[Creating a List Setting|SettingsList]]
* [[Creating a Slider|SettingsRange]]
* [[Going Further with Settings|Settings-More]]
&gt; &#39;&#39;Note:&#39;&#39; you can find a Setting Template with the most useful settings for Interactive Fiction on my [[itch page|https://manonamora.itch.io/twine-sugarcube-templates]].

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="158" name="SettingsHeader" tags="page" position="1400,1900" size="100,100">&lt;h1&gt;Adding Headers&lt;/h1&gt;
If you want to customise the Setting Dialog Box or organise your settings, you can group those under a Header. This will indicate to users what kind of setting they can expect below.
This API has 2 parameters :
* {{{name}}}: the name of the header (string)
* {{{desc}}}: description of the group of settings (string, optional)
{{{
    Setting.addHeader(name [, description])
}}}
&gt; //Examples://
{{{
→ Only a header
    Setting.addHeader(&quot;Font Settings&quot;);

→ A header and a description
    Setting.addHeader(&quot;Font Settings&quot;, &quot;Settings controlling how the text is formatted.&quot;);
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Settings API Menu|Settings]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="159" name="SettingsToggle" tags="page" position="1500,1900" size="100,100">&lt;h1&gt;Creating a Toggle Setting&lt;/h1&gt;
Like the name suggests, this type of settings create a toggle. This type is best used for settings with a True/False options. For example: toggling a widescreen or autosave.

To add a Toggle setting, you need the followin API:
{{{
    Setting.addToggle(name, definition)
}}}
This API has 2 main parameters:
* {{{name}}}: the name of the settings variable (string)
* {{{definition}}}: definition of the setting (object)
The //definition// object has multiple options:
* {{{label}}}: visible description of the setting (string)
* {{{desc}}}: further description of the setting (string, optional)
* {{{default}}}: default value for the setting (boolean, optional, undefined = false)
* {{{onInit}}}: the function to call when the game starts (optional, function)
* {{{onChange}}}: the function to call when the setting is changed (optional, function)
&gt; &#39;&#39;Note:&#39;&#39; You can use a setting as a variable in a passage. You would write the variable as such:
{{{settings.name}}} 

&gt; //Basic Toggle Setting to create a boolean setting//:
{{{
    Setting.addToggle(&quot;notifications&quot;, {
	    label : &quot;Show notifications?&quot; 
    });
→ the default value not defined, so false is used

    :: Story Passage
    &lt;&lt;if settings.notifications is true&gt;&gt; 
        /* your code/text  */
    &lt;&lt;/if&gt;&gt;
}}}
&gt; //Toggle Setting to add/remove a CSS class//:
{{{
    var settingNotifications = function () {
        if (settings.notifications) { // is true
            $(&quot;html&quot;).addClass(&quot;notifications&quot;);
        }
        else { // is false
            $(&quot;html&quot;).removeClass(&quot;notifications&quot;);
        }
    };
    Setting.addToggle(&quot;notifications&quot;, {
        label    : &quot;Display Notifications?&quot;,
        desc     : &quot;If enabled, you will be shown notifications throughout the game&quot;,
        default  : false,
        onInit   : settingNotifications,
        onChange : settingNotifications
    });

→ In your CSS, you&#39;ll need to include the following:
    html.notifications .macro-notif {
	    display: none;
    }
}}}
&gt; &#39;&#39;Note:&#39;&#39; this assumes that the notification element/macro uses the class {{{.macro-notif}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Settings API Menu|Settings]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="160" name="SettingsList" tags="page" position="1400,2000" size="100,100">&lt;h1&gt;Creating a List Setting&lt;/h1&gt;
Like the name suggests, this type of settings create a list. This type is best used for settings with more than 2 options or options with names. For example: a theme change setting or font settings.

To add a Toggle setting, you need the followin API:
{{{
    Setting.addList(name, definition)
}}}
This API has 2 main parameters:
* {{{name}}}: the name of the settings variable (string)
* {{{definition}}}: definition of the setting (object)
The //definition// object has multiple options:
* {{{label}}}: visible description of the setting (string)
* {{{list}}}: the list of options (array of string)
* {{{desc}}}: further description of the setting (string, optional)
* {{{default}}}: default value for the setting (string from array, optional, undefined = 1st of array)
* {{{onInit}}}: the function to call when the game starts (optional, function)
* {{{onChange}}}: the function to call when the setting is changed (optional, function)
&gt; &#39;&#39;Note:&#39;&#39; You can use a setting as a variable in a passage. You would write the variable as such:
{{{settings.name}}} 

&gt; //Basic List Setting, creating a string setting variable//:
{{{
    Setting.addList(&quot;difficulty&quot;, {
        label   : &quot;Choose a difficulty level.&quot;,
        list    : [&quot;Easy&quot;, &quot;Normal&quot;, &quot;Hard&quot;, &quot;INSANE&quot;],
        default : &quot;Normal&quot;
    });

    :: Story Passage
    &lt;&lt;if settings.difficulty is &quot;Normal&quot;&gt;&gt; 
        /* your code/text  */
    &lt;&lt;/if&gt;&gt;
}}}
&gt; //List Setting to add/remove a CSS class//:
{{{
    var settingThemeNames = [&quot;Base&quot;, &quot;Reverse&quot;, &quot;Night&quot;, &quot;Light&quot;];
    var settingThemeHandler = function () {
        var $html = $(&quot;html&quot;);
        // remove any existing theme class
            $html.removeClass(&quot;theme-reverse theme-night theme-light&quot;);
        // switch on the theme name to add the requested theme class
            switch (settings.theme) {
                case &quot;Reverse&quot;:
                    $html.addClass(&quot;theme-reverse&quot;);
                    break;
                case &quot;Night&quot;:
                    $html.addClass(&quot;theme-night&quot;);
                    break;
                case &quot;Light&quot;:
                    $html.addClass(&quot;theme-light&quot;);
                    break;
            }
    };
    Setting.addList(&quot;theme&quot;, {
        label    : &quot;Choose a theme.&quot;,
        desc     : &quot;This will change the colour palette&quot;,
        list     : settingThemeNames,
        default  : &quot;Base&quot;,
        onInit   : settingThemeHandler,
        onChange : settingThemeHandler
    });

→ In your CSS: 
    body {color: black;}
    html.theme-reverse body {color: white;}
    html.theme-night body {color: lightgrey;}
    html.theme-light body {color: darkgrey;}
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Settings API Menu|Settings]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="161" name="SettingsRange" tags="page" position="1500,2000" size="100,100">&lt;h1&gt;Creating a Slider&lt;/h1&gt;
Like the name suggests, this type of settings create a slider. This type is best used for settings with a range of value. For example: a a volume.

To add a Toggle setting, you need the followin API:
{{{
    Setting.addRange(name, definition)
}}}
\
This API has 2 main parameters:
* {{{name}}}: the name of the settings variable (string)
* {{{definition}}}: definition of the setting (object)
The //definition// object has multiple options:
* {{{label}}}: visible description of the setting (string)
* {{{min}}}: the minimum value (number)
* {{{max}}}: the maximum value (number)
* {{{step}}}: the increment between each step (number, divisible by min &amp; max)
* {{{desc}}}: further description of the setting (string, optional)
* {{{default}}}: default value for the setting (boolean, optional, undefined = false)
* {{{onInit}}}: the function to call when the game starts (optional, function)
* {{{onChange}}}: the function to call when the setting is changed (optional, function)

&gt; //Basic Range Setting//:
{{{
    Setting.addRange(&quot;masterVolume&quot;, {
        label    : &quot;Volume Level&quot;,
        min      : 0,
        max      : 10,
        step     : 1,
        default  : 10,
        onChange : function () {
            SimpleAudio.volume(settings.masterVolume / 10);
        }
    });
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Settings API Menu|Settings]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="162" name="Settings-More" tags="page" position="1400,2100" size="100,100">&lt;h1&gt;Going Further with Settings&lt;/h1&gt;
The settings are not just stuck to the JavaScript passage, they can also be used in regular passages.
\
&lt;h3&gt;The {{{settings}}} variable&lt;/h3&gt;\
When a Setting is set, it creates a special variable that can be used in other passages, for example to trigger code.
{{{
    settings.nameOfTheSetting
}}}
Assuming that a setting has been set up with the name {{{notification}}}:
{{{
→ For a Toggle Setting:
    &lt;&lt;if settings.notification&gt;&gt;
        &lt;&lt;notify 5s&gt;&gt;This is a notification only seen if the notification setting is toggled on&lt;&lt;/notify&gt;&gt;
    &lt;&lt;/if&gt;&gt;

→ For a Range Setting:
    &lt;&lt;if settings.notification gt 9&gt;&gt;
        &lt;&lt;notify 5s&gt;&gt;This is very loud!&lt;&lt;/notify&gt;&gt;
    &lt;&lt;/if&gt;&gt;

→ For a List Setting:
    &lt;&lt;if settings.notification is &quot;Easy&quot;&gt;&gt;
        &lt;&lt;notify 5s&gt;&gt;You are playing on BabyMode&lt;&lt;/notify&gt;&gt;
    &lt;&lt;/if&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; the {{{&lt;&lt;notify&gt;&gt;}}} macro is a [[Custom Macro by Chapel|https://github.com/ChapelR/custom-macros-for-sugarcube-2/blob/master/docs/notify-macro.md]].
\
&lt;h3&gt;Changing the Settings in the Passage&lt;/h3&gt;\
It is also possible to change settings outside of the Settings Dialog Box, and can be done with {{{Setting.reset()}}} to reset a/all setting(s) to their default value, or {{{Setting.save()}}} to save the change of a setting.
&gt; &#39;&#39;Note:&#39;&#39; the targeted setting needs to be set in the JavaScript beforehand.
&gt; You also need to use the macros {{{&lt;&lt;script&gt;&gt;}}} or {{{&lt;&lt;run&gt;&gt;}}} with those APIs.
\
&gt; //To reset://
{{{
    Setting.reset() → will reset all settings to the default
    Setting.reset(&#39;difficulty&#39;) → will reset only the &#39;difficulty&#39; setting 

    &lt;&lt;run Setting.reset()&gt;&gt;
}}}
&gt; //To save://
{{{
    &lt;&lt;set settings.difficulty to &quot;Normal&quot;&gt;&gt;
    &lt;&lt;run Setting.save()&gt;&gt;
}}}
&gt; &#39;&#39;Note:&#39;&#39; this can be quite useful when setting some functionality before the game starts, like the game&#39;s Language.

&gt; &#39;&#39;Note:&#39;&#39; a {{{Setting.load()}}} API exists within SugarCube. However, it is called automatically everytime the game is loaded. As such, it should never be called manually.

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Settings API Menu|Settings]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="163" name="StateAPI" tags="chapter menu" position="3200,1800" size="200,100">&lt;h1&gt;Dealing with the State of Play&lt;/h1&gt;
Any started playthrough will contain a State, which will include moments (states) created during play used to navigate the history (undo/redo) and to save the (potentially changed) value of variables. If relevant, the State will include Metadata and a Seedable PRNG.

* [[Managing the State of Variables|StateAPI-Variable]] 
* [[Exploring the Different Moments inside the State|StateAPI-State]] 
* [[Using the Story Metadata|StateAPI-Metadata]] 
* [[Initialising a Seedable PRNG|StateAPI-PRNG]] 

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="164" name="StateAPI-Variable" tags="page" position="3200,1900" size="100,100">&lt;h1&gt;Managing the State of Variables&lt;/h1&gt;
The following APIs will help check the state of current variables in the story, and can be used to set value to those variables. They are especially helpful in JavaScript/jQuery code requiring the value of a SugarCube variable or setting them. 
\
&lt;h3&gt;{{{State.temporary}}}&lt;/h3&gt;\
This API will return the current temporary variables ({{{_temp}}}), as an object. 
A specific temporary variable can be targeted by using the name of the variable as a property. 
&gt; //Assuming that// {{{_ThisIsATemp = [value]}}}:
{{{
    State.temporary.ThisIsATemp
}}}
\
&lt;h3&gt;{{{State.variables}}}&lt;/h3&gt;\
This API will return the current active variables ({{{$var}}}), as an object. 
A specific variable can be targeted by using the name of the variable as a property.
&gt; //Assuming that// {{{$aVariable = [value]}}}:
{{{
    State.variables.aVariable
}}}
\
&lt;h3&gt;{{{State.getVar()}}}&lt;/h3&gt;\
This API will return the value of the indicated variable.
{{{
    State.getVar(varName)
}}}
It has 1 parameter:
* {{{varName}}}, the name of the variable, including its sigil 
&gt; //Examples//
{{{
    State.getVar(&quot;$variable&quot;)
    State.getVar(&quot;_temporary&quot;)
    State.getVar(&quot;settings.alsothat&quot;)
}}}
\
&lt;h3&gt;{{{State.setVar()}}}&lt;/h3&gt;\
This API sets the value of the indicated variable, like the {{{&lt;&lt;set&gt;&gt;}}} macro does.
{{{
    State.setVar(varName, value)
}}}
It has 2 parameters:
* {{{varName}}}, the name of the variable, including its sigil 
* {{{value}}}, the value to assign 
&gt; //Example://
{{{
    State.setVar(&quot;$charName&quot;, &quot;Jane Doe&quot;)  
→ assigns the string &quot;Jane Doe&quot; to $charName
}}}
&lt;div id=&quot;link-menu&quot;&gt;[[Back to State API Menu|StateAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="165" name="StateAPI-State" tags="page" position="3300,1900" size="100,100">&lt;h1&gt;Exploring the Different Moments inside the State&lt;/h1&gt;
The following APIs will look at the different moments of the state, from future to current to history. Some of these will look only at the current moment (active), some will focus on the in-play moments (influenced by the [[maxState|Basic-API-Config]]), while others will include the expired moments.
\
&lt;h3&gt;{{{State.active}}}&lt;/h3&gt;\
This API will return the active/present moment.
However, it is generally unnecessary, as there are better shortcut properties with {{{State.passage}}} (below) and {{{State.variables}}} ([[here|StateAPI-Variable]]), or the [[functions|Functions]] {{{passage()}}} and {{{variables()}}}.
&gt; //Examples://
{{{
    State.active.title      
→ title of the present moment

    State.active.variables  
→ variables of the present moment
}}}
\
&lt;h3&gt;{{{State.bottom}}}&lt;/h3&gt;\
This API will return the bottommost (least recent) moment, within the full in-play history.
&gt; //Examples://
{{{
    State.bottom.title      
→ title of the bottommost moment

    State.bottom.variables  
→ variables of the bottommost moment
}}}
\
&lt;h3&gt;{{{State.top}}}&lt;/h3&gt;\
This API will return the topmost (most recent) moment, within the full in-play history.
&gt;&#39;&#39;Note:&#39;&#39; {{{State.top}}} is not synonymous to {{{State.active}}}. It is extreemly unlikely you will ever need {{{State.top}}}.
\
&gt; //Examples://
{{{
    State.top.title      
→ title of the topmost moment

    State.top.variables  
→ variables of the topmost moment
}}}
\
&lt;h3&gt;{{{State.current}}}&lt;/h3&gt;\
This API will return the current moment, within the full in-play history, which is the pre-play version of the active moment.
&gt;&#39;&#39;Note:&#39;&#39; {{{State.current}}} is not synonymous to {{{State.active}}}. It is extreemly unlikely you will ever need {{{State.current}}}.
\
&gt; //Examples://
{{{
    State.current.title      
→ title of the current moment

    State.current.variables  
→ variables of the current moment
}}}
\
&lt;h3&gt;{{{State.length}}}&lt;/h3&gt;\
This API will return the number of moments in the past in-play history. This includes all visited passages in order of their visit. 
&gt; //Example://
{{{
    if (State.length === 0) {
        /* No moments within the past in-play history. Egad! */
    }
}}}
\
&lt;h3&gt;{{{State.size}}}&lt;/h3&gt;\
This API will return the number of moments within the full in-play history.
It is particularly useful when specific bits of code need to run on the landing page when the game starts, but shouldn&#39;t run again if the player undoes their actions.
&gt; //Examples://
{{{
    if (State.size === 0) {
        /* Code if no moments in the history */
    }
}}}
\
&lt;h3&gt;{{{State.turns}}}&lt;/h3&gt;\
This API will return the number of played moments within the extended past history.
&gt; //Examples://
{{{
    if (State.turns === 1) {
        /* Code to run on the starting passage */
    }
}}}
\
&lt;h3&gt;{{{State.passage}}}&lt;/h3&gt;\
This API returns the passage of the active (present) moment. It is useful in JavaScript code requiring the name of a passage to run code.
&gt; //Example://
{{{
   if (State.passage === &quot;PassageName&quot;) {
    /* Code to run in that passage only */
   }
}}}
\
&lt;h3&gt;{{{State.has()}}}&lt;/h3&gt;\
This API checks whether any moment(s) with the indicated title exist within the past in-play history.
&gt; &#39;&#39;Note:&#39;&#39; {{{State.has()}}} does not check expired moments. You may want to use {{{State.hasPlayed()}}} or {{{hasVisited()}}} instead.
{{{
    State.has(passageTitle)
}}}
It has 1 parameter:
* {{{passageTitle}}}, the title of the moment to check
&gt; //Example://
{{{
    State.has(&quot;The Ducky&quot;)  
→ checks if a moment matching &quot;The Ducky&quot; exists
}}}
\
&lt;h3&gt;{{{State.hasPlayed()}}}&lt;/h3&gt;\
This API checks whether any moment(s) with the indicated title exist within the past history.
&gt; &#39;&#39;Note:&#39;&#39; if you need to check multiple passages, you may want to use {{{hasVisited()}}} instead.
{{{
    State.hasPlayed(passageTitle)
}}}
It has 1 parameter:
* {{{passageTitle}}}, the title of the moment to check
&gt; //Example://
{{{
    State.hasPlayed(&quot;The Ducky&quot;)  
→ checks if a moment matching &quot;The Ducky&quot; exists
}}}
\
&lt;h3&gt;{{{State.index()}}}&lt;/h3&gt;\
This API returns the moment relative to the bottom of the past in-play history, with the given index.
{{{
    State.index(index)
}}}
It has 1 parameter:
* {{{index}}}, the index of the relevant moment
&gt; //Example://
{{{
    State.index(0)                 
→ the least recent moment

    State.index(1)
→ the second least recent moment

    State.index(State.length - 1)
→ the most recent moment
}}}
\
&lt;h3&gt;{{{State.isEmpty()}}}&lt;/h3&gt;\
This API checks whether the full in-play history is empty.
&gt; //Example://
{{{
    if (State.isEmpty()) {
        /* Code to run if history is empty */
    }
}}}
\
&lt;h3&gt;{{{State.peek()}}}&lt;/h3&gt;\
This API return the moment, relative to the top of the past in-play history, with an optional offset.
{{{
    State.peek([offset])
}}}
It has 1 parameter:
* {{{offset}}} (optional), the offset from the top moment 
** default is 0
&gt; //Examples://
{{{
    State.peek()
    State.peek(0)                  
→ most recent moment

    State.peek(1)
→ the second most recent moment 

    State.peek(State.length - 1)
→ the least recent moment
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to State API Menu|StateAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="166" name="StateAPI-Metadata" tags="page" position="3200,2000" size="100,100">&lt;h1&gt;Using the Story Metadata&lt;/h1&gt;
Some of the APIs below functions similarly to the {{{memorize()}}}, {{{recall()}}}, and {{{forget()}}} [[functions|Function-Metadata]], in that it will affect the state of the Story Metadata. 
\
&lt;h3&gt;{{{State.metadata.size}}}&lt;/h3&gt;\
This API will return the size of the story metadata.
{{{
    if (State.metadata.size &gt; 0) {
	    /* code if some metadata */
    }
}}}
\
&lt;h3&gt;{{{State.metadata.clear()}}}&lt;/h3&gt;\
This API will empty the story metadata.
{{{
    State.metadata.clear();
}}}
\
&lt;h3&gt;{{{State.metadata.delete()}}}&lt;/h3&gt;\
This API will remove the specified key and its value from the story metadata.
{{{
    State.metadata.delete(key)
}}}
It has 1 parameter:
* {{{key}}}, the key to delete 
&gt; //Assuming that:// {{{&#39;achievements&#39; = some value}}}
{{{
    State.metadata.delete(&#39;achievements&#39;);
}}}
\
&lt;h3&gt;{{{State.metadata.entries()}}}&lt;/h3&gt;\
This API will return the array of the metadata key/value pair ({{{[key, value]}}}).
&gt; //Examples://
{{{
→ going through the pairs with a {for} loop
    var metadata = State.metadata.entries();
    for (var i = 0; i &lt; metadata.length; ++i) {
        var key   = metadata[i][0];
        var value = metadata[i][1];

        /* code to do something */
    }

→ going through the pairs with {&lt;Array&gt;.forEach()}
    State.metadata.entries().forEach(function (pair) {
        var key   = pair[0];
        var value = pair[1];

        /* code to do something */
    });
}}}
\
&lt;h3&gt;{{{State.metadata.get()}}}&lt;/h3&gt;\
This API will return the value associated with the specified metadata key. This can be useful for conditional statements.
{{{
    State.metadata.get(key)
}}}
It has 1 parameter:
* {{{key}}}, the key to delete 
&gt; //Assuming that:// {{{&#39;achievements&#39; = true}}}
{{{
    State.metadata.get(&#39;achievements&#39;);
→ will have the value {true}    
}}}
\
&lt;h3&gt;{{{State.metadata.has()}}}&lt;/h3&gt;\
This API will check whether the specified metadata key is defined. This can be useful for conditional statements.
{{{
    State.metadata.has(key)
}}}
It has 1 parameter:
* {{{key}}}, the key to delete 
&gt; //Assuming that:// {{{&#39;achievements&#39; = some value}}}
{{{
    State.metadata.has(&#39;achievements&#39;)  

    if (State.metadata.has(&#39;achievements&#39;)) {
	    /* code to do something */
    }
}}}
\
&lt;h3&gt;{{{State.metadata.keys()}}}&lt;/h3&gt;\
This API will return the array of the current metadata keys.
&gt; //Examples://
{{{
→ going through the keys with a {for} loop
    var metadataKeys = State.metadata.keys();
    for (var i = 0; i &lt; metadataKeys.length; ++i) {
        var key = metadataKeys[i];

        /* do something */
    }
→ going through the keys with {&lt;Array&gt;.forEach()}
    State.metadata.keys().forEach(function (key) {
        /* do something */
    });
}}}
\
&lt;h3&gt;{{{State.metadata.set()}}}&lt;/h3&gt;\
This API will set a value to the specified key within the story metadata, which will persist over the story and browser restarts.
&gt; &#39;&#39;Notes:&#39;&#39; private browsing modes will interfere with this.
&gt; The story metadata is tired to the specific story it was generated with.
&gt; The metadata &#39;&#39;SHOULD NOT&#39;&#39; replace saves.
{{{
    State.metadata.set(key, value)
}}}
It has 2 parameters:
* {{{key}}}, the key that should be set 
* {{{value}}}, the value to set 
\
&gt; //Examples://
{{{
→ simple key setting 
    State.metadata.set(&#39;ngplus&#39;, true);

→ setting the key as an object
    State.metadata.set(&#39;achievements&#39;, { ateYellowSnow : true });
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to State API Menu|StateAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="167" name="StateAPI-PRNG" tags="page" position="3300,2000" size="100,100">&lt;h1&gt;Initialising a Seedable PRNG&lt;/h1&gt;
A PRNG, or pseudo-random number generator, is a deterministic algorithm for generating a sequence of numbers whose properties approximate the properties of sequences of random numbers.
The APIs below will be useful for procedural world building, factions alignment, loot drops, dungeon map layout etc... essentiall, anything that affects or involves randomness.
\
&lt;h3&gt;{{{State.prng.init()}}}&lt;/h3&gt;\
This API will initialise the seedable PRNG and integrate it into the story state and saves. This will affect the result of methods and functions like {{{State.random()}}}, {{{random()}}}, and {{{randomFloat()}}}.

If used, {{{State.prng.init()}}} should be coded in the JavaScript section of your project, or inside {{{StoryInit}}}. It is strongly recommended not to add arguments to the API, but, if you do use an explicit seed, you must enable additional entropy (or all playthroughs will be the same).
{{{
    State.prng.init([seed [, useEntropy]])
}}}
It has 2 parameters:
* {{{seed}}} (optional), the explicit seed used to initialise the PRNG 
* {{{useEntropy}}} (optional), entables the use of additional entropy to pad the seed.
\
&gt; //Examples://
{{{
    State.prng.init()
→ automatically seed the PRNG

    State.prng.init(&quot;aVeryLongSeed&quot;)
→ seed with &quot;aVeryLongSeed&quot; (not recommended)

    State.prng.init(&quot;aVeryLongSeed&quot;, true)
→ seed with &quot;aVeryLongSeed&quot; and pad it (recommended)
}}}
\
&lt;h3&gt;{{{State.prng.isEnabled()}}}&lt;/h3&gt;\
This API will check whether the seedable PRNG has been enable.
{{{
    State.prng.isEnabled()
}}}
\
&lt;h3&gt;{{{State.prng.pull}}}&lt;/h3&gt;\
This API will return the current pull count, meaning how many times a request has been made from the PRNG. 
&gt; &#39;&#39;Note:&#39;&#39; the pull count is automatically included within saves and sessions, and is mainly useful for debugging purposes.
{{{
    State.prng.pull
}}}
\
&lt;h3&gt;{{{State.prng.seed}}}&lt;/h3&gt;\
This API will return the seed from the PRNG.
&gt; &#39;&#39;Note:&#39;&#39; the pull count is automatically included within saves and sessions, and is mainly useful for debugging purposes.
{{{
    State.prng.seed
}}}
\
&lt;h3&gt;{{{State.random()}}}&lt;/h3&gt;\
This API will return a pseudo-random decimal number (floating-point) in the range 0 (inclusive) up to but not included 1 (exclusive).
&gt; &#39;&#39;Note:&#39;&#39; by default, it simply returns results from {{{Math.random()}}}. 
{{{
    State.random()
→ returns a pseudo-random floating-point number in the range [0, 1)
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to State API Menu|StateAPI]] - [[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="168" name="StoryAPI" tags="chapter page" position="3500,1900" size="200,100">&lt;h1&gt;Managing Story Elements with APIs&lt;/h1&gt;
The APIs listed below will help you check and manage different elements of your Story.
\
&lt;h3&gt;{{{Story.domId}}}&lt;/h3&gt;
This API keeps the DOM ID of the project, created from the slugified story title.
{{{
    Story.domId
→ sugarcube-guide is the DOM ID of this project.
}}}
\
&lt;h3&gt;{{{Story.ifId}}}&lt;/h3&gt;\
This API keeps the IFID ([[Interactive Fiction IDentifier|https://ifdb.org/help-ifid]]) of the story.
{{{
    Story.ifId
→ C15CE33F-61F6-4909-BB59-73EE7A3D57B1
  is the IFID of this project
}}}
\
&lt;h3&gt;{{{Story.title}}}&lt;/h3&gt;
This API keeps the title of the project.
{{{
    Story.title
→ {SugarCube Guide} is the title of this project
}}}
\
&lt;h3&gt;{{{Story.get()}}}&lt;/h3&gt;\
This API will return the Passage object of the referenced title (tags, classes, HTML element).
{{{
    Story.get(title)
}}}
It has 1 parameter:
* {{{title}}}, the title of the Passage object (i.e. the Passage Name)
&gt; //Example://
{{{
    Story.get(&quot;Start&quot;)  
→ returns the Passage object of {:: Start}
}}}
\
&lt;h3&gt;{{{Story.has()}}}&lt;/h3&gt;\
This API will check whether the Passage object of the referenced title (tags, classes, HTML element) exists.
{{{
    Story.has(title)
}}}
It has 1 parameter:
* {{{title}}}, the title of the Passage object (i.e. the Passage Name)
&gt; //Example://
{{{
    Story.has(&quot;Start&quot;)  
→ checks that {:: Start} exists 
}}}
\
&lt;h3&gt;{{{Story.lookup()}}}&lt;/h3&gt;\
This API will return an array of Passage objects whose value matches the search value, given a property.
{{{
    Story.lookup(propertyName , searchValue [, sortProperty])
}}}
It has 3 parameters:
* {{{propertyName}}}, the property to check 
* {{{searchValue}}}, the value wanted related to the property
* {{{sortProperty}}} (optional), the property used to sort the array 
** default is the Passage&#39;s title lexicographically sorting
\
&gt; //Example://
{{{
    Story.lookup(&quot;tags&quot;, &quot;forest&quot;);
→ will list all Passages tagged &#39;forest&#39;
  sorted by title
}}}
\
&lt;h3&gt;{{{Story.lookupWith()}}}&lt;/h3&gt;\
This API will return an array of Passage objects passing the test from a defined predicate function.
{{{
    Story.lookupWith(predicate [, sortProperty])
}}}
It has 2 properties:
* {{{predicate}}}, the function used to test each Passage object 
* {{{sortProperty}}} (optional), the property used to sort the array 
** default is the Passage&#39;s title lexicographically sorting
\
&gt; //Examples://
{{{
    Story.lookupWith(function (p) {
        return p.tags.includes(&quot;forest&quot;);
    });
→ will list all Passages tagged &#39;forest&#39;
  sorted by title

    var hasWhitespaceRegExp = /\s/;
    Story.lookupWith(function (p) {
        return hasWhitespaceRegExp.test(p.title);
    });
→ will list all Passages containing whitespace
  sorted by title
}}}

&lt;div id=&quot;link-menu&quot;&gt;[[Back to the Start Menu|Start]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="169" name="Update Log" tags="side" position="1700,400" size="100,100">&lt;h1&gt;100% Good Twine SugarCube Guide&lt;/h1&gt;
&gt; //Next Update// (TBA)
Edits to take into account changes in the new SugarCube version 
Potentially the Audio API
&lt;hr&gt;
&gt; &#39;&#39;Version 1.2.1&#39;&#39;
[24-Jan] - Added Function/Methog Index + API Index
[24-Jan] - Completed the TODO comments
[24-Jan] - Removed the //New// and //Updated// signs
[24-Jan] - Fixed typos, broken links
[24-Jan] - Reformatted the Macro Index
&gt; &#39;&#39;Version 1.2.0&#39;&#39;
[10-Dec] - Released a Downloadable Form
[10-Dec] - Completed the SugarCube Theme 
[10-Dec] - Completed the Settings Options
[10-Dec] - Added the {Targetable HTML Elements} page
[10-Dec] - Added the {State APIs} pages 
[09-Dec] - Added the {Passage API} page
[09-Dec] - Added the {Story API} page
[08-Dec] - Added the {Methods Advanced} pages
[08-Dec] - Added the {FullScreen API} pages
[08-Dec] - Added the {Accessibility} page
[07-Dec] - Added the {Stats Bar} and {Loading Screen} pages
[07-Dec] - Added the {Save API} pages 
[06-Dec] - Added the {Custom Macro} pages
[05-Dec] - Added the {More Markup} pages 
[05-Dec] - Added the {More Basic API} pages 
[05-Dec] - Added the {Configuration API} pages
[04-Dec] - Added more and reformatted examples 
[04-Dec] - Rephrased some explanations for clarity and consistency
[04-Dec] - Added the {Special Variables} and {Asset Tags} pages
[04-Dec] - Added the {Settings API} pages
[03-Dec] - Added more and reformatted examples 
[03-Dec] - Rephrased some explanations for clarity and consistency
[03-Dec] - Corrected an error in the {Typing Events} page
[02-Dec] - Added more and reformatted examples 
[02-Dec] - Rephrased some explanations for clarity and consistency
[02-Dec] - Corrected an error in the {Script/Run Macro} page
[30-Nov] - Added more and reformatted examples 
[30-Nov] - Rephrased some explanations for clarity and consistency
[30-Nov] - Fixed error in text for the {Condition Statements}
[29-Nov] - Added more and reformatted examples 
[29-Nov] - Rephrased some explanations for clarity and consistency
[28-Nov] - Added more and reformatted examples 
[28-Nov] - Fixes some code examples (Settings, Markup-Link)
[28-Nov] - Rephrased some explanations for clarity and consistency
[28-Nov] - Fixed some external links
[28-Nov] - Added more links (internal guide)
&lt;hr&gt;
&gt; &#39;&#39;Version 1.1.0&#39;&#39;
[05-Aug] - Clean up and check for update
[02-Aug] - Added the {Event} pages
[02-Aug] - Added the {Intro to Animation} page
[01-Aug] - Addition in the {Going Further with Settings} page.
[01-Aug] - Added the {Engine API} pages
[01-Aug] - Added the {Localization} pages
&lt;hr&gt;
&gt; &#39;&#39;Version 1.0.2&#39;&#39;
[30-Jul] - Fixed broken links
[30-Jul] - Added external links
[30-Jul] - Added extra explanation on the {Back vs Return} macros, and the {Conditional Statements}.
[30-Jul] - Fixed errors in Typed code, Basic Macro code, Styling Markup
[30-Jul] - Corrected wrong information in the Further CSS, Interactive Macros (cycle, listbox)
[30-Jul] - Updated the {Index}
[30-Jul] - Completed the {Macro List} Page
[30-Jul] - Updated the {Lexicon}
&lt;hr&gt;
&gt; &#39;&#39;Version 1.0.1&#39;&#39;
[29-Jul] - Fixed errors in Method code (array, string)
[29-Jul] - Fixed broken links
[29-Jul] - Fixed markup errors
[29-Jul] - Fixed inconsistencies in formatting
[29-Jul] - Cleaned up TODO notes on published pages
&lt;hr&gt;
&gt; &#39;&#39;Version 1.0.0&#39;&#39;
[30-Jun] - Pre-Release

&lt;&lt;back&gt;&gt;</tw-passagedata></tw-storydata>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){(function(window,document,jQuery,undefined){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?\w*(?:error|exception|_err):\s+)+/i,Alert=function(){function mesg(where,error,isFatal,isUncaught){var mesg="Error",nice="A".concat(isFatal?" fatal":"n"," error has occurred.");nice+=isFatal?" Aborting.":" You may be able to continue, but some parts may not work properly.";var isObject=null!==error&&"object"===_typeof(error),what=(isObject&&"message"in error?String(error.message).replace(errorPrologRegExp,""):String(error)).trim()||"unknown error";null!=where&&(mesg+=" [".concat(where,"]")),mesg+=": ".concat(what,"."),isObject&&"stack"in error&&(mesg+="\n\nStack Trace:\n".concat(error.stack)),mesg&&(nice+="\n\n".concat(mesg)),isUncaught||console[isFatal?"error":"warn"](mesg),window.alert(nice)}var origOnError;return origOnError=window.onerror,window.onerror=function(what,source,lineNum,colNum,error){"complete"===document.readyState?mesg(null,null!=error?error:what,!1,!0):(mesg(null,null!=error?error:what,!0,!0),window.onerror=origOnError,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))},Object.freeze(Object.defineProperties({},{error:{value:function(where,error){mesg(where,error)}},fatal:{value:function(where,error){mesg(where,error,!0)}}}))}(),Patterns=(wsMap=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),wsRe=/^\s$/,missing="",wsMap.forEach((function(pat,char){wsRe.test(char)||(missing+=pat)})),space=missing?"[\\s".concat(missing,"]"):"\\s",spaceNoTerminator="[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",notSpace="\\s"===space?"\\S":space.replace(/^\[/,"[^"),anyChar="(?:.|".concat("[\\n\\r\\u2028\\u2029]",")"),anyLetter="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",anyLetterStrict=anyLetter.replace("\\-",""),identifier="".concat("[$A-Z_a-z]").concat("[$0-9A-Z_a-z]","*"),variable="[$_]"+identifier,htmlTagName="[A-Za-z](?:".concat(cENChar="(?:[\\x2D.0-9A-Z_a-z\\xB7\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u037D\\u037F-\\u1FFF\\u200C\\u200D\\u203F\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]|[\\uD800-\\uDB7F][\\uDC00-\\uDFFF])","*-").concat(cENChar,"*|[0-9A-Za-z]*)"),twStyle="(".concat(anyLetter,"+)\\(([^\\)\\|\\n]+)\\):"),cssStyle="".concat(spaceNoTerminator,"*(").concat(anyLetter,"+)").concat(spaceNoTerminator,"*:([^;\\|\\n]+);"),idOrClass="".concat(spaceNoTerminator,"*((?:").concat("[#.]").concat(anyLetter,"+").concat(spaceNoTerminator,"*)+);"),inlineCss="".concat(twStyle,"|").concat(cssStyle,"|").concat(idOrClass),Object.freeze({space:space,spaceNoTerminator:spaceNoTerminator,lineTerminator:"[\\n\\r\\u2028\\u2029]",notSpace:notSpace,anyChar:anyChar,anyLetter:anyLetter,anyLetterStrict:anyLetterStrict,identifierFirstChar:"[$A-Z_a-z]",identifierNextChar:"[$0-9A-Z_a-z]",identifier:identifier,variableSigil:"[$_]",variable:variable,macroName:"[A-Za-z][\\w-]*|[=-]",templateName:"[A-Za-z][\\w-]*",htmlTagName:htmlTagName,cssIdOrClassSigil:"[#.]",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:inlineCss,url:"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+"})),wsMap,wsRe,missing,cENChar,twStyle,cssStyle,idOrClass,space,spaceNoTerminator,notSpace,anyChar,anyLetter,anyLetterStrict,identifier,variable,htmlTagName,inlineCss;!function(){var startWSRe,endWSRe,_trimString=(startWSRe=new RegExp("^".concat(Patterns.space).concat(Patterns.space,"*")),endWSRe=new RegExp("".concat(Patterns.space).concat(Patterns.space,"*$")),function(str,where){var val=String(str);if(!val)return val;switch(where){case"start":return startWSRe.test(val)?val.replace(startWSRe,""):val;case"end":return endWSRe.test(val)?val.replace(endWSRe,""):val;default:throw new Error('_trimString called with incorrect where parameter value: "'.concat(where,'"'))}});function _createPadString(length,padding){var targetLength=Number.parseInt(length,10)||0;if(targetLength<1)return"";var padString=void 0===padding?"":String(padding);for(""===padString&&(padString=" ");padString.length<targetLength;){var curPadLength=padString.length,remainingLength=targetLength-curPadLength;padString+=curPadLength>remainingLength?padString.slice(0,remainingLength):padString}return padString.length>targetLength&&(padString=padString.slice(0,targetLength)),padString}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,writable:!0,value:function flat(){if(null==this)throw new TypeError("Array.prototype.flat called on null or undefined");var depth=0===arguments.length?1:Number(arguments[0])||0;return depth<1?Array.prototype.slice.call(this):Array.prototype.reduce.call(this,(function(acc,cur){return cur instanceof Array?acc.push.apply(acc,_toConsumableArray(flat.call(cur,depth-1))):acc.push(cur),acc}),[])}}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatMap called on null or undefined");return Array.prototype.map.apply(this,arguments).flat()}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var length=this.length>>>0;if(0===length)return!1;var needle=arguments[0],i=Number(arguments[1])||0;for(i<0&&(i=Math.max(0,length+i));i<length;++i){var value=this[i];if(value===needle||value!=value&&needle!=needle)return!0}return!1}}),Object.entries||Object.defineProperty(Object,"entries",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.entries object parameter must be an object");return Object.keys(obj).map((function(key){return[key,obj[key]]}))}}),Object.fromEntries||Object.defineProperty(Object,"fromEntries",{configurable:!0,writable:!0,value:function(iter){return Array.from(iter).reduce((function(acc,pair){if(Object(pair)!==pair)throw new TypeError("Object.fromEntries iterable parameter must yield objects");return pair[0]in acc?Object.defineProperty(acc,pair[0],{configurable:!0,enumerable:!0,writable:!0,value:pair[1]}):acc[pair[0]]=pair[1],acc}),{})}}),Object.getOwnPropertyDescriptors||Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(obj){if(null==obj)throw new TypeError("Object.getOwnPropertyDescriptors object parameter is null or undefined");var O=Object(obj);return Reflect.ownKeys(O).reduce((function(acc,key){var desc=Object.getOwnPropertyDescriptor(O,key);return void 0!==desc&&(key in acc?Object.defineProperty(acc,key,{configurable:!0,enumerable:!0,writable:!0,value:desc}):acc[key]=desc),acc}),{})}}),Object.values||Object.defineProperty(Object,"values",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.values object parameter must be an object");return Object.keys(obj).map((function(key){return obj[key]}))}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:_createPadString(targetLength-baseLength,padding)+baseString}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:baseString+_createPadString(targetLength-baseLength,padding)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return _trimString(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return _trimString(this,"end")}})}(),function(){var _nativeMathRandom=Math.random,_regExpMetaCharsRe,_hasRegExpMetaCharsRe,_formatRegExp,_hasFormatRegExp;function _random(){var min,max;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:min=0,max=arguments[0];break;default:min=arguments[0],max=arguments[1]}if(min>max){var _ref=[max,min];min=_ref[0],max=_ref[1]}return Math.floor(_nativeMathRandom()*(max-min+1))+min}function _randomIndex(length,boundsArgs){var min,max;switch(boundsArgs.length){case 1:min=0,max=length-1;break;case 2:min=0,max=Math.trunc(boundsArgs[1]);break;default:min=Math.trunc(boundsArgs[1]),max=Math.trunc(boundsArgs[2])}return Number.isNaN(min)?min=0:!Number.isFinite(min)||min>=length?min=length-1:min<0&&(min=length+min)<0&&(min=0),Number.isNaN(max)?max=0:(!Number.isFinite(max)||max>=length||max<0&&(max=length+max)<0)&&(max=length-1),_random(min,max)}function _getCodePointStartAndEnd(str,pos){var code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};if(code<55296||code>57343)return{char:str.charAt(pos),start:pos,end:pos};if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)throw new Error("high surrogate without trailing low surrogate");var nextCode=str.charCodeAt(nextPos);if(nextCode<56320||nextCode>57343)throw new Error("high surrogate without trailing low surrogate");return{char:str.charAt(pos)+str.charAt(nextPos),start:pos,end:nextPos}}if(0===pos)throw new Error("low surrogate without leading high surrogate");var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);if(prevCode<55296||prevCode>56319)throw new Error("low surrogate without leading high surrogate");return{char:str.charAt(prevPos)+str.charAt(pos),start:prevPos,end:pos}}Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(array){if("object"!==_typeof(array)||null===array||!Object.prototype.hasOwnProperty.call(array,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var length=array.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments,1));return array[index]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var result=Array.from(this);if(0===arguments.length)return result;var items=Array.prototype.reduce.call(arguments,(function(prev,cur){return prev.concat(cur)}),[]),addSize=items.length;if(0===addSize)return result;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=items[i];-1===indexOf.call(result,value)&&push.call(result,value)}return result}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var indexOf=Array.prototype.indexOf,needle=arguments[0],pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,++pos;return count}}),Object.defineProperty(Array.prototype,"countWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.countWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.countWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return 0;for(var count=0,i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&++count;return count}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var needles=Array.prototype.concat.apply([],arguments),needlesLength=needles.length,indices=[],i=0;i<length;++i)for(var value=this[i],j=0;j<needlesLength;++j){var needle=needles[j];if(value===needle||value!=value&&needle!=needle){indices.push(i);break}}for(var result=[],_i=0,iend=indices.length;_i<iend;++_i)result[_i]=this[indices[_i]];for(var splice=Array.prototype.splice,_i2=indices.length-1;_i2>=0;--_i2)splice.call(this,indices[_i2],1);return result}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,cpyIndices=_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map((function(x){return x<0?Math.max(0,length+x):x}))).values()),delIndices=_toConsumableArray(cpyIndices).sort((function(a,b){return b-a})),result=[],i=0,iend=cpyIndices.length;i<iend;++i)result[i]=this[cpyIndices[i]];for(var _i3=0,_iend=delIndices.length;_i3<_iend;++_i3)splice.call(this,delIndices[_i3],1);return result}}),Object.defineProperty(Array.prototype,"deleteWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.deleteWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.deleteWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,indices=[],result=[],i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&(result.push(this[i]),indices.push(i));for(var _i4=indices.length-1;_i4>=0;--_i4)splice.call(this,indices[_i4],1);return result}}),Object.defineProperty(Array.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.first called on null or undefined");if(0!==this.length>>>0)return this[0]}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(!Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.last called on null or undefined");var length=this.length>>>0;if(0!==length)return this[length-1]}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return Array.prototype.splice.call(this,index,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var splice=Array.prototype.splice,result=[],max=length-1;do{result.push(splice.call(this,_random(0,max--),1)[0])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&push.call(this,value)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return this[index]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var picked=new Map,result=[],max=length-1;do{var i=void 0;do{i=_random(0,max)}while(picked.has(i));picked.set(i,!0),result.push(this[i])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var length=this.length>>>0;if(0===length)return this;for(var i=length-1;i>0;--i){var j=Math.floor(_nativeMathRandom()*(i+1));if(i!==j){var swap=this[i];this[i]=this[j],this[j]=swap}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,unshift=Array.prototype.unshift,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&unshift.call(this,value)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var slice=Array.prototype.slice,fn=this,bound=slice.call(arguments,0);return function(){for(var applied=[],argc=0,i=0;i<bound.length;++i)applied.push(bound[i]===undefined?arguments[argc++]:bound[i]);return fn.apply(this,applied.concat(slice.call(arguments,argc)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(num,min,max){var value=Number(num);return Number.isNaN(value)?NaN:value.clamp(min,max)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(num){return 1-(Math.cos(Number(num)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var min=Number(arguments[0]),max=Number(arguments[1]);if(min>max){var _ref2=[max,min];min=_ref2[0],max=_ref2[1]}return Math.min(Math.max(this,min),max)}}),RegExp.escape||(_regExpMetaCharsRe=/[\\^$*+?.()|[\]{}]/g,_hasRegExpMetaCharsRe=new RegExp(_regExpMetaCharsRe.source),Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(str){var val=String(str);return val&&_hasRegExpMetaCharsRe.test(val)?val.replace(_regExpMetaCharsRe,"\\$&"):val}})),_formatRegExp=/{(\d+)(?:,([+-]?\d+))?}/g,_hasFormatRegExp=new RegExp(_formatRegExp.source),Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(format){function padString(str,align,pad){if(!align)return str;var plen=Math.abs(align)-str.length;if(plen<1)return str;var padding=String(pad).repeat(plen);return align<0?str+padding:padding+str}if(arguments.length<2)return 0===arguments.length?"":format;var args=2===arguments.length&&Array.isArray(arguments[1])?_toConsumableArray(arguments[1]):Array.prototype.slice.call(arguments,1);return 0===args.length?format:_hasFormatRegExp.test(format)?(_formatRegExp.lastIndex=0,format.replace(_formatRegExp,(function(match,index,align){var retval=args[index];if(null==retval)return"";for(;"function"==typeof retval;)retval=retval();switch(_typeof(retval)){case"string":break;case"object":retval=JSON.stringify(retval);break;default:retval=String(retval)}return padString(retval,align?Number.parseInt(align,10):0," ")}))):format}}),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var needle=String(arguments[0]||"");if(""===needle)return 0;for(var indexOf=String.prototype.indexOf,step=needle.length,pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,pos+=step;return count}}),Object.defineProperty(String.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.first called on null or undefined");return _getCodePointStartAndEnd(String(this),0).char}}),Object.defineProperty(String.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.last called on null or undefined");var str=String(this);return _getCodePointStartAndEnd(str,str.length-1).char}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(startAt,delCount,replacement){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var length=this.length>>>0;if(0===length)return"";var start=Number(startAt);Number.isSafeInteger(start)?start<0&&(start+=length)<0&&(start=0):start=0,start>length&&(start=length);var count=Number(delCount);(!Number.isSafeInteger(count)||count<0)&&(count=0);var res=this.slice(0,start);return void 0!==replacement&&(res+=replacement),start+count<length&&(res+=this.slice(start+count)),res}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd3=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd3.char,end=_getCodePointStartAnd3.end;return-1===end?"":char.toLocaleUpperCase()+str.slice(end+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd4=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd4.char,end=_getCodePointStartAnd4.end;return-1===end?"":char.toUpperCase()+str.slice(end+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","(".concat(this.toString(),")")]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",_toConsumableArray(this)]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",_toConsumableArray(this)]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(code,data){if("string"!=typeof code)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[code,data]]}}),Object.defineProperty(JSON,"_real_stringify",{value:JSON.stringify}),Object.defineProperty(JSON,"stringify",{configurable:!0,writable:!0,value:function(_value,replacer,space){return JSON._real_stringify(_value,(function(key,val){var value=val;if("function"==typeof replacer)try{value=replacer(key,value)}catch(ex){}return void 0===value&&(value=["(revive:eval)","undefined"]),value}),space)}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,(function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(ex){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(ex){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(ex){}return value}))}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.flat.call(this,1/0)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var match,re=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),names=[];null!==(match=re.exec(this));)match[1]?names.push(match[1]):match[2]&&names.push(match[2]);return names}})}();var Browser=(userAgent=navigator.userAgent.toLowerCase(),winPhone=userAgent.includes("windows phone"),isMobile=Object.freeze({Android:!winPhone&&userAgent.includes("android"),BlackBerry:/blackberry|bb10/.test(userAgent),iOS:!winPhone&&/ip(?:hone|ad|od)/.test(userAgent),Opera:!winPhone&&("object"===_typeof(window.operamini)||userAgent.includes("opera mini")),Windows:winPhone||/iemobile|wpdesktop/.test(userAgent),any:function(){return isMobile.Android||isMobile.BlackBerry||isMobile.iOS||isMobile.Opera||isMobile.Windows}}),isGecko=!isMobile.Windows&&!/khtml|trident|edge/.test(userAgent)&&userAgent.includes("gecko"),isIE=!userAgent.includes("opera")&&/msie|trident/.test(userAgent),ieVersion=isIE?(ver=/(?:msie\s+|rv:)(\d+\.\d)/.exec(userAgent))?Number(ver[1]):0:null,isOpera=userAgent.includes("opera")||userAgent.includes(" opr/"),operaVersion=isOpera?function(){var ver=new RegExp("".concat(/khtml|chrome/.test(userAgent)?"opr":"version","\\/(\\d+\\.\\d+)")).exec(userAgent);return ver?Number(ver[1]):0}():null,isVivaldi=userAgent.includes("vivaldi"),Object.freeze({userAgent:userAgent,isMobile:isMobile,isGecko:isGecko,isIE:isIE,ieVersion:ieVersion,isOpera:isOpera,operaVersion:operaVersion,isVivaldi:isVivaldi})),ver,userAgent,winPhone,isMobile,isGecko,isIE,ieVersion,isOpera,operaVersion,isVivaldi,Has=(hasAudioElement=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(ex){}return!1}(),hasFile=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(ex){}return!1}(),hasGeolocation=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(ex){}return!1}(),hasMutationObserver=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(ex){}return!1}(),hasPerformance=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(ex){}return!1}(),hasTouch=function(){try{return"ontouchstart"in window||!!window.DocumentTouch&&document instanceof window.DocumentTouch||!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints}catch(ex){}return!1}(),hasTransitionEndEvent=function(){try{for(var teMap=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),teKeys=_toConsumableArray(teMap.keys()),el=document.createElement("div"),i=0;i<teKeys.length;++i)if(el.style[teKeys[i]]!==undefined)return teMap.get(teKeys[i])}catch(ex){}return!1}(),Object.freeze({audio:hasAudioElement,fileAPI:hasFile,geolocation:hasGeolocation,mutationObserver:hasMutationObserver,performance:hasPerformance,touch:hasTouch,transitionEndEvent:hasTransitionEndEvent})),hasAudioElement,hasFile,hasGeolocation,hasMutationObserver,hasPerformance,hasTouch,hasTransitionEndEvent,Visibility=(vendor=function(){try{return Object.freeze([{hiddenProperty:"hidden",stateProperty:"visibilityState",changeEvent:"visibilitychange"},{hiddenProperty:"webkitHidden",stateProperty:"webkitVisibilityState",changeEvent:"webkitvisibilitychange"},{hiddenProperty:"mozHidden",stateProperty:"mozVisibilityState",changeEvent:"mozvisibilitychange"},{hiddenProperty:"msHidden",stateProperty:"msVisibilityState",changeEvent:"msvisibilitychange"}].find((function(vnd){return vnd.hiddenProperty in document})))}catch(ex){}return undefined}(),Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},state:{get:function(){return vendor&&document[vendor.stateProperty]||"visible"}},isEnabled:{value:function(){return Boolean(vendor)}},isHidden:{value:function(){return Boolean(vendor&&document[vendor.hiddenProperty])}},hiddenProperty:{value:vendor&&vendor.hiddenProperty},stateProperty:{value:vendor&&vendor.stateProperty},changeEvent:{value:vendor&&vendor.changeEvent}}))),vendor,Fullscreen=function(){var _hasPromise,vendor=function(){try{return Object.freeze([{isEnabled:"fullscreenEnabled",element:"fullscreenElement",requestFn:"requestFullscreen",exitFn:"exitFullscreen",changeEvent:"fullscreenchange",errorEvent:"fullscreenerror"},{isEnabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",requestFn:"webkitRequestFullscreen",exitFn:"webkitExitFullscreen",changeEvent:"webkitfullscreenchange",errorEvent:"webkitfullscreenerror"},{isEnabled:"mozFullScreenEnabled",element:"mozFullScreenElement",requestFn:"mozRequestFullScreen",exitFn:"mozCancelFullScreen",changeEvent:"mozfullscreenchange",errorEvent:"mozfullscreenerror"},{isEnabled:"msFullscreenEnabled",element:"msFullscreenElement",requestFn:"msRequestFullscreen",exitFn:"msExitFullscreen",changeEvent:"MSFullscreenChange",errorEvent:"MSFullscreenError"}].find((function(vnd){return vnd.isEnabled in document})))}catch(ex){}return undefined}(),_returnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,vendor)try{var value=document.exitFullscreen();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise});function _selectElement(requestedEl){var selectedEl=requestedEl||document.documentElement;return selectedEl===document.documentElement&&("msRequestFullscreen"===vendor.requestFn||Browser.isOpera&&Browser.operaVersion<15)&&(selectedEl=document.body),selectedEl}function isFullscreen(){return Boolean(vendor&&document[vendor.element])}function requestFullscreen(options,requestedEl){var _this=this;if(!vendor)return Promise.reject(new Error("fullscreen not supported"));var element=_selectElement(requestedEl);if("function"!=typeof element[vendor.requestFn])return Promise.reject(new Error("fullscreen not supported"));if(isFullscreen())return Promise.resolve();if(_returnsPromise())return element[vendor.requestFn](options);var namespace=".Fullscreen_requestFullscreen";return new Promise((function(resolve,reject){jQuery(element).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen request error")):resolve()})),element[vendor.requestFn](options)}))}function exitFullscreen(){var _this2=this;if(!vendor||"function"!=typeof document[vendor.exitFn])return Promise.reject(new TypeError("fullscreen not supported"));if(!isFullscreen())return Promise.reject(new TypeError("fullscreen mode not active"));if(_returnsPromise())return document[vendor.exitFn]();var namespace=".Fullscreen_exitFullscreen";return new Promise((function(resolve,reject){jQuery(document).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this2).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen exit error")):resolve()})),document[vendor.exitFn]()}))}return Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},element:{get:function(){return vendor?document[vendor.element]:null}},isEnabled:{value:function(){return Boolean(vendor&&document[vendor.isEnabled])}},isFullscreen:{value:isFullscreen},request:{value:requestFullscreen},exit:{value:exitFullscreen},toggle:{value:function(options,requestedEl){return isFullscreen()?exitFullscreen():requestFullscreen(options,requestedEl)}},onChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.changeEvent,handlerFn)}}},offChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.changeEvent,handlerFn):$(element).off(vendor.changeEvent)}}},onError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.errorEvent,handlerFn)}}},offError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.errorEvent,handlerFn):$(element).off(vendor.errorEvent)}}}}))}(),_ref3=Object.freeze(Object.defineProperties({},{clone:{value:function clone(orig){return"object"!==_typeof(orig)||null===orig?orig:orig instanceof String?String(orig):orig instanceof Number?Number(orig):orig instanceof Boolean?Boolean(orig):"function"==typeof orig.clone?orig.clone(!0):orig.nodeType&&"function"==typeof orig.cloneNode?orig.cloneNode(!0):(orig instanceof Array?copy=new Array(orig.length):orig instanceof Date?copy=new Date(orig.getTime()):orig instanceof Map?(copy=new Map,orig.forEach((function(val,key){return copy.set(key,clone(val))}))):orig instanceof RegExp?copy=new RegExp(orig):orig instanceof Set?(copy=new Set,orig.forEach((function(val){return copy.add(clone(val))}))):copy=Object.create(Object.getPrototypeOf(orig)),Object.keys(orig).forEach((function(name){return copy[name]=clone(orig[name])})),copy);var copy}},convertBreaks:{value:function(source){for(var node,output=document.createDocumentFragment(),para=document.createElement("p");null!==(node=source.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":if(null!==node.nextSibling&&node.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===node.nextSibling.nodeName.toUpperCase()){source.removeChild(node.nextSibling),source.removeChild(node),output.appendChild(para),para=document.createElement("p");continue}if(!para.hasChildNodes()){source.removeChild(node);continue}break;case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":para.hasChildNodes()&&(output.appendChild(para),para=document.createElement("p")),output.appendChild(node);continue}para.appendChild(node)}para.hasChildNodes()&&output.appendChild(para),source.appendChild(output)}},safeActiveElement:{value:function(){try{return document.activeElement||null}catch(ex){return null}}},setDisplayTitle:{value:function(title){if("string"!=typeof title)throw new TypeError("story display title must be a string (received: ".concat(Util.getType(title),")"));var render=document.createDocumentFragment();new Wikifier(render,title);var text=function(source){for(var node,copy=source.cloneNode(!0),frag=document.createDocumentFragment();null!==(node=copy.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":case"DIV":case"P":frag.appendChild(document.createTextNode(" "))}frag.appendChild(node)}return frag.textContent}(render).trim();document.title=Config.passages.displayTitles&&""!==State.passage&&State.passage!==Config.passages.start?"".concat(State.passage," | ").concat(text):text;var storyTitle=document.getElementById("story-title");null!==storyTitle&&jQuery(storyTitle).empty().append(render)}},setPageElement:{value:function(idOrElement,titles,defaultText){var el="object"===_typeof(idOrElement)?idOrElement:document.getElementById(idOrElement);if(null==el)return null;var ids=Array.isArray(titles)?titles:[titles];jQuery(el).empty();for(var i=0,iend=ids.length;i<iend;++i)if(Story.has(ids[i]))return new Wikifier(el,Story.get(ids[i]).processText().trim()),el;if(null!=defaultText){var text=String(defaultText).trim();""!==text&&new Wikifier(el,text)}return el}},throwError:{value:function(place,message,source){var $wrapper=jQuery(document.createElement("div")),$toggle=jQuery(document.createElement("button")),$source=jQuery(document.createElement("pre")),mesg="".concat(L10n.get("errorTitle"),": ").concat(message||"unknown error");return $toggle.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},(function(){$toggle.hasClass("enabled")?($toggle.removeClass("enabled"),$source.attr({"aria-hidden":!0,hidden:"hidden"})):($toggle.addClass("enabled"),$source.removeAttr("aria-hidden hidden"))})).appendTo($wrapper),jQuery(document.createElement("span")).addClass("error").text(mesg).appendTo($wrapper),jQuery(document.createElement("code")).text(source).appendTo($source),$source.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo($wrapper),$wrapper.addClass("error-view").appendTo(place),console.warn("".concat(mesg,"\n\t").concat(source.replace(/\n/g,"\n\t"))),!1}},stringFrom:{value:function stringFrom(value){switch(_typeof(value)){case"function":return"[function]";case"number":if(Number.isNaN(value))return"[number NaN]";break;case"object":if(null===value)return"[null]";if(value instanceof Array)return value.map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Set)return Array.from(value).map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Map){var result=Array.from(value).map((function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],val=_ref5[1];return"".concat(stringFrom(key)," → ").concat(stringFrom(val))}));return"{ ".concat(result.join(", ")," }")}if(value instanceof Date)return value.toLocaleString();if(value instanceof Element){if(value===document.documentElement||value===document.head||value===document.body)throw new Error("illegal operation; attempting to convert the <html>, <head>, or <body> tags to string is not allowed");return value.outerHTML}return value instanceof Node?value.textContent:"function"==typeof value.toString?value.toString():Object.prototype.toString.call(value);case"symbol":var desc=void 0!==value.description?' "'.concat(value.description,'"'):"";return"[symbol".concat(desc,"]");case"undefined":return"[undefined]"}return String(value)}}})),clone=_ref3.clone,convertBreaks=_ref3.convertBreaks,safeActiveElement=_ref3.safeActiveElement,setDisplayTitle=_ref3.setDisplayTitle,setPageElement=_ref3.setPageElement,throwError=_ref3.throwError,stringFrom=_ref3.stringFrom;!function(){function onKeypressFn(ev){13!==ev.which&&32!==ev.which||(ev.preventDefault(),jQuery(safeActiveElement()||this).trigger("click"))}function onClickFnWrapper(fn){return function(){var $this=jQuery(this);$this.ariaIsDisabled()||($this.is("[aria-pressed]")&&$this.attr("aria-pressed","true"===$this.attr("aria-pressed")?"false":"true"),fn.apply(this,arguments))}}function oneClickFnWrapper(fn){return onClickFnWrapper((function(){jQuery(this).off(".aria-clickable").removeAttr("role tabindex aria-controls aria-pressed").filter("button").prop("disabled",!0),fn.apply(this,arguments)}))}jQuery.fn.extend({ariaClick:function(options,handler){if(0===this.length||0===arguments.length)return this;var opts=options,fn=handler;return null==fn&&(fn=opts,opts=undefined),"string"!=typeof(opts=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,role:undefined,controls:undefined,pressed:undefined,label:undefined},opts)).namespace?opts.namespace="":"."!==opts.namespace[0]&&(opts.namespace=".".concat(opts.namespace)),"boolean"==typeof opts.pressed&&(opts.pressed=opts.pressed?"true":"false"),this.filter("button").prop("type","button"),null!=opts.role?this.attr("role",opts.role):this.not("[role]").filter("a,[data-passage]").attr("role","link").end().not("a").not("[data-passage]").attr("role","button").end().end().end(),this.attr("tabindex",0),null!=opts.controls&&this.attr("aria-controls",opts.controls),null!=opts.pressed&&this.attr("aria-pressed",opts.pressed),null!=opts.label&&this.attr({"aria-label":opts.label,title:opts.label}),this.not("button").on("keypress.aria-clickable".concat(opts.namespace),opts.selector,onKeypressFn),this.on("click.aria-clickable".concat(opts.namespace),opts.selector,opts.data,opts.one?oneClickFnWrapper(fn):onClickFnWrapper(fn)),this},ariaDisabled:function(disable){if(0===this.length||0===arguments.length)return this;var $nonDisableable=this.not("button,fieldset,input,menuitem,optgroup,option,select,textarea"),$disableable=this.filter("button,fieldset,input,menuitem,optgroup,option,select,textarea");return disable?($nonDisableable.each((function(){this.setAttribute("disabled",""),this.setAttribute("aria-disabled","true")})),$disableable.each((function(){this.disabled=!0,this.setAttribute("aria-disabled","true")}))):($nonDisableable.each((function(){this.removeAttribute("disabled"),this.removeAttribute("aria-disabled")})),$disableable.each((function(){this.disabled=!1,this.removeAttribute("aria-disabled")}))),this},ariaIsDisabled:function(){return this.is("[disabled]")}})}(),jQuery.extend({wikiWithOptions:function(options){for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];if(0!==sources.length){var frag=document.createDocumentFragment();sources.forEach((function(content){return new Wikifier(frag,content,options)}));var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "))}},wiki:function(){for(var _len2=arguments.length,sources=new Array(_len2),_key2=0;_key2<_len2;_key2++)sources[_key2]=arguments[_key2];this.wikiWithOptions.apply(this,[undefined].concat(sources))}}),jQuery.fn.extend({wikiWithOptions:function(options){for(var _len3=arguments.length,sources=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)sources[_key3-1]=arguments[_key3];if(0===this.length||0===sources.length)return this;var frag=document.createDocumentFragment();return sources.forEach((function(content){return new Wikifier(frag,content,options)})),this.append(frag),this},wiki:function(){for(var _len4=arguments.length,sources=new Array(_len4),_key4=0;_key4<_len4;_key4++)sources[_key4]=arguments[_key4];return this.wikiWithOptions.apply(this,[undefined].concat(sources))}});var Util=function(){var toString,utilGetType="[object Object]"===(toString=Object.prototype.toString).call(new Map)?function(O){if(null===O)return"null";if(O instanceof Map)return"Map";if(O instanceof Set)return"Set";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType}:function(O){if(null===O)return"null";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType};function utilToEnum(obj){var pEnum=Object.create(null);if(obj instanceof Array)obj.forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Set)Array.from(obj).forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Map)obj.forEach((function(val,key){return pEnum[String(key)]=val}));else{if("object"!==_typeof(obj)||null===obj||Object.getPrototypeOf(obj)!==Object.prototype)throw new TypeError("Util.toEnum obj parameter must be an Array, Map, Set, or generic object");Object.assign(pEnum,obj)}return Object.freeze(pEnum)}function utilToStringTag(obj){return Object.prototype.toString.call(obj).slice(8,-1)}var _illegalSlugCharsRe=/[\x00-\x20!-/:-@[-^`{-\x9f]+/g,_isInvalidSlugRe=/^-*$/;var _illegalFilenameCharsRE=/[\x00-\x1f"#$%&'*+,/:;<=>?\\^`|\x7f-\x9f]+/g;var _markupCharsRe=/[!"#$&'*\-/<=>?@[\\\]^_`{|}~]/g,_hasMarkupCharsRe=new RegExp(_markupCharsRe.source),_markupCharsMap=utilToEnum({"!":"&#33;",'"':"&quot;","#":"&#35;",$:"&#36;","&":"&amp;","'":"&#39;","*":"&#42;","-":"&#45;","/":"&#47;","<":"&lt;","=":"&#61;",">":"&gt;","?":"&#63;","@":"&#64;","[":"&#91;","\\":"&#92;","]":"&#93;","^":"&#94;",_:"&#95;","`":"&#96;","{":"&#123;","|":"&#124;","}":"&#125;","~":"&#126;"});var _htmlCharsRe=/[&<>"'`]/g,_hasHtmlCharsRe=new RegExp(_htmlCharsRe.source),_htmlCharsMap=utilToEnum({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"});function utilEscape(str){if(null==str)return"";var val=String(str);return val&&_hasHtmlCharsRe.test(val)?val.replace(_htmlCharsRe,(function(ch){return _htmlCharsMap[ch]})):val}var _escapedHtmlRe=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,_hasEscapedHtmlRe=new RegExp(_escapedHtmlRe.source,"i"),_escapedHtmlMap=utilToEnum({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"});function utilUnescape(str){if(null==str)return"";var val=String(str);return val&&_hasEscapedHtmlRe.test(val)?val.replace(_escapedHtmlRe,(function(entity){return _escapedHtmlMap[entity.toLowerCase()]})):val}var _nowSource=Has.performance?performance:Date;var _cssTimeRe=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/;var utilScrubEventKey=function(){var separatorKey,decimalKey;if("undefined"!=typeof Intl&&"function"==typeof Intl.NumberFormat){var match=(new Intl.NumberFormat).format(111111.5).match(/(\D*)\d+(\D*)/);match&&(separatorKey=match[1],decimalKey=match[2])}return separatorKey||decimalKey||(separatorKey=",",decimalKey="."),function(key){switch(key){case"Scroll":return"ScrollLock";case"Spacebar":return" ";case"Left":return"ArrowLeft";case"Right":return"ArrowRight";case"Up":return"ArrowUp";case"Down":return"ArrowDown";case"Del":return"Delete";case"Crsel":return"CrSel";case"Exsel":return"ExSel";case"Esc":return"Escape";case"Apps":return"ContextMenu";case"Nonconvert":return"NonConvert";case"MediaNextTrack":return"MediaTrackNext";case"MediaPreviousTrack":return"MediaTrackPrevious";case"VolumeUp":return"AudioVolumeUp";case"VolumeDown":return"AudioVolumeDown";case"VolumeMute":return"AudioVolumeMute";case"Zoom":return"ZoomToggle";case"SelectMedia":case"MediaSelect":return"LaunchMediaPlayer";case"Add":return"+";case"Divide":return"/";case"Multiply":return"*";case"Subtract":return"-";case"Decimal":return decimalKey;case"Separator":return separatorKey}return key}}(),utilHasMediaQuery="function"!=typeof window.matchMedia?function(){return!1}:function(mediaQuery){return window.matchMedia(mediaQuery).matches};return Object.freeze(Object.defineProperties({},{getType:{value:utilGetType},isBoolean:{value:function(obj){return"boolean"==typeof obj||"string"==typeof obj&&("true"===obj||"false"===obj)}},isIterable:{value:function(obj){return null!=obj&&"function"==typeof obj[Symbol.iterator]}},isNumeric:{value:function(obj){var num;switch(_typeof(obj)){case"number":num=obj;break;case"string":num=Number(obj);break;default:return!1}return!Number.isNaN(num)&&Number.isFinite(num)}},sameValueZero:{value:function(a,b){return a===b||a!=a&&b!=b}},toEnum:{value:utilToEnum},toStringTag:{value:utilToStringTag},slugify:{value:function(str){var base=String(str).trim(),_legacy=base.replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase();return _isInvalidSlugRe.test(_legacy)?base.replace(_illegalSlugCharsRe,"").replace(/[_\s\u2013\u2014-]+/g,"-"):_legacy}},sanitizeFilename:{value:function(str){return String(str).trim().replace(_illegalFilenameCharsRE,"")}},escapeMarkup:{value:function(str){if(null==str)return"";var val=String(str);return val&&_hasMarkupCharsRe.test(val)?val.replace(_markupCharsRe,(function(ch){return _markupCharsMap[ch]})):val}},escape:{value:utilEscape},unescape:{value:utilUnescape},charAndPosAt:{value:function(text,position){var str=String(text),pos=Math.trunc(position),code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};var retval={char:str.charAt(pos),start:pos,end:pos};if(code<55296||code>57343)return retval;if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)return retval;var nextCode=str.charCodeAt(nextPos);return nextCode<56320||nextCode>57343||(retval.char=retval.char+str.charAt(nextPos),retval.end=nextPos),retval}if(0===pos)return retval;var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);return prevCode<55296||prevCode>56319||(retval.char=str.charAt(prevPos)+retval.char,retval.start=prevPos),retval}},now:{value:function(){return _nowSource.now()}},fromCssTime:{value:function(cssTime){var match=_cssTimeRe.exec(String(cssTime));if(null===match)throw new SyntaxError('invalid time value syntax: "'.concat(cssTime,'"'));var msec=Number(match[1]);if(1===match[2].length&&(msec*=1e3),Number.isNaN(msec)||!Number.isFinite(msec))throw new RangeError('invalid time value: "'.concat(cssTime,'"'));return msec}},toCssTime:{value:function(msec){if("number"!=typeof msec||Number.isNaN(msec)||!Number.isFinite(msec)){var what;switch(_typeof(msec)){case"string":what='"'.concat(msec,'"');break;case"number":what=String(msec);break;default:what=utilToStringTag(msec)}throw new Error("invalid milliseconds: ".concat(what))}return"".concat(msec,"ms")}},fromCssProperty:{value:function(cssName){if(!cssName.includes("-"))switch(cssName){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return cssName}return("-ms-"===cssName.slice(0,4)?cssName.slice(1):cssName).split("-").map((function(part,i){return 0===i?part:part.toUpperFirst()})).join("")}},parseUrl:{value:function(url){var el=document.createElement("a"),queryObj=Object.create(null);el.href=url,el.search&&el.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach((function(query){var _query$split2=_slicedToArray(query.split("="),2),key=_query$split2[0],value=_query$split2[1];queryObj[key]=value}));var pathname=el.host&&"/"!==el.pathname[0]?"/".concat(el.pathname):el.pathname;return{href:el.href,protocol:el.protocol,host:el.host,hostname:el.hostname,port:el.port,path:"".concat(pathname).concat(el.search),pathname:pathname,query:el.search,search:el.search,queries:queryObj,searches:queryObj,hash:el.hash}}},newExceptionFrom:{value:function(original,exceptionType,override){if("object"!==_typeof(original)||null===original)throw new Error("Util.newExceptionFrom original parameter must be an object");if("function"!=typeof exceptionType)throw new Error("Util.newExceptionFrom exceptionType parameter must be an error type constructor");var ex=new exceptionType(original.message);void 0!==original.name&&(ex.name=original.name),void 0!==original.code&&(ex.code=original.code),void 0!==original.columnNumber&&(ex.columnNumber=original.columnNumber),void 0!==original.description&&(ex.description=original.description),void 0!==original.fileName&&(ex.fileName=original.fileName),void 0!==original.lineNumber&&(ex.lineNumber=original.lineNumber),void 0!==original.number&&(ex.number=original.number),void 0!==original.stack&&(ex.stack=original.stack);var overrideType=_typeof(override);if("undefined"!==overrideType)if("object"===overrideType&&null!==override)Object.assign(ex,override);else{if("string"!==overrideType)throw new Error("Util.newExceptionFrom override parameter must be an object or string");ex.message=override}return ex}},scrubEventKey:{value:utilScrubEventKey},hasMediaQuery:{value:utilHasMediaQuery},random:{value:Math.random},entityEncode:{value:utilEscape},entityDecode:{value:utilUnescape},evalExpression:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),SimpleStore=(_adapters=[],_initialized=null,Object.freeze(Object.defineProperties({},{adapters:{value:_adapters},create:{value:function(storageId,persistent){if(_initialized)return _initialized.create(storageId,persistent);for(var i=0;i<_adapters.length;++i)if(_adapters[i].init(storageId,persistent))return(_initialized=_adapters[i]).create(storageId,persistent);throw new Error("no valid storage adapters found")}}}))),_adapters,_initialized,_ok,_WebStorageAdapter;SimpleStore.adapters.push((_ok=!1,_WebStorageAdapter=function(){function _WebStorageAdapter(storageId,persistent){_classCallCheck(this,_WebStorageAdapter);var prefix="".concat(storageId,"."),engine=null,name=null;persistent?(engine=window.localStorage,name="localStorage"):(engine=window.sessionStorage,name="sessionStorage"),Object.defineProperties(this,{_engine:{value:engine},_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:name},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_WebStorageAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var keys=[],i=0;i<this._engine.length;++i){var key=this._engine.key(i);this._prefixRe.test(key)&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&this._engine.hasOwnProperty(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=this._engine.getItem(this._prefix+key);return null==value?null:_WebStorageAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{this._engine.setItem(this._prefix+key,_WebStorageAdapter._serialize(value))}catch(ex){if(/quota.?(?:exceeded|reached)/i.test(ex.name+ex.message))throw Util.newExceptionFrom(ex,Error,"".concat(this.name," quota exceeded"));throw ex}return!0}},{key:"delete",value:function(key){return!("string"!=typeof key||!key||(this._engine.removeItem(this._prefix+key),0))}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_serialize",value:function(obj){return LZString.compressToUTF16(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromUTF16(str))}}]),_WebStorageAdapter}(),Object.freeze(Object.defineProperties({},{init:{value:function(){function hasWebStorage(storeId){try{var store=window[storeId],tid="_sc_".concat(String(Date.now()));store.setItem(tid,tid);var result=store.getItem(tid)===tid;return store.removeItem(tid),result}catch(ex){}return!1}return _ok=hasWebStorage("localStorage")&&hasWebStorage("sessionStorage")}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _WebStorageAdapter(storageId,persistent)}}})))),SimpleStore.adapters.push(function(){var _MAX_EXPIRY="Tue, 19 Jan 2038 03:14:07 GMT",_MIN_EXPIRY="Thu, 01 Jan 1970 00:00:00 GMT",_ok=!1,_CookieAdapter=function(){function _CookieAdapter(storageId,persistent){_classCallCheck(this,_CookieAdapter);var prefix="".concat(storageId).concat(persistent?"!":"*",".");Object.defineProperties(this,{_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:"cookie"},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_CookieAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var cookies=document.cookie.split(/;\s*/),keys=[],i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(this._prefixRe.test(key))""!==decodeURIComponent(kvPair[1])&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&null!==_CookieAdapter._getCookie(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=_CookieAdapter._getCookie(this._prefix+key);return null===value?null:_CookieAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,_CookieAdapter._serialize(value),this.persistent?"Tue, 19 Jan 2038 03:14:07 GMT":undefined),!this.has(key))throw new Error("unknown validation error during set")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"delete",value:function(key){if("string"!=typeof key||!key||!this.has(key))return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,undefined,_MIN_EXPIRY),this.has(key))throw new Error("unknown validation error during delete")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_getCookie",value:function(prefixedKey){if(!prefixedKey||""===document.cookie)return null;for(var cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("=");if(prefixedKey===decodeURIComponent(kvPair[0]))return decodeURIComponent(kvPair[1])||null}return null}},{key:"_setCookie",value:function(prefixedKey,value,expiry){if(prefixedKey){var payload="".concat(encodeURIComponent(prefixedKey),"=");null!=value&&(payload+=encodeURIComponent(value)),null!=expiry&&(payload+="; expires=".concat(expiry)),payload+="; path=/",document.cookie=payload}}},{key:"_serialize",value:function(obj){return LZString.compressToBase64(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromBase64(str))}}]),_CookieAdapter}();return Object.freeze(Object.defineProperties({},{init:{value:function(storageId){try{var tid="_sc_".concat(String(Date.now()));_CookieAdapter._setCookie(tid,_CookieAdapter._serialize(tid),undefined),_ok=_CookieAdapter._deserialize(_CookieAdapter._getCookie(tid))===tid,_CookieAdapter._setCookie(tid,undefined,_MIN_EXPIRY)}catch(ex){_ok=!1}return _ok&&function(storageId){if(""===document.cookie)return;for(var oldPrefix="".concat(storageId,"."),oldPrefixRe=new RegExp("^".concat(RegExp.escape(oldPrefix))),persistPrefix="".concat(storageId,"!."),sessionPrefix="".concat(storageId,"*."),sessionTestRe=/\.(?:state|rcWarn)$/,cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(oldPrefixRe.test(key)){var value=decodeURIComponent(kvPair[1]);""!==value&&function(){var persist=!sessionTestRe.test(key);_CookieAdapter._setCookie(key,undefined,_MIN_EXPIRY),_CookieAdapter._setCookie(key.replace(oldPrefixRe,(function(){return persist?persistPrefix:sessionPrefix})),value,persist?_MAX_EXPIRY:undefined)}()}}}(storageId),_ok}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _CookieAdapter(storageId,persistent)}}}))}());var DebugView=function(){function DebugView(parent,type,name,title){_classCallCheck(this,DebugView),Object.defineProperties(this,{parent:{value:parent},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:title,"aria-label":title,"data-type":null!=type?type:"","data-name":null!=name?name:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(DebugView,[{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(type){this.view.setAttribute("data-type",null!=type?type:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(name){this.view.setAttribute("data-name",null!=name?name:"")}},{key:"title",get:function(){return this.view.title},set:function(title){this.view.title=title}},{key:"append",value:function(el){return jQuery(this.view).append(el),this}},{key:"modes",value:function(options){if(null==options){var current={};return this.view.className.splitOrEmpty(/\s+/).forEach((function(name){"debug"!==name&&(current[name]=!0)})),current}if("object"===_typeof(options))return Object.keys(options).forEach((function(name){this[options[name]?"addClass":"removeClass"](name)}),jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var $view=jQuery(this.view);this.view.hasChildNodes()&&$view.contents().appendTo(this.parent),$view.remove(),jQuery(this.break).remove()}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?DebugView.disable():DebugView.enable()}}]),DebugView}(),NodeTyper=function(){var NodeTyper=function(){function NodeTyper(config){if(_classCallCheck(this,NodeTyper),"object"!==_typeof(config)||null===config)throw new Error("config parameter must be an object (received: ".concat(Util.getType(config),")"));if(!(config.hasOwnProperty("targetNode")&&config.targetNode instanceof Node))throw new Error('config parameter object "targetNode" property must be a node');Object.defineProperties(this,{node:{value:config.targetNode},childNodes:{value:[]},nodeValue:{writable:!0,value:""},appendTo:{writable:!0,value:config.parentNode||null},classNames:{writable:!0,value:config.classNames||null},finished:{writable:!0,value:!1}});var childNode,node=this.node;for(node.nodeValue&&(this.nodeValue=node.nodeValue,node.nodeValue="");null!==(childNode=node.firstChild);)this.childNodes.push(new NodeTyper({targetNode:childNode,parentNode:node,classNames:this.classNames})),node.removeChild(childNode)}return _createClass(NodeTyper,[{key:"finish",value:function(){for(;this.type(!0););return!1}},{key:"type",value:function(flush){if(this.finished)return!1;if(this.appendTo){if(this.appendTo.appendChild(this.node),this.appendTo=null,this.node.nodeType!==Node.ELEMENT_NODE&&this.node.nodeType!==Node.TEXT_NODE||"none"===jQuery(this.node.parentNode).css("display"))return this.finish();this.node.parentNode&&this.classNames&&jQuery(this.node.parentNode).addClass(this.classNames)}if(this.nodeValue){if(flush)this.node.nodeValue+=this.nodeValue,this.nodeValue="";else{var _Util$charAndPosAt=Util.charAndPosAt(this.nodeValue,0),char=_Util$charAndPosAt.char,start=_Util$charAndPosAt.start,end=_Util$charAndPosAt.end;this.node.nodeValue+=char,this.nodeValue=this.nodeValue.slice(1+end-start)}return!0}this.classNames&&(jQuery(this.node.parentNode).removeClass(this.classNames),this.classNames=null);for(var childNodes=this.childNodes;childNodes.length>0;){if(childNodes[0].type())return!0;childNodes.shift()}return this.finished=!0,!1}}]),NodeTyper}();return NodeTyper}(),PRNGWrapper=function(){function PRNGWrapper(seed,useEntropy){_classCallCheck(this,PRNGWrapper),Object.defineProperties(this,new Math.seedrandom(seed,useEntropy,(function(prng,seed){return{_prng:{value:prng},seed:{writable:!0,value:seed},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}})))}return _createClass(PRNGWrapper,null,[{key:"marshal",value:function(prng){if(!prng||!prng.hasOwnProperty("seed")||!prng.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:prng.seed,pull:prng.pull}}},{key:"unmarshal",value:function(prngObj){if(!prngObj||!prngObj.hasOwnProperty("seed")||!prngObj.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var prng=new PRNGWrapper(prngObj.seed,!1),i=prngObj.pull;i>0;--i)prng.random();return prng}}]),PRNGWrapper}(),StyleWrapper=(_imageMarkupRe=new RegExp(Patterns.cssImage,"g"),_hasImageMarkupRe=new RegExp(Patterns.cssImage),function(){function StyleWrapper(style){if(_classCallCheck(this,StyleWrapper),null==style)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:style}})}return _createClass(StyleWrapper,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(rawCss){this.clear(),this.add(rawCss)}},{key:"add",value:function(rawCss){var css=rawCss;_hasImageMarkupRe.test(css)&&(_imageMarkupRe.lastIndex=0,css=css.replace(_imageMarkupRe,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text.trim())}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),this.style.styleSheet?this.style.styleSheet.cssText+=css:this.style.appendChild(document.createTextNode(css))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),StyleWrapper}()),_imageMarkupRe,_hasImageMarkupRe,Diff=(Op=Util.toEnum({Delete:0,SpliceArray:1,Copy:2,CopyDate:3}),Object.freeze(Object.defineProperties({},{Op:{value:Op},diff:{value:function diff(orig,dest){for(var aOpRef,objToString=Object.prototype.toString,origIsArray=orig instanceof Array,keys=[].concat(Object.keys(orig),Object.keys(dest)).sort().filter((function(val,i,arr){return 0===i||arr[i-1]!==val})),diffed={},keyIsAOpRef=function(key){return key===aOpRef},i=0,klen=keys.length;i<klen;++i){var key=keys[i],origP=orig[key],destP=dest[key];if(orig.hasOwnProperty(key))if(dest.hasOwnProperty(key)){if(origP===destP)continue;if(_typeof(origP)===_typeof(destP))if("function"==typeof origP)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,destP]);else if("object"!==_typeof(origP)||null===origP)diffed[key]=[Op.Copy,destP];else{var origPType=objToString.call(origP);if(origPType===objToString.call(destP))if(origP instanceof Date)Number(origP)!==Number(destP)&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Map)diffed[key]=[Op.Copy,clone(destP)];else if(origP instanceof RegExp)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Set)diffed[key]=[Op.Copy,clone(destP)];else if("[object Object]"!==origPType)diffed[key]=[Op.Copy,clone(destP)];else{var recurse=diff(origP,destP);null!==recurse&&(diffed[key]=recurse)}else diffed[key]=[Op.Copy,clone(destP)]}else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}else if(origIsArray&&Util.isNumeric(key)){var nKey=Number(key);if(!aOpRef){aOpRef="";do{aOpRef+="~"}while(keys.some(keyIsAOpRef));diffed[aOpRef]=[Op.SpliceArray,nKey,nKey]}nKey<diffed[aOpRef][1]&&(diffed[aOpRef][1]=nKey),nKey>diffed[aOpRef][2]&&(diffed[aOpRef][2]=nKey)}else diffed[key]=Op.Delete;else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}return Object.keys(diffed).length>0?diffed:null}},patch:{value:function patch(orig,diffed){for(var keys=Object.keys(diffed||{}),patched=clone(orig),i=0,klen=keys.length;i<klen;++i){var key=keys[i],diffedP=diffed[key];if(diffedP===Op.Delete)delete patched[key];else if(diffedP instanceof Array)switch(diffedP[0]){case Op.SpliceArray:patched.splice(diffedP[1],diffedP[2]-diffedP[1]+1);break;case Op.Copy:patched[key]=clone(diffedP[1]);break;case Op.CopyDate:patched[key]=new Date(diffedP[1])}else patched[key]=patch(patched[key],diffedP)}return patched}}}))),Op,L10n=(_patternRe=/\{\w+\}/g,_hasPatternRe=new RegExp(_patternRe.source),Object.freeze(Object.defineProperties({},{init:{value:function(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach((function(id){try{var value;switch(id){case"identity":value=strings.identity;break;case"aborting":value=strings.aborting;break;case"cancel":value=strings.cancel;break;case"close":value=strings.close;break;case"ok":value=strings.ok;break;case"errorTitle":value=strings.errors.title;break;case"errorNonexistentPassage":value=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":value=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":value=strings.errors.saveIdMismatch;break;case"warningDegraded":value=strings.warnings.degraded;break;case"debugViewTitle":value=strings.debugView.title;break;case"debugViewToggle":value=strings.debugView.toggle;break;case"uiBarToggle":value=strings.uiBar.toggle;break;case"uiBarBackward":value=strings.uiBar.backward;break;case"uiBarForward":value=strings.uiBar.forward;break;case"uiBarJumpto":value=strings.uiBar.jumpto;break;case"jumptoTitle":value=strings.jumpto.title;break;case"jumptoTurn":value=strings.jumpto.turn;break;case"jumptoUnavailable":value=strings.jumpto.unavailable;break;case"savesTitle":value=strings.saves.title;break;case"savesDisallowed":value=strings.saves.disallowed;break;case"savesIncapable":value=strings.saves.incapable;break;case"savesLabelAuto":value=strings.saves.labelAuto;break;case"savesLabelDelete":value=strings.saves.labelDelete;break;case"savesLabelExport":value=strings.saves.labelExport;break;case"savesLabelImport":value=strings.saves.labelImport;break;case"savesLabelLoad":value=strings.saves.labelLoad;break;case"savesLabelClear":value=strings.saves.labelClear;break;case"savesLabelSave":value=strings.saves.labelSave;break;case"savesLabelSlot":value=strings.saves.labelSlot;break;case"savesUnavailable":value=strings.saves.unavailable;break;case"savesUnknownDate":value=strings.saves.unknownDate;break;case"settingsTitle":value=strings.settings.title;break;case"settingsOff":value=strings.settings.off;break;case"settingsOn":value=strings.settings.on;break;case"settingsReset":value=strings.settings.reset;break;case"restartTitle":value=strings.restart.title;break;case"restartPrompt":value=strings.restart.prompt;break;case"shareTitle":value=strings.share.title;break;case"alertTitle":break;case"autoloadTitle":value=strings.autoload.title;break;case"autoloadCancel":value=strings.autoload.cancel;break;case"autoloadOk":value=strings.autoload.ok;break;case"autoloadPrompt":value=strings.autoload.prompt;break;case"macroBackText":value=strings.macros.back.text;break;case"macroReturnText":value=strings.macros.return.text}value&&(l10nStrings[id]=value.replace(/%\w+%/g,(function(pat){return"{".concat(pat.slice(1,-1),"}")})))}catch(ex){}}))}},get:{value:function(ids,overrides){if(!ids)return"";var selectedId,id=((Array.isArray(ids)?ids:[ids]).some((function(id){return!!l10nStrings.hasOwnProperty(id)&&(selectedId=id,!0)})),selectedId);if(!id)return"";for(var processed=l10nStrings[id],iteration=0;_hasPatternRe.test(processed);){if(++iteration>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");_patternRe.lastIndex=0,processed=processed.replace(_patternRe,(function(pat){var subId=pat.slice(1,-1);return overrides&&overrides.hasOwnProperty(subId)?overrides[subId]:l10nStrings.hasOwnProperty(subId)?l10nStrings[subId]:void 0}))}return processed}}}))),_patternRe,_hasPatternRe,strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveDiskLoadFailed:"failed to load save file from disk",errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarToggle:"Toggle the debug bar",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",alertTitle:"Alert",autoloadTitle:"Autoload",autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=(_debug=!1,_addVisitedLinkClass=!1,_cleanupWikifierOutput=!1,_loadDelay=0,_audioPauseOnFadeToZero=!0,_audioPreloadMetadata=!0,_historyControls=!0,_historyMaxStates=40,_macrosIfAssignmentError=!0,_macrosMaxLoopIterations=1e3,_macrosTypeSkipKey=" ",_macrosTypeVisitedPassages=!0,_passagesDisplayTitles=!1,_passagesNobr=!1,_savesId="untitled-story",_savesSlots=8,_savesTryDiskOnMobile=!0,_uiStowBarInitially=800,_uiUpdateStoryElements=!0,_errHistoryModeDeprecated="Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code",Object.freeze({get debug(){return _debug},set debug(value){_debug=Boolean(value)},get addVisitedLinkClass(){return _addVisitedLinkClass},set addVisitedLinkClass(value){_addVisitedLinkClass=Boolean(value)},get cleanupWikifierOutput(){return _cleanupWikifierOutput},set cleanupWikifierOutput(value){_cleanupWikifierOutput=Boolean(value)},get loadDelay(){return _loadDelay},set loadDelay(value){if(!Number.isSafeInteger(value)||value<0)throw new RangeError("Config.loadDelay must be a non-negative integer");_loadDelay=value},audio:Object.freeze({get pauseOnFadeToZero(){return _audioPauseOnFadeToZero},set pauseOnFadeToZero(value){_audioPauseOnFadeToZero=Boolean(value)},get preloadMetadata(){return _audioPreloadMetadata},set preloadMetadata(value){_audioPreloadMetadata=Boolean(value)}}),history:Object.freeze({get controls(){return _historyControls},set controls(value){var controls=Boolean(value);if(1===_historyMaxStates&&controls)throw new Error("Config.history.controls must be false when Config.history.maxStates is 1");_historyControls=controls},get maxStates(){return _historyMaxStates},set maxStates(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.history.maxStates must be a positive integer");_historyMaxStates=value,_historyControls&&1===value&&(_historyControls=!1)},get mode(){throw new Error(_errHistoryModeDeprecated)},set mode(_){throw new Error(_errHistoryModeDeprecated)},get tracking(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")},set tracking(_){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}}),macros:Object.freeze({get ifAssignmentError(){return _macrosIfAssignmentError},set ifAssignmentError(value){_macrosIfAssignmentError=Boolean(value)},get maxLoopIterations(){return _macrosMaxLoopIterations},set maxLoopIterations(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.macros.maxLoopIterations must be a positive integer");_macrosMaxLoopIterations=value},get typeSkipKey(){return _macrosTypeSkipKey},set typeSkipKey(value){_macrosTypeSkipKey=String(value)},get typeVisitedPassages(){return _macrosTypeVisitedPassages},set typeVisitedPassages(value){_macrosTypeVisitedPassages=Boolean(value)}}),navigation:Object.freeze({get override(){return _navigationOverride},set override(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.navigation.override must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_navigationOverride=value}}),passages:Object.freeze({get descriptions(){return _passagesDescriptions},set descriptions(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"Object"!==valueType&&"function"!==valueType)throw new TypeError("Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: ".concat(valueType,")"))}_passagesDescriptions=value},get displayTitles(){return _passagesDisplayTitles},set displayTitles(value){_passagesDisplayTitles=Boolean(value)},get nobr(){return _passagesNobr},set nobr(value){_passagesNobr=Boolean(value)},get onProcess(){return _passagesOnProcess},set onProcess(value){if(null!=value){var valueType=Util.getType(value);if("function"!==valueType)throw new TypeError("Config.passages.onProcess must be a function or null/undefined (received: ".concat(valueType,")"))}_passagesOnProcess=value},get start(){return _passagesStart},set start(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType)throw new TypeError("Config.passages.start must be a string or null/undefined (received: ".concat(valueType,")"))}_passagesStart=value},get transitionOut(){return _passagesTransitionOut},set transitionOut(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: ".concat(valueType,")"))}_passagesTransitionOut=value}}),saves:Object.freeze({get autoload(){return _savesAutoload},set autoload(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"string"!==valueType&&"function"!==valueType)throw new TypeError("Config.saves.autoload must be a boolean, string, function, or null/undefined (received: ".concat(valueType,")"))}_savesAutoload=value},get autosave(){return _savesAutosave},set autosave(value){if(null!=value){var valueType=Util.getType(value);if("string"===valueType)return void(_savesAutosave=[value]);if("boolean"!==valueType&&("Array"!==valueType||!value.every((function(item){return"string"==typeof item})))&&"function"!==valueType)throw new TypeError("Config.saves.autosave must be a boolean, Array<string>, function, or null/undefined (received: ".concat(valueType).concat("Array"===valueType?"<any>":"",")"))}_savesAutosave=value},get id(){return _savesId},set id(value){if("string"!=typeof value||""===value)throw new TypeError("Config.saves.id must be a non-empty string (received: ".concat(Util.getType(value),")"));_savesId=value},get isAllowed(){return _savesIsAllowed},set isAllowed(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.saves.isAllowed must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_savesIsAllowed=value},get slots(){return _savesSlots},set slots(value){if(!Number.isSafeInteger(value)||value<0)throw new TypeError("Config.saves.slots must be a non-negative integer (received: ".concat(Util.getType(value),")"));_savesSlots=value},get tryDiskOnMobile(){return _savesTryDiskOnMobile},set tryDiskOnMobile(value){_savesTryDiskOnMobile=Boolean(value)},get version(){return _savesVersion},set version(value){_savesVersion=value},get onLoad(){throw new Error("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead")},set onLoad(value){console.warn("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead"),Save.onLoad.add(value)},get onSave(){throw new Error("Config.saves.onSave has been deprecated, use the Save.onSave API instead")},set onSave(value){console.warn("Config.saves.onSave has been deprecated, use the Save.onSave API instead"),Save.onSave.add(value)}}),ui:Object.freeze({get stowBarInitially(){return _uiStowBarInitially},set stowBarInitially(value){var valueType=Util.getType(value);if("boolean"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.ui.stowBarInitially must be a boolean or non-negative integer (received: ".concat(valueType,")"));_uiStowBarInitially=value},get updateStoryElements(){return _uiUpdateStoryElements},set updateStoryElements(value){_uiUpdateStoryElements=Boolean(value)}})})),_navigationOverride,_passagesDescriptions,_passagesStart,_passagesOnProcess,_passagesTransitionOut,_savesAutoload,_savesAutosave,_savesIsAllowed,_savesVersion,_debug,_addVisitedLinkClass,_cleanupWikifierOutput,_loadDelay,_audioPauseOnFadeToZero,_audioPreloadMetadata,_historyControls,_historyMaxStates,_macrosIfAssignmentError,_macrosMaxLoopIterations,_macrosTypeSkipKey,_macrosTypeVisitedPassages,_passagesDisplayTitles,_passagesNobr,_savesId,_savesSlots,_savesTryDiskOnMobile,_uiStowBarInitially,_uiUpdateStoryElements,_errHistoryModeDeprecated,SimpleAudio=function(){var _hasPromise,_gestureEventNames=Object.freeze(["click","contextmenu","dblclick","keyup","mouseup","pointerup","touchend"]),_specialIds=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]),_formatSpecRe=/^([\w-]+)\s*\|\s*(\S.*)$/,_badIdRe=/[:\s]/,_tracks=new Map,_groups=new Map,_lists=new Map,_subscribers=new Map,_masterRate=1,_masterVolume=1,_masterMute=!1,_masterMuteOnHidden=!1,_playReturnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,Has.audio)try{var audio=document.createElement("audio");audio.muted=!0;var value=audio.play();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise}),AudioTrack=function(){function AudioTrack(obj){if(_classCallCheck(this,AudioTrack),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioTrack))throw new Error("sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioTrack,[{key:"_create",value:function(sourceList){var dataUriRe=/^data:\s*audio\/(?:x-)?([^;,]+)\s*[;,]/i,extRe=/\.([^./\\]+)$/,formats=AudioTrack.formats,usedSources=[],audio=document.createElement("audio");audio.preload="none",sourceList.forEach((function(src){var srcUri=null;switch(_typeof(src)){case"string":var match;if("data:"===src.slice(0,5)){if(null===(match=dataUriRe.exec(src)))throw new Error("source data URI missing media type")}else if(null===(match=extRe.exec(Util.parseUrl(src).pathname)))throw new Error("source URL missing file extension");formats[match[1]]&&(srcUri=src);break;case"object":if(null===src)throw new Error("source object cannot be null");if(!src.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!src.hasOwnProperty("format"))throw new Error('source object missing required "format" property');formats[src.format]&&(srcUri=src.src);break;default:throw new Error("invalid source value (type: ".concat(_typeof(src),")"))}if(null!==srcUri){var source=document.createElement("source");source.src=srcUri,audio.appendChild(source),usedSources.push(srcUri)}})),audio.hasChildNodes()&&Config.audio.preloadMetadata&&(audio.preload="metadata"),this._finalize(audio,usedSources,clone(sourceList))}},{key:"_copy",value:function(obj){this._finalize(obj.audio.cloneNode(!0),clone(obj.sources),clone(obj.originals))}},{key:"_finalize",value:function(audio,sources,originals){var _this3=this;Object.defineProperties(this,{audio:{configurable:!0,value:audio},sources:{value:Object.freeze(sources)},originals:{value:Object.freeze(originals)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart.AudioTrack",(function(){return _this3._error=!1})).on("error.AudioTrack",(function(){return _this3._error=!0})).find("source:last-of-type").on("error.AudioTrack",(function(){return _this3._trigger("error")})),function(id,callback){if("function"!=typeof callback)throw new Error("callback parameter must be a function");_subscribers.set(id,callback)}(this,(function(mesg){if(_this3.audio)switch(mesg){case"loadwithscreen":if(_this3.hasSource()){var lockId=LoadScreen.lock();_this3.one("canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen",(function(){jQuery(this).off(".AudioTrack_loadwithscreen"),LoadScreen.unlock(lockId)})).load()}break;case"load":_this3.load();break;case"mute":_this3._updateAudioMute();break;case"rate":_this3._updateAudioRate();break;case"stop":_this3.stop();break;case"volume":_this3._updateAudioVolume();break;case"unload":_this3.unload()}else unsubscribe(_this3)})),this._updateAudioMute(),this._updateAudioRate(),this._updateAudioVolume()}},{key:"_trigger",value:function(eventName){jQuery(this.audio).triggerHandler(eventName)}},{key:"_destroy",value:function(){unsubscribe(this),this.audio&&(jQuery(this.audio).off(),this.unload(),this._error=!0,delete this.audio)}},{key:"clone",value:function(){return new AudioTrack(this)}},{key:"load",value:function(){var _this4=this;if(this.fadeStop(),this.audio.pause(),!this.audio.hasChildNodes()){if(0===this.sources.length)return;this.sources.forEach((function(srcUri){var source=document.createElement("source");source.src=srcUri,_this4.audio.appendChild(source)}))}"auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load()}},{key:"unload",value:function(){this.fadeStop(),this.stop();var audio=this.audio;for(audio.preload="none";audio.hasChildNodes();)audio.removeChild(audio.firstChild);audio.load()}},{key:"play",value:function(){var _this5=this;if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));"auto"!==this.audio.preload&&(this.audio.preload="auto");var namespace=".AudioTrack_play";return _playReturnsPromise()?this.audio.play():new Promise((function(resolve,reject){_this5.isPlaying()?resolve():(jQuery(_this5.audio).off(namespace).one("error".concat(namespace," playing").concat(namespace," timeupdate").concat(namespace),(function(ev){jQuery(_this5).off(namespace),"error"===ev.type?reject(new Error("unknown audio play error")):resolve()})),_this5.audio.play())}))}},{key:"playWhenAllowed",value:function(){var _this6=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioTrack_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioTrack_playWhenAllowed"),_this6.audio.play()}))}))}},{key:"pause",value:function(){this.audio.pause()}},{key:"stop",value:function(){this.audio.pause(),this.time(0),this._trigger(":stopped")}},{key:"fade",value:function(duration,toVol,fromVol){var _this7=this;if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));this.fadeStop();var from=Math.clamp(null==fromVol?this.volume():fromVol,0,1),to=Math.clamp(toVol,0,1);return from!==to?(this.volume(from),jQuery(this.audio).off("timeupdate.AudioTrack_fade").one("timeupdate.AudioTrack_fade",(function(){var min,max;from<to?(min=from,max=to):(min=to,max=from);var time=Math.max(duration,1),delta=(to-from)/(time/.025);_this7._trigger(":fading"),_this7._faderId=setInterval((function(){_this7.isPlaying()?(_this7.volume(Math.clamp(_this7.volume()+delta,min,max)),Config.audio.pauseOnFadeToZero&&0===_this7.volume()&&_this7.pause(),_this7.volume()===to&&(_this7.fadeStop(),_this7._trigger(":faded"))):_this7.fadeStop()}),25)})),this.play()):void 0}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"loop",value:function(_loop){return null==_loop?this.audio.loop:(this.audio.loop=!!_loop,this)}},{key:"mute",value:function(_mute){return null==_mute?this._mute:(this._mute=!!_mute,this._updateAudioMute(),this)}},{key:"_updateAudioMute",value:function(){this.audio.muted=this._mute||_masterMute}},{key:"rate",value:function(_rate){if(null==_rate)return this._rate;if("number"!=typeof _rate)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate,.2,5),this._updateAudioRate(),this}},{key:"_updateAudioRate",value:function(){this.audio.playbackRate=Math.clamp(this._rate*_masterRate,.2,5)}},{key:"time",value:function(_time){var _this8=this;if(null==_time)return this.audio.currentTime;if("number"!=typeof _time)throw new TypeError("time parameter must be a number");return this.hasMetadata()?this.audio.currentTime=_time:jQuery(this.audio).off("loadedmetadata.AudioTrack_time").one("loadedmetadata.AudioTrack_time",(function(){return _this8.audio.currentTime=_time})),this}},{key:"volume",value:function(_volume){if(null==_volume)return this._volume;if("number"!=typeof _volume)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume,0,1),this._updateAudioVolume(),this}},{key:"_updateAudioVolume",value:function(){this.audio.volume=Math.clamp(this._volume*_masterVolume,0,1)}},{key:"duration",value:function(){return this.audio.duration}},{key:"remaining",value:function(){return this.audio.duration-this.audio.currentTime}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isUnloaded",value:function(){return!this.audio.hasChildNodes()}},{key:"isUnavailable",value:function(){return!this.hasSource()||this.isUnloaded()||this.isFailed()}},{key:"isPlaying",value:function(){return!this.audio.paused&&this.hasSomeData()}},{key:"isPaused",value:function(){return this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended}},{key:"isStopped",value:function(){return this.audio.paused&&0===this.audio.currentTime}},{key:"isEnded",value:function(){return this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isSeeking",value:function(){return this.audio.seeking}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"on",value:function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return jQuery.fn.on.apply(jQuery(this.audio),args),this}},{key:"one",value:function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return jQuery.fn.one.apply(jQuery(this.audio),args),this}},{key:"off",value:function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return jQuery.fn.off.apply(jQuery(this.audio),args),this}}]),AudioTrack}();Object.defineProperties(AudioTrack,{formats:{value:function(){var audio=document.createElement("audio"),types=new Map;function canPlay(mimeType){return types.has(mimeType)||types.set(mimeType,""!==audio.canPlayType(mimeType).replace(/^no$/i,"")),types.get(mimeType)}return Object.assign(Object.create(null),{aac:canPlay("audio/aac"),caf:canPlay("audio/x-caf")||canPlay("audio/caf"),flac:canPlay("audio/x-flac")||canPlay("audio/flac"),mp3:canPlay('audio/mpeg; codecs="mp3"')||canPlay("audio/mpeg")||canPlay("audio/mp3")||canPlay("audio/mpa"),mpeg:canPlay("audio/mpeg"),m4a:canPlay("audio/x-m4a")||canPlay("audio/m4a")||canPlay("audio/aac"),mp4:canPlay("audio/x-mp4")||canPlay("audio/mp4")||canPlay("audio/aac"),ogg:canPlay("audio/ogg"),oga:canPlay("audio/ogg"),opus:canPlay('audio/ogg; codecs="opus"')||canPlay("audio/opus"),wav:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),wave:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),weba:canPlay("audio/webm"),webm:canPlay("audio/webm")})}()}});var AudioList=function(){function AudioList(obj){if(_classCallCheck(this,AudioList),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioList))throw new Error("tracks parameter must be either an array, of track objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioList,[{key:"_create",value:function(trackList){var _this9=this;this._finalize(trackList.map((function(trackObj){if("object"!==_typeof(trackObj))throw new Error("tracks parameter array members must be objects");var own,rate,track,volume;if(trackObj instanceof AudioTrack)own=!0,rate=trackObj.rate(),track=trackObj.clone(),volume=trackObj.volume();else{if(!trackObj.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(trackObj.track instanceof AudioTrack))throw new Error('track object\'s "track" property must be an AudioTrack object');own=trackObj.hasOwnProperty("own")&&trackObj.own,rate=trackObj.hasOwnProperty("rate")?trackObj.rate:trackObj.track.rate(),track=trackObj.track,volume=trackObj.hasOwnProperty("volume")?trackObj.volume:trackObj.track.volume()}return track.stop(),track.loop(!1),track.mute(!1),track.rate(rate),track.volume(volume),track.on("ended.AudioList",(function(){return _this9._onEnd()})),{own:own,track:track,volume:volume,rate:rate}})))}},{key:"_copy",value:function(obj){this._finalize(clone(obj.tracks))}},{key:"_finalize",value:function(tracks){Object.defineProperties(this,{tracks:{configurable:!0,value:Object.freeze(tracks)},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}})}},{key:"_destroy",value:function(){this.stop(),this.tracks.filter((function(trackObj){return trackObj.own})).forEach((function(trackObj){return trackObj.track._destroy()})),delete this.tracks,delete this.queue}},{key:"load",value:function(){this.tracks.forEach((function(trackObj){return trackObj.track.load()}))}},{key:"unload",value:function(){this.stop(),this.tracks.forEach((function(trackObj){return trackObj.track.unload()}))}},{key:"play",value:function(){return null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||(0===this.queue.length&&this._fillQueue(),this._next())?this.current.track.play():Promise.reject(new Error("no tracks were available"))}},{key:"playWhenAllowed",value:function(){var _this10=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioList_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioList_playWhenAllowed"),_this10.play()}))}))}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this._drainQueue()}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fade",value:function(duration,toVol,fromVol){if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(0===this.queue.length&&this._fillQueue(),null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||this._next()){var adjFromVol,adjToVol=Math.clamp(toVol,0,1)*this.current.volume;return null!=fromVol&&(adjFromVol=Math.clamp(fromVol,0,1)*this.current.volume),this._volume=toVol,this.current.track.fade(duration,adjToVol,adjFromVol)}}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this.current&&this.current.track.fadeStop()}},{key:"loop",value:function(_loop2){return null==_loop2?this._loop:(this._loop=!!_loop2,this)}},{key:"mute",value:function(_mute2){return null==_mute2?this._mute:(this._mute=!!_mute2,null!==this.current&&this.current.track.mute(this._mute),this)}},{key:"rate",value:function(_rate2){if(null==_rate2)return this._rate;if("number"!=typeof _rate2)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate2,.2,5),null!==this.current&&this.current.track.rate(this._rate*this.current.rate),this}},{key:"shuffle",value:function(_shuffle){var _this11=this;if(null==_shuffle)return this._shuffle;if(this._shuffle=!!_shuffle,this.queue.length>0&&(this._fillQueue(),!this._shuffle&&null!==this.current&&this.queue.length>1)){var _this$queue,firstIdx=this.queue.findIndex((function(trackObj){return trackObj===_this11.current}));if(-1!==firstIdx)(_this$queue=this.queue).push.apply(_this$queue,_toConsumableArray(this.queue.splice(0,firstIdx+1)))}return this}},{key:"volume",value:function(_volume2){if(null==_volume2)return this._volume;if("number"!=typeof _volume2)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume2,0,1),null!==this.current&&this.current.track.volume(this._volume*this.current.volume),this}},{key:"duration",value:function(){if(arguments.length>0)throw new Error("duration takes no parameters");return this.tracks.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0)}},{key:"remaining",value:function(){if(arguments.length>0)throw new Error("remaining takes no parameters");var remainingTime=this.queue.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0);return null!==this.current&&(remainingTime+=this.current.track.remaining()),remainingTime}},{key:"time",value:function(){if(arguments.length>0)throw new Error("time takes no parameters");return this.duration()-this.remaining()}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isStopped",value:function(){return 0===this.queue.length&&null===this.current}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isFading",value:function(){return null!==this.current&&this.current.track.isFading()}},{key:"_next",value:function(){var nextTrack;for(null!==this.current&&(this.current.track.stop(),this.current=null);nextTrack=this.queue.shift();)if(!nextTrack.track.isUnavailable()){this.current=nextTrack;break}return null!==this.current&&(this.current.track.mute(this._mute),this.current.track.rate(this._rate*this.current.rate),this.current.track.volume(this._volume*this.current.volume),this.current.track.loop(!1),!0)}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._fillQueue()}this._next()&&this.current.track.play()}},{key:"_drainQueue",value:function(){this.queue.splice(0)}},{key:"_fillQueue",value:function(){var _this$queue2;this._drainQueue(),(_this$queue2=this.queue).push.apply(_this$queue2,_toConsumableArray(this.tracks.filter((function(trackObj){return!trackObj.track.isUnavailable()})))),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}}]),AudioList}(),AudioRunner=function(){function AudioRunner(list){if(_classCallCheck(this,AudioRunner),!(list instanceof Set||list instanceof AudioRunner))throw new TypeError("list parameter must be a Set or a AudioRunner instance");Object.defineProperties(this,{trackIds:{value:new Set(list instanceof AudioRunner?list.trackIds:list)}})}return _createClass(AudioRunner,[{key:"load",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.load)}},{key:"unload",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.unload)}},{key:"play",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.play)}},{key:"playWhenAllowed",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.playWhenAllowed)}},{key:"pause",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.pause)}},{key:"stop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.stop)}},{key:"fade",value:function(duration,toVol,fromVol){if(null==duration||null==toVol)throw new Error("fade requires parameters");AudioRunner._run(this.trackIds,AudioTrack.prototype.fade,duration,toVol,fromVol)}},{key:"fadeIn",value:function(duration,fromVol){if(null==duration)throw new Error("fadeIn requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeIn,duration,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){if(null==duration)throw new Error("fadeOut requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeOut,duration,fromVol)}},{key:"fadeStop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeStop)}},{key:"loop",value:function(_loop3){if(null==_loop3)throw new Error("loop requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.loop,_loop3),this}},{key:"mute",value:function(_mute3){if(null==_mute3)throw new Error("mute requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.mute,_mute3),this}},{key:"rate",value:function(_rate3){if(null==_rate3)throw new Error("rate requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.rate,_rate3),this}},{key:"time",value:function(_time2){if(null==_time2)throw new Error("time requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.time,_time2),this}},{key:"volume",value:function(_volume3){if(null==_volume3)throw new Error("volume requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.volume,_volume3),this}},{key:"on",value:function(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.on].concat(args)),this}},{key:"one",value:function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.one].concat(args)),this}},{key:"off",value:function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.off].concat(args)),this}}],[{key:"_run",value:function(ids,fn){for(var _len11=arguments.length,args=new Array(_len11>2?_len11-2:0),_key11=2;_key11<_len11;_key11++)args[_key11-2]=arguments[_key11];ids.forEach((function(id){var track=_tracks.get(id);track&&fn.apply(track,args)}))}}]),AudioRunner}();var _runnerParseSelector=function(){var notWsRe=/\S/g,parenRe=/[()]/g;function processNegation(str,startPos){var match;if(notWsRe.lastIndex=startPos,null===(match=notWsRe.exec(str))||"("!==match[0])throw new Error('invalid ":not()" syntax: missing parentheticals');parenRe.lastIndex=notWsRe.lastIndex;for(var start=notWsRe.lastIndex,result={str:"",nextMatch:-1},depth=1;null!==(match=parenRe.exec(str));)if("("===match[0]?++depth:--depth,depth<1){result.nextMatch=parenRe.lastIndex,result.str=str.slice(start,result.nextMatch-1);break}return result}return function parseSelector(idArg){for(var match,ids=[],idRe=/:?[^\s:()]+/g;null!==(match=idRe.exec(idArg));){var id=match[0];if(":not"===id){if(0===ids.length)throw new Error('invalid negation: no group ID preceded ":not()"');var parent=ids[ids.length-1];if(":"!==parent.id[0])throw new Error('invalid negation of track "'.concat(parent.id,'": only groups may be negated with ":not()"'));var negation=processNegation(idArg,idRe.lastIndex);if(-1===negation.nextMatch)throw new Error('unknown error parsing ":not()"');idRe.lastIndex=negation.nextMatch,parent.not=parseSelector(negation.str)}else ids.push({id:id})}return ids}}();function masterMute(mute){if(null==mute)return _masterMute;publish("mute",_masterMute=!!mute)}function unsubscribe(id){_subscribers.delete(id)}function publish(mesg,data){_subscribers.forEach((function(fn){return fn(mesg,data)}))}function _newTrack(sources){return new AudioTrack(sources.map((function(source){if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);if(passage.tags.includes("Twine.audio"))return passage.text.trim()}var match=_formatSpecRe.exec(source);return null===match?source:{format:match[1],src:match[2]}})))}return Object.freeze(Object.defineProperties({},{tracks:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("track ID"),arguments.length<2&&errors.push("sources"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='track ID "'.concat(id,'"');if(_badIdRe.test(id))throw new Error("invalid ".concat(what,": track IDs must not contain colons or whitespace"));var track,sources=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{track=_newTrack(sources)}catch(ex){throw new Error("".concat(what,": error during track initialization: ").concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("".concat(what,": no supported audio sources found"));_tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.set(id,track)}},delete:{value:function(id){return _tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.delete(id)}},clear:{value:function(){_tracks.forEach((function(track){return track._destroy()})),_tracks.clear()}},has:{value:function(id){return _tracks.has(id)}},get:{value:function(id){return _tracks.get(id)||null}}}))},groups:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("group ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='group ID "'.concat(id,'"');if(":"!==id[0]||_badIdRe.test(id.slice(1)))throw new Error("invalid ".concat(what,": group IDs must start with a colon and must not contain colons or whitespace"));if(_specialIds.includes(id))throw new Error("cannot clobber special ".concat(what));var group,trackIds=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{group=new Set(trackIds.map((function(trackId){if(!_tracks.has(trackId))throw new Error('track "'.concat(trackId,'" does not exist'));return trackId})))}catch(ex){throw new Error("".concat(what,": error during group initialization: ").concat(ex.message))}_groups.set(id,Object.freeze(Array.from(group)))}},delete:{value:function(id){return _groups.delete(id)}},clear:{value:function(){_groups.clear()}},has:{value:function(id){return _groups.has(id)}},get:{value:function(id){return _groups.get(id)||null}}}))},lists:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("list ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='list ID "'.concat(id,'"');if(_badIdRe.test(id))return this.error("invalid ".concat(what,": list IDs must not contain colons or whitespace"));var list,descriptors=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{list=new AudioList(descriptors.map((function(desc){if(null===desc)throw new Error("track descriptor must be a string or object (type: null)");switch(_typeof(desc)){case"string":desc={id:desc};break;case"object":if(!desc.hasOwnProperty("id")&&!desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain one of either an "id" or a "sources" property');if(desc.hasOwnProperty("id")&&desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain either an "id" or a "sources" property, not both');break;default:throw new Error("track descriptor must be a string or object (type: ".concat(_typeof(desc),")"))}var own,track,volume;if(desc.hasOwnProperty("id")){if("string"!=typeof desc.id)throw new Error('"id" property must be a string');if(!_tracks.has(desc.id))throw new Error('track "'.concat(desc.id,'" does not exist'));track=_tracks.get(desc.id)}else if(desc.hasOwnProperty("sources")){if(!Array.isArray(desc.sources)||0===desc.sources.length)throw new Error('"sources" property must be a non-empty array');if(desc.hasOwnProperty("own"))throw new Error('"own" property is not allowed with the "sources" property');try{track=_newTrack(desc.sources),own=!0}catch(ex){throw new Error("error during track initialization: ".concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("no supported audio sources found")}if(desc.hasOwnProperty("own")){if("boolean"!=typeof desc.own)throw new Error('"own" property must be a boolean');(own=desc.own)&&(track=track.clone())}if(desc.hasOwnProperty("volume")){if("number"!=typeof desc.volume||Number.isNaN(desc.volume)||!Number.isFinite(desc.volume)||desc.volume<0)throw new Error('"volume" property must be a non-negative finite number');volume=desc.volume}return{own:null!=own&&own,track:track,volume:null!=volume?volume:track.volume()}})))}catch(ex){throw new Error("".concat(what,": error during playlist initialization: ").concat(ex.message))}_lists.has(id)&&_lists.get(id)._destroy(),_lists.set(id,list)}},delete:{value:function(id){return _lists.has(id)&&_lists.get(id)._destroy(),_lists.delete(id)}},clear:{value:function(){_lists.forEach((function(list){return list._destroy()})),_lists.clear()}},has:{value:function(id){return _lists.has(id)}},get:{value:function(id){return _lists.get(id)||null}}}))},select:{value:function(){if(0===arguments.length)throw new Error("no track selector specified");var selector=String(arguments[0]).trim(),trackIds=new Set;try{var renderIds=function renderIds(idObj){var ids,id=idObj.id;switch(id){case":all":ids=allIds;break;case":looped":ids=allIds.filter((function(id){return _tracks.get(id).loop()}));break;case":muted":ids=allIds.filter((function(id){return _tracks.get(id).mute()}));break;case":paused":ids=allIds.filter((function(id){return _tracks.get(id).isPaused()}));break;case":playing":ids=allIds.filter((function(id){return _tracks.get(id).isPlaying()}));break;default:ids=":"===id[0]?_groups.get(id):[id]}if(idObj.hasOwnProperty("not")){var negated=idObj.not.map((function(idObj){return renderIds(idObj)})).flat(1/0);ids=ids.filter((function(id){return!negated.includes(id)}))}return ids},allIds=Array.from(_tracks.keys());_runnerParseSelector(selector).forEach((function(idObj){return renderIds(idObj).forEach((function(id){if(!_tracks.has(id))throw new Error('track "'.concat(id,'" does not exist'));trackIds.add(id)}))}))}catch(ex){throw new Error("error during runner initialization: ".concat(ex.message))}return new AudioRunner(trackIds)}},load:{value:function(){publish("load")}},loadWithScreen:{value:function(){publish("loadwithscreen")}},mute:{value:masterMute},muteOnHidden:{value:function(mute){if(!Visibility.isEnabled())return!1;if(null==mute)return _masterMuteOnHidden;var namespace=".SimpleAudio_masterMuteOnHidden";if(_masterMuteOnHidden=!!mute){var visibilityChange="".concat(Visibility.changeEvent).concat(namespace);jQuery(document).off(namespace).on(visibilityChange,(function(){return masterMute(Visibility.isHidden())})),Visibility.isHidden()&&masterMute(!0)}else jQuery(document).off(namespace)}},rate:{value:function(rate){if(null==rate)return _masterRate;if("number"!=typeof rate||Number.isNaN(rate)||!Number.isFinite(rate))throw new Error("rate must be a finite number");publish("rate",_masterRate=Math.clamp(rate,.2,5))}},stop:{value:function(){publish("stop")}},unload:{value:function(){publish("unload")}},volume:{value:function(volume){if(null==volume)return _masterVolume;if("number"!=typeof volume||Number.isNaN(volume)||!Number.isFinite(volume))throw new Error("volume must be a finite number");publish("volume",_masterVolume=Math.clamp(volume,0,1))}}}))}(),State=function(){var _history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null,_tempVariables={};function stateMarshal(noDelta){var stateObj={index:_activeIndex};return noDelta?stateObj.history=clone(_history):stateObj.delta=historyDeltaEncode(_history),_expired.length>0&&(stateObj.expired=_toConsumableArray(_expired)),null!==_prng&&(stateObj.seed=_prng.seed),stateObj}function stateUnmarshal(stateObj,noDelta){if(null==stateObj)throw new Error("state object is null or undefined");if(!stateObj.hasOwnProperty(noDelta?"history":"delta")||0===stateObj[noDelta?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!stateObj.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==_prng&&!stateObj.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===_prng&&stateObj.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");_history=noDelta?clone(stateObj.history):historyDeltaDecode(stateObj.delta),_activeIndex=stateObj.index,_expired=stateObj.hasOwnProperty("expired")?_toConsumableArray(stateObj.expired):[],stateObj.hasOwnProperty("seed")&&(_prng.seed=stateObj.seed),momentActivate(_activeIndex)}function momentCreate(title,variables){return{title:null==title?"":String(title),variables:null==variables?{}:clone(variables)}}function momentActivate(moment){if(null==moment)throw new Error("moment activation attempted with null or undefined");switch(_typeof(moment)){case"object":_active=clone(moment);break;case"number":if(historyIsEmpty())throw new Error("moment activation attempted with index on empty history");if(moment<0||moment>=historySize())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, ".concat(historySize()-1,"], got ").concat(moment));_active=clone(_history[moment]);break;default:throw new TypeError('moment activation attempted with a "'.concat(_typeof(moment),'"; must be an object or valid history stack index'))}return null!==_prng&&(_prng=PRNGWrapper.unmarshal({seed:_prng.seed,pull:_active.pull})),session.set("state",stateMarshal()),jQuery.event.trigger(":historyupdate"),_active}function historyLength(){return _activeIndex+1}function historySize(){return _history.length}function historyIsEmpty(){return 0===_history.length}function historyTop(){return _history.length>0?_history[_history.length-1]:null}function historyGoTo(index){return!(null==index||index<0||index>=historySize()||index===_activeIndex)&&(momentActivate(_activeIndex=index),!0)}function historyDeltaEncode(historyArr){if(!Array.isArray(historyArr))return null;if(0===historyArr.length)return[];for(var delta=[historyArr[0]],i=1,iend=historyArr.length;i<iend;++i)delta.push(Diff.diff(historyArr[i-1],historyArr[i]));return delta}function historyDeltaDecode(delta){if(!Array.isArray(delta))return null;if(0===delta.length)return[];for(var historyArr=[clone(delta[0])],i=1,iend=delta.length;i<iend;++i)historyArr.push(Diff.patch(historyArr[i-1],delta[i]));return historyArr}function prngInit(seed,useEntropy){var scriptSection;if(!historyIsEmpty())throw scriptSection="the Story JavaScript",new Error("State.prng.init must be called during initialization, within either ".concat(scriptSection," or the StoryInit special passage"));_prng=new PRNGWrapper(seed,useEntropy),_active.pull=_prng.pull}function metadataDelete(key){if("string"!=typeof key)throw new TypeError("State.metadata.delete key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");store&&store.hasOwnProperty(key)&&(1===Object.keys(store).length?storage.delete("metadata"):(delete store[key],storage.set("metadata",store)))}return Object.freeze(Object.defineProperties({},{reset:{value:function(){session.delete("state"),_history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null===_prng?null:new PRNGWrapper(_prng.seed,!1)}},restore:{value:function(){if(session.has("state")){var stateObj=session.get("state");return null!=stateObj&&(stateUnmarshal(stateObj),!0)}return!1}},marshalForSave:{value:function(){return stateMarshal(!0)}},unmarshalForSave:{value:function(stateObj){return stateUnmarshal(stateObj,!0)}},expired:{get:function(){return _expired}},turns:{get:function(){return _expired.length+historyLength()}},passages:{get:function(){return _expired.concat(_history.slice(0,historyLength()).map((function(moment){return moment.title})))}},hasPlayed:{value:function(title){return null!=title&&""!==title&&(!!_expired.includes(title)||!!_history.slice(0,historyLength()).some((function(moment){return moment.title===title})))}},active:{get:function(){return _active}},activeIndex:{get:function(){return _activeIndex}},passage:{get:function(){return _active.title}},variables:{get:function(){return _active.variables}},history:{get:function(){return _history}},length:{get:historyLength},size:{get:historySize},isEmpty:{value:historyIsEmpty},current:{get:function(){return _history.length>0?_history[_activeIndex]:null}},top:{get:historyTop},bottom:{get:function(){return _history.length>0?_history[0]:null}},index:{value:function(index){return historyIsEmpty()||index<0||index>_activeIndex?null:_history[index]}},peek:{value:function(offset){if(historyIsEmpty())return null;var lengthOffset=1+(offset?Math.abs(offset):0);return lengthOffset>historyLength()?null:_history[historyLength()-lengthOffset]}},has:{value:function(title){if(historyIsEmpty()||null==title||""===title)return!1;for(var i=_activeIndex;i>=0;--i)if(_history[i].title===title)return!0;return!1}},create:{value:function(title){for(0,historyLength()<historySize()&&_history.splice(historyLength(),historySize()-historyLength()),_history.push(momentCreate(title,_active.variables)),_prng&&(historyTop().pull=_prng.pull);historySize()>Config.history.maxStates;)_expired.push(_history.shift().title);return momentActivate(_activeIndex=historySize()-1),historyLength()}},goTo:{value:historyGoTo},go:{value:function(offset){return null!=offset&&0!==offset&&historyGoTo(_activeIndex+offset)}},deltaEncode:{value:historyDeltaEncode},deltaDecode:{value:historyDeltaDecode},prng:{value:Object.freeze(Object.defineProperties({},{init:{value:prngInit},isEnabled:{value:function(){return null!==_prng}},pull:{get:function(){return _prng?_prng.pull:NaN}},seed:{get:function(){return _prng?_prng.seed:null}}}))},random:{value:function(){return _prng?_prng.random():Math.random()}},clearTemporary:{value:function(){TempVariables=_tempVariables={}}},temporary:{get:function(){return _tempVariables}},getVar:{value:function(varExpression){try{return Scripting.evalTwineScript(varExpression)}catch(ex){}}},setVar:{value:function(varExpression,value){try{return Scripting.evalTwineScript("".concat(varExpression," = evalTwineScript$Data$"),null,value),!0}catch(ex){}return!1}},metadata:{value:Object.freeze(Object.defineProperties({},{clear:{value:function(){storage.delete("metadata")}},delete:{value:metadataDelete},entries:{value:function(){var store=storage.get("metadata");return store&&Object.entries(store)}},get:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.get key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)?store[key]:undefined}},has:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.has key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)}},keys:{value:function(){var store=storage.get("metadata");return store&&Object.keys(store)}},set:{value:function(key,value){if("string"!=typeof key)throw new TypeError("State.metadata.set key parameter must be a string (received: ".concat(_typeof(key),")"));if(void 0===value)metadataDelete(key);else{var store=storage.get("metadata")||{};store[key]=value,storage.set("metadata",store)}}},size:{get:function(){var store=storage.get("metadata");return store?Object.keys(store).length:0}}}))},initPRNG:{value:prngInit},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(targets,selector,handler,one,namespace){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var fn,opts;if("function"==typeof selector?(fn=selector,opts={namespace:one,one:!!handler}):(fn=handler,opts={namespace:namespace,one:!!one,selector:selector}),"function"!=typeof fn)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(targets).ariaClick(opts,fn)}function insertElement(place,type,id,classNames,text,title){var $el=jQuery(document.createElement(type));return id&&$el.attr("id",id),classNames&&$el.addClass(classNames),title&&$el.attr("title",title),text&&$el.text(text),place&&$el.appendTo(place),$el[0]}function insertText(place,text){jQuery(place).append(document.createTextNode(text))}function removeChildren(node){jQuery(node).empty()}function removeElement(node){jQuery(node).remove()}function fade(el,options){var current,intervalId,direction="in"===options.fade?1:-1,proxy=el.cloneNode(!0);function setOpacity(el,opacity){el.style.zoom=1,el.style.filter="alpha(opacity=".concat(Math.floor(100*opacity),")"),el.style.opacity=opacity}el.parentNode.replaceChild(proxy,el),"in"===options.fade?(current=0,proxy.style.visibility="visible"):current=1,setOpacity(proxy,current),intervalId=window.setInterval((function(){current+=.05*direction,setOpacity(proxy,Math.easeInOut(current)),(1===direction&&current>=1||-1===direction&&current<=0)&&(el.style.visibility="in"===options.fade?"visible":"hidden",proxy.parentNode.replaceChild(el,proxy),proxy=null,window.clearInterval(intervalId),options.onComplete&&options.onComplete())}),25)}function scrollWindowTo(el,incrementBy){var increment=null!=incrementBy?Number(incrementBy):.1;Number.isNaN(increment)||!Number.isFinite(increment)||increment<0?increment=.1:increment>1&&(increment=1);var intervalId,start=window.scrollY?window.scrollY:document.body.scrollTop,end=function(el){var posTop=function(el){var curtop=0;for(;el.offsetParent;)curtop+=el.offsetTop,el=el.offsetParent;return curtop}(el),posBottom=posTop+el.offsetHeight,winTop=window.scrollY?window.scrollY:document.body.scrollTop,winHeight=window.innerHeight?window.innerHeight:document.body.clientHeight,winBottom=winTop+winHeight;return posTop>=winTop&&posBottom>winBottom&&el.offsetHeight<winHeight?posTop-(winHeight-el.offsetHeight)+20:posTop}(el),distance=Math.abs(start-end),direction=start>end?-1:1,progress=0;intervalId=window.setInterval((function(){progress+=increment,window.scroll(0,start+direction*(distance*Math.easeInOut(progress))),progress>=1&&window.clearInterval(intervalId)}),25)}function toStringOrDefault(value){return stringFrom(value)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function forget(key){if("string"!=typeof key)throw new TypeError("forget key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.delete(key)}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,i=0,iend=needles.length;i<iend;++i)if(!played.includes(needles[i]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,uBound=played.length-1,turns=State.turns,i=0,iend=needles.length;i<iend&&turns>-1;++i){var lastIndex=played.lastIndexOf(needles[i]);turns=Math.min(turns,-1===lastIndex?-1:uBound-lastIndex)}return turns}function memorize(key,value){if("string"!=typeof key)throw new TypeError("memorize key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.set(key,value)}function passage(){return State.passage}function previous(){var passages=State.passages;if(arguments.length>0){var offset=Number(arguments[0]);if(!Number.isSafeInteger(offset)||offset<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return passages.length>offset?passages[passages.length-1-offset]:""}for(var i=passages.length-2;i>=0;--i)if(passages[i]!==State.passage)return passages[i];return""}function random(){var min,max;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:min=0,max=Math.trunc(arguments[0]);break;default:min=Math.trunc(arguments[0]),max=Math.trunc(arguments[1])}if(!Number.isInteger(min))throw new Error("random min parameter must be an integer");if(!Number.isInteger(max))throw new Error("random max parameter must be an integer");if(min>max){var _ref6=[max,min];min=_ref6[0],max=_ref6[1]}return Math.floor(State.random()*(max-min+1))+min}function randomFloat(){var min,max;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:min=0,max=Number(arguments[0]);break;default:min=Number(arguments[0]),max=Number(arguments[1])}if(Number.isNaN(min)||!Number.isFinite(min))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(max)||!Number.isFinite(max))throw new Error("randomFloat max parameter must be a number");if(min>max){var _ref7=[max,min];min=_ref7[0],max=_ref7[1]}return State.random()*(max-min)+min}function recall(key,defaultValue){if("string"!=typeof key)throw new TypeError("recall key parameter must be a string (received: ".concat(Util.getType(key),")"));return State.metadata.has(key)?State.metadata.get(key):defaultValue}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var passages=Array.prototype.concat.apply([],arguments),tags=[],i=0,iend=passages.length;i<iend;++i)tags=tags.concat(Story.get(passages[i]).tags);return tags}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),played=State.passages,count=State.turns,i=0,iend=needles.length;i<iend&&count>0;++i)count=Math.min(count,played.count(needles[i]));return count}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],arguments),nLength=needles.length,played=State.passages,seen=new Map,count=0,i=0,iend=played.length;i<iend;++i){var title=played[i];if(seen.has(title))seen.get(title)&&++count;else{var _tags2=Story.get(title).tags;if(_tags2.length>0){for(var found=0,j=0;j<nLength;++j)_tags2.includes(needles[j])&&++found;found===nLength?(++count,seen.set(title,!0)):seen.set(title,!1)}}}return count}var _ref8=function(){function slugifyUrl(url){return Util.parseUrl(url).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function addScript(url){return new Promise((function(resolve,reject){jQuery(document.createElement("script")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importScripts failed to load the script "'.concat(url,'".')))})).appendTo(document.head).attr({id:"script-imported-".concat(slugifyUrl(url)),type:"text/javascript",src:url})}))}function addStyle(url){return new Promise((function(resolve,reject){jQuery(document.createElement("link")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importStyles failed to load the stylesheet "'.concat(url,'".')))})).appendTo(document.head).attr({id:"style-imported-".concat(slugifyUrl(url)),rel:"stylesheet",href:url})}))}function sequence(callbacks){return callbacks.reduce((function(seq,fn){return seq.then(fn)}),Promise.resolve())}return{importScripts:function(){for(var _len12=arguments.length,urls=new Array(_len12),_key12=0;_key12<_len12;_key12++)urls[_key12]=arguments[_key12];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addScript(url)}}))):addScript(oneOrSeries)})))},importStyles:function(){for(var _len13=arguments.length,urls=new Array(_len13),_key13=0;_key13<_len13;_key13++)urls[_key13]=arguments[_key13];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addStyle(url)}}))):addStyle(oneOrSeries)})))}}}(),importScripts=_ref8.importScripts,importStyles=_ref8.importStyles,parse=function(){var tokenTable=Util.toEnum({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),parseRe=new RegExp(["(?:\"\"|''|``)",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(`(?:\\\\.|[^`\\\\])+`)","(?:[=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),notSpaceRe=/\S/,varTest=new RegExp("^".concat(Patterns.variable)),withColonTestRe=/^\s*:/,withNotTestRe=/^\s+not\b/;function parse(rawCodeString){if(0!==parseRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var match,code=rawCodeString;null!==(match=parseRe.exec(code));)if(match[1]){var rawTemplate=match[1],parsedTemplate=parseTemplate(rawTemplate);parsedTemplate!==rawTemplate&&(code=code.splice(match.index,rawTemplate.length,parsedTemplate),parseRe.lastIndex+=parsedTemplate.length-rawTemplate.length)}else if(match[2]){var token=match[2];if("$"===token||"_"===token)continue;if(varTest.test(token))token=token[0];else if("is"===token){var start=parseRe.lastIndex,ahead=code.slice(start);withNotTestRe.test(ahead)&&(code=code.splice(start,ahead.search(notSpaceRe)),token="isnot")}else{var _ahead=code.slice(parseRe.lastIndex);if(withColonTestRe.test(_ahead))continue}tokenTable[token]&&(code=code.splice(match.index,token.length,tokenTable[token]),parseRe.lastIndex+=tokenTable[token].length-token.length)}return code}var templateGroupStartRe=/\$\{/g,templateGroupParseRe=new RegExp(["(?:\"\"|'')",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(\\{)","(\\})"].join("|"),"g");function parseTemplate(rawTemplateLiteral){if(0!==templateGroupStartRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start of template literal");for(var startMatch,template=rawTemplateLiteral;null!==(startMatch=templateGroupStartRe.exec(template));){var startIdx=startMatch.index+2,endIdx=startIdx,depth=1,endMatch=void 0;for(templateGroupParseRe.lastIndex=startIdx;null!==(endMatch=templateGroupParseRe.exec(template));)if(endMatch[1]?++depth:endMatch[2]&&--depth,0===depth){endIdx=endMatch.index;break}if(endIdx>startIdx){var parseIndex=parseRe.lastIndex,rawGroup=template.slice(startIdx,endIdx);parseRe.lastIndex=0;var parsedGroup=parse(rawGroup);parseRe.lastIndex=parseIndex,template=template.splice(startIdx,rawGroup.length,parsedGroup),templateGroupStartRe.lastIndex+=parsedGroup.length-rawGroup.length}}return template}return parse}();function evalJavaScript(code,output,data){return function(code,output,evalJavaScript$Data$){return eval(code)}.call(output?{output:output}:null,String(code),output,data)}function evalTwineScript(code,output,data){return function(code,output,evalTwineScript$Data$){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output,data)}return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),_ref9=function(){var Lexer=function(){function Lexer(source,initialState){if(_classCallCheck(this,Lexer),arguments.length<2)throw new Error("Lexer constructor called with too few parameters (source:string , initialState:function)");Object.defineProperties(this,{source:{value:source},initial:{value:initialState},state:{writable:!0,value:initialState},start:{writable:!0,value:0},pos:{writable:!0,value:0},depth:{writable:!0,value:0},items:{writable:!0,value:[]},data:{writable:!0,value:{}}})}return _createClass(Lexer,[{key:"reset",value:function(){this.state=this.initial,this.start=0,this.pos=0,this.depth=0,this.items=[],this.data={}}},{key:"run",value:function(){for(;null!==this.state;)this.state=this.state(this);return this.items}},{key:"nextItem",value:function(){for(;0===this.items.length&&null!==this.state;)this.state=this.state(this);return this.items.shift()}},{key:"next",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos++]}},{key:"peek",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos]}},{key:"backup",value:function(num){this.pos-=num||1}},{key:"forward",value:function(num){this.pos+=num||1}},{key:"ignore",value:function(){this.start=this.pos}},{key:"accept",value:function(valid){var ch=this.next();return-1!==ch&&(!!valid.includes(ch)||(this.backup(),!1))}},{key:"acceptRe",value:function(validRe){var ch=this.next();return-1!==ch&&(!!validRe.test(ch)||(this.backup(),!1))}},{key:"acceptRun",value:function(valid){for(;;){var ch=this.next();if(-1===ch)return;if(!valid.includes(ch))break}this.backup()}},{key:"acceptRunRe",value:function(validRe){for(;;){var ch=this.next();if(-1===ch)return;if(!validRe.test(ch))break}this.backup()}},{key:"emit",value:function(type){this.items.push({type:type,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),this.start=this.pos}},{key:"error",value:function(type,message){if(arguments.length<2)throw new Error("Lexer.prototype.error called with too few parameters (type:number , message:string)");return this.items.push({type:type,message:message,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),null}}],[{key:"enumFromNames",value:function(names){var obj=names.reduce((function(obj,name,i){return obj[name]=i,obj}),{});return Object.freeze(Object.assign(Object.create(null),obj))}}]),Lexer}();return{EOF:-1,Lexer:Lexer}}(),EOF=_ref9.EOF,Lexer=_ref9.Lexer,Wikifier=function(){var _optionsStack,lookaheadRe,idOrClassRe,_callDepth=0,Wikifier=function(){function Wikifier(destination,source,options){_classCallCheck(this,Wikifier),Wikifier.Parser.Profile.isEmpty()&&Wikifier.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(source)},options:{writable:!0,value:Object.assign({profile:"all"},options)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==destination?this.output=document.createDocumentFragment():destination.jquery?this.output=destination[0]:this.output=destination;try{++_callDepth,this.subWikify(this.output),1===_callDepth&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--_callDepth}}return _createClass(Wikifier,[{key:"subWikify",value:function(output,terminator,options){var newOptions,oldOptions,oldOutput=this.output;this.output=output,Wikifier.Option.length>0&&(newOptions=Object.assign(newOptions||{},Wikifier.Option.options)),null!==options&&"object"===_typeof(options)&&(newOptions=Object.assign(newOptions||{},options)),newOptions&&(oldOptions=this.options,this.options=Object.assign({},this.options,newOptions));var terminatorMatch,parserMatch,parsersProfile=Wikifier.Parser.Profile.get(this.options.profile),terminatorRegExp=terminator?new RegExp("(?:".concat(terminator,")"),this.options.ignoreTerminatorCase?"gim":"gm"):null;do{if(parsersProfile.parserRegExp.lastIndex=this.nextMatch,terminatorRegExp&&(terminatorRegExp.lastIndex=this.nextMatch),parserMatch=parsersProfile.parserRegExp.exec(this.source),(terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null)&&(!parserMatch||terminatorMatch.index<=parserMatch.index))return terminatorMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,terminatorMatch.index),this.matchStart=terminatorMatch.index,this.matchLength=terminatorMatch[0].length,this.matchText=terminatorMatch[0],this.nextMatch=terminatorRegExp.lastIndex,this.output=oldOutput,void(oldOptions&&(this.options=oldOptions));if(parserMatch){parserMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,parserMatch.index),this.matchStart=parserMatch.index,this.matchLength=parserMatch[0].length,this.matchText=parserMatch[0],this.nextMatch=parsersProfile.parserRegExp.lastIndex;for(var matchingParser=void 0,i=1,iend=parserMatch.length;i<iend;++i)if(parserMatch[i]){matchingParser=i-1;break}if(parsersProfile.parsers[matchingParser].handler(this),null!=TempState.break)break}}while(terminatorMatch||parserMatch);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=oldOutput,oldOptions&&(this.options=oldOptions)}},{key:"outputText",value:function(destination,startPos,endPos){jQuery(destination).append(document.createTextNode(this.source.substring(startPos,endPos)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(text){var output=document.createDocumentFragment();new Wikifier(output,text);var errors=output.querySelector(".error");if(null!==errors)throw new Error(errors.textContent.replace(errorPrologRegExp,""));return output}},{key:"createInternalLink",value:function(destination,passage,text,callback){var $link=jQuery(document.createElement("a"));return null!=passage&&($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken"),$link.ariaClick({one:!0},(function(){"function"==typeof callback&&callback(),Engine.play(passage)}))),text&&$link.append(document.createTextNode(text)),destination&&$link.appendTo(destination),$link[0]}},{key:"createExternalLink",value:function(destination,url,text){var $link=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(text).appendTo(destination);return null!=url&&$link.attr({href:url,tabindex:0}),$link[0]}},{key:"isExternalLink",value:function(link){return!Story.has(link)&&(new RegExp("^".concat(Patterns.url),"gim").test(link)||/[/.?#]/.test(link))}}]),Wikifier}();return Object.defineProperty(Wikifier,"Option",{value:(_optionsStack=[],Object.freeze(Object.defineProperties({},{length:{get:function(){return _optionsStack.length}},options:{get:function(){return Object.assign.apply(Object,[{}].concat(_toConsumableArray(_optionsStack)))}},clear:{value:function(){_optionsStack=[]}},get:{value:function(idx){return _optionsStack[idx]}},pop:{value:function(){return _optionsStack.pop()}},push:{value:function(options){if("object"!==_typeof(options)||null===options)throw new TypeError("Wikifier.Option.push options parameter must be an object (received: ".concat(Util.getType(options),")"));return _optionsStack.push(options)}}})))}),Object.defineProperty(Wikifier,"Parser",{value:function(){var _profiles,_parsers=[];function parsersHas(name){return!!_parsers.find((function(parser){return parser.name===name}))}return Object.freeze(Object.defineProperties({},{parsers:{get:function(){return _parsers}},add:{value:function(parser){if("object"!==_typeof(parser))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!parser.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof parser.name)throw new Error('parser object "name" property must be a string');if(!parser.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof parser.match)throw new Error('parser object "match" property must be a string');if(!parser.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof parser.handler)throw new Error('parser object "handler" property must be a function');if(parser.hasOwnProperty("profiles")&&!Array.isArray(parser.profiles))throw new Error('parser object "profiles" property must be an array');if(parsersHas(parser.name))throw new Error('cannot clobber existing parser "'.concat(parser.name,'"'));_parsers.push(parser)}},delete:{value:function(name){var parser=_parsers.find((function(parser){return parser.name===name}));parser&&_parsers.delete(parser)}},isEmpty:{value:function(){return 0===_parsers.length}},has:{value:parsersHas},get:{value:function(name){return _parsers.find((function(parser){return parser.name===name}))||null}},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:function(){return _profiles}},compile:{value:function(){var all=_parsers,core=all.filter((function(parser){return!Array.isArray(parser.profiles)||parser.profiles.includes("core")}));return _profiles=Object.freeze({all:{parsers:all,parserRegExp:new RegExp(all.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")},core:{parsers:core,parserRegExp:new RegExp(core.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")}})}},isEmpty:{value:function(){return"object"!==_typeof(_profiles)||0===Object.keys(_profiles).length}},has:{value:function(profile){return"object"===_typeof(_profiles)&&_profiles.hasOwnProperty(profile)}},get:{value:function(profile){if("object"!==_typeof(_profiles)||!_profiles.hasOwnProperty(profile))throw new Error('nonexistent parser profile "'.concat(profile,'"'));return _profiles[profile]}}}))}}))}()}),Object.defineProperties(Wikifier,{helpers:{value:{}},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(Wikifier.helpers,{inlineCss:{value:(lookaheadRe=new RegExp(Patterns.inlineCss,"gm"),idOrClassRe=new RegExp("(".concat(Patterns.cssIdOrClassSigil,")(").concat(Patterns.anyLetter,"+)"),"g"),function(w){var matched,css={classes:[],id:"",styles:{}};do{lookaheadRe.lastIndex=w.nextMatch;var match=lookaheadRe.exec(w.source);if(matched=match&&match.index===w.nextMatch){if(match[1])css.styles[Util.fromCssProperty(match[1])]=match[2].trim();else if(match[3])css.styles[Util.fromCssProperty(match[3])]=match[4].trim();else if(match[5]){var subMatch=void 0;for(idOrClassRe.lastIndex=0;null!==(subMatch=idOrClassRe.exec(match[5]));)"."===subMatch[1]?css.classes.push(subMatch[2]):css.id=subMatch[2]}w.nextMatch=lookaheadRe.lastIndex}}while(matched);return css})},evalText:{value:function(text){var result;try{switch(_typeof(result=Scripting.evalTwineScript(text))){case"string":""===result.trim()&&(result=text);break;case"number":result=String(result);break;default:result=text}}catch(ex){result=text}return result}},evalPassageId:{value:function(passage){return null==passage||Story.has(passage)?passage:Wikifier.helpers.evalText(passage)}},hasBlockContext:{value:function(nodes){for(var hasGCS="function"==typeof window.getComputedStyle,i=nodes.length-1;i>=0;--i){var node=nodes[i];switch(node.nodeType){case Node.ELEMENT_NODE:var tagName=node.nodeName.toUpperCase();if("BR"===tagName)return!0;var styles=hasGCS?window.getComputedStyle(node,null):node.currentStyle;if(styles&&styles.display){if("none"===styles.display)continue;return"block"===styles.display}switch(tagName){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:function(){var macroParser=null;function getMacroContextShadowView(){for(var macro=macroParser||function(){if(!macroParser&&!(macroParser=Wikifier.Parser.get("macro")))throw new Error('cannot find "macro" parser');return macroParser}(),view=new Set,context=macro.context;null!==context;context=context.parent)context._shadows&&context._shadows.forEach((function(name){return view.add(name)}));return _toConsumableArray(view)}return function(code){var shadowStore={};return getMacroContextShadowView().forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]})),function(){var shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null;try{return shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),Scripting.evalJavaScript(code)}finally{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}}()},parseSquareBracketedMarkup:{value:function(){var Item=Lexer.enumFromNames(["Error","DelimLTR","DelimRTL","InnerMeta","ImageMeta","LinkMeta","Link","RightMeta","Setter","Source","Text"]),Delim=Lexer.enumFromNames(["None","LTR","RTL"]);function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexLeftMeta(lexer){if(!lexer.accept("["))return lexer.error(Item.Error,"malformed square-bracketed markup");if(lexer.accept("["))lexer.data.isLink=!0,lexer.emit(Item.LinkMeta);else{if(lexer.accept("<>"),!(lexer.accept("Ii")&&lexer.accept("Mm")&&lexer.accept("Gg")&&lexer.accept("[")))return lexer.error(Item.Error,"malformed square-bracketed markup");lexer.data.isLink=!1,lexer.emit(Item.ImageMeta)}return lexer.depth=2,lexCoreComponents}function lexCoreComponents(lexer){for(var what=lexer.data.isLink?"link":"image",delim=Delim.None;;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup"));break;case"|":delim===Delim.None&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(),lexer.emit(Item.DelimLTR));break;case"-":delim===Delim.None&&">"===lexer.peek()&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(2),lexer.emit(Item.DelimLTR));break;case"<":delim===Delim.None&&"-"===lexer.peek()&&(delim=Delim.RTL,lexer.backup(),lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.DelimRTL));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.InnerMeta),lexer.data.isLink?lexSetter:lexImageLink;case"]":return--lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexImageLink(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup link component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.InnerMeta),lexSetter;case"]":return--lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexSetter(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup setter component"));break;case"'":if(slurpQuote(lexer,"'")===EOF)return lexer.error(Item.Error,"unterminated single quoted string in ".concat(what," markup setter component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)return"]"!==lexer.peek()?lexer.error(Item.Error,"malformed ".concat(what," markup")):(--lexer.depth,lexer.backup(),lexer.emit(Item.Setter),lexer.forward(2),lexer.emit(Item.RightMeta),null)}}return function(w){var lexer=new Lexer(w.source,lexLeftMeta);lexer.start=lexer.pos=w.matchStart;var markup={},items=lexer.run(),last=items.last();return last&&last.type===Item.Error?markup.error=last.message:items.forEach((function(item){var text=item.text.trim();switch(item.type){case Item.ImageMeta:markup.isImage=!0,"<"===text[1]?markup.align="left":">"===text[1]&&(markup.align="right");break;case Item.LinkMeta:markup.isLink=!0;break;case Item.Link:"~"===text[0]?(markup.forceInternal=!0,markup.link=text.slice(1)):markup.link=text;break;case Item.Setter:markup.setter=text;break;case Item.Source:markup.source=text;break;case Item.Text:markup.text=text}})),markup.pos=lexer.pos,markup}}()}}),Wikifier}();!function(){function _verbatimTagHandler(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("blockquote")).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,i,destStack=[w.output],curLevel=0,newLevel=w.matchLength;do{if(newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement("blockquote")).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();curLevel=newLevel,w.subWikify(destStack[destStack.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(destStack[destStack.length-1]),this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);(matched=match&&match.index===w.nextMatch)&&(newLevel=match[0].length,w.nextMatch+=match[0].length)}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?".concat(Patterns.macroName,")(?:\\s*)((?:(?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/)|(?://.*\\n)|(?:`(?:\\\\.|[^`\\\\])*`)|(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>"),"gm"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(w){var matchStart=this.lookahead.lastIndex=w.matchStart;if(this.parseTag(w)){var macro,nextMatch=w.nextMatch,name=this.working.name,rawArgs=this.working.arguments;try{if(!(macro=Macro.get(name))){if(Macro.tags.has(name)){var tags=Macro.tags.get(name);return throwError(w.output,"child tag <<".concat(name,">> was found outside of a call to its parent macro").concat(1===tags.length?"":"s"," <<").concat(tags.join(">>, <<"),">>"),w.source.slice(matchStart,w.nextMatch))}return throwError(w.output,"macro <<".concat(name,">> does not exist"),w.source.slice(matchStart,w.nextMatch))}var payload=null;if(void 0!==macro.tags&&!(payload=this.parseBody(w,macro)))return w.nextMatch=nextMatch,throwError(w.output,"cannot find a closing tag for macro <<".concat(name,">>"),"".concat(w.source.slice(matchStart,w.nextMatch),"…"));if("function"!=typeof macro.handler)return throwError(w.output,"macro <<".concat(name,">> handler function ").concat(void 0===macro.handler?"does not exist":"is not a function"),w.source.slice(matchStart,w.nextMatch));var args=payload?payload[0].args:this.createArgs(rawArgs,this.skipArgs(macro,macro.name));if(void 0!==macro._MACRO_API){this.context=new MacroContext({macro:macro,name:name,args:args,payload:payload,source:w.source.slice(matchStart,w.nextMatch),parent:this.context,parser:w});try{macro.handler.call(this.context)}finally{this.context=this.context.parent}}else{var prevRawArgs=w._rawArgs;w._rawArgs=rawArgs;try{macro.handler(w.output,name,args,w,payload)}finally{w._rawArgs=prevRawArgs}}}catch(ex){return throwError(w.output,"cannot execute ".concat(macro&&macro.isWidget?"widget":"macro"," <<").concat(name,">>: ").concat(ex.message),w.source.slice(matchStart,w.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else w.outputText(w.output,w.matchStart,w.nextMatch)},parseTag:function(w){var match=this.lookahead.exec(w.source);return!(!match||match.index!==w.matchStart||!match[1])&&(w.nextMatch=this.lookahead.lastIndex,this.working.source=w.source.slice(match.index,this.lookahead.lastIndex),this.working.name=match[1],this.working.arguments=match[2],this.working.index=match.index,!0)},parseBody:function(w,macro){for(var openTag=this.working.name,closeTag="/".concat(openTag),closeAlt="end".concat(openTag),bodyTags=!!Array.isArray(macro.tags)&&macro.tags,payload=[],end=-1,opened=1,curSource=this.working.source,curTag=this.working.name,curArgument=this.working.arguments,contentStart=w.nextMatch;-1!==(w.matchStart=w.source.indexOf(this.match,w.nextMatch));)if(this.parseTag(w)){var tagSource=this.working.source,tagName=this.working.name,tagArgs=this.working.arguments,tagBegin=this.working.index,tagEnd=w.nextMatch,hasArgs=""!==tagArgs.trim();switch(tagName){case openTag:++opened;break;case closeAlt:case closeTag:if(hasArgs)throw w.nextMatch=tagBegin+2+tagName.length,new Error('malformed closing tag: "'.concat(tagSource,'"'));--opened;break;default:if(hasArgs&&(tagName.startsWith("/")||tagName.startsWith("end"))){this.lookahead.lastIndex=w.nextMatch=tagBegin+2+tagName.length;continue}if(1===opened&&bodyTags)for(var i=0,iend=bodyTags.length;i<iend;++i)tagName===bodyTags[i]&&(payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),curSource=tagSource,curTag=tagName,curArgument=tagArgs,contentStart=tagEnd)}if(0===opened){payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),end=tagEnd;break}}else this.lookahead.lastIndex=w.nextMatch=w.matchStart+this.match.length;return-1!==end?(w.nextMatch=end,payload):null},createArgs:function(rawArgsString,skipArgs){var args=skipArgs?[]:this.parseArgs(rawArgsString);return Object.defineProperties(args,{raw:{value:rawArgsString},full:{value:Scripting.parse(rawArgsString)}}),args},skipArgs:function(macro,tagName){if(void 0!==macro.skipArgs){var sa=macro.skipArgs;return"boolean"==typeof sa&&sa||Array.isArray(sa)&&sa.includes(tagName)}return void 0!==macro.skipArg0&&(macro.skipArg0&&macro.name===tagName)},parseArgs:function(){var Item=Lexer.enumFromNames(["Error","Bareword","Expression","String","SquareBracket"]),spaceRe=new RegExp(Patterns.space),notSpaceRe=new RegExp(Patterns.notSpace),varTest=new RegExp("^".concat(Patterns.variable));function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexSpace(lexer){var offset=lexer.source.slice(lexer.pos).search(notSpaceRe);if(offset===EOF)return null;switch(0!==offset&&(lexer.pos+=offset,lexer.ignore()),lexer.next()){case"`":return lexExpression;case'"':return lexDoubleQuote;case"'":return lexSingleQuote;case"[":return lexSquareBracket;default:return lexBareword}}function lexExpression(lexer){return slurpQuote(lexer,"`")===EOF?lexer.error(Item.Error,"unterminated backquote expression"):(lexer.emit(Item.Expression),lexSpace)}function lexDoubleQuote(lexer){return slurpQuote(lexer,'"')===EOF?lexer.error(Item.Error,"unterminated double quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSingleQuote(lexer){return slurpQuote(lexer,"'")===EOF?lexer.error(Item.Error,"unterminated single quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSquareBracket(lexer){var what;if(lexer.accept("<>IiMmGg")?(what="image",lexer.acceptRun("<>IiMmGg")):what="link",!lexer.accept("["))return lexer.error(Item.Error,"malformed ".concat(what," markup"));lexer.depth=2;loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case"[":++lexer.depth;break;case"]":if(--lexer.depth,lexer.depth<0)return lexer.error(Item.Error,"unexpected right square bracket ']'");if(1===lexer.depth){if("]"===lexer.next()){--lexer.depth;break loop}lexer.backup()}}return lexer.emit(Item.SquareBracket),lexSpace}function lexBareword(lexer){var offset=lexer.source.slice(lexer.pos).search(spaceRe);return lexer.pos=offset===EOF?lexer.source.length:lexer.pos+offset,lexer.emit(Item.Bareword),offset===EOF?null:lexSpace}return function(rawArgsString){var lexer=new Lexer(rawArgsString,lexSpace),args=[];return lexer.run().forEach((function(item){var arg=item.text;switch(item.type){case Item.Error:throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(item.message));case Item.Bareword:if(varTest.test(arg))arg=State.getVar(arg);else if(/^(?:settings|setup)[.[]/.test(arg))try{arg=Scripting.evalTwineScript(arg)}catch(ex){throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(ex.message))}else if("null"===arg)arg=null;else if("undefined"===arg)arg=undefined;else if("true"===arg)arg=!0;else if("false"===arg)arg=!1;else if("NaN"===arg)arg=NaN;else{var argAsNum=Number(arg);Number.isNaN(argAsNum)||(arg=argAsNum)}break;case Item.Expression:if(""===(arg=arg.slice(1,-1).trim()))arg=undefined;else try{arg=Scripting.evalTwineScript("(".concat(arg,")"))}catch(ex){throw new Error('unable to parse macro argument expression "'.concat(arg,'": ').concat(ex.message))}break;case Item.String:try{arg=Scripting.evalJavaScript(arg)}catch(ex){throw new Error('unable to parse macro argument string "'.concat(arg,'": ').concat(ex.message))}break;case Item.SquareBracket:var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:arg,matchStart:0});if(markup.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(markup.error));if(markup.pos<arg.length)throw new Error('unable to parse macro argument "'.concat(arg,'": unexpected character(s) "').concat(arg.slice(markup.pos),'" (pos: ').concat(markup.pos,")"));markup.isLink?((arg={isLink:!0}).count=markup.hasOwnProperty("text")?2:1,arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):arg.link,arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null):markup.isImage&&(arg=function(source){var imgObj={source:source,isImage:!0};if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(imgObj.source=passage.text,imgObj.passage=passage.title)}return imgObj}(Wikifier.helpers.evalPassageId(markup.source)),markup.hasOwnProperty("align")&&(arg.align=markup.align),markup.hasOwnProperty("text")&&(arg.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("link")&&(arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link)),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null)}args.push(arg)})),args}}()}),Wikifier.Parser.add({name:"link",profiles:["core"],match:"\\[\\[[^[]",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{w.nextMatch=markup.pos;var link=Wikifier.helpers.evalPassageId(markup.link),text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):link,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,output=(Config.debug?new DebugView(w.output,"link-markup","[[link]]",w.source.slice(w.matchStart,w.nextMatch)):w).output;markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(output,link,text,setFn):Wikifier.createExternalLink(output,link,text)}}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(w){w.outputText(Wikifier.createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{var debugView;w.nextMatch=markup.pos,Config.debug&&(debugView=new DebugView(w.output,"image-markup",markup.hasOwnProperty("link")?"[img[][link]]":"[img[]]",w.source.slice(w.matchStart,w.nextMatch))).modes({block:!0});var source,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,el=(Config.debug?debugView:w).output;if(markup.hasOwnProperty("link")){var link=Wikifier.helpers.evalPassageId(markup.link);(el=markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(el,link,null,setFn):Wikifier.createExternalLink(el,link)).classList.add("link-image")}if(el=jQuery(document.createElement("img")).appendTo(el).get(0),"data:"!==(source=Wikifier.helpers.evalPassageId(markup.source)).slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(el.setAttribute("data-passage",passage.title),source=passage.text.trim())}el.src=source,markup.hasOwnProperty("text")&&(el.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("align")&&(el.align=markup.align)}}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){var pre=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(match[1]).appendTo(pre),pre.appendTo(w.output),w.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(w){switch(w.matchText){case"''":w.subWikify(jQuery(document.createElement("strong")).appendTo(w.output).get(0),"''");break;case"//":w.subWikify(jQuery(document.createElement("em")).appendTo(w.output).get(0),"//");break;case"__":w.subWikify(jQuery(document.createElement("u")).appendTo(w.output).get(0),"__");break;case"^^":w.subWikify(jQuery(document.createElement("sup")).appendTo(w.output).get(0),"\\^\\^");break;case"~~":w.subWikify(jQuery(document.createElement("sub")).appendTo(w.output).get(0),"~~");break;case"==":w.subWikify(jQuery(document.createElement("s")).appendTo(w.output).get(0),"==");break;case"{{{":var lookahead=/\{\{\{((?:.|\n)*?)\}\}\}/gm;lookahead.lastIndex=w.matchStart;var match=lookahead.exec(w.source);match&&match.index===w.matchStart&&(jQuery(document.createElement("code")).text(match[1]).appendTo(w.output),w.nextMatch=lookahead.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRe:/\s*\n/gm,handler:function(w){var css=Wikifier.helpers.inlineCss(w);this.blockRe.lastIndex=w.nextMatch;var blockMatch=this.blockRe.exec(w.source),blockLevel=blockMatch&&blockMatch.index===w.nextMatch,$el=jQuery(document.createElement(blockLevel?"div":"span")).appendTo(w.output);0===css.classes.length&&""===css.id&&0===Object.keys(css.styles).length?$el.addClass("marked"):(css.classes.forEach((function(className){return $el.addClass(className)})),""!==css.id&&$el.attr("id",css.id),$el.css(css.styles)),blockLevel?(w.nextMatch+=blockMatch[0].length,w.subWikify($el[0],"\\n?".concat(this.terminator))):w.subWikify($el[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(match[1]||match[2]).appendTo(w.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+$\\n?|<[Hh][Rr]\\s*/?>\\n?",handler:function(w){jQuery(document.createElement("hr")).appendTo(w.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(w){jQuery(document.createTextNode("—")).appendTo(w.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(w){jQuery(document.createTextNode("$")).appendTo(w.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:"".concat(Patterns.variable,"(?:(?:\\.").concat(Patterns.identifier,")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\[").concat(Patterns.variable,"\\]))*"),handler:function(w){var result=State.getVar(w.matchText);null==result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"variable",w.matchText,w.matchText):w).output,stringFrom(result))}}),Wikifier.Parser.add({name:"template",profiles:["core"],match:"\\?".concat(Patterns.templateName),handler:function(w){var name=w.matchText.slice(1),template=Template.get(name),result=null;switch(template instanceof Array&&(template=template.random()),_typeof(template)){case"function":try{result=stringFrom(template.call({name:name}))}catch(ex){return throwError(w.output,"cannot execute function template ?".concat(name,": ").concat(ex.message),w.source.slice(w.matchStart,w.nextMatch))}break;case"string":result=template}null===result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"template",w.matchText,w.matchText):w).output,result)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("h".concat(w.matchLength))).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,table=jQuery(document.createElement("table")).appendTo(w.output).get(0),prevColumns=[],curRowType=null,$rowContainer=null,rowCount=0;w.nextMatch=w.matchStart;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var nextRowType=match[2];"k"===nextRowType?(table.className=match[1],w.nextMatch+=match[0].length+1):(nextRowType!==curRowType&&(curRowType=nextRowType,$rowContainer=jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table)),"c"===curRowType?($rowContainer.css("caption-side",0===rowCount?"top":"bottom"),w.nextMatch+=1,w.subWikify($rowContainer[0],this.rowTerminator)):this.rowHandler(w,jQuery(document.createElement("tr")).appendTo($rowContainer).get(0),prevColumns),++rowCount)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))},rowHandler:function(w,rowEl,prevColumns){var matched,_this12=this,cellRe=new RegExp(this.cellPattern,"gm"),col=0,curColCount=1;do{cellRe.lastIndex=w.nextMatch;var cellMatch=cellRe.exec(w.source);if(matched=cellMatch&&cellMatch.index===w.nextMatch){if("~"===cellMatch[1]){var last=prevColumns[col];last&&(++last.rowCount,last.$element.attr("rowspan",last.rowCount).css("vertical-align","middle")),w.nextMatch=cellMatch.index+cellMatch[0].length-1}else if(">"===cellMatch[1])++curColCount,w.nextMatch=cellMatch.index+cellMatch[0].length-1;else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}!function(){++w.nextMatch;for(var css=Wikifier.helpers.inlineCss(w),spaceLeft=!1,spaceRight=!1,$cell=void 0;" "===w.source.substr(w.nextMatch,1);)spaceLeft=!0,++w.nextMatch;"!"===w.source.substr(w.nextMatch,1)?($cell=jQuery(document.createElement("th")).appendTo(rowEl),++w.nextMatch):$cell=jQuery(document.createElement("td")).appendTo(rowEl),prevColumns[col]={rowCount:1,$element:$cell},curColCount>1&&($cell.attr("colspan",curColCount),curColCount=1),w.subWikify($cell[0],_this12.cellTerminator)," "===w.matchText.substr(w.matchText.length-2,1)&&(spaceRight=!0),css.classes.forEach((function(className){return $cell.addClass(className)})),""!==css.id&&$cell.attr("id",css.id),spaceLeft&&spaceRight?css.styles["text-align"]="center":spaceLeft?css.styles["text-align"]="right":spaceRight&&(css.styles["text-align"]="left"),$cell.css(css.styles),w.nextMatch=w.nextMatch-1}()}++col}}while(matched)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){w.nextMatch=w.matchStart;var matched,i,destStack=[w.output],curType=null,curLevel=0;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var newType=match[2]?"ol":"ul",newLevel=match[0].length;if(w.nextMatch+=match[0].length,newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();else newLevel===curLevel&&newType!==curType&&(destStack.pop(),destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0)));curLevel=newLevel,curType=newType,w.subWikify(jQuery(document.createElement("li")).appendTo(destStack[destStack.length-1]).get(0),this.terminator)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\".concat(Patterns.spaceNoTerminator,"*\\n|\\n").concat(Patterns.spaceNoTerminator,"*\\\\|\\n?\\\\").concat(Patterns.spaceNoTerminator,"*$|^").concat(Patterns.spaceNoTerminator,"*\\\\\\n?"),handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n|<[Bb][Rr]\\s*/?>",handler:function(w){w.options.nobr||jQuery(document.createElement("br")).appendTo(w.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(w){jQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){w.nextMatch=this.lookahead.lastIndex;var css=match[2];this.hasImageMarkup.test(css)&&(this.imageMarkup.lastIndex=0,css=css.replace(this.imageMarkup,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text)}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),jQuery(document.createDocumentFragment()).append(match[1]+css+match[3]).appendTo(w.output)}}}),Wikifier.Parser.add({name:"svgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/<(\/?)[Ss][Vv][Gg][^>]*>/gm,namespace:"http://www.w3.org/2000/svg",handler:function(w){var _this13=this;this.lookahead.lastIndex=w.nextMatch;for(var match,depth=1;depth>0&&null!==(match=this.lookahead.exec(w.source));)depth+="/"===match[1]?-1:1;if(0===depth){w.nextMatch=this.lookahead.lastIndex;var svgTag=w.source.slice(w.matchStart,this.lookahead.lastIndex),$frag=jQuery(document.createDocumentFragment()).append(svgTag);$frag.find("a[data-passage],image[data-passage]").each((function(_,el){var tagName=el.tagName.toLowerCase();try{_this13.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"svg|<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}el.hasAttribute("data-passage")&&_this13.processDataAttributes(el,tagName)})),$frag.appendTo(w.output)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref10){var name=_ref10.name,value=_ref10.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if("image"===tagName)"data:"!==passage.slice(0,5)&&Story.has(passage)&&(passage=Story.get(passage)).tags.includes("Twine.image")&&el.setAttribute("href",passage.text.trim());else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<".concat(Patterns.htmlTagName,"(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>"),tagRe:new RegExp("^<(".concat(Patterns.htmlTagName,")")),mediaTags:["audio","img","source","track","video"],nobrTags:["audio","colgroup","datalist","dl","figure","meter","ol","optgroup","picture","progress","ruby","select","table","tbody","tfoot","thead","tr","ul","video"],voidTags:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],handler:function(w){var tagMatch=this.tagRe.exec(w.matchText),tag=tagMatch&&tagMatch[1],tagName=tag&&tag.toLowerCase();if(tagName){var terminator,terminatorMatch,isVoid=this.voidTags.includes(tagName)||w.matchText.endsWith("/>"),isNobr=this.nobrTags.includes(tagName);if(!isVoid){terminator="<\\/".concat(tagName,"\\s*>");var terminatorRe=new RegExp(terminator,"gim");terminatorRe.lastIndex=w.matchStart,terminatorMatch=terminatorRe.exec(w.source)}if(!isVoid&&!terminatorMatch)return throwError(w.output,"cannot find a closing tag for HTML <".concat(tag,">"),"".concat(w.matchText,"…"));var debugView,output=w.output,el=document.createElement(w.output.tagName);for(el.innerHTML=w.matchText;el.firstChild;)el=el.firstChild;try{this.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}if(el.hasAttribute("data-passage")&&(this.processDataAttributes(el,tagName),Config.debug&&((debugView=new DebugView(w.output,"html-".concat(tagName),tagName,w.matchText)).modes({block:"img"===tagName,nonvoid:terminatorMatch}),output=debugView.output)),terminatorMatch){try{Wikifier.Option.push({nobr:isNobr}),w.subWikify(el,terminator,{ignoreTerminatorCase:!0})}finally{Wikifier.Option.pop()}debugView&&jQuery(el).find(".debug.block").length>0&&debugView.modes({block:!0})}output.appendChild("track"===tagName?el.cloneNode(!0):el)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref11){var name=_ref11.name,value=_ref11.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if(this.mediaTags.includes(tagName)){if("data:"!==passage.slice(0,5)&&Story.has(passage)){var parentName,twineTag;switch(passage=Story.get(passage),tagName){case"audio":case"video":twineTag="Twine.".concat(tagName);break;case"img":twineTag="Twine.image";break;case"track":twineTag="Twine.vtt";break;case"source":var $parent=$(el).closest("audio,picture,video");$parent.length&&(parentName=$parent.get(0).tagName.toLowerCase(),twineTag="Twine.".concat("picture"===parentName?"image":parentName))}passage.tags.includes(twineTag)&&(el["picture"===parentName?"srcset":"src"]=passage.text.trim())}}else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}})}();var Template=(_templates=new Map,_validNameRe=new RegExp("^(?:".concat(Patterns.templateName,")$")),_validType=function(template){var templateType=_typeof(template);return"function"===templateType||"string"===templateType},Object.freeze(Object.defineProperties({},{add:{value:function(name,template){if(!(_validType(template)||template instanceof Array&&template.length>0&&template.every(_validType)))throw new TypeError("invalid template type (".concat(name,"); templates must be: functions, strings, or an array of either"));(name instanceof Array?name:[name]).forEach((function(name){if(!_validNameRe.test(name))throw new Error('invalid template name "'.concat(name,'"'));if(_templates.has(name))throw new Error("cannot clobber existing template ?".concat(name));_templates.set(name,template)}))}},delete:{value:function(name){(name instanceof Array?name:[name]).forEach((function(name){return _templates.delete(name)}))}},get:{value:function(name){return _templates.has(name)?_templates.get(name):null}},has:{value:function(name){return _templates.has(name)}},size:{get:function(){return _templates.size}}}))),_templates,_validNameRe,_validType,Macro=function(){var _macros={},_tags={},_validNameRe=new RegExp("^(?:".concat(Patterns.macroName,")$"));function macrosHas(name){return _macros.hasOwnProperty(name)}function tagsRegister(parent,bodyTags){if(!parent)throw new Error("no parent specified");for(var endTags=["/".concat(parent),"end".concat(parent)],allTags=[].concat(endTags,Array.isArray(bodyTags)?bodyTags:[]),i=0;i<allTags.length;++i){var tag=allTags[i];if(macrosHas(tag))throw new Error("cannot register tag for an existing macro");tagsHas(tag)?_tags[tag].includes(parent)||(_tags[tag].push(parent),_tags[tag].sort()):_tags[tag]=[parent]}}function tagsUnregister(parent){if(!parent)throw new Error("no parent specified");Object.keys(_tags).forEach((function(tag){var i=_tags[tag].indexOf(parent);-1!==i&&(1===_tags[tag].length?delete _tags[tag]:_tags[tag].splice(i,1))}))}function tagsHas(name){return _tags.hasOwnProperty(name)}return Object.freeze(Object.defineProperties({},{add:{value:function macrosAdd(name,def){if(Array.isArray(name))name.forEach((function(name){return macrosAdd(name,def)}));else{if(!_validNameRe.test(name))throw new Error('invalid macro name "'.concat(name,'"'));if(macrosHas(name))throw new Error("cannot clobber existing macro <<".concat(name,">>"));if(tagsHas(name))throw new Error("cannot clobber child tag <<".concat(name,">> of parent macro").concat(1===_tags[name].length?"":"s"," <<").concat(_tags[name].join(">>, <<"),">>"));try{if("object"===_typeof(def))_macros[name]=Object.assign(Object.create(null),def,{_MACRO_API:!0});else{if(!macrosHas(def))throw new Error("cannot create alias of nonexistent macro <<".concat(def,">>"));_macros[name]=Object.create(_macros[def],{_ALIAS_OF:{enumerable:!0,value:def}})}Object.defineProperty(_macros,name,{writable:!1})}catch(ex){throw"TypeError"===ex.name?new Error("cannot clobber protected macro <<".concat(name,">>")):new Error("unknown error when attempting to add macro <<".concat(name,">>: [").concat(ex.name,"] ").concat(ex.message))}if(void 0!==_macros[name].tags)if(null==_macros[name].tags)tagsRegister(name);else{if(!Array.isArray(_macros[name].tags))throw new Error('bad value for "tags" property of macro <<'.concat(name,">>"));tagsRegister(name,_macros[name].tags)}}}},delete:{value:function macrosDelete(name){if(Array.isArray(name))name.forEach((function(name){return macrosDelete(name)}));else if(macrosHas(name)){void 0!==_macros[name].tags&&tagsUnregister(name);try{Object.defineProperty(_macros,name,{writable:!0}),delete _macros[name]}catch(ex){throw new Error("unknown error removing macro <<".concat(name,">>: ").concat(ex.message))}}else if(tagsHas(name))throw new Error("cannot remove child tag <<".concat(name,">> of parent macro <<").concat(_tags[name],">>"))}},isEmpty:{value:function(){return 0===Object.keys(_macros).length}},has:{value:macrosHas},get:{value:function(name){var macro=null;return macrosHas(name)&&"function"==typeof _macros[name].handler?macro=_macros[name]:macros.hasOwnProperty(name)&&"function"==typeof macros[name].handler&&(macro=macros[name]),macro}},init:{value:function(){var handler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(_macros).forEach((function(name){"function"==typeof _macros[name][handler]&&_macros[name][handler](name)})),Object.keys(macros).forEach((function(name){"function"==typeof macros[name][handler]&&macros[name][handler](name)}))}},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:tagsRegister},unregister:{value:tagsUnregister},has:{value:tagsHas},get:{value:function(name){return tagsHas(name)?_tags[name]:null}}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){var MacroContext=function(){function MacroContext(contextData){_classCallCheck(this,MacroContext);var context=Object.assign({parent:null,macro:null,name:"",displayName:"",args:null,payload:null,parser:null,source:""},contextData);if(null===context.macro||""===context.name||null===context.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:context.macro},name:{value:void 0===context.macro._ALIAS_OF?context.name:context.macro._ALIAS_OF},displayName:{value:context.name},args:{value:context.args},payload:{value:context.payload},source:{value:context.source},parent:{value:context.parent},parser:{value:context.parser},_output:{value:context.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(MacroContext,[{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return _toConsumableArray(this._shadows)}},{key:"shadowView",get:function(){var view=new Set;return this.contextSelectAll((function(ctx){return ctx._shadows})).forEach((function(ctx){return ctx._shadows.forEach((function(name){return view.add(name)}))})),_toConsumableArray(view)}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}},{key:"contextHas",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return!0;return!1}},{key:"contextSelect",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return context;return null}},{key:"contextSelectAll",value:function(filter){for(var result=[],context=this;null!==(context=context.parent);)filter(context)&&result.push(context);return result}},{key:"addShadow",value:function(){var _this14=this;this._shadows||(this._shadows=new Set);for(var varRe=new RegExp("^".concat(Patterns.variable,"$")),_len14=arguments.length,names=new Array(_len14),_key14=0;_key14<_len14;_key14++)names[_key14]=arguments[_key14];names.flat(1/0).forEach((function(name){if("string"!=typeof name)throw new TypeError("variable name must be a string; type: ".concat(_typeof(name)));if(!varRe.test(name))throw new Error('invalid variable name "'.concat(name,'"'));_this14._shadows.add(name)}))}},{key:"createShadowWrapper",value:function(callback,doneCallback,startCallback){var shadowStore,shadowContext=this;return"function"==typeof callback&&(shadowStore={},this.shadowView.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]}))),function(){for(var _len15=arguments.length,args=new Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];if("function"==typeof startCallback&&startCallback.apply(this,args),"function"==typeof callback){var contextCache,shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null,macroParser=Wikifier.Parser.get("macro");try{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),contextCache=macroParser.context,macroParser.context=shadowContext,callback.apply(this,args)}finally{contextCache!==undefined&&(macroParser.context=contextCache),shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}"function"==typeof doneCallback&&doneCallback.apply(this,args)}}},{key:"createDebugView",value:function(name,title){return this._debugView=new DebugView(this._output,"macro",name||this.displayName,title||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(message,source){return throwError(this._output,"<<".concat(this.displayName,">>: ").concat(message),source||this.source)}}]),MacroContext}();return MacroContext}();!function(){if(Macro.add("capture",{skipArgs:!0,tags:null,tsVarRe:new RegExp("(".concat(Patterns.variable,")"),"g"),handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var valueCache={};try{for(var match,tsVarRe=this.self.tsVarRe;null!==(match=tsVarRe.exec(this.args.raw));){var varName=match[1],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),this.addShadow(varName)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("unset",{skipArgs:!0,jsVarRe:new RegExp("State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var match,jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var store=State[match[1]],name=match[2];store.hasOwnProperty(name)&&delete store[name]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remember",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}for(var match,remember=storage.get("remember")||{},jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];remember[name]=State.variables[name]}if(!storage.set("remember",remember))return this.error("unknown error, cannot remember: ".concat(this.args.raw));Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var remember=storage.get("remember");remember&&Object.keys(remember).forEach((function(name){return State.variables[name]=remember[name]}))}}),Macro.add("forget",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var match,remember=storage.get("remember"),jsVarRe=this.self.jsVarRe,needStore=!1;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];State.variables.hasOwnProperty(name)&&delete State.variables[name],remember&&remember.hasOwnProperty(name)&&(needStore=!0,delete remember[name])}if(needStore)if(0===Object.keys(remember).length){if(!storage.delete("remember"))return this.error("unknown error, cannot update remember store")}else if(!storage.set("remember",remember))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var output=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,output)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.createDebugView(),output.hasChildNodes()&&this.output.appendChild(output)}}),Macro.add("include",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?(Config.debug&&this.debugView.modes({block:!0}),passage=Story.get(passage),void(this.args[1]?jQuery(document.createElement(this.args[1])).addClass("".concat(passage.domId," macro-").concat(this.name)).attr("data-passage",passage.title).appendTo(this.output):jQuery(this.output)).wiki(passage.processText())):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var result=stringFrom(Scripting.evalJavaScript(this.args.full));null!==result&&new Wikifier(this.output,"-"===this.name?Util.escape(result):result)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("silently",{skipArgs:!0,tags:null,handler:function(){var frag=document.createDocumentFragment();if(new Wikifier(frag,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({block:!0,hidden:!0}),this.output.appendChild(frag);else{var errList=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent}));if(errList.length>0)return this.error("error".concat(1===errList.length?"":"s"," within contents (").concat(errList.join("; "),")"))}}}),Macro.add("type",{isAsync:!0,tags:null,typeId:0,handler:function(){if(0===this.args.length)return this.error("no speed specified");var cursor,speed=Util.fromCssTime(this.args[0]);if(speed<0)return this.error("speed time value must be non-negative (received: ".concat(this.args[0],")"));for(var elClass="",elId="",elTag="div",skipKey=Config.macros.typeSkipKey,start=400,options=this.args.slice(1);options.length>0;){var option=options.shift();switch(option){case"class":if(0===options.length)return this.error("class option missing required class name(s)");if(""===(elClass=options.shift()))throw new Error('class option class name(s) must be non-empty (received: "")');break;case"element":if(0===options.length)return this.error("element option missing required element tag name");if(""===(elTag=options.shift()))throw new Error('element option tag name must be non-empty (received: "")');break;case"id":if(0===options.length)return this.error("id option missing required ID");if(""===(elId=options.shift()))throw new Error('id option ID must be non-empty (received: "")');break;case"keep":cursor="keep";break;case"none":cursor="none";break;case"skipkey":if(0===options.length)return this.error("skipkey option missing required key value");if(""===(skipKey=options.shift()))throw new Error('skipkey option key value must be non-empty (received: "")');break;case"start":if(0===options.length)return this.error("start option missing required time value");var value=options.shift();if((start=Util.fromCssTime(value))<0)throw new Error("start option time value must be non-negative (received: ".concat(value,")"));break;default:return this.error("unknown option: ".concat(option))}}var contents=this.payload[0].contents;if(""!==contents.trim()){Config.debug&&this.debugView.modes({block:!0});var className="macro-".concat(this.name),namespace=".".concat(className),$target=jQuery(document.createElement(elTag)).addClass("".concat(className," ").concat(className,"-target")).appendTo(this.output);TempState.macroTypeQueue||(TempState.macroTypeQueue=[],$(document).off(namespace).one(":passageinit".concat(namespace),(function(){return $(document).off(namespace)})));var startTyping=0===TempState.macroTypeQueue.length,selfId=++this.self.typeId;TempState.macroTypeQueue.push({id:selfId,handler:function(){var $wrapper=jQuery(document.createElement(elTag)).addClass(className);elId&&$wrapper.attr("id",elId),elClass&&$wrapper.addClass(elClass),new Wikifier($wrapper,contents);var passage=State.passage,turn=State.turns;if(!Config.macros.typeVisitedPassages&&State.passages.slice(0,-1).some((function(title){return title===passage}))||$wrapper.find(".error").length>0)return $target.replaceWith($wrapper),TempState.macroTypeQueue.shift(),void(TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().handler());var typer=new NodeTyper({targetNode:$wrapper.get(0),classNames:"none"===cursor?null:"".concat(className,"-cursor")});$target.replaceWith($wrapper);var keydownAndNS="keydown".concat(namespace),typingStopAndNS="".concat(":typingstop").concat(namespace);$(document).off(keydownAndNS).on(keydownAndNS,(function(ev){Util.scrubEventKey(ev.key)!==skipKey||ev.target!==document.body&&ev.target!==document.documentElement||(ev.preventDefault(),$(document).off(keydownAndNS),typer.finish())})).one(typingStopAndNS,(function(){TempState.macroTypeQueue&&(0===TempState.macroTypeQueue.length?jQuery.event.trigger(":typingcomplete"):TempState.macroTypeQueue.first().handler())}));var typeNode=function(){var typeNodeMember=function(typeIntervalId){State.passage===passage&&State.turns===turn&&typer.type()||(typeIntervalId&&clearInterval(typeIntervalId),TempState.macroTypeQueue&&TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().id===selfId&&TempState.macroTypeQueue.shift(),$wrapper.trigger(":typingstop"),$wrapper.addClass("".concat(className,"-done")),"keep"===cursor&&$wrapper.addClass("".concat(className,"-cursor")))};$wrapper.trigger(":typingstart"),typeNodeMember();var typeNodeMemberId=setInterval((function(){return typeNodeMember(typeNodeMemberId)}),speed)};start?setTimeout(typeNode,start):typeNode()}}),startTyping&&(Engine.isPlaying()?$(document).one(":passageend".concat(namespace),(function(){return TempState.macroTypeQueue.first().handler()})):TempState.macroTypeQueue.first().handler())}}}),Macro.add("display","include"),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],elseifWsRe:/^\s*if\b/i,ifAssignRe:/[^!=&^|<>*/%+-]=[^=>]/,handler:function(){var i;try{var len=this.payload.length,elseifWsRe=this.self.elseifWsRe,ifAssignRe=this.self.ifAssignRe;for(i=0;i<len;++i)if("else"===this.payload[i].name){if(this.payload[i].args.raw.length>0)return elseifWsRe.test(this.payload[i].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'.concat(i>0?" (#"+i+")":"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<else>> must be the final clause")}else{if(0===this.payload[i].args.full.length)return this.error("no conditional expression specified for <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""));if(Config.macros.ifAssignmentError&&ifAssignRe.test(this.payload[i].args.full))return this.error("assignment operator found within <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""," (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: ").concat(this.payload[i].args.raw))}var evalJavaScript=Scripting.evalJavaScript,success=!1;for(i=0;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"else"===this.payload[i].name||evalJavaScript(this.payload[i].args.full)){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!success,invalid:!success})}}catch(ex){return this.error("bad conditional expression in <<".concat(0===i?"if":"elseif",">> clause").concat(i>0?" (#"+i+")":"",": ").concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("switch",{skipArgs:["switch"],tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var i,result,len=this.payload.length;if(1===len)return this.error("no cases specified");for(i=1;i<len;++i)if("default"===this.payload[i].name){if(this.payload[i].args.length>0)return this.error("<<default>> does not accept values, invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<default>> must be the final case")}else if(0===this.payload[i].args.length)return this.error("no value(s) specified for <<".concat(this.payload[i].name,">> (#").concat(i,")"));try{result=Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}var debugView=this.debugView,success=!1;for(Config.debug&&debugView.modes({nonvoid:!1,hidden:!0}),i=1;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"default"===this.payload[i].name||this.payload[i].args.some((function(val){return val===result}))){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});debugView.modes({nonvoid:!1,hidden:!0,invalid:!success}),this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0,invalid:!success})}}}),Macro.add("for",{skipArgs:!0,tags:null,hasRangeRe:new RegExp("^\\S".concat(Patterns.anyChar,"*?\\s+range\\s+\\S").concat(Patterns.anyChar,"*?$")),rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")\\s*,\\s*)?State\\.(variables|temporary)\\.(").concat(Patterns.identifier,")\\s+range\\s+(\\S").concat(Patterns.anyChar,"*?)$")),threePartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,forInRe:/^\S+\s+in\s+\S+/i,forOfRe:/^\S+\s+of\s+\S+/i,handler:function(){var argsStr=this.args.full.trim(),payload=this.payload[0].contents.replace(/\n$/,"");if(0===argsStr.length)this.self.handleFor.call(this,payload,null,!0,null);else if(this.self.hasRangeRe.test(argsStr)){var parts=argsStr.match(this.self.rangeRe);if(null===parts)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self.handleForRange.call(this,payload,{type:parts[1],name:parts[2]},{type:parts[3],name:parts[4]},parts[5])}else{var init,condition,post;if(-1===argsStr.indexOf(";")){if(this.self.forInRe.test(argsStr))return this.error("invalid syntax, for…in is not supported; see: for…range");if(this.self.forOfRe.test(argsStr))return this.error("invalid syntax, for…of is not supported; see: for…range");condition=argsStr}else{var _parts=argsStr.match(this.self.threePartRe);if(null===_parts)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");init=_parts[1],condition=_parts[2].trim(),post=_parts[3],0===condition.length&&(condition=!0)}this.self.handleFor.call(this,payload,init,condition,post)}},handleFor:function(payload,init,condition,post){var evalJavaScript=Scripting.evalJavaScript,first=!0,safety=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,init)try{evalJavaScript(init)}catch(ex){return this.error("bad init expression: ".concat("object"===_typeof(ex)?ex.message:ex))}for(;evalJavaScript(condition);){if(--safety<0)return this.error("exceeded configured maximum loop iterations (".concat(Config.macros.maxLoopIterations,")"));if(new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(post)try{evalJavaScript(post)}catch(ex){return this.error("bad post expression: ".concat("object"===_typeof(ex)?ex.message:ex))}}}catch(ex){return this.error("bad conditional expression: ".concat("object"===_typeof(ex)?ex.message:ex))}finally{TempState.break=null}},handleForRange:function(payload,indexVar,valueVar,rangeExp){var rangeList,first=!0;try{rangeList=this.self.toRangeList(rangeExp)}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var i=0;i<rangeList.length;++i)if(indexVar.name&&(State[indexVar.type][indexVar.name]=rangeList[i][0]),State[valueVar.type][valueVar.name]=rangeList[i][1],new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(ex){return this.error("object"===_typeof(ex)?ex.message:ex)}finally{TempState.break=null}},toRangeList:function(rangeExp){var value,list,evalJavaScript=Scripting.evalJavaScript;try{value=evalJavaScript("{"===rangeExp[0]?"(".concat(rangeExp,")"):rangeExp)}catch(ex){if("object"!==_typeof(ex))throw new Error("bad range expression: ".concat(ex));throw ex.message="bad range expression: ".concat(ex.message),ex}switch(_typeof(value)){case"string":list=[];for(var i=0;i<value.length;){var obj=Util.charAndPosAt(value,i);list.push([i,obj.char]),i=1+obj.end}break;case"object":if(Array.isArray(value))list=value.map((function(val,i){return[i,val]}));else if(value instanceof Set)list=_toConsumableArray(value).map((function(val,i){return[i,val]}));else if(value instanceof Map)list=_toConsumableArray(value.entries());else{if("Object"!==Util.toStringTag(value))throw new Error("unsupported range expression type: ".concat(Util.toStringTag(value)));list=Object.keys(value).map((function(key){return[key,value[key]]}))}break;default:throw new Error("unsupported range expression type: ".concat(_typeof(value)))}return list}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas((function(ctx){return"for"===ctx.name})))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var _this15=this;if(0===this.args.length)return this.error("no ".concat("button"===this.name?"button":"link"," text specified"));var passage,$link=jQuery(document.createElement("button"===this.name?"button":"a"));if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var $image=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo($link);$link.addClass("link-image"),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link}else $link.append(document.createTextNode(this.args[0].text)),passage=this.args[0].link;else $link.wikiWithOptions({profile:"core"},this.args[0]),passage=this.args.length>1?this.args[1]:undefined;null!=passage?($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken")):$link.addClass("link-internal"),$link.addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:null!=passage?"link":"button",one:null!=passage},this.createShadowWrapper(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(_this15.payload[0].contents.trim())}:null,null!=passage?function(){return Engine.play(passage)}:null)).appendTo(this.output)}}),Macro.add("checkbox",{isAsync:!0,handler:function(){if(this.args.length<3){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("unchecked value"),this.args.length<3&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),uncheckValue=this.args[1],checkValue=this.args[2],el=document.createElement("input");switch(jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:"checkbox",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.checked?checkValue:uncheckValue)}))).appendTo(this.output),this.args[3]){case"autocheck":State.getVar(varName)===checkValue?el.checked=!0:State.setVar(varName,uncheckValue);break;case"checked":el.checked=!0,State.setVar(varName,checkValue);break;default:State.setVar(varName,uncheckValue)}}}),Macro.add(["cycle","listbox"],{isAsync:!0,skipArgs:["optionsfrom"],tags:["option","optionsfrom"],handler:function(){var _this16=this;if(0===this.args.length)return this.error("no variable name specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),len=this.payload.length;if(1===len)return this.error("no options specified");for(var config={autoselect:!1,once:!1},i=1;i<this.args.length;++i){var arg=this.args[i];switch(arg){case"once":config.once=!0;break;case"autoselect":config.autoselect=!0;break;default:return this.error("unknown argument: ".concat(arg))}}for(var options=[],tagCount={option:0,optionsfrom:0},selectedIdx=-1,_i5=1;_i5<len;++_i5){var payload=this.payload[_i5];if("option"===payload.name){if(++tagCount.option,0===payload.args.length)return this.error("no arguments specified for <<".concat(payload.name,">> (#").concat(tagCount.option,")"));var option={label:String(payload.args[0])},isSelected=!1;switch(payload.args.length){case 1:option.value=payload.args[0];break;case 2:"selected"===payload.args[1]?(option.value=payload.args[0],isSelected=!0):option.value=payload.args[1];break;default:option.value=payload.args[1],"selected"===payload.args[2]&&(isSelected=!0)}if(options.push(option),isSelected){if(config.autoselect)return this.error("cannot specify both the autoselect and selected keywords");if(-1!==selectedIdx)return this.error("multiple selected keywords specified for <<".concat(payload.name,">> (#").concat(selectedIdx+1," & #").concat(tagCount.option,")"));selectedIdx=options.length-1}}else{var _ret=function(){if(++tagCount.optionsfrom,0===payload.args.full.length)return{v:_this16.error("no expression specified for <<".concat(payload.name,">> (#").concat(tagCount.optionsfrom,")"))};var result=void 0;try{var exp=payload.args.full;result=Scripting.evalJavaScript("{"===exp[0]?"(".concat(exp,")"):exp)}catch(ex){return{v:_this16.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}if("object"!==_typeof(result)||null===result)return{v:_this16.error("expression must yield a supported collection or generic object (type: ".concat(null===result?"null":_typeof(result),")"))};if(result instanceof Array||result instanceof Set)result.forEach((function(val){return options.push({label:String(val),value:val})}));else if(result instanceof Map)result.forEach((function(val,key){return options.push({label:String(key),value:val})}));else{var oType=Util.toStringTag(result);if("Object"!==oType)return{v:_this16.error("expression must yield a supported collection or generic object (object type: ".concat(oType,")"))};Object.keys(result).forEach((function(key){return options.push({label:key,value:result[key]})}))}}();if("object"===_typeof(_ret))return _ret.v}}if(-1===selectedIdx)if(config.autoselect){var sameValueZero=Util.sameValueZero,curValue=State.getVar(varName),curValueIdx=options.findIndex((function(opt){return sameValueZero(opt.value,curValue)}));selectedIdx=-1===curValueIdx?0:curValueIdx}else selectedIdx=0;if("cycle"===this.name){var lastIdx=options.length-1;if(config.once&&selectedIdx===lastIdx)jQuery(this.output).wikiWithOptions({profile:"core"},options[selectedIdx].label);else{var cycleIdx=selectedIdx;jQuery(document.createElement("a")).wikiWithOptions({profile:"core"},options[selectedIdx].label).attr("id","".concat(this.name,"-").concat(varId)).addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:"button"},this.createShadowWrapper((function(){var $this=$(this);cycleIdx=(cycleIdx+1)%options.length,State.setVar(varName,options[cycleIdx].value),$this.empty().wikiWithOptions({profile:"core"},options[cycleIdx].label),config.once&&cycleIdx===lastIdx&&$this.off().contents().unwrap()}))).appendTo(this.output)}}else{var $select=jQuery(document.createElement("select"));options.forEach((function(opt,i){jQuery(document.createElement("option")).val(i).text(opt.label).appendTo($select)})),$select.attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),tabindex:0}).addClass("macro-".concat(this.name)).val(selectedIdx).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,options[Number(this.value)].value)}))).appendTo(this.output)}State.setVar(varName,options[selectedIdx].value)}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this17=this;if(0===this.args.length)return this.error("no link text specified");var $link=jQuery(document.createElement("a")),$insert=jQuery(document.createElement("span")),transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]);$link.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-".concat(this.name)).ariaClick({namespace:".macros",one:!0},this.createShadowWrapper((function(){if("linkreplace"===_this17.name?$link.remove():$link.wrap('<span class="macro-'.concat(_this17.name,'"></span>')).replaceWith((function(){return $link.html()})),""!==_this17.payload[0].contents){var frag=document.createDocumentFragment();new Wikifier(frag,_this17.payload[0].contents),$insert.append(frag)}transition&&setTimeout((function(){return $insert.removeClass("macro-".concat(_this17.name,"-in"))}),Engine.minDomActionDelay)}))).appendTo(this.output),$insert.addClass("macro-".concat(this.name,"-insert")),transition&&$insert.addClass("macro-".concat(this.name,"-in")),"linkprepend"===this.name?$insert.insertBefore($link):$insert.insertAfter($link)}}),Macro.add(["numberbox","textbox"],{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var asNumber="numberbox"===this.name,defaultValue=asNumber?Number(this.args[1]):this.args[1];if(asNumber&&Number.isNaN(defaultValue))return this.error('default value "'.concat(this.args[1],'" is neither a number nor can it be parsed into a number'));var passage,varId=Util.slugify(varName),el=document.createElement("input"),autofocus=!1;this.args.length>3?(passage=this.args[2],autofocus="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?autofocus=!0:passage=this.args[2]),"object"===_typeof(passage)&&(passage=passage.link),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:asNumber?"number":"text",inputmode:asNumber?"decimal":"text",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,asNumber?Number(this.value):this.value)}))).on("keypress.macros",this.createShadowWrapper((function(ev){13===ev.which&&(ev.preventDefault(),State.setVar(varName,asNumber?Number(this.value):this.value),null!=passage&&Engine.play(passage))}))).appendTo(this.output),asNumber&&(el.step="any"),State.setVar(varName,defaultValue),el.value=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("radiobutton",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),checkValue=this.args[1],el=document.createElement("input");switch(TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId,"-").concat(TempState[this.name][varId]++),name:"".concat(this.name,"-").concat(varId),type:"radio",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){this.checked&&State.setVar(varName,checkValue)}))).appendTo(this.output),this.args[2]){case"autocheck":State.getVar(varName)===checkValue&&(el.checked=!0);break;case"checked":el.checked=!0,State.setVar(varName,checkValue)}}}),Macro.add("textarea",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var varId=Util.slugify(varName),defaultValue=this.args[1],autofocus="autofocus"===this.args[2],el=document.createElement("textarea");jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),rows:4,tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.value)}))).appendTo(this.output),State.setVar(varName,defaultValue),el.textContent=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var $list=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),i=0;i<this.args.length;++i){var passage=void 0,text=void 0,$image=void 0,setFn=void 0;if("object"===_typeof(this.args[i])?this.args[i].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[i].source),this.args[i].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[i].passage),this.args[i].hasOwnProperty("title")&&$image.attr("title",this.args[i].title),this.args[i].hasOwnProperty("align")&&$image.attr("align",this.args[i].align),passage=this.args[i].link,setFn=this.args[i].setFn):(text=this.args[i].text,passage=this.args[i].link,setFn=this.args[i].setFn):text=passage=this.args[i],!(State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(passage)&&State.variables["#actions"][passage])){var $link=jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo($list),passage,null,function(passage,fn){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][passage]=!0,"function"==typeof fn&&fn()}}(passage,setFn))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text));$image&&$link.addClass("link-image")}}}}),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var passage,text,$image,$link,momentIndex=-1;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(passage=this.args[0].link)):(1===this.args[0].count||(text=this.args[0].text),passage=this.args[0].link):1===this.args.length&&(text=this.args[0])),null==passage){for(var i=State.length-2;i>=0;--i)if(State.history[i].title!==State.passage){momentIndex=i,passage=State.history[i].title;break}if(null==passage&&"return"===this.name)for(var _i6=State.expired.length-1;_i6>=0;--_i6)if(State.expired[_i6]!==State.passage){passage=State.expired[_i6];break}}else{if(!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));if("back"===this.name){for(var _i7=State.length-2;_i7>=0;--_i7)if(State.history[_i7].title===passage){momentIndex=_i7;break}if(-1===momentIndex)return this.error('cannot find passage "'.concat(passage,'" in the current story history'))}}if(null==passage)return this.error("cannot find passage");"back"!==this.name||-1!==momentIndex?($link=jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(passage)}:function(){return Engine.goTo(momentIndex)}),$image&&$link.addClass("link-image")):$link=jQuery(document.createElement("span")).addClass("link-disabled"),$link.addClass("macro-".concat(this.name)).append($image||document.createTextNode(text||L10n.get("macro".concat(this.name.toUpperFirst(),"Text")))).appendTo(this.output)}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var passage,text,$image,setFn,$link,choiceId=State.passage;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link,setFn=this.args[0].setFn):(text=this.args[0].text,passage=this.args[0].link,setFn=this.args[0].setFn):text=passage=this.args[0]:(passage=this.args[0],text=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(choiceId)&&State.variables["#choice"][choiceId])return $link=jQuery(document.createElement("span")).addClass("link-disabled macro-".concat(this.name)).attr("tabindex",-1).append($image||document.createTextNode(text)).appendTo(this.output),void($image&&$link.addClass("link-image"));$link=jQuery(Wikifier.createInternalLink(this.output,passage,null,(function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][choiceId]=!0,"function"==typeof setFn&&setFn()}))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text)),$image&&$link.addClass("link-image")}}),Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("selector"),this.args.length<2&&errors.push("class names"),this.error("no ".concat(errors.join(" or ")," specified"))}var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));switch(this.name){case"addclass":$targets.addClass(this.args[1].trim());break;case"toggleclass":$targets.toggleClass(this.args[1].trim())}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));this.args.length>1?$targets.removeClass(this.args[1].trim()):$targets.removeClass(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));jQuery(this.output).append($targets.html()),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["append","prepend","replace"],{tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this18=this;if(0===this.args.length)return this.error("no selector specified");var $insert,$targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));if(""!==this.payload[0].contents)switch(this.args.length>1&&this.self.t8nRe.test(this.args[1])?(($insert=jQuery(document.createElement("span"))).addClass("macro-".concat(this.name,"-insert macro-").concat(this.name,"-in")),setTimeout((function(){return $insert.removeClass("macro-".concat(_this18.name,"-in"))}),Engine.minDomActionDelay)):$insert=jQuery(document.createDocumentFragment()),$insert.wiki(this.payload[0].contents),this.name){case"replace":$targets.empty();case"append":$targets.append($insert);break;case"prepend":$targets.prepend($insert)}else"replace"===this.name&&$targets.empty();Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));$targets.remove(),Config.debug&&this.debugView.modes({hidden:!0})}}),Has.audio){var errorOnePlaybackAction=function(cur,prev){return'only one playback action allowed per invocation, "'.concat(cur,'" cannot be combined with "').concat(prev,'"')};Macro.add("audio",{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track and/or group IDs"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var selected;try{selected=SimpleAudio.select(this.args[0])}catch(ex){return this.error(ex.message)}for(var action,fadeTo,loop,mute,passage,time,volume,args=this.args.slice(1),fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors=[];return args.length<1&&_errors.push("seconds"),args.length<2&&_errors.push("level"),this.error("fadeoverto missing required ".concat(_errors.join(" and ")," value").concat(_errors.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"time":if(0===args.length)return this.error("time missing required seconds value");if(raw=args.shift(),time=Number.parseFloat(raw),Number.isNaN(time)||!Number.isFinite(time))return this.error("cannot parse time: ".concat(raw));break;case"loop":case"unloop":loop="loop"===arg;break;case"goto":if(0===args.length)return this.error("goto missing required passage title");if(raw=args.shift(),passage="object"===_typeof(raw)?raw.link:raw,!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));break;default:return this.error("unknown action: ".concat(arg))}}try{if(null!=volume&&selected.volume(volume),null!=time&&selected.time(time),null!=mute&&selected.mute(mute),null!=loop&&selected.loop(loop),null!=passage){var nsEnded="ended.macros.macro-".concat(this.name,"_goto");selected.off(nsEnded).one(nsEnded,(function(){selected.off(nsEnded),Engine.play(passage)}))}switch(action){case"fade":selected.fade(fadeOver,fadeTo);break;case"load":selected.load();break;case"pause":selected.pause();break;case"play":selected.playWhenAllowed();break;case"stop":selected.stop();break;case"unload":selected.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("cacheaudio",{handler:function(){var _this19=this;if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track ID"),this.args.length<2&&errors.push("sources"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim(),oldFmtRe=/^format:\s*([\w-]+)\s*;\s*/i;try{SimpleAudio.tracks.add(id,this.args.slice(1).map((function(source){if(oldFmtRe.test(source)){if(Config.debug)return _this19.error('track ID "'.concat(id,'": format specifier migration required, "format:formatId;" → "formatId|"'));source=source.replace(oldFmtRe,"$1|")}return source})))}catch(ex){return this.error(ex.message)}if(Config.debug&&!SimpleAudio.tracks.get(id).hasSource())return this.error('track ID "'.concat(id,'": no supported audio sources found'));Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var groupId=String(this.args[0]).trim(),trackIds=[],i=1,len=this.payload.length;i<len;++i){if(this.payload[i].args.length<1)return this.error("no track ID specified");trackIds.push(String(this.payload[i].args[0]).trim()),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.groups.add(groupId,trackIds)}catch(ex){return this.error(ex.message)}Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no list ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");var playlist=Macro.get("playlist");if(null!==playlist.from&&"createplaylist"!==playlist.from)return this.error("a playlist has already been defined with <<setplaylist>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var listId=String(this.args[0]).trim(),trackObjs=[],i=1,len=this.payload.length;i<len;++i){if(0===this.payload[i].args.length)return this.error("no track ID specified");for(var trackObj={id:String(this.payload[i].args[0]).trim()},args=this.payload[i].args.slice(1);args.length>0;){var arg=args.shift(),raw=void 0,parsed=void 0;switch(arg){case"copy":case"own":trackObj.own=!0;break;case"rate":args.length>0&&args.shift();break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),parsed=Number.parseFloat(raw),Number.isNaN(parsed)||!Number.isFinite(parsed))return this.error("cannot parse volume: ".concat(raw));trackObj.volume=parsed;break;default:return this.error("unknown action: ".concat(arg))}}trackObjs.push(trackObj),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.lists.add(listId,trackObjs)}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="createplaylist"),Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var action,mute,muteOnHide,volume,args=this.args.slice(0);args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"mute":case"unmute":mute="mute"===arg;break;case"muteonhide":case"nomuteonhide":muteOnHide="muteonhide"===arg;break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=mute&&SimpleAudio.mute(mute),null!=muteOnHide&&SimpleAudio.muteOnHidden(muteOnHide),null!=volume&&SimpleAudio.volume(volume),action){case"load":SimpleAudio.load();break;case"stop":SimpleAudio.stop();break;case"unload":SimpleAudio.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("playlist",{from:null,handler:function(){var list,args,action,from=this.self.from;if(null===from)return this.error("no playlists have been created");if("createplaylist"===from){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("list ID"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));list=SimpleAudio.lists.get(id),args=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");list=SimpleAudio.lists.get("setplaylist"),args=this.args.slice(0)}for(var fadeTo,loop,mute,shuffle,volume,fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"skip":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors2=[];return args.length<1&&_errors2.push("seconds"),args.length<2&&_errors2.push("level"),this.error("fadeoverto missing required ".concat(_errors2.join(" and ")," value").concat(_errors2.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"loop":case"unloop":loop="loop"===arg;break;case"shuffle":case"unshuffle":shuffle="shuffle"===arg;break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=volume&&list.volume(volume),null!=mute&&list.mute(mute),null!=loop&&list.loop(loop),null!=shuffle&&list.shuffle(shuffle),action){case"fade":list.fade(fadeOver,fadeTo);break;case"load":list.load();break;case"pause":list.pause();break;case"play":list.playWhenAllowed();break;case"skip":list.skip();break;case"stop":list.stop();break;case"unload":list.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("removeaudiogroup",{handler:function(){if(0===this.args.length)return this.error("no group ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.groups.has(id))return this.error('group "'.concat(id,'" does not exist'));SimpleAudio.groups.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));SimpleAudio.lists.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("waitforaudio",{skipArgs:!0,handler:function(){SimpleAudio.loadWithScreen()}}),Macro.add("setplaylist",{handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var playlist=Macro.get("playlist");if(null!==playlist.from&&"setplaylist"!==playlist.from)return this.error("playlists have already been defined with <<createplaylist>>");try{SimpleAudio.lists.add("setplaylist",this.args.slice(0))}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="setplaylist"),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){SimpleAudio.select(":all").stop(),Config.debug&&this.debugView.modes({hidden:!0})}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeaudiogroup","removeplaylist","waitforaudio","setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){Config.debug&&this.debugView.modes({hidden:!0})}});Macro.add("done",{skipArgs:!0,tags:null,handler:function(){var contents=this.payload[0].contents.trim();""!==contents&&setTimeout(this.createShadowWrapper((function(){return $.wiki(contents)})),Engine.minDomActionDelay)}}),Macro.add("goto",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?void setTimeout((function(){return Engine.play(passage)}),Engine.minDomActionDelay):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){var delay,_this20=this;if(0===this.args.length)return this.error("no time value specified");try{delay=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper((function(){var frag=document.createDocumentFragment();new Wikifier(frag,_this20.payload[0].contents);var $output=$wrapper;transition&&($output=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-repeat-in")}),Engine.minDomActionDelay)})),delay)},registerInterval:function(callback,delay){var _this21=this;if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null;timerId=setInterval((function(){if(State.passage!==passage||State.turns!==turn)return clearInterval(timerId),void timers.delete(timerId);var timerIdCache;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(timerIdCache=TempState.repeatTimerId),TempState.repeatTimerId=timerId,callback.call(_this21)}finally{void 0!==timerIdCache?TempState.repeatTimerId=timerIdCache:delete TempState.repeatTimerId,TempState.break=null}}),delay),timers.add(timerId),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearInterval(timerId)})),timers.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var timers=Macro.get("repeat").timers,timerId=TempState.repeatTimerId;clearInterval(timerId),timers.delete(timerId),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var i,items=[];try{items.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(ex){return this.error("".concat(ex.message," in <<timed>>"))}if(this.payload.length>1)try{var len;for(i=1,len=this.payload.length;i<len;++i)items.push({name:this.payload[i].name,source:this.payload[i].source,delay:0===this.payload[i].args.length?items[items.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[i].args[0])),content:this.payload[i].contents})}catch(ex){return this.error("".concat(ex.message," in <<next>> (#").concat(i,")"))}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper((function(item){var frag=document.createDocumentFragment();new Wikifier(frag,item.content);var $output=$wrapper;Config.debug&&"next"===item.name&&($output=jQuery(new DebugView($output[0],"macro",item.name,item.source).output)),transition&&($output=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-timed-in")}),Engine.minDomActionDelay)})),items)},registerTimeout:function(callback,items){if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null,nextItem=items.shift();timerId=setTimeout((function worker(){if(timers.delete(timerId),State.passage===passage&&State.turns===turn){var curItem=nextItem;null!=(nextItem=items.shift())&&(timerId=setTimeout(worker,nextItem.delay),timers.add(timerId)),callback.call(this,curItem)}}),nextItem.delay),timers.add(timerId),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearTimeout(timerId)})),timers.clear()})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var widgetCode,widgetName=this.args[0],isNonVoid=this.args.length>1&&"container"===this.args[1];if(Macro.has(widgetName)){if(!Macro.get(widgetName).isWidget)return this.error('cannot clobber existing macro "'.concat(widgetName,'"'));Macro.delete(widgetName)}try{var widgetDef={isWidget:!0,handler:(widgetCode=this.payload[0].contents,function(){var shadowStore={};State.temporary.hasOwnProperty("args")&&(shadowStore._args=State.temporary.args),State.temporary.args=_toConsumableArray(this.args),State.temporary.args.raw=this.args.raw,State.temporary.args.full=this.args.full,this.addShadow("_args"),isNonVoid&&(State.temporary.hasOwnProperty("contents")&&(shadowStore._contents=State.temporary.contents),State.temporary.contents=this.payload[0].contents,this.addShadow("_contents")),State.variables.hasOwnProperty("args")&&(shadowStore.$args=State.variables.args),State.variables.args=State.temporary.args,this.addShadow("$args");try{var resFrag=document.createDocumentFragment(),errList=[];if(new Wikifier(resFrag,widgetCode),Array.from(resFrag.querySelectorAll(".error")).forEach((function(errEl){errList.push(errEl.textContent)})),0!==errList.length)return this.error("error".concat(errList.length>1?"s":""," within widget code (").concat(errList.join("; "),")"));this.output.appendChild(resFrag)}catch(ex){return this.error("cannot execute widget: ".concat(ex.message))}finally{shadowStore.hasOwnProperty("_args")?State.temporary.args=shadowStore._args:delete State.temporary.args,isNonVoid&&(shadowStore.hasOwnProperty("_contents")?State.temporary.contents=shadowStore._contents:delete State.temporary.contents),shadowStore.hasOwnProperty("$args")?State.variables.args=shadowStore.$args:delete State.variables.args}})};isNonVoid&&(widgetDef.tags=[]),Macro.add(widgetName,widgetDef),Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error('cannot create widget macro "'.concat(widgetName,'": ').concat(ex.message))}}})}();var Dialog=function(){var _$overlay=null,_$dialog=null,_$dialogTitle=null,_$dialogBody=null,_lastActive=null,_scrollbarWidth=0,_dialogObserver=null;function dialogClose(ev){return _$dialogBody.trigger(":dialogclosing"),jQuery(document).off(".dialog-close"),_dialogObserver?(_dialogObserver.disconnect(),_dialogObserver=null):_$dialogBody.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),_$dialog.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),_$overlay.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),_$dialogTitle.empty(),_$dialogBody.empty().removeClass(),null!==_lastActive&&(jQuery(_lastActive).focus(),_lastActive=null),ev&&ev.data&&"function"==typeof ev.data.closeFn&&ev.data.closeFn(ev),_$dialogBody.trigger(":dialogclose"),_$dialogBody.trigger(":dialogclosed"),Dialog}function dialogIsOpen(classNames){return _$dialog.hasClass("open")&&(!classNames||classNames.splitOrEmpty(/\s+/).every((function(cn){return _$dialogBody.hasClass(cn)})))}function dialogOpen(options,closeFn){_$dialogBody.trigger(":dialogopening");var top=jQuery.extend({top:50},options).top;return dialogIsOpen()||(_lastActive=safeActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),_$overlay.addClass("open"),null!==_$dialogBody[0].querySelector("img")&&_$dialogBody.imagesLoaded().always((function(){return _resizeHandler({data:{top:top}})})),jQuery("body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0),_$dialog.css(_calcPosition(top)).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),Has.mutationObserver?(_dialogObserver=new MutationObserver((function(mutations){for(var i=0;i<mutations.length;++i)if("childList"===mutations[i].type){_resizeHandler({data:{top:top}});break}}))).observe(_$dialogBody[0],{childList:!0,subtree:!0}):_$dialogBody.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),jQuery(document).one("click.dialog-close",".ui-close",{closeFn:closeFn},(function(ev){dialogClose(ev)})).one("keypress.dialog-close",".ui-close",(function(ev){13!==ev.which&&32!==ev.which||jQuery(this).trigger("click")})),_$dialogBody.trigger(":dialogopen"),_$dialogBody.trigger(":dialogopened"),Dialog}function _calcPosition(topPos){var top=null!=topPos?topPos:50,$parent=jQuery(window),dialogPos={left:"",right:"",top:"",bottom:""};_$dialog.css(dialogPos);var horzSpace=$parent.width()-_$dialog.outerWidth(!0)-1,vertSpace=$parent.height()-_$dialog.outerHeight(!0)-1;return horzSpace<=32+_scrollbarWidth&&(vertSpace-=_scrollbarWidth),vertSpace<=32+_scrollbarWidth&&(horzSpace-=_scrollbarWidth),dialogPos.left=dialogPos.right=horzSpace<=32?16:horzSpace/2>>0,dialogPos.top=vertSpace<=32?dialogPos.bottom=16:vertSpace/2>top?top:dialogPos.bottom=vertSpace/2>>0,Object.keys(dialogPos).forEach((function(key){""!==dialogPos[key]&&(dialogPos[key]+="px")})),dialogPos}function _resizeHandler(ev){var top=ev&&ev.data&&void 0!==ev.data.top?ev.data.top:50;"block"===_$dialog.css("display")&&(_$dialog.css({display:"none"}),_$dialog.css(jQuery.extend({display:""},_calcPosition(top))))}return Object.freeze(Object.defineProperties({},{append:{value:function(){var _$dialogBody2;return(_$dialogBody2=_$dialogBody).append.apply(_$dialogBody2,arguments),Dialog}},body:{value:function(){return _$dialogBody.get(0)}},close:{value:dialogClose},init:{value:function(){if(!document.getElementById("ui-dialog")){_scrollbarWidth=function(){var scrollbarWidth;try{var inner=document.createElement("p"),outer=document.createElement("div");inner.style.width="100%",inner.style.height="200px",outer.style.position="absolute",outer.style.left="0px",outer.style.top="0px",outer.style.width="100px",outer.style.height="100px",outer.style.visibility="hidden",outer.style.overflow="hidden",outer.appendChild(inner),document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="auto";var w2=inner.offsetWidth;w1===w2&&(w2=outer.clientWidth),document.body.removeChild(outer),scrollbarWidth=w1-w2}catch(ex){}return scrollbarWidth||17}();var $elems=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1>'+'<button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'.concat(L10n.get("close"),'"></button>')+'</div><div id="ui-dialog-body"></div></div>');_$overlay=jQuery($elems.find("#ui-overlay").get(0)),_$dialog=jQuery($elems.find("#ui-dialog").get(0)),_$dialogTitle=jQuery($elems.find("#ui-dialog-title").get(0)),_$dialogBody=jQuery($elems.find("#ui-dialog-body").get(0)),$elems.insertBefore("body>script#script-sugarcube")}}},isOpen:{value:dialogIsOpen},open:{value:dialogOpen},resize:{value:function(data){return _resizeHandler("object"===_typeof(data)?{data:data}:undefined)}},setup:{value:function(title,classNames){return _$dialogBody.empty().removeClass(),null!=classNames&&_$dialogBody.addClass(classNames),_$dialogTitle.empty().append((null!=title?String(title):"")||" "),_$dialogBody.get(0)}},wiki:{value:function(){var _$dialogBody3;return(_$dialogBody3=_$dialogBody).wiki.apply(_$dialogBody3,arguments),Dialog}},addClickHandler:{value:function(targets,options,startFn,doneFn,closeFn){return jQuery(targets).ariaClick((function(ev){ev.preventDefault(),"function"==typeof startFn&&startFn(ev),dialogOpen(options,closeFn),"function"==typeof doneFn&&doneFn(ev)}))}}}))}(),Engine=function(){var States=Util.toEnum({Idle:"idle",Playing:"playing",Rendering:"rendering"}),_initDebugViews=[],_state=States.Idle,_lastPlay=null,_outlinePatch=null,_updating=null;function engineGo(offset){var succeded=State.go(offset);return succeded&&engineShow(),succeded}function engineShow(){return enginePlay(State.passage,!0)}function enginePlay(title,noHistory){var passageReadyOutput,passageDoneOutput,passageTitle=title;if(_state=States.Playing,TempState={},State.clearTemporary(),"function"==typeof Config.navigation.override)try{var overrideTitle=Config.navigation.override(passageTitle);overrideTitle&&(passageTitle=overrideTitle)}catch(ex){}var passage=Story.get(passageTitle);if(jQuery.event.trigger({type:":passageinit",passage:passage}),Object.keys(prehistory).forEach((function(task){"function"==typeof prehistory[task]&&prehistory[task].call(passage,task)})),noHistory||State.create(passage.title),document.body.className&&(document.body.className=""),_lastPlay=Util.now(),Object.keys(predisplay).forEach((function(task){"function"==typeof predisplay[task]&&predisplay[task].call(passage,task)})),Story.has("PassageReady"))try{passageReadyOutput=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(ex){console.error(ex),Alert.error("PassageReady",ex.message)}_state=States.Rendering;var dataTags=passage.tags.length>0?passage.tags.join(" "):null,passageEl=document.createElement("div");jQuery(passageEl).attr({id:passage.domId,"data-passage":passage.title,"data-tags":dataTags}).addClass("passage ".concat(passage.className)),jQuery(document.body).attr("data-tags",dataTags).addClass(passage.className),jQuery(document.documentElement).attr("data-tags",dataTags),jQuery.event.trigger({type:":passagestart",content:passageEl,passage:passage}),Object.keys(prerender).forEach((function(task){"function"==typeof prerender[task]&&prerender[task].call(passage,passageEl,task)})),Story.has("PassageHeader")&&new Wikifier(passageEl,Story.get("PassageHeader").processText()),passageEl.appendChild(passage.render()),Story.has("PassageFooter")&&new Wikifier(passageEl,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:passageEl,passage:passage}),Object.keys(postrender).forEach((function(task){"function"==typeof postrender[task]&&postrender[task].call(passage,passageEl,task)}));var debugView,containerEl=document.getElementById("passages");if(containerEl.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&Has.transitionEndEvent?_toConsumableArray(containerEl.childNodes).forEach((function(outgoing){var $outgoing=jQuery(outgoing);if(outgoing.nodeType===Node.ELEMENT_NODE&&$outgoing.hasClass("passage")){if($outgoing.hasClass("passage-out"))return;$outgoing.attr({id:"out-".concat($outgoing.attr("id")),"aria-live":"off"}).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?$outgoing.on(Has.transitionEndEvent,(function(ev){ev.propertyName===Config.passages.transitionOut&&$outgoing.remove()})):setTimeout((function(){return $outgoing.remove()}),Math.max(40,Config.passages.transitionOut))}else $outgoing.remove()})):jQuery(containerEl).empty()),jQuery(passageEl).addClass("passage-in").appendTo(containerEl),setTimeout((function(){return jQuery(passageEl).removeClass("passage-in")}),40),Story.has("StoryDisplayTitle")?null===_updating&&Config.ui.updateStoryElements||setDisplayTitle(Story.get("StoryDisplayTitle").processText()):Config.passages.displayTitles&&passage.title!==Config.passages.start&&(document.title="".concat(passage.title," | ").concat(Story.title)),window.scroll(0,0),_state=States.Playing,Story.has("PassageDone"))try{passageDoneOutput=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(ex){console.error(ex),Alert.error("PassageDone",ex.message)}(jQuery.event.trigger({type:":passagedisplay",content:passageEl,passage:passage}),Object.keys(postdisplay).forEach((function(task){"function"==typeof postdisplay[task]&&postdisplay[task].call(passage,task)})),null!==_updating?_updating.forEach((function(pair){jQuery(pair.element).empty(),new Wikifier(pair.element,Story.get(pair.passage).processText().trim())})):Config.ui.updateStoryElements&&UIBar.update(),Config.debug)&&(null!=passageReadyOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady")).modes({hidden:!0}),debugView.append(passageReadyOutput),jQuery(passageEl).prepend(debugView.output)),null!=passageDoneOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone")).modes({hidden:!0}),debugView.append(passageDoneOutput),jQuery(passageEl).append(debugView.output)),1===State.turns&&_initDebugViews.length>0&&jQuery(passageEl).prepend(_initDebugViews));switch(jQuery("#story").find("a[href]:not(.link-external)").addClass("link-external").end().find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"object":passage.tags.some((function(tag){return Config.saves.autosave.includes(tag)}))&&Save.autosave.save();break;case"function":Config.saves.autosave()&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",content:passageEl,passage:passage}),_state=States.Idle,_lastPlay=Util.now(),passageEl}function _hideOutlines(){_outlinePatch.set("*:focus{outline:none;}")}return Object.freeze(Object.defineProperties({},{States:{value:States},minDomActionDelay:{value:40},init:{value:function(){var _lastOutlineEvent;jQuery("#init-no-js,#init-lacking").remove(),function(){var $elems=jQuery(document.createDocumentFragment()),markup=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(markup){UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),$elems.append(markup);var $passages=$elems.find("#passages");if(0===$passages.length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage');$passages.empty().not("[aria-live]").attr("aria-live","polite").end(),$elems.find("[data-init-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-init-passage" content attribute'));var passage=el.getAttribute("data-init-passage").trim();if(el.hasAttribute("data-passage"))throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> must not contain a "data-passage" content attribute'));if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&jQuery(el).empty().wiki(Story.get(passage).processText().trim())}));var updating=[];$elems.find("[data-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-passage" content attribute'));var passage=el.getAttribute("data-passage").trim();if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&updating.push({passage:passage,element:el})})),updating.length>0&&(_updating=updating),Config.ui.updateStoryElements=!1}else $elems.append('<div id="story" role="main"><div id="passages" aria-live="polite"></div></div>');$elems.insertBefore("body>script#script-sugarcube")}(),_outlinePatch=new StyleWrapper(jQuery(document.createElement("style")).attr({id:"style-aria-outlines",type:"text/css"}).appendTo(document.head).get(0)),_hideOutlines(),jQuery(document).on("mousedown.aria-outlines keydown.aria-outlines",(function(ev){ev.type!==_lastOutlineEvent&&(_lastOutlineEvent=ev.type,"keydown"===ev.type?_outlinePatch.clear():_hideOutlines())}))}},start:{value:function(){if(Story.getAllInit().forEach((function(passage){try{var debugBuffer=Wikifier.wikifyEval(passage.text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","".concat(passage.title," [init-tagged]"),"".concat(passage.title," [init-tagged]"));debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("".concat(passage.title," [init-tagged]"),"object"===_typeof(ex)?ex.message:ex)}})),Story.has("StoryInit"))try{var debugBuffer=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("StoryInit","object"===_typeof(ex)?ex.message:ex)}if(null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'.concat(Config.passages.start,'") not found'));if(jQuery(document.documentElement).focus(),State.restore())engineShow();else{var loadStart=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!1,UI.buildAutoload(),Dialog.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(loadStart=!Save.autosave.load())}loadStart&&enginePlay(Config.passages.start)}}},restart:{value:function(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}},state:{get:function(){return _state}},isIdle:{value:function(){return _state===States.Idle}},isPlaying:{value:function(){return _state!==States.Idle}},isRendering:{value:function(){return _state===States.Rendering}},lastPlay:{get:function(){return _lastPlay}},goTo:{value:function(idx){var succeded=State.goTo(idx);return succeded&&engineShow(),succeded}},go:{value:engineGo},backward:{value:function(){return engineGo(-1)}},forward:{value:function(){return engineGo(1)}},show:{value:engineShow},play:{value:enginePlay},display:{value:function(title,link,option){var noHistory=!1;switch(option){case undefined:break;case"replace":case"back":noHistory=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'.concat(option,'"; please notify the developer'))}enginePlay(title,noHistory)}}}))}(),Passage=(_tagsToSkip=/^(?:debug|nobr|passage|widget|twine\..*)$/i,function(){function Passage(title,el){var _this22=this;_classCallCheck(this,Passage),Object.defineProperties(this,{title:{value:Util.unescape(title)},element:{value:el||null},tags:{value:Object.freeze(el&&el.hasAttribute("tags")?Array.from(new Set(el.getAttribute("tags").trim().splitOrEmpty(/\s+/))):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-".concat(Util.slugify(this.title))},classes:{value:Object.freeze(0===this.tags.length?[]:_this22.tags.filter((function(tag){return!_tagsToSkip.test(tag)})).map((function(tag){return Util.slugify(tag)})))}})}return _createClass(Passage,[{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var passage=Util.escapeMarkup(this.title),mesg="".concat(L10n.get("errorTitle"),": ").concat(L10n.get("errorNonexistentPassage",{passage:passage}));return'<div class="error-view"><span class="error">'.concat(mesg,"</span></div>")}return this.element.textContent.replace(/\r/g,"")}},{key:"description",value:function(){var descriptions=Config.passages.descriptions;switch(_typeof(descriptions)){case"boolean":if(descriptions)return this.title;break;case"object":if(descriptions.hasOwnProperty(this.title))return descriptions[this.title];break;case"function":var result=descriptions.call(this);if(result)return result}return null===this._excerpt&&(this._excerpt=Passage.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){if(null==this.element)return this.text;if(this.tags.includes("Twine.image"))return"[img[".concat(this.text,"]]");var processed=this.text;return Config.passages.onProcess&&(processed=Config.passages.onProcess.call(null,{title:this.title,tags:this.tags,text:processed})),(Config.passages.nobr||this.tags.includes("nobr"))&&(processed=processed.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),processed}},{key:"render",value:function(options){var frag=document.createDocumentFragment();return new Wikifier(frag,this.processText(),options),this._excerpt=Passage.getExcerptFromNode(frag),frag}}],[{key:"getExcerptFromNode",value:function(node,count){if(!node.hasChildNodes())return"";var excerpt=node.textContent.trim();if(""!==excerpt){var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})"));excerpt=excerpt.replace(/\s+/g," ").match(excerptRe)}return excerpt?"".concat(excerpt[1],"…"):"…"}},{key:"getExcerptFromText",value:function(text,count){if(""===text)return"";var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})")),excerpt=text.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*?)(?:(?:\||->|<-)[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(excerptRe);return excerpt?"".concat(excerpt[1],"…"):"…"}}]),Passage}()),_tagsToSkip,Save=function(){var Type=Util.toEnum({Autosave:"autosave",Disk:"disk",Serialize:"serialize",Slot:"slot"}),_slotsUBound=-1,_onLoadHandlers=new Set,_onSaveHandlers=new Set;function savesObjGet(){var saves=storage.get("saves");return null===saves?{autosave:null,slots:_appendSlots([],Config.saves.slots)}:saves}function savesObjClear(){return storage.delete("saves"),!0}function autosaveOk(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function slotsOk(){return"cookie"!==storage.name&&-1!==_slotsUBound}function slotsCount(){if(!slotsOk())return 0;for(var saves=savesObjGet(),count=0,i=0,iend=saves.slots.length;i<iend;++i)null!==saves.slots[i]&&++count;return count}function _appendSlots(array,num){for(var i=0;i<num;++i)array.push(null);return array}function _savesObjIsEmpty(saves){for(var slots=saves.slots,isSlotsEmpty=!0,i=0,iend=slots.length;i<iend;++i)if(null!==slots[i]){isSlotsEmpty=!1;break}return null===saves.autosave&&isSlotsEmpty}function _savesObjSave(saves){return _savesObjIsEmpty(saves)?(storage.delete("saves"),!0):storage.set("saves",saves)}function _savesObjUpdate(saveObj){if(null==saveObj||"object"!==_typeof(saveObj))return!1;var updated=!1;return saveObj.hasOwnProperty("state")&&saveObj.state.hasOwnProperty("delta")&&saveObj.state.hasOwnProperty("index")||(saveObj.hasOwnProperty("data")?(delete saveObj.mode,saveObj.state={delta:State.deltaEncode(saveObj.data)},delete saveObj.data):saveObj.state.hasOwnProperty("delta")?saveObj.state.hasOwnProperty("index")||delete saveObj.state.mode:(delete saveObj.state.mode,saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history),saveObj.state.index=saveObj.state.delta.length-1,updated=!0),saveObj.state.hasOwnProperty("rseed")&&(saveObj.state.seed=saveObj.state.rseed,delete saveObj.state.rseed,saveObj.state.delta.forEach((function(_,i,delta){delta[i].hasOwnProperty("rcount")&&(delta[i].pull=delta[i].rcount,delete delta[i].rcount)})),updated=!0),(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired||saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired&&delete saveObj.state.expired,(saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.expired=[],saveObj.state.hasOwnProperty("unique")&&(saveObj.state.expired.push(saveObj.state.unique),delete saveObj.state.unique),saveObj.state.hasOwnProperty("last")&&(saveObj.state.expired.push(saveObj.state.last),delete saveObj.state.last)),updated=!0),updated}function _marshal(supplemental,details){if(null!=supplemental&&"object"!==_typeof(supplemental))throw new Error("supplemental parameter must be an object");var saveObj=Object.assign({},supplemental,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(saveObj.version=Config.saves.version),_onSaveHandlers.forEach((function(fn){return fn(saveObj,details)})),saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history,saveObj}function _unmarshal(saveObj){try{if(_savesObjUpdate(saveObj),!saveObj||!saveObj.hasOwnProperty("id")||!saveObj.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(saveObj.state.history=State.deltaDecode(saveObj.state.delta),delete saveObj.state.delta,_onLoadHandlers.forEach((function(fn){return fn(saveObj)})),saveObj.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(saveObj.state),Engine.show()}catch(ex){return UI.alert("".concat(ex.message.toUpperFirst(),".</p><p>").concat(L10n.get("aborting"),".")),!1}return!0}return Object.freeze(Object.defineProperties({},{init:{value:function(){if("cookie"===storage.name)return savesObjClear(),Config.saves.autoload=undefined,Config.saves.autosave=undefined,Config.saves.slots=0,!1;var saves=savesObjGet(),updated=!1;Array.isArray(saves)&&(saves={autosave:null,slots:saves},updated=!0),Config.saves.slots!==saves.slots.length&&(Config.saves.slots<saves.slots.length?(saves.slots.reverse(),saves.slots=saves.slots.filter((function(val){return!(null===val&&this.count>0)||(--this.count,!1)}),{count:saves.slots.length-Config.saves.slots}),saves.slots.reverse()):Config.saves.slots>saves.slots.length&&_appendSlots(saves.slots,Config.saves.slots-saves.slots.length),updated=!0),_savesObjUpdate(saves.autosave)&&(updated=!0);for(var i=0;i<saves.slots.length;++i)_savesObjUpdate(saves.slots[i])&&(updated=!0);return _savesObjIsEmpty(saves)&&(storage.delete("saves"),updated=!1),updated&&_savesObjSave(saves),_slotsUBound=saves.slots.length-1,!0}},get:{value:savesObjGet},clear:{value:savesObjClear},ok:{value:function(){return autosaveOk()||slotsOk()}},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:autosaveOk},has:{value:function(){return null!==savesObjGet().autosave}},get:{value:function(){return savesObjGet().autosave}},load:{value:function(){var saves=savesObjGet();return null!==saves.autosave&&_unmarshal(saves.autosave)}},save:{value:function(title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var saves=savesObjGet(),supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.autosave=_marshal(supplemental,{type:Type.Autosave}),_savesObjSave(saves)}},delete:{value:function(){var saves=savesObjGet();return saves.autosave=null,_savesObjSave(saves)}}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:slotsOk},length:{get:function(){return _slotsUBound+1}},isEmpty:{value:function(){return 0===slotsCount()}},count:{value:slotsCount},has:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])}},get:{value:function(slot){if(slot<0||slot>_slotsUBound)return null;var saves=savesObjGet();return slot>=saves.slots.length?null:saves.slots[slot]}},load:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])&&_unmarshal(saves.slots[slot])}},save:{value:function(slot,title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),!1;if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();if(slot>=saves.slots.length)return!1;var supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.slots[slot]=_marshal(supplemental,{type:Type.Slot}),_savesObjSave(saves)}},delete:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length)&&(saves.slots[slot]=null,_savesObjSave(saves))}}}))},export:{value:function(filename,metadata){if("function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed()){var str,now,MM,DD,hh,mm,ss,baseName=null==filename?Story.domId:(str=filename,Util.sanitizeFilename(str).replace(/[_\s\u2013\u2014-]+/g,"-")),saveName="".concat(baseName,"-").concat((now=new Date,MM=now.getMonth()+1,DD=now.getDate(),hh=now.getHours(),mm=now.getMinutes(),ss=now.getSeconds(),MM<10&&(MM="0".concat(MM)),DD<10&&(DD="0".concat(DD)),hh<10&&(hh="0".concat(hh)),mm<10&&(mm="0".concat(mm)),ss<10&&(ss="0".concat(ss)),"".concat(now.getFullYear()).concat(MM).concat(DD,"-").concat(hh).concat(mm).concat(ss)),".save"),supplemental=null==metadata?{}:{metadata:metadata},saveObj=LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Disk})));saveAs(new Blob([saveObj],{type:"text/plain;charset=UTF-8"}),saveName)}else Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed"))}},import:{value:function(event){var file=event.target.files[0],reader=new FileReader;jQuery(reader).one("loadend",(function(){if(reader.error){var ex=reader.error;UI.alert("".concat(L10n.get("errorSaveDiskLoadFailed").toUpperFirst()," (").concat(ex.name,": ").concat(ex.message,").</p><p>").concat(L10n.get("aborting"),"."))}else{var saveObj;try{saveObj=JSON.parse(/\.json$/i.test(file.name)||/^\{/.test(reader.result)?reader.result:LZString.decompressFromBase64(reader.result))}catch(ex){}_unmarshal(saveObj)}})),reader.readAsText(file)}},serialize:{value:function(metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),null;var supplemental=null==metadata?{}:{metadata:metadata};return LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Serialize})))}},deserialize:{value:function(base64Str){var saveObj;try{saveObj=JSON.parse(LZString.decompressFromBase64(base64Str))}catch(ex){}return _unmarshal(saveObj)?saveObj.metadata:null}},onLoad:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onLoad.add handler parameter must be a function (received: ".concat(valueType,")"));_onLoadHandlers.add(handler)}},clear:{value:function(){_onLoadHandlers.clear()}},delete:{value:function(handler){return _onLoadHandlers.delete(handler)}},size:{get:function(){return _onLoadHandlers.size}}}))},onSave:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onSave.add handler parameter must be a function (received: ".concat(valueType,")"));_onSaveHandlers.add(handler)}},clear:{value:function(){_onSaveHandlers.clear()}},delete:{value:function(handler){return _onSaveHandlers.delete(handler)}},size:{get:function(){return _onSaveHandlers.size}}}))}}))}(),Setting=function(){var Types=Util.toEnum({Header:0,Toggle:1,List:2,Range:3}),_definitions=[];function settingsCreate(){return Object.create(null)}function settingsSave(){var savedSettings=settingsCreate();return Object.keys(settings).length>0&&_definitions.filter((function(def){return def.type!==Types.Header&&settings[def.name]!==def.default})).forEach((function(def){return savedSettings[def.name]=settings[def.name]})),0===Object.keys(savedSettings).length?(storage.delete("settings"),!0):storage.set("settings",savedSettings)}function settingsLoad(){var defaultSettings=settingsCreate(),loadedSettings=storage.get("settings")||settingsCreate();_definitions.filter((function(def){return def.type!==Types.Header})).forEach((function(def){return defaultSettings[def.name]=def.default})),window.SugarCube.settings=settings=Object.assign(defaultSettings,loadedSettings)}function settingsClear(){return window.SugarCube.settings=settings=settingsCreate(),storage.delete("settings"),!0}function definitionsAdd(type,name,def){if(arguments.length<3){var errors=[];throw arguments.length<1&&errors.push("type"),arguments.length<2&&errors.push("name"),arguments.length<3&&errors.push("definition"),new Error("missing parameters, no ".concat(errors.join(" or ")," specified"))}if("object"!==_typeof(def))throw new TypeError("definition parameter must be an object");if(definitionsHas(name))throw new Error('cannot clobber existing setting "'.concat(name,'"'));var str,pos,definition={type:type,name:name,label:"string"==typeof def.label?def.label.trim():""};if("string"==typeof def.desc){var desc=def.desc.trim();""!==desc&&(definition.desc=desc)}switch(type){case Types.Header:break;case Types.Toggle:definition.default=!!def.default;break;case Types.List:if(!def.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(def.list))throw new TypeError("list must be an array");if(0===def.list.length)throw new Error("list must not be empty");if(definition.list=Object.freeze(def.list),null==def.default)definition.default=def.list[0];else{var defaultIndex=def.list.indexOf(def.default);if(-1===defaultIndex)throw new Error("list does not contain default");definition.default=def.list[defaultIndex]}break;case Types.Range:if(!def.hasOwnProperty("min"))throw new Error("no min specified");if("number"!=typeof def.min||Number.isNaN(def.min)||!Number.isFinite(def.min))throw new TypeError("min must be a finite number");if(!def.hasOwnProperty("max"))throw new Error("no max specified");if("number"!=typeof def.max||Number.isNaN(def.max)||!Number.isFinite(def.max))throw new TypeError("max must be a finite number");if(!def.hasOwnProperty("step"))throw new Error("no step specified");if("number"!=typeof def.step||Number.isNaN(def.step)||!Number.isFinite(def.step)||def.step<=0)throw new TypeError("step must be a finite number greater than zero");var stepValidate=function(value){if(fracDigits>0){var ma=Number("".concat(def.min,"e").concat(fracDigits)),sa=Number("".concat(def.step,"e").concat(fracDigits)),_va=Number("".concat(value,"e").concat(fracDigits))-ma;return Number("".concat(_va-_va%sa+ma,"e-").concat(fracDigits))}var va=value-def.min;return va-va%def.step+def.min},fracDigits=(str=String(def.step),-1===(pos=str.lastIndexOf("."))?0:str.length-pos-1);if(stepValidate(def.max)!==def.max)throw new RangeError("max (".concat(def.max,") is not a multiple of the step (").concat(def.step,") plus the min (").concat(def.min,")"));if(definition.max=def.max,definition.min=def.min,definition.step=def.step,null==def.default)definition.default=def.max;else{if("number"!=typeof def.default||Number.isNaN(def.default)||!Number.isFinite(def.default))throw new TypeError("default must be a finite number");if(def.default<def.min)throw new RangeError("default (".concat(def.default,") is less than min (").concat(def.min,")"));if(def.default>def.max)throw new RangeError("default (".concat(def.default,") is greater than max (").concat(def.max,")"));definition.default=def.default}break;default:throw new Error("unknown Setting type: ".concat(type))}"function"==typeof def.onInit&&(definition.onInit=Object.freeze(def.onInit)),"function"==typeof def.onChange&&(definition.onChange=Object.freeze(def.onChange)),_definitions.push(Object.freeze(definition))}function definitionsHas(name){return _definitions.some((function(definition){return definition.name===name}))}function definitionsGet(name){return _definitions.find((function(definition){return definition.name===name}))}return Object.freeze(Object.defineProperties({},{Types:{value:Types},init:{value:function(){if(storage.has("options")){var old=storage.get("options");null!==old&&(window.SugarCube.settings=settings=Object.assign(settingsCreate(),old)),settingsSave(),storage.delete("options")}settingsLoad(),_definitions.forEach((function(def){if(def.hasOwnProperty("onInit")){var thisArg={name:def.name,value:settings[def.name],default:def.default};def.hasOwnProperty("list")&&(thisArg.list=def.list),def.onInit.call(thisArg)}}))}},create:{value:settingsCreate},save:{value:settingsSave},load:{value:settingsLoad},clear:{value:settingsClear},reset:{value:function(name){if(0===arguments.length)settingsClear(),settingsLoad();else{if(null==name||!definitionsHas(name))throw new Error('nonexistent setting "'.concat(name,'"'));var def=definitionsGet(name);def.type!==Types.Header&&(settings[name]=def.default)}return settingsSave()}},forEach:{value:function(callback,thisArg){_definitions.forEach(callback,thisArg)}},add:{value:definitionsAdd},addHeader:{value:function(name,desc){definitionsAdd(Types.Header,name,{desc:desc})}},addToggle:{value:function(){for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++)args[_key16]=arguments[_key16];definitionsAdd.apply(void 0,[Types.Toggle].concat(args))}},addList:{value:function(){for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];definitionsAdd.apply(void 0,[Types.List].concat(args))}},addRange:{value:function(){for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];definitionsAdd.apply(void 0,[Types.Range].concat(args))}},isEmpty:{value:function(){return 0===_definitions.length}},has:{value:definitionsHas},get:{value:definitionsGet},delete:{value:function definitionsDelete(name){definitionsHas(name)&&delete settings[name];for(var i=0;i<_definitions.length;++i)if(_definitions[i].name===name){_definitions.splice(i,1),definitionsDelete(name);break}}}}))}(),Story=function(){var _passages={},_inits=[],_scripts=[],_styles=[],_widgets=[],_title="",_ifId="",_domId="";function _storySetTitle(rawTitle){if(null==rawTitle)throw new Error("story title must not be null or undefined");var title=Util.unescape(String(rawTitle)).trim();if(""===title)throw new Error("story title must not be empty or consist solely of whitespace");if(document.title=_title=title,""===(_domId=Util.slugify(_title)))if(""!==_ifId)_domId=_ifId;else for(var i=0,len=_title.length;i<len;++i){var _Util$charAndPosAt2=Util.charAndPosAt(_title,i),char=_Util$charAndPosAt2.char,start=_Util$charAndPosAt2.start,end=_Util$charAndPosAt2.end;_domId+=char.codePointAt(0).toString(16),i+=end-start}}return Object.freeze(Object.defineProperties({},{load:{value:function(){var validationCodeTags=["init","widget"],validationNoCodeTagPassages=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"];function validateStartingPassage(passage){if(passage.tags.includesAny(validationCodeTags))throw new Error('starting passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(passage.tags.filter((function(tag){return validationCodeTags.includes(tag)})).sort().join('", "'),'"'))}function validateSpecialPassages(passage){if(validationNoCodeTagPassages.includes(passage.title)){for(var _len19=arguments.length,tags=new Array(_len19>1?_len19-1:0),_key19=1;_key19<_len19;_key19++)tags[_key19-1]=arguments[_key19];throw new Error('special passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(tags.sort().join('", "'),'"'))}var codeTags=[].concat(validationCodeTags),foundTags=[];if(passage.tags.forEach((function(tag){codeTags.includes(tag)&&foundTags.push.apply(foundTags,_toConsumableArray(codeTags.delete(tag)))})),foundTags.length>1)throw new Error('passage "'.concat(passage.title,'" contains multiple special tags; invalid: "').concat(foundTags.sort().join('", "'),'"'))}var $storydata=jQuery("tw-storydata"),startNode=$storydata.attr("startnode")||"";Config.passages.start=null,Config.debug=/\bdebug\b/.test($storydata.attr("options")),$storydata.children("style").each((function(i){_styles.push(new Passage("tw-user-style-".concat(i),this))})),$storydata.children("script").each((function(i){_scripts.push(new Passage("tw-user-script-".concat(i),this))})),$storydata.children('tw-passagedata:not([tags~="Twine.private"],[tags~="annotation"])').each((function(){var $this=jQuery(this),pid=$this.attr("pid")||"",passage=new Passage($this.attr("name"),this);pid===startNode&&""!==startNode?(Config.passages.start=passage.title,validateStartingPassage(passage),_passages[passage.title]=passage):passage.tags.includes("init")?(validateSpecialPassages(passage,"init"),_inits.push(passage)):passage.tags.includes("widget")?(validateSpecialPassages(passage,"widget"),_widgets.push(passage)):_passages[passage.title]=passage})),_ifId=$storydata.attr("ifid"),_storySetTitle("SugarCube Guide"),Config.saves.id=Story.domId}},init:{value:function(){var storyStyle;storyStyle=document.createElement("style"),new StyleWrapper(storyStyle).add(_styles.map((function(style){return style.text.trim()})).join("\n")),jQuery(storyStyle).appendTo(document.head).attr({id:"style-story",type:"text/css"});for(var i=0;i<_scripts.length;++i)try{Scripting.evalJavaScript(_scripts[i].text)}catch(ex){console.error(ex),Alert.error(_scripts[i].title,"object"===_typeof(ex)?ex.message:ex)}for(var _i8=0;_i8<_widgets.length;++_i8)try{Wikifier.wikifyEval(_widgets[_i8].processText())}catch(ex){console.error(ex),Alert.error(_widgets[_i8].title,"object"===_typeof(ex)?ex.message:ex)}}},title:{get:function(){return _title}},domId:{get:function(){return _domId}},ifId:{get:function(){return _ifId}},add:{value:function(passage){if(!(passage instanceof Passage))throw new TypeError("Story.add passage parameter must be an instance of Passage");var title=passage.title;return!_passages.hasOwnProperty(title)&&(_passages[title]=passage,!0)}},has:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":return _passages.hasOwnProperty(String(title));case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.has title parameter cannot be ".concat(type))}},get:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":var id=String(title);return _passages.hasOwnProperty(id)?_passages[id]:new Passage(id||"(unknown)");case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.get title parameter cannot be ".concat(type))}},getAllInit:{value:function(){return Object.freeze(Array.from(_inits))}},getAllRegular:{value:function(){return Object.freeze(Object.assign({},_passages))}},getAllScript:{value:function(){return Object.freeze(Array.from(_scripts))}},getAllStylesheet:{value:function(){return Object.freeze(Array.from(_styles))}},getAllWidget:{value:function(){return Object.freeze(Array.from(_widgets))}},lookup:{value:function(key,value){var sortKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];"object"===_typeof(passage[key])&&null!==passage[key]?passage[key]instanceof Array&&passage[key].some((function(m){return Util.sameValueZero(m,value)}))&&results.push(passage):Util.sameValueZero(passage[key],value)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}},lookupWith:{value:function(predicate){var sortKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof predicate)throw new TypeError("Story.lookupWith predicate parameter must be a function");var results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];predicate(passage)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}}}))}(),UI=function(){function uiAssembleLinkList(passage,listEl){var list=listEl,debugState=Config.debug,cleanState=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==list&&(list=document.createElement("ul"));var frag=document.createDocumentFragment();new Wikifier(frag,Story.get(passage).processText().trim());var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "));for(;frag.hasChildNodes();){var node=frag.firstChild;if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.nodeName.toUpperCase()){var li=document.createElement("li");list.appendChild(li),li.appendChild(node)}else frag.removeChild(node)}}finally{Config.cleanupWikifierOutput=cleanState,Config.debug=debugState}return list}function uiOpenAlert(message){jQuery(Dialog.setup(L10n.get("alertTitle"),"alert")).append("<p>".concat(message,'</p><ul class="buttons">')+'<li><button id="alert-ok" class="ui-close">'.concat(L10n.get(["alertOk","ok"]),"</button></li>")+"</ul>");for(var _len20=arguments.length,args=new Array(_len20>1?_len20-1:0),_key20=1;_key20<_len20;_key20++)args[_key20-1]=arguments[_key20];Dialog.open.apply(Dialog,args)}function uiBuildAutoload(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>".concat(L10n.get("autoloadPrompt"),'</p><ul class="buttons">')+'<li><button id="autoload-ok" class="ui-close">'.concat(L10n.get(["autoloadOk","ok"]),"</button></li>")+'<li><button id="autoload-cancel" class="ui-close">'.concat(L10n.get(["autoloadCancel","cancel"]),"</button></li>")+"</ul>"),jQuery(document).one("click.autoload",".ui-close",(function(ev){var isAutoloadOk="autoload-ok"===ev.target.id;jQuery(document).one(":dialogclosed",(function(){isAutoloadOk&&Save.autosave.load()||Engine.play(Config.passages.start)}))})),!0}function uiBuildJumpto(){var list=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(list);for(var expired=State.expired.length,i=State.size-1;i>=0;--i)if(i!==State.activeIndex){var passage=Story.get(State.history[i].title);passage&&passage.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(idx){return function(){return jQuery(document).one(":dialogclosed",(function(){return Engine.goTo(idx)}))}}(i)).addClass("ui-close").text("".concat(L10n.get("jumptoTurn")," ").concat(expired+i+1,": ").concat(passage.description()))).appendTo(list)}list.hasChildNodes()||jQuery(list).append("<li><a><em>".concat(L10n.get("jumptoUnavailable"),"</em></a></li>"))}function uiBuildRestart(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>".concat(L10n.get("restartPrompt"),'</p><ul class="buttons">')+'<li><button id="restart-ok">'.concat(L10n.get(["restartOk","ok"]),"</button></li>")+'<li><button id="restart-cancel" class="ui-close">'.concat(L10n.get(["restartCancel","cancel"]),"</button></li>")+"</ul>").find("#restart-ok").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){return Engine.restart()})),Dialog.close()})),!0}function uiBuildSaves(){var savesAllowed="function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed();function createActionItem(bId,bClass,bText,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId)).html(bText);return bClass&&$btn.addClass(bClass),bAction?$btn.ariaClick(bAction):$btn.ariaDisabled(!0),jQuery(document.createElement("li")).append($btn)}var $dialogBody=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),savesOk=Save.ok(),fileOk=Has.fileAPI&&(Config.saves.tryDiskOnMobile||!Browser.isMobile.any());if(savesOk&&$dialogBody.append(function(){function createButton(bId,bClass,bText,bSlot,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId,"-").concat(bSlot)).addClass(bId).html(bText);return bClass&&$btn.addClass(bClass),bAction?"auto"===bSlot?$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelAuto"))},(function(){return bAction()})):$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelSlot")," ").concat(bSlot+1)},(function(){return bAction(bSlot)})):$btn.ariaDisabled(!0),$btn}var saves=Save.get(),$tbody=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var $tdSlot=jQuery(document.createElement("td")),$tdLoad=jQuery(document.createElement("td")),$tdDesc=jQuery(document.createElement("td")),$tdDele=jQuery(document.createElement("td"));jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo($tdSlot),saves.autosave?($tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),"auto",(function(){jQuery(document).one(":dialogclosed",(function(){return Save.autosave.load()}))}))),jQuery(document.createElement("div")).text(saves.autosave.title).appendTo($tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.autosave.date?"".concat(new Date(saves.autosave.date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo($tdDesc),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto",(function(){Save.autosave.delete(),uiBuildSaves()})))):($tdLoad.append(createButton("load",null,L10n.get("savesLabelLoad"),"auto")),$tdDesc.addClass("empty").text("•  •  •"),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody)}for(var i=0,iend=saves.slots.length;i<iend;++i){var _$tdSlot=jQuery(document.createElement("td")),_$tdLoad=jQuery(document.createElement("td")),_$tdDesc=jQuery(document.createElement("td")),_$tdDele=jQuery(document.createElement("td"));_$tdSlot.append(document.createTextNode(i+1)),saves.slots[i]?(_$tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),i,(function(slot){jQuery(document).one(":dialogclosed",(function(){return Save.slots.load(slot)}))}))),jQuery(document.createElement("div")).text(saves.slots[i].title).appendTo(_$tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.slots[i].date?"".concat(new Date(saves.slots[i].date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo(_$tdDesc),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i,(function(slot){Save.slots.delete(slot),uiBuildSaves()})))):(_$tdLoad.append(createButton("save","ui-close",L10n.get("savesLabelSave"),i,savesAllowed?Save.slots.save:null)),_$tdDesc.addClass("empty").text("•  •  •"),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i))),jQuery(document.createElement("tr")).append(_$tdSlot).append(_$tdLoad).append(_$tdDesc).append(_$tdDele).appendTo($tbody)}return jQuery(document.createElement("table")).attr("id","saves-list").append($tbody)}()),savesOk||fileOk){var $btnBar=jQuery(document.createElement("ul")).addClass("buttons").appendTo($dialogBody);return fileOk&&($btnBar.append(createActionItem("export","ui-close",L10n.get("savesLabelExport"),savesAllowed?function(){return Save.export()}:null)),$btnBar.append(createActionItem("import",null,L10n.get("savesLabelImport"),(function(){return $dialogBody.find("#saves-import-file").trigger("click")}))),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",(function(ev){jQuery(document).one(":dialogclosed",(function(){return Save.import(ev)})),Dialog.close()})).appendTo($dialogBody)),savesOk&&$btnBar.append(createActionItem("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),uiBuildSaves()}:null)),!0}return uiOpenAlert(L10n.get("savesIncapable")),!1}function uiBuildSettings(){var $dialogBody=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach((function(control){if(control.type===Setting.Types.Header){var _name=control.name,_id=Util.slugify(_name),$header=jQuery(document.createElement("div")),$heading=jQuery(document.createElement("h2"));return $header.attr("id","header-body-".concat(_id)).append($heading).appendTo($dialogBody),$heading.attr("id","header-heading-".concat(_id)).wiki(_name),void(control.desc&&jQuery(document.createElement("p")).attr("id","header-desc-".concat(_id)).wiki(control.desc).appendTo($header))}var $control,name=control.name,id=Util.slugify(name),$setting=jQuery(document.createElement("div")),$label=jQuery(document.createElement("label")),$controlBox=jQuery(document.createElement("div"));switch(jQuery(document.createElement("div")).append($label).append($controlBox).appendTo($setting),control.desc&&jQuery(document.createElement("p")).attr("id","setting-desc-".concat(id)).wiki(control.desc).appendTo($setting),$label.attr({id:"setting-label-".concat(id),for:"setting-control-".concat(id)}).wiki(control.label),null==settings[name]&&(settings[name]=control.default),control.type){case Setting.Types.Toggle:$control=jQuery(document.createElement("button")),settings[name]?$control.addClass("enabled").text(L10n.get("settingsOn")):$control.text(L10n.get("settingsOff")),$control.ariaClick((function(){settings[name]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[name]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[name]=!0),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default})}));break;case Setting.Types.List:$control=jQuery(document.createElement("select"));for(var i=0,iend=control.list.length;i<iend;++i)jQuery(document.createElement("option")).val(i).text(control.list[i]).appendTo($control);$control.val(control.list.indexOf(settings[name])).attr("tabindex",0).on("change",(function(){settings[name]=control.list[Number(this.value)],Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,list:control.list})}));break;case Setting.Types.Range:($control=jQuery(document.createElement("input"))).attr({type:"range",min:control.min,max:control.max,step:control.step,value:settings[name],tabindex:0}).on("change input",(function(){settings[name]=Number(this.value),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,min:control.min,max:control.max,step:control.step})})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$control.trigger("change"))}))}$control.attr("id","setting-control-".concat(id)).appendTo($controlBox),$setting.attr("id","setting-body-".concat(id)).appendTo($dialogBody)})),$dialogBody.append('<ul class="buttons">'+'<li><button id="settings-ok" class="ui-close">'.concat(L10n.get(["settingsOk","ok"]),"</button></li>")+'<li><button id="settings-reset">'.concat(L10n.get("settingsReset"),"</button></li>")+"</ul>").find("#settings-reset").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){Setting.reset(),window.location.reload()})),Dialog.close()})),!0}function uiBuildShare(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(uiAssembleLinkList("StoryShare"))}catch(ex){return console.error(ex),Alert.error("StoryShare",ex.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:uiAssembleLinkList},alert:{value:uiOpenAlert},jumpto:{value:function(){uiBuildJumpto(),Dialog.open.apply(Dialog,arguments)}},restart:{value:function(){uiBuildRestart(),Dialog.open.apply(Dialog,arguments)}},saves:{value:function(){uiBuildSaves(),Dialog.open.apply(Dialog,arguments)}},settings:{value:function(){uiBuildSettings(),Dialog.open.apply(Dialog,arguments)}},share:{value:function(){uiBuildShare(),Dialog.open.apply(Dialog,arguments)}},buildAutoload:{value:uiBuildAutoload},buildJumpto:{value:uiBuildJumpto},buildRestart:{value:uiBuildRestart},buildSaves:{value:uiBuildSaves},buildSettings:{value:uiBuildSettings},buildShare:{value:uiBuildShare},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.update()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:uiBuildAutoload},buildDialogJumpto:{value:uiBuildJumpto},buildDialogRestart:{value:uiBuildRestart},buildDialogSaves:{value:uiBuildSaves},buildDialogSettings:{value:uiBuildSettings},buildDialogShare:{value:uiBuildShare},buildLinkListFromPassage:{value:uiAssembleLinkList}}))}(),UIBar=function(){var _$uiBar=null;function uiBarStow(noAnimation){var $story;_$uiBar&&!_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.addClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay));return this}function uiBarUpdate(){if(Story.has("StoryDisplayTitle")&&setDisplayTitle(Story.get("StoryDisplayTitle").processText()),_$uiBar){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var menuStory=document.getElementById("menu-story");if(null!==menuStory&&(jQuery(menuStory).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",menuStory)}catch(ex){console.error(ex),Alert.error("StoryMenu",ex.message)}}}return Object.freeze(Object.defineProperties({},{destroy:{value:function(){_$uiBar&&(_$uiBar.hide(),jQuery(document).off(".ui-bar"),jQuery(document.head).find("#style-ui-bar").remove(),_$uiBar.remove(),_$uiBar=null)}},hide:{value:function(){return _$uiBar&&_$uiBar.hide(),this}},init:{value:function(){if(!document.getElementById("ui-bar")){var toggleLabel,backwardLabel,jumptoLabel,forwardLabel,$backward,$forward,$elems=(toggleLabel=L10n.get("uiBarToggle"),backwardLabel=L10n.get("uiBarBackward"),jumptoLabel=L10n.get("uiBarJumpto"),forwardLabel=L10n.get("uiBarForward"),jQuery(document.createDocumentFragment()).append('<div id="ui-bar" aria-live="polite"><div id="ui-bar-tray">'+'<button id="ui-bar-toggle" tabindex="0" title="'.concat(toggleLabel,'" aria-label="').concat(toggleLabel,'"></button>')+'<div id="ui-bar-history">'+'<button id="history-backward" tabindex="0" title="'.concat(backwardLabel,'" aria-label="').concat(backwardLabel,'"></button>')+'<button id="history-jumpto" tabindex="0" title="'.concat(jumptoLabel,'" aria-label="').concat(jumptoLabel,'"></button>')+'<button id="history-forward" tabindex="0" title="'.concat(forwardLabel,'" aria-label="').concat(forwardLabel,'"></button>')+'</div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core">'+'<li id="menu-item-saves"><a tabindex="0">'.concat(L10n.get("savesTitle"),"</a></li>")+'<li id="menu-item-settings"><a tabindex="0">'.concat(L10n.get("settingsTitle"),"</a></li>")+'<li id="menu-item-restart"><a tabindex="0">'.concat(L10n.get("restartTitle"),"</a></li>")+'<li id="menu-item-share"><a tabindex="0">'.concat(L10n.get("shareTitle"),"</a></li>")+"</ul></nav></div></div>"));_$uiBar=jQuery($elems.find("#ui-bar").get(0)),$elems.insertBefore("body>script#script-sugarcube"),jQuery(document).on(":historyupdate.ui-bar",($backward=jQuery("#history-backward"),$forward=jQuery("#history-forward"),function(){$backward.ariaDisabled(State.length<2),$forward.ariaDisabled(State.length===State.size)}))}}},isHidden:{value:function(){return _$uiBar&&"none"===_$uiBar.css("display")}},isStowed:{value:function(){return _$uiBar&&_$uiBar.hasClass("stowed")}},show:{value:function(){return _$uiBar&&_$uiBar.show(),this}},start:{value:function(){_$uiBar&&(("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&uiBarStow(!0),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},(function(){return _$uiBar.toggleClass("stowed")})),Config.history.controls?(jQuery("#history-backward").ariaDisabled(State.length<2).ariaClick({label:L10n.get("uiBarBackward")},(function(){return Engine.backward()})),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},(function(){return UI.jumpto()})):jQuery("#history-jumpto").remove(),jQuery("#history-forward").ariaDisabled(State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},(function(){return Engine.forward()}))):jQuery("#ui-bar-history").remove(),Story.has("StoryDisplayTitle")?setDisplayTitle(Story.get("StoryDisplayTitle").processText()):jQuery("#story-title").text(Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||uiBarUpdate(),jQuery("#menu-item-saves a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSaves(),Dialog.open()})).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():jQuery("#menu-item-settings a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSettings(),Dialog.open()})).text(L10n.get("settingsTitle")),jQuery("#menu-item-restart a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildRestart(),Dialog.open()})).text(L10n.get("restartTitle")),Story.has("StoryShare")?jQuery("#menu-item-share a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildShare(),Dialog.open()})).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove())}},stow:{value:uiBarStow},unstow:{value:function(noAnimation){var $story;return _$uiBar&&_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.removeClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay)),this}},update:{value:uiBarUpdate},setStoryElements:{value:uiBarUpdate}}))}(),DebugBar=function(){var _variableRe=new RegExp("^".concat(Patterns.variable,"$")),_numericKeyRe=/^\d+$/,_watchList=[],_$debugBar=null,_$watchBody=null,_$watchList=null,_$turnSelect=null,_stowed=!0;function debugBarStow(){_$debugBar.css("right","-".concat(_$debugBar.outerWidth(),"px")),_stowed=!0,_updateSession()}function debugBarUnstow(){_$debugBar.css("right",0),_stowed=!1,_updateSession()}function debugBarToggle(){_stowed?debugBarUnstow():debugBarStow()}function debugBarWatchAdd(varName){_variableRe.test(varName)&&(_watchList.pushUnique(varName),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession())}function debugBarWatchAddAll(){Object.keys(State.variables).map((function(name){return _watchList.pushUnique("$".concat(name))})),Object.keys(State.temporary).map((function(name){return _watchList.pushUnique("_".concat(name))})),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchClear(){for(var i=_watchList.length-1;i>=0;--i)_watchList.pop();_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDelete(varName){_watchList.delete(varName),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDisable(){_debugBarWatchDisableNoUpdate(),_updateSession()}function debugBarWatchEnable(){_debugBarWatchEnableNoUpdate(),_updateSession()}function debugBarWatchIsEnabled(){return!_$watchBody.attr("hidden")}function debugBarWatchToggle(){_$watchBody.attr("hidden")?debugBarWatchEnable():debugBarWatchDisable()}function _debugBarWatchDisableNoUpdate(){_$watchBody.attr({"aria-hidden":!0,hidden:"hidden"})}function _debugBarWatchEnableNoUpdate(){_$watchBody.removeAttr("aria-hidden hidden")}function _clearSession(){session.delete("debugState")}function _hasSession(){return session.has("debugState")}function _updateSession(){session.set("debugState",{stowed:_stowed,watchList:_watchList,watchEnabled:debugBarWatchIsEnabled(),viewsEnabled:DebugView.isEnabled()})}function _updateWatchBody(){if(0!==_watchList.length){for(var delLabel=L10n.get("debugBarDeleteWatch"),$table=jQuery(document.createElement("table")),$tbody=jQuery(document.createElement("tbody")),_loop4=function(i,len){var varName=_watchList[i],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary,$row=jQuery(document.createElement("tr")),$delBtn=jQuery(document.createElement("button")),$code=jQuery(document.createElement("code"));$delBtn.addClass("watch-delete").attr("data-name",varName).ariaClick({one:!0,label:delLabel},(function(){return debugBarWatchDelete(varName)})),$code.text(_toWatchString(store[varKey])),jQuery(document.createElement("td")).append($delBtn).appendTo($row),jQuery(document.createElement("td")).text(varName).appendTo($row),jQuery(document.createElement("td")).append($code).appendTo($row),$row.appendTo($tbody)},i=0,len=_watchList.length;i<len;++i)_loop4(i);$table.append($tbody),_$watchBody.empty().append($table)}else _$watchBody.empty().append("<div>".concat(L10n.get("debugBarNoWatches"),"</div>"))}function _updateWatchList(){var svn=Object.keys(State.variables),tvn=Object.keys(State.temporary);if(0!==svn.length||0!==tvn.length){var names=[].concat(_toConsumableArray(svn.map((function(name){return"$".concat(name)}))),_toConsumableArray(tvn.map((function(name){return"_".concat(name)})))).sort(),options=document.createDocumentFragment();names.delete(_watchList);for(var i=0,len=names.length;i<len;++i)jQuery(document.createElement("option")).val(names[i]).appendTo(options);_$watchList.empty().append(options)}else _$watchList.empty()}function _updateTurnSelect(){for(var histLen=State.size,expLen=State.expired.length,options=document.createDocumentFragment(),i=0;i<histLen;++i)jQuery(document.createElement("option")).val(i).text("".concat(expLen+i+1,". ").concat(Util.escape(State.history[i].title))).appendTo(options);_$turnSelect.empty().ariaDisabled(histLen<2).append(options).val(State.activeIndex)}function _toWatchString(value){if(null===value)return"null";switch(_typeof(value)){case"number":if(Number.isNaN(value))return"NaN";if(!Number.isFinite(value))return"Infinity";case"boolean":case"symbol":case"undefined":return String(value);case"string":return JSON.stringify(value);case"function":return"Function"}var objType=Util.toStringTag(value);if("Date"===objType)return"Date {".concat(value.toLocaleString(),"}");if("RegExp"===objType)return"RegExp ".concat(value.toString());var result=[];if(value instanceof Array||value instanceof Set){for(var list=value instanceof Array?value:Array.from(value),i=0,len=list.length;i<len;++i)result.push(list.hasOwnProperty(i)?_toWatchString(list[i]):"<empty>");return Object.keys(list).filter((function(key){return!_numericKeyRe.test(key)})).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(list[key])))})),"".concat(objType,"(").concat(list.length,") [").concat(result.join(", "),"]")}return value instanceof Map?(value.forEach((function(val,key){return result.push("".concat(_toWatchString(key)," → ").concat(_toWatchString(val)))})),"".concat(objType,"(").concat(value.size,") {").concat(result.join(", "),"}")):(Object.keys(value).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(value[key])))})),"".concat(objType," {").concat(result.join(", "),"}"))}return Object.freeze(Object.defineProperties({},{init:{value:function(){var barToggleLabel=L10n.get("debugBarToggle"),watchAddLabel=L10n.get("debugBarAddWatch"),watchAllLabel=L10n.get("debugBarWatchAll"),watchNoneLabel=L10n.get("debugBarWatchNone"),watchToggleLabel=L10n.get("debugBarWatchToggle"),viewsToggleLabel=L10n.get("debugBarViewsToggle");jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch">'+"<div>".concat(L10n.get("debugBarNoWatches"),"</div>>")+"</div><div>"+'<button id="debug-bar-watch-toggle" tabindex="0" title="'.concat(watchToggleLabel,'" aria-label="').concat(watchToggleLabel,'">').concat(L10n.get("debugBarLabelWatch"),"</button>")+'<label id="debug-bar-watch-label" for="debug-bar-watch-input">'.concat(L10n.get("debugBarLabelAdd"),"</label>")+'<input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist>'+'<button id="debug-bar-watch-add" tabindex="0" title="'.concat(watchAddLabel,'" aria-label="').concat(watchAddLabel,'"></button>')+'<button id="debug-bar-watch-all" tabindex="0" title="'.concat(watchAllLabel,'" aria-label="').concat(watchAllLabel,'"></button>')+'<button id="debug-bar-watch-none" tabindex="0" title="'.concat(watchNoneLabel,'" aria-label="').concat(watchNoneLabel,'"></button>')+"</div><div>"+'<button id="debug-bar-views-toggle" tabindex="0" title="'.concat(viewsToggleLabel,'" aria-label="').concat(viewsToggleLabel,'">').concat(L10n.get("debugBarLabelViews"),"</button>")+'<label id="debug-bar-turn-label" for="debug-bar-turn-select">'.concat(L10n.get("debugBarLabelTurn"),"</label>")+'<select id="debug-bar-turn-select" tabindex="0"></select></div>'+'<button id="debug-bar-toggle" tabindex="0" title="'.concat(barToggleLabel,'" aria-label="').concat(barToggleLabel,'"></button>')+'</div><div id="debug-bar-hint"></div>').appendTo("body"),_$debugBar=jQuery("#debug-bar"),_$watchBody=jQuery(_$debugBar.find("#debug-bar-watch").get(0)),_$watchList=jQuery(_$debugBar.find("#debug-bar-watch-list").get(0)),_$turnSelect=jQuery(_$debugBar.find("#debug-bar-turn-select").get(0));var $barToggle=jQuery(_$debugBar.find("#debug-bar-toggle").get(0)),$watchToggle=jQuery(_$debugBar.find("#debug-bar-watch-toggle").get(0)),$watchInput=jQuery(_$debugBar.find("#debug-bar-watch-input").get(0)),$watchAdd=jQuery(_$debugBar.find("#debug-bar-watch-add").get(0)),$watchAll=jQuery(_$debugBar.find("#debug-bar-watch-all").get(0)),$watchNone=jQuery(_$debugBar.find("#debug-bar-watch-none").get(0)),$viewsToggle=jQuery(_$debugBar.find("#debug-bar-views-toggle").get(0));$barToggle.ariaClick(debugBarToggle),$watchToggle.ariaClick(debugBarWatchToggle),$watchInput.on(":addwatch",(function(){debugBarWatchAdd(this.value.trim()),this.value=""})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$watchInput.trigger(":addwatch"))})),$watchAdd.ariaClick((function(){return $watchInput.trigger(":addwatch")})),$watchAll.ariaClick(debugBarWatchAddAll),$watchNone.ariaClick(debugBarWatchClear),_$turnSelect.on("change",(function(){Engine.goTo(Number(this.value))})),$viewsToggle.ariaClick((function(){DebugView.toggle(),_updateSession()})),jQuery(document).on(":historyupdate.debug-bar",_updateTurnSelect).on(":passageend.debug-bar",(function(){_updateWatchBody(),_updateWatchList()})).on(":enginerestart.debug-bar",_clearSession),_hasSession()||DebugView.enable()}},isStowed:{value:function(){return _stowed}},start:{value:function(){(function(){if(!_hasSession())return!1;var debugState=session.get("debugState");_stowed=debugState.stowed,_watchList.push.apply(_watchList,_toConsumableArray(debugState.watchList)),debugState.watchEnabled?_debugBarWatchEnableNoUpdate():_debugBarWatchDisableNoUpdate();debugState.viewsEnabled?DebugView.enable():DebugView.disable()})(),_stowed?debugBarStow():debugBarUnstow(),_updateTurnSelect(),_updateWatchBody(),_updateWatchList()}},stow:{value:debugBarStow},toggle:{value:debugBarToggle},unstow:{value:debugBarUnstow},watch:{value:Object.freeze(Object.defineProperties({},{add:{value:debugBarWatchAdd},all:{value:debugBarWatchAddAll},clear:{value:debugBarWatchClear},delete:{value:debugBarWatchDelete},disable:{value:debugBarWatchDisable},enable:{value:debugBarWatchEnable},isEnabled:{value:debugBarWatchIsEnabled},toggle:{value:debugBarWatchToggle}}))}}))}(),LoadScreen=function(){var _locks=new Set,_autoId=0;function loadScreenHide(){jQuery(document.documentElement).removeAttr("data-init")}function loadScreenShow(){jQuery(document.documentElement).attr("data-init","loading")}return Object.freeze(Object.defineProperties({},{init:{value:function(){jQuery(document).on("readystatechange.SugarCube",(function(){_locks.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout((function(){0===_locks.size&&loadScreenHide()}),Math.max(Engine.minDomActionDelay,Config.loadDelay)):loadScreenHide()):loadScreenShow())}))}},clear:{value:function(){jQuery(document).off("readystatechange.SugarCube"),_locks.clear(),loadScreenHide()}},hide:{value:loadScreenHide},show:{value:loadScreenShow},lock:{value:function(){return++_autoId,_locks.add(_autoId),loadScreenShow(),_autoId}},unlock:{value:function(id){if(null==id)throw new Error("LoadScreen.unlock called with a null or undefined ID");_locks.has(id)&&_locks.delete(id),0===_locks.size&&jQuery(document).trigger("readystatechange")}}}))}(),version=Object.freeze({title:"SugarCube",major:2,minor:36,patch:1,prerelease:null,build:9717,date:new Date("2021-12-22T05:37:33.467Z"),extensions:{},toString:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,"+").concat(this.build)},short:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.title," (v").concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,")")},long:function(){return"".concat(this.title," v").concat(this.toString()," (").concat(this.date.toUTCString(),")")}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery((function(){try{var lockId=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Engine.start(),Config.debug&&DebugBar.init();var $window=$(window),vprCheckId=setInterval((function(){$window.width()&&(clearInterval(vprCheckId),UIBar.start(),Config.debug&&DebugBar.start(),jQuery.event.trigger({type:":storyready"}),setTimeout((function(){return LoadScreen.unlock(lockId)}),2*Engine.minDomActionDelay))}),Engine.minDomActionDelay);Object.defineProperty(window,"SugarCube",{value:Object.seal(Object.assign(Object.create(null),{Browser:Browser,Config:Config,Dialog:Dialog,Engine:Engine,Fullscreen:Fullscreen,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Visibility:Visibility,Wikifier:Wikifier,session:session,settings:settings,setup:setup,storage:storage,version:version}))})}catch(ex){return console.error(ex),LoadScreen.clear(),Alert.fatal(null,ex.message,ex)}}))})(window,window.document,jQuery);}
	</script>
</body>
</html>
